From hidave.darkstar at gmail.com  Thu Oct  1 10:49:24 2009
From: hidave.darkstar at gmail.com (Dave Young)
Date: Thu, 1 Oct 2009 16:49:24 +0800
Subject: b43: fix wldev use after free
Message-ID: <20091001084924.GA4170@darkstar>

when rmmod b43, I got following bug message

[  100.121798] BUG: unable to handle kernel paging request at 2f4066fa
[  100.123338] IP: [<f9e9dd57>] b43_unregister_led+0x6/0x1c [b43]
[  100.123338] *pde = 00000000 
[  100.123338] Oops: 0000 [#1] SMP 
[  100.123338] last sysfs file: /sys/devices/pci0000:00/0000:00:1c.1/0000:0c:00.0/ssb0:0/firmware/ssb0:0/loading
[  100.123338] Modules linked in: reiserfs kvm_intel kvm snd_hda_codec_intelhdmi firewire_ohci snd_hda_codec_idt firewire_core b43(-) snd_hda_intel mac80211 snd_hda_codec crc_itu_t cfg80211 snd_hwdep ohci1394 snd_pcm dell_laptop wmi ieee1394 rfkill snd_timer snd_page_alloc
[  100.123338] 
[  100.123338] Pid: 1931, comm: rmmod Not tainted (2.6.31-mm1 #2) Latitude E5400                  
[  100.123338] EIP: 0060:[<f9e9dd57>] EFLAGS: 00010246 CPU: 0
[  100.123338] EIP is at b43_unregister_led+0x6/0x1c [b43]
[  100.123338] EAX: 2f4066fa EBX: 2f4066fa ECX: 00000006 EDX: 00000246
[  100.123338] ESI: f6a59000 EDI: f72030a8 EBP: f6373ec8 ESP: f6373ec4
[  100.123338]  DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068
[  100.123338] Process rmmod (pid: 1931, ti=f6372000 task=f66e0000 task.ti=f6372000)
[  100.123338] Stack:
[  100.123338]  2f406576 f6373ed4 f9e9dd7f f674cda0 f6373ee8 f9e8816e f72030a8 f9ea4b18
[  100.123338] <0> f9ea4b18 f6373ef4 c04bbd57 f7297000 f6373f04 c03f2563 f7297000 f7297034
[  100.123338] <0> f6373f18 c03f2609 f9ea4b18 00000000 c07742fc f6373f2c c03f1aac 00000000
[  100.123338] Call Trace:
[  100.123338]  [<f9e9dd7f>] ? b43_leds_unregister+0x12/0x36 [b43]
[  100.123338]  [<f9e8816e>] ? b43_remove+0x79/0x87 [b43]
[  100.123338]  [<c04bbd57>] ? ssb_device_remove+0x1d/0x29
[  100.123338]  [<c03f2563>] ? __device_release_driver+0x59/0x98
[  100.123338]  [<c03f2609>] ? driver_detach+0x67/0x85
[  100.123338]  [<c03f1aac>] ? bus_remove_driver+0x63/0x7f
[  100.123338]  [<c03f2a04>] ? driver_unregister+0x4d/0x54
[  100.123338]  [<c04bb828>] ? ssb_driver_unregister+0xb/0xd
[  100.123338]  [<f9e9f876>] ? b43_exit+0xd/0x19 [b43]
[  100.123338]  [<c025124b>] ? sys_delete_module+0x17c/0x1e0
[  100.123338]  [<c054c654>] ? do_page_fault+0x29d/0x2a5
[  100.123338]  [<c02032d6>] ? restore_all_notrace+0x0/0x18
[  100.123338]  [<c054c3b7>] ? do_page_fault+0x0/0x2a5
[  100.123338]  [<c020329d>] ? syscall_call+0x7/0xb
[  100.123338] Code: 0f b6 93 d8 03 00 00 e8 16 ff ff ff 0f b6 8b 39 03 00 00 89 f0 0f b6 93 38 03 00 00 e8 01 ff ff ff 5b 5e 5d c3 55 89 e5 53 89 c3 <83> 38 00 74 0e 8d 40 04 e8 de cc 60 c6 c7 03 00 00 00 00 5b 5d 
[  100.123338] EIP: [<f9e9dd57>] b43_unregister_led+0x6/0x1c [b43] SS:ESP 0068:f6373ec4
[  100.123338] CR2: 000000002f4066fa
[  100.953375] ---[ end trace d100c06b1451fbd8 ]---

in b43_remove, b43_one_core_detach free the wldev,
thus following callback which reference wldev will oops.

fix it by call b43_leds_unregister before b43_one_core_detach
if it is the last one in wl->devlist


Signed-off-by: Dave Young <hidave.darkstar at gmail.com>
---
drivers/net/wireless/b43/main.c |    4 +++-
1 file changed, 3 insertions(+), 1 deletion(-)

--- linux-2.6.31.orig/drivers/net/wireless/b43/main.c	2009-10-01 16:17:00.000000000 +0800
+++ linux-2.6.31/drivers/net/wireless/b43/main.c	2009-10-01 16:37:41.000000000 +0800
@@ -4993,11 +4993,13 @@ static void b43_remove(struct ssb_device
 		ieee80211_unregister_hw(wl->hw);
 	}
 
+	if (list_is_last(&wldev->list, &wl->devlist))
+		b43_leds_unregister(wldev);
+
 	b43_one_core_detach(dev);
 
 	if (list_empty(&wl->devlist)) {
 		b43_rng_exit(wl);
-		b43_leds_unregister(wldev);
 		/* Last core on the chip unregistered.
 		 * We can destroy common struct b43_wl.
 		 */


From mb at bu3sch.de  Thu Oct  1 15:54:32 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 1 Oct 2009 15:54:32 +0200
Subject: [PATCH] b43: Don't use struct wldev after detach.
Message-ID: <200910011554.34488.mb@bu3sch.de>

Don't use struct wldev after detach. This fixes an oops on access.

Signed-off-by: Michael Buesch <mb at bu3sch.de>


---
 drivers/net/wireless/b43/leds.c |    4 ++--
 drivers/net/wireless/b43/leds.h |    4 ++--
 drivers/net/wireless/b43/main.c |    2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

--- wireless-testing.orig/drivers/net/wireless/b43/leds.c
+++ wireless-testing/drivers/net/wireless/b43/leds.c
@@ -348,9 +348,9 @@ void b43_leds_register(struct b43_wldev 
 	}
 }
 
-void b43_leds_unregister(struct b43_wldev *dev)
+void b43_leds_unregister(struct b43_wl *wl)
 {
-	struct b43_leds *leds = &dev->wl->leds;
+	struct b43_leds *leds = &wl->leds;
 
 	b43_unregister_led(&leds->led_tx);
 	b43_unregister_led(&leds->led_rx);
--- wireless-testing.orig/drivers/net/wireless/b43/leds.h
+++ wireless-testing/drivers/net/wireless/b43/leds.h
@@ -60,7 +60,7 @@ enum b43_led_behaviour {
 };
 
 void b43_leds_register(struct b43_wldev *dev);
-void b43_leds_unregister(struct b43_wldev *dev);
+void b43_leds_unregister(struct b43_wl *wl);
 void b43_leds_init(struct b43_wldev *dev);
 void b43_leds_exit(struct b43_wldev *dev);
 void b43_leds_stop(struct b43_wldev *dev);
@@ -76,7 +76,7 @@ struct b43_leds {
 static inline void b43_leds_register(struct b43_wldev *dev)
 {
 }
-static inline void b43_leds_unregister(struct b43_wldev *dev)
+static inline void b43_leds_unregister(struct b43_wl *wl)
 {
 }
 static inline void b43_leds_init(struct b43_wldev *dev)
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4997,7 +4997,7 @@ static void b43_remove(struct ssb_device
 
 	if (list_empty(&wl->devlist)) {
 		b43_rng_exit(wl);
-		b43_leds_unregister(wldev);
+		b43_leds_unregister(wl);
 		/* Last core on the chip unregistered.
 		 * We can destroy common struct b43_wl.
 		 */

-- 
Greetings, Michael.


From zajec5polish at gmail.com  Fri Oct  2 17:54:32 2009
From: zajec5polish at gmail.com (=?UTF-8?B?UmFmYcWCIE1pxYJlY2tp?=)
Date: Fri, 2 Oct 2009 17:54:32 +0200
Subject: b43 bug report on kernel's bugzilla
Message-ID: <14b026160910020854w78310df8kc99efee08093e2a6@mail.gmail.com>

If someone would have a moment to check this:
http://bugzilla.kernel.org/show_bug.cgi?id=14181

I post this here, as I am not sure if anyone monitors kernel's
bugzilla for b43 bugs.


From Larry.Finger at lwfinger.net  Fri Oct  2 19:54:34 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 02 Oct 2009 12:54:34 -0500
Subject: [RFC/RFT] b43: Fix PPC crash in rfkill polling on unload
Message-ID: <4ac63e5a.mdsHQ3/FdomgnWKo%Larry.Finger@lwfinger.net>

In Bugzilla No. 14181, a PowerMac G4 crashes on ifdown or
module unload because the rfkill polling has not been stopped.
For the x86 architectures, the attempt to reach a now unmapped
register is not fatal as it is on PPC.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

Michael,

Does this look right?

Larry
---

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4500,6 +4500,7 @@ static void b43_op_stop(struct ieee80211
 	cancel_work_sync(&(wl->beacon_update_trigger));
 
 	mutex_lock(&wl->mutex);
+	wiphy_rfkill_stop_polling(hw->wiphy);
 	if (b43_status(dev) >= B43_STAT_STARTED) {
 		dev = b43_wireless_core_stop(dev);
 		if (!dev)


From fred99 at carolina.rr.com  Fri Oct  2 23:04:24 2009
From: fred99 at carolina.rr.com (fred99 at carolina.rr.com)
Date: Fri, 2 Oct 2009 17:04:24 -0400
Subject: 14e4:4315 DMA Errors (still)
Message-ID: <20091002210424.15P33.401182.root@cdptpa-web23-z01>


Hi Folks -- 
 
I've read in the archives about DMA errors with the LP-PHY, but there didn't 
seem to be any conclusion.  Any guidance on what I can test to get it working?  
It's reproducable on my Lenovo G530 laptop.  (Yes, I know forcing PIO works for 
others, and it works for me too, but I'd like to help testing if I can). 
 
Any guidance on which tests would be most likely to work?  AFAIK, options to 
test include: 
* 64bit kernel (and userland?) 
* Hack b43/dma.c to force fallback to 32bit DMA (as a trial datapoint only) 
* Boot with Mem=2G.  Currently 4G ram is installed. 
* Firmware 5xx 

Or is this a HW design error in the laptop, and I should just live with forcing PIO?
 
My system details: 
* Compat-wireless-2009-09-30 (and also back to 9-21) 
* Fedora Rawhide 32-bit, kernel 2.6.31.1-56.fc12.i686 
* Firmware 478.104 
* Fatal DMA error soon after heavy traffic starts 
 
dmesg extract: 
 
ssb: Sonics Silicon Backplane found on PCI device 0000:04:00.0 
b43-phy0: Broadcom 4312 WLAN found (core revision 15) 
b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1 
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2 
phy0: Selected rate control algorithm 'minstrel' 
Registered led device: b43-phy0::tx 
Registered led device: b43-phy0::rx 
Registered led device: b43-phy0::radio 
Broadcom 43xx driver loaded [ Features: PML, Firmware-ID: FW13 ] 
b43 ssb0:0: firmware: requesting b43/ucode15.fw 
cfg80211: Calling CRDA for country: US 
cfg80211: Regulatory domain changed to country: US 
        (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp) 
        (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm) 
        (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm) 
        (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm) 
        (5490000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm) 
        (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm) 
b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw 
b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw 
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23) 
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz. 
b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5 
b43-phy0 debug: Chip initialized 
b43-phy0 debug: 64-bit DMA initialized 
b43-phy0 debug: QoS enabled 
b43-phy0 debug: Wireless interface started 
b43-phy0 debug: Adding Interface type 2 
ADDRCONF(NETDEV_UP): wlan0: link is not ready 
wlan0: deauthenticating from 00:0c:41:e2:f9:81 by local choice (reason=3) 
wlan0: direct probe to AP 00:0c:41:e2:f9:81 (try 1) 
wlan0: direct probe responded 
wlan0: authenticate with AP 00:0c:41:e2:f9:81 (try 1) 
wlan0: authenticated 
wlan0: associate with AP 00:0c:41:e2:f9:81 (try 1) 
wlan0: RX AssocResp from 00:0c:41:e2:f9:81 (capab=0x411 status=0 aid=2) 
wlan0: associated 
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready 
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
ff:ff:ff:ff:ff:ff 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
NOHZ: local_softirq_pending 08 
wlan0: no IPv6 routers present 
CE: hpet increasing min_delta_ns to 15000 nsec 
b43-phy0 ERROR: Fatal DMA error: 0x00000000, 0x00000400, 0x00000000, 0x00000000, 
0x00000000, 0x00000000 
b43-phy0: Controller RESET (DMA error) ... 
b43-phy0 debug: Wireless interface stopped 
b43-phy0 debug: DMA-64 rx_ring: Used slots 8/64, Failed frames 0/0 = 0.0%, 
Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 256/256, Failed frames 0/7742 = 
0.0%, Average tries 1.37 
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/555 = 
0.0%, Average tries 1.01 
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23) 
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz. 
b43-phy0 debug: Chip initialized 
b43-phy0 debug: 64-bit DMA initialized 
b43-phy0 debug: QoS enabled 
b43-phy0 debug: Wireless interface started 
b43-phy0: Controller restarted 
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 
0x00000000, 0x00000000 
b43-phy0: Controller RESET (DMA error) ... 
b43-phy0 debug: Wireless interface stopped 
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, 
Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 1/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23) 
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz. 
b43-phy0 debug: Chip initialized 
b43-phy0 debug: 64-bit DMA initialized 
b43-phy0 debug: QoS enabled 
b43-phy0 debug: Wireless interface started 
b43-phy0: Controller restarted 
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 
0x00000000, 0x00000000 
b43-phy0: Controller RESET (DMA error) ... 
b43-phy0 debug: Wireless interface stopped 
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, 
Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 
0.0%, Average tries 0.00 
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23) 
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz. 
b43-phy0 debug: Chip initialized 
b43-phy0 debug: 64-bit DMA initialized 
b43-phy0 debug: QoS enabled 
 
etc etc. 
 
regards, .............. Charlie 



From mb at bu3sch.de  Fri Oct  2 20:02:16 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 2 Oct 2009 20:02:16 +0200
Subject: [RFC/RFT] b43: Fix PPC crash in rfkill polling on unload
In-Reply-To: <4ac63e5a.mdsHQ3/FdomgnWKo%Larry.Finger@lwfinger.net>
References: <4ac63e5a.mdsHQ3/FdomgnWKo%Larry.Finger@lwfinger.net>
Message-ID: <200910022002.18859.mb@bu3sch.de>

On Friday 02 October 2009 19:54:34 Larry Finger wrote:
> In Bugzilla No. 14181, a PowerMac G4 crashes on ifdown or
> module unload because the rfkill polling has not been stopped.
> For the x86 architectures, the attempt to reach a now unmapped
> register is not fatal as it is on PPC.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---
> 
> Michael,
> 
> Does this look right?

I don't know how rfkill works, so I can't tell.

> 
> Larry
> ---
> 
> Index: wireless-testing/drivers/net/wireless/b43/main.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/main.c
> +++ wireless-testing/drivers/net/wireless/b43/main.c
> @@ -4500,6 +4500,7 @@ static void b43_op_stop(struct ieee80211
>  	cancel_work_sync(&(wl->beacon_update_trigger));
>  
>  	mutex_lock(&wl->mutex);
> +	wiphy_rfkill_stop_polling(hw->wiphy);
>  	if (b43_status(dev) >= B43_STAT_STARTED) {
>  		dev = b43_wireless_core_stop(dev);
>  		if (!dev)
> 
> 



-- 
Greetings, Michael.


From mb at bu3sch.de  Sat Oct  3 00:57:58 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 3 Oct 2009 00:57:58 +0200
Subject: [PATCH] b43: Protect sanity check against physical device removal
Message-ID: <200910030058.00906.mb@bu3sch.de>

Fix IRQ mask sanity check for physically pulled device.

Tested-by: Andrew Price <andy at andrewprice.me.uk>
Signed-off-by: Michael Buesch <mb at bu3sch.de>

---
 drivers/net/wireless/b43/main.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -3874,6 +3874,7 @@ static struct b43_wldev * b43_wireless_c
 {
 	struct b43_wl *wl = dev->wl;
 	struct b43_wldev *orig_dev;
+	u32 mask;
 
 redo:
 	if (!dev || b43_status(dev) < B43_STAT_STARTED)
@@ -3920,7 +3921,8 @@ redo:
 			goto redo;
 		return dev;
 	}
-	B43_WARN_ON(b43_read32(dev, B43_MMIO_GEN_IRQ_MASK));
+	mask = b43_read32(dev, B43_MMIO_GEN_IRQ_MASK);
+	B43_WARN_ON(mask != 0xFFFFFFFF && mask);
 
 	/* Drain the TX queue */
 	while (skb_queue_len(&wl->tx_queue))

-- 
Greetings, Michael.


From netrolller.3d at gmail.com  Mon Oct  5 14:44:20 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Mon, 5 Oct 2009 14:44:20 +0200
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <20091002210424.15P33.401182.root@cdptpa-web23-z01>
References: <20091002210424.15P33.401182.root@cdptpa-web23-z01>
Message-ID: <69e28c910910050544q2a96939lffe259a211c08ce8@mail.gmail.com>

On Fri, Oct 2, 2009 at 11:04 PM,  <fred99 at carolina.rr.com> wrote:
>
> Hi Folks --
>
> I've read in the archives about DMA errors with the LP-PHY, but there didn't
> seem to be any conclusion. ?Any guidance on what I can test to get it working?
> It's reproducable on my Lenovo G530 laptop. ?(Yes, I know forcing PIO works for
> others, and it works for me too, but I'd like to help testing if I can).
>
> Any guidance on which tests would be most likely to work? ?AFAIK, options to
> test include:
> * 64bit kernel (and userland?)
> * Hack b43/dma.c to force fallback to 32bit DMA (as a trial datapoint only)

Won't work - LP-PHY only supports 64bit DMA.

> * Boot with Mem=2G. ?Currently 4G ram is installed.
> * Firmware 5xx
>
> Or is this a HW design error in the laptop, and I should just live with forcing PIO?
>
> My system details:
> * Compat-wireless-2009-09-30 (and also back to 9-21)
> * Fedora Rawhide 32-bit, kernel 2.6.31.1-56.fc12.i686
> * Firmware 478.104
> * Fatal DMA error soon after heavy traffic starts
>

Try installing a proper wireless-testing kernel (not just
compat-wireless). This issue seems to specifically affect
2.6.31+compat-wireless users (probably something needs to be
backported). 2.6.32-rc1+compat-wireless shoud also work.

> dmesg extract:
>
> ssb: Sonics Silicon Backplane found on PCI device 0000:04:00.0
> b43-phy0: Broadcom 4312 WLAN found (core revision 15)
> b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
> b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
> phy0: Selected rate control algorithm 'minstrel'
> Registered led device: b43-phy0::tx
> Registered led device: b43-phy0::rx
> Registered led device: b43-phy0::radio
> Broadcom 43xx driver loaded [ Features: PML, Firmware-ID: FW13 ]
> b43 ssb0:0: firmware: requesting b43/ucode15.fw
> cfg80211: Calling CRDA for country: US
> cfg80211: Regulatory domain changed to country: US
> ? ? ? ?(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
> ? ? ? ?(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
> ? ? ? ?(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
> ? ? ? ?(5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ?(5490000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ?(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
> b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
> b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
> b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
> b43-phy0 debug: Chip initialized
> b43-phy0 debug: 64-bit DMA initialized
> b43-phy0 debug: QoS enabled
> b43-phy0 debug: Wireless interface started
> b43-phy0 debug: Adding Interface type 2
> ADDRCONF(NETDEV_UP): wlan0: link is not ready
> wlan0: deauthenticating from 00:0c:41:e2:f9:81 by local choice (reason=3)
> wlan0: direct probe to AP 00:0c:41:e2:f9:81 (try 1)
> wlan0: direct probe responded
> wlan0: authenticate with AP 00:0c:41:e2:f9:81 (try 1)
> wlan0: authenticated
> wlan0: associate with AP 00:0c:41:e2:f9:81 (try 1)
> wlan0: RX AssocResp from 00:0c:41:e2:f9:81 (capab=0x411 status=0 aid=2)
> wlan0: associated
> ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
> b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac:
> ff:ff:ff:ff:ff:ff
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> NOHZ: local_softirq_pending 08
> wlan0: no IPv6 routers present
> CE: hpet increasing min_delta_ns to 15000 nsec
> b43-phy0 ERROR: Fatal DMA error: 0x00000000, 0x00000400, 0x00000000, 0x00000000,
> 0x00000000, 0x00000000
> b43-phy0: Controller RESET (DMA error) ...
> b43-phy0 debug: Wireless interface stopped
> b43-phy0 debug: DMA-64 rx_ring: Used slots 8/64, Failed frames 0/0 = 0.0%,
> Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 256/256, Failed frames 0/7742 =
> 0.0%, Average tries 1.37
> b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/555 =
> 0.0%, Average tries 1.01
> b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy0 debug: Chip initialized
> b43-phy0 debug: 64-bit DMA initialized
> b43-phy0 debug: QoS enabled
> b43-phy0 debug: Wireless interface started
> b43-phy0: Controller restarted
> b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000,
> 0x00000000, 0x00000000
> b43-phy0: Controller RESET (DMA error) ...
> b43-phy0 debug: Wireless interface stopped
> b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%,
> Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 1/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy0 debug: Chip initialized
> b43-phy0 debug: 64-bit DMA initialized
> b43-phy0 debug: QoS enabled
> b43-phy0 debug: Wireless interface started
> b43-phy0: Controller restarted
> b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000,
> 0x00000000, 0x00000000
> b43-phy0: Controller RESET (DMA error) ...
> b43-phy0 debug: Wireless interface stopped
> b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%,
> Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> 0.0%, Average tries 0.00
> b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy0 debug: Chip initialized
> b43-phy0 debug: 64-bit DMA initialized
> b43-phy0 debug: QoS enabled
>
> etc etc.
>
> regards, .............. Charlie
>
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From nlhepler at gmail.com  Tue Oct  6 05:27:36 2009
From: nlhepler at gmail.com (Lance Hepler)
Date: Mon, 5 Oct 2009 20:27:36 -0700
Subject: 14e4:4315 DMA Errors (still)
Message-ID: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com>

Hello all,

Like Charlie, I also have DMA errors, and not specifically to
2.6.31+compat-wireless. I have been testing the LP-PHY changes on
2.6.32-rc1/2 and
2.6.32-rc3+b43_Dont_use_struct_wldev_after_detach.patch (so I can
unload the module without an oops) kernels and consistently get DMA
errors while trying to associate to an AP.

First, let me make my experiences explicit. If I cold-boot, sometimes
I can connect using b43 (albeit with a few "NOHZ:
local_softirq_pending 08" errors). Once I sleep+resume, the controller
seems to be put into a broken state, and any subsequent attempt to
connect will fail with a DMA error, even after module unload+reload,
attempts to use the proprietary wl module, or anything else I could
think of (retrying sleep+resume, ifconfig up/down, etc etc). To once
again have use of my wireless card, I will have to cold-boot the
machine.

I am using the latest Moblin 2.1 preview on a Dell Mini 10v with the
latest 478.104 firmware as grabbed from the instructions on
linuxwireless.org.

I'm willing to test basically anything, although I have noted in the
past you have asked users to test the 5xx firmware, which isn't
available in the current git b43-tools package, and requires some
obscure patches and an absurdly large download of linksys source
packages to grab.. Wouldn't it be easier to find a way to grab it from
the STA wl driver "source" available on Broadcom's website
(wlc_hybrid.o_shipped)?

Please see the following logs for expanded info:

>> uname -a
Linux Frogstar 2.6.32-rc3-netbook #1 SMP PREEMPT Mon Oct 5 00:33:22
PDT 2009 i686 i686 i386 GNU/Linux

>> /sbin/lspci -vvnn
00:00.0 Host bridge [0600]: Intel Corporation Mobile 945GME Express
Memory Controller Hub [8086:27ac] (rev 03)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR+ FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort+ >SERR- <PERR- INTx-
	Latency: 0
	Capabilities: <access denied>
	Kernel driver in use: agpgart-intel

00:02.0 VGA compatible controller [0300]: Intel Corporation Mobile
945GME Express Integrated Graphics Controller [8086:27ae] (rev 03)
(prog-if 00 [VGA controller])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin A routed to IRQ 16
	Region 0: Memory at f0000000 (32-bit, non-prefetchable) [size=512K]
	Region 1: I/O ports at 1800 [size=8]
	Region 2: Memory at d0000000 (32-bit, prefetchable) [size=256M]
	Region 3: Memory at f0200000 (32-bit, non-prefetchable) [size=256K]
	Capabilities: <access denied>
	Kernel driver in use: i915

00:02.1 Display controller [0380]: Intel Corporation Mobile
945GM/GMS/GME, 943/940GML Express Integrated Graphics Controller
[8086:27a6] (rev 03)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Region 0: Memory at f0080000 (32-bit, non-prefetchable) [size=512K]
	Capabilities: <access denied>

00:1b.0 Audio device [0403]: Intel Corporation 82801G (ICH7 Family)
High Definition Audio Controller [8086:27d8] (rev 02)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Interrupt: pin A routed to IRQ 22
	Region 0: Memory at f0440000 (64-bit, non-prefetchable) [size=16K]
	Capabilities: <access denied>
	Kernel driver in use: HDA Intel

00:1c.0 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
Express Port 1 [8086:27d0] (rev 02) (prog-if 00 [Normal decode])
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx+
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Bus: primary=00, secondary=02, subordinate=02, sec-latency=0
	I/O behind bridge: 00003000-00003fff
	Memory behind bridge: 40000000-401fffff
	Prefetchable memory behind bridge: 0000000040200000-00000000403fffff
	Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort+ <SERR- <PERR-
	BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
		PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
	Capabilities: <access denied>
	Kernel driver in use: pcieport-driver

00:1c.1 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
Express Port 2 [8086:27d2] (rev 02) (prog-if 00 [Normal decode])
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx+
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Bus: primary=00, secondary=03, subordinate=03, sec-latency=0
	I/O behind bridge: 00004000-00004fff
	Memory behind bridge: f0100000-f01fffff
	Prefetchable memory behind bridge: 0000000040400000-00000000405fffff
	Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort+ <SERR- <PERR-
	BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
		PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
	Capabilities: <access denied>
	Kernel driver in use: pcieport-driver

00:1c.2 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
Express Port 3 [8086:27d4] (rev 02) (prog-if 00 [Normal decode])
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx+
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Bus: primary=00, secondary=04, subordinate=04, sec-latency=0
	I/O behind bridge: 00002000-00002fff
	Memory behind bridge: 40600000-409fffff
	Prefetchable memory behind bridge: 00000000f0500000-00000000f05fffff
	Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort+ <SERR- <PERR-
	BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
		PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
	Capabilities: <access denied>
	Kernel driver in use: pcieport-driver

00:1d.0 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
USB UHCI Controller #1 [8086:27c8] (rev 02) (prog-if 00 [UHCI])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin A routed to IRQ 23
	Region 4: I/O ports at 1820 [size=32]
	Kernel driver in use: uhci_hcd

00:1d.1 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
USB UHCI Controller #2 [8086:27c9] (rev 02) (prog-if 00 [UHCI])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin B routed to IRQ 19
	Region 4: I/O ports at 1840 [size=32]
	Kernel driver in use: uhci_hcd

00:1d.2 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
USB UHCI Controller #3 [8086:27ca] (rev 02) (prog-if 00 [UHCI])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin C routed to IRQ 18
	Region 4: I/O ports at 1860 [size=32]
	Kernel driver in use: uhci_hcd

00:1d.3 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
USB UHCI Controller #4 [8086:27cb] (rev 02) (prog-if 00 [UHCI])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin D routed to IRQ 16
	Region 4: I/O ports at 1880 [size=32]
	Kernel driver in use: uhci_hcd

00:1d.7 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
USB2 EHCI Controller [8086:27cc] (rev 02) (prog-if 20 [EHCI])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin A routed to IRQ 23
	Region 0: Memory at f0444000 (32-bit, non-prefetchable) [size=1K]
	Capabilities: <access denied>
	Kernel driver in use: ehci_hcd

00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge
[8086:2448] (rev e2) (prog-if 01 [Subtractive decode])
	Control: I/O- Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Bus: primary=00, secondary=05, subordinate=05, sec-latency=32
	Secondary status: 66MHz- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort+ <SERR- <PERR-
	BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- >Reset- FastB2B-
		PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
	Capabilities: <access denied>

00:1f.0 ISA bridge [0601]: Intel Corporation 82801GBM (ICH7-M) LPC
Interface Bridge [8086:27b9] (rev 02)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Capabilities: <access denied>

00:1f.2 IDE interface [0101]: Intel Corporation 82801GBM/GHM (ICH7
Family) SATA IDE Controller [8086:27c4] (rev 02) (prog-if 8a [Master
SecP PriP])
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz+ UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0
	Interrupt: pin B routed to IRQ 19
	Region 0: I/O ports at 01f0 [size=8]
	Region 1: I/O ports at 03f4 [size=1]
	Region 2: I/O ports at 0170 [size=8]
	Region 3: I/O ports at 0374 [size=1]
	Region 4: I/O ports at 1810 [size=16]
	Region 5: Memory at 40a00000 (32-bit, non-prefetchable) [size=1K]
	Capabilities: <access denied>
	Kernel driver in use: ata_piix

00:1f.3 SMBus [0c05]: Intel Corporation 82801G (ICH7 Family) SMBus
Controller [8086:27da] (rev 02)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem- BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Interrupt: pin B routed to IRQ 10
	Region 4: I/O ports at 18c0 [size=32]

03:00.0 Network controller [0280]: Broadcom Corporation BCM4312
802.11b/g [14e4:4315] (rev 01)
	Subsystem: Dell Wireless 1397 WLAN Mini-Card [1028:000c]
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Interrupt: pin A routed to IRQ 17
	Region 0: Memory at f0100000 (64-bit, non-prefetchable) [size=16K]
	Capabilities: <access denied>
	Kernel driver in use: b43-pci-bridge
	Kernel modules: wl, ssb

04:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd.
RTL8101E/RTL8102E PCI Express Fast Ethernet controller [10ec:8136]
(rev 02)
	Subsystem: Dell Unknown device [1028:02f4]
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
Stepping- SERR- FastB2B- DisINTx+
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 0, Cache Line Size: 64 bytes
	Interrupt: pin A routed to IRQ 27
	Region 0: I/O ports at 2000 [size=256]
	Region 2: Memory at f0510000 (64-bit, prefetchable) [size=4K]
	Region 4: Memory at f0500000 (64-bit, prefetchable) [size=64K]
	[virtual] Expansion ROM at f0520000 [disabled] [size=128K]
	Capabilities: <access denied>
	Kernel driver in use: r8169


>> dmesg
[  220.487137] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  221.868442] b43-phy1 debug: Chip initialized
[  221.868886] b43-phy1 debug: 64-bit DMA initialized
[  221.869185] b43-phy1 debug: QoS enabled
[  221.878480] b43-phy1 debug: Wireless interface started
[  221.878508] b43-phy1: Controller restarted
[  221.879669] b43-phy1 debug: Wireless interface stopped
[  222.046440] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
[  222.049134] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  223.430374] b43-phy1 debug: Chip initialized
[  223.430846] b43-phy1 debug: 64-bit DMA initialized
[  223.431383] b43-phy1 debug: QoS enabled
[  223.440380] b43-phy1 debug: Wireless interface started
[  223.440404] __ratelimit: 2 callbacks suppressed
[  223.440417] b43-phy1:
[  223.440426] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
[  223.440450] b43-phy1: Controller RESET (DMA error) ...
[  223.440464] Controller restarted
[  223.441218] b43-phy1 debug: Wireless interface stopped
[  223.610596] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
[  223.613314] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  224.997453] b43-phy1 debug: Chip initialized
[  224.997893] b43-phy1 debug: 64-bit DMA initialized
[  224.998190] b43-phy1 debug: QoS enabled
[  225.007481] b43-phy1 debug: Wireless interface started
[  225.007500] b43-phy1: Controller restarted
[  225.007554] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
[  225.007575] b43-phy1: Controller RESET (DMA error) ...
[  225.008102] b43-phy1 debug: Wireless interface stopped
[  225.176380] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
[  225.179102] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  226.560502] b43-phy1 debug: Chip initialized
[  226.560945] b43-phy1 debug: 64-bit DMA initialized
[  226.561243] b43-phy1 debug: QoS enabled
[  226.570534] b43-phy1 debug: Wireless interface started
[  226.570555] b43-phy1: Controller restarted
[  226.570598] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
[  226.570619] b43-phy1: Controller RESET (DMA error) ...
[  226.571146] b43-phy1 debug: Wireless interface stopped
[  226.740453] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
[  226.743139] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  228.125476] b43-phy1 debug: Chip initialized
[  228.125914] b43-phy1 debug: 64-bit DMA initialized
[  228.126213] b43-phy1 debug: QoS enabled
[  228.135381] b43-phy1 debug: Wireless interface started
[  228.135408] b43-phy1: Controller restarted
[  228.135745] b43-phy1 debug: Wireless interface stopped
[  228.304381] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
[  228.307117] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
[  229.687826] b43-phy1 debug: Chip initialized
[  229.688393] b43-phy1 debug: 64-bit DMA initialized
[  229.688680] b43-phy1 debug: QoS enabled
[  229.697865] b43-phy1 debug: Wireless interface started
[  229.697888] __ratelimit: 2 callbacks suppressed
[  229.697900] b43-phy1: Controller restarted
[  229.697947] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
[  229.697968] b43-phy1: Controller RESET (DMA error) ...
[  229.698894] b43-phy1 debug: Wireless interface stopped
{truncated to remove further duplicates of the above load/reset loop}

>> cat ~/build/kernel/.config
#
# Automatically generated make config: don't edit
# Linux kernel version: 2.6.32-rc3
# Sun Oct  4 23:23:27 2009
#
# CONFIG_64BIT is not set
CONFIG_X86_32=y
# CONFIG_X86_64 is not set
CONFIG_X86=y
CONFIG_OUTPUT_FORMAT="elf32-i386"
CONFIG_ARCH_DEFCONFIG="arch/x86/configs/i386_defconfig"
CONFIG_GENERIC_TIME=y
CONFIG_GENERIC_CMOS_UPDATE=y
CONFIG_CLOCKSOURCE_WATCHDOG=y
CONFIG_GENERIC_CLOCKEVENTS=y
CONFIG_GENERIC_CLOCKEVENTS_BROADCAST=y
CONFIG_LOCKDEP_SUPPORT=y
CONFIG_STACKTRACE_SUPPORT=y
CONFIG_HAVE_LATENCYTOP_SUPPORT=y
CONFIG_FAST_CMPXCHG_LOCAL=y
CONFIG_MMU=y
CONFIG_ZONE_DMA=y
CONFIG_GENERIC_ISA_DMA=y
CONFIG_GENERIC_IOMAP=y
CONFIG_GENERIC_BUG=y
CONFIG_GENERIC_HWEIGHT=y
CONFIG_ARCH_MAY_HAVE_PC_FDC=y
# CONFIG_RWSEM_GENERIC_SPINLOCK is not set
CONFIG_RWSEM_XCHGADD_ALGORITHM=y
CONFIG_ARCH_HAS_CPU_IDLE_WAIT=y
CONFIG_GENERIC_CALIBRATE_DELAY=y
# CONFIG_GENERIC_TIME_VSYSCALL is not set
CONFIG_ARCH_HAS_CPU_RELAX=y
CONFIG_ARCH_HAS_DEFAULT_IDLE=y
CONFIG_ARCH_HAS_CACHE_LINE_SIZE=y
CONFIG_HAVE_SETUP_PER_CPU_AREA=y
CONFIG_NEED_PER_CPU_EMBED_FIRST_CHUNK=y
CONFIG_NEED_PER_CPU_PAGE_FIRST_CHUNK=y
# CONFIG_HAVE_CPUMASK_OF_CPU_MAP is not set
CONFIG_ARCH_HIBERNATION_POSSIBLE=y
CONFIG_ARCH_SUSPEND_POSSIBLE=y
# CONFIG_ZONE_DMA32 is not set
CONFIG_ARCH_POPULATES_NODE_MAP=y
# CONFIG_AUDIT_ARCH is not set
CONFIG_ARCH_SUPPORTS_OPTIMIZED_INLINING=y
CONFIG_ARCH_SUPPORTS_DEBUG_PAGEALLOC=y
CONFIG_GENERIC_HARDIRQS=y
CONFIG_GENERIC_HARDIRQS_NO__DO_IRQ=y
CONFIG_GENERIC_IRQ_PROBE=y
CONFIG_GENERIC_PENDING_IRQ=y
CONFIG_USE_GENERIC_SMP_HELPERS=y
CONFIG_X86_32_SMP=y
CONFIG_X86_HT=y
CONFIG_X86_TRAMPOLINE=y
CONFIG_X86_32_LAZY_GS=y
CONFIG_KTIME_SCALAR=y
CONFIG_DEFCONFIG_LIST="/lib/modules/$UNAME_RELEASE/.config"
CONFIG_CONSTRUCTORS=y

#
# General setup
#
CONFIG_EXPERIMENTAL=y
CONFIG_LOCK_KERNEL=y
CONFIG_INIT_ENV_ARG_LIMIT=32
CONFIG_LOCALVERSION="-netbook"
# CONFIG_LOCALVERSION_AUTO is not set
CONFIG_HAVE_KERNEL_GZIP=y
CONFIG_HAVE_KERNEL_BZIP2=y
CONFIG_HAVE_KERNEL_LZMA=y
CONFIG_KERNEL_GZIP=y
# CONFIG_KERNEL_BZIP2 is not set
# CONFIG_KERNEL_LZMA is not set
CONFIG_SWAP=y
CONFIG_SYSVIPC=y
CONFIG_SYSVIPC_SYSCTL=y
CONFIG_POSIX_MQUEUE=y
CONFIG_POSIX_MQUEUE_SYSCTL=y
CONFIG_BSD_PROCESS_ACCT=y
CONFIG_BSD_PROCESS_ACCT_V3=y
# CONFIG_TASKSTATS is not set
# CONFIG_AUDIT is not set

#
# RCU Subsystem
#
# CONFIG_TREE_RCU is not set
CONFIG_TREE_PREEMPT_RCU=y
# CONFIG_RCU_TRACE is not set
CONFIG_RCU_FANOUT=32
# CONFIG_RCU_FANOUT_EXACT is not set
# CONFIG_TREE_RCU_TRACE is not set
# CONFIG_IKCONFIG is not set
CONFIG_LOG_BUF_SHIFT=17
CONFIG_HAVE_UNSTABLE_SCHED_CLOCK=y
# CONFIG_GROUP_SCHED is not set
# CONFIG_CGROUPS is not set
# CONFIG_SYSFS_DEPRECATED_V2 is not set
CONFIG_RELAY=y
CONFIG_NAMESPACES=y
# CONFIG_UTS_NS is not set
# CONFIG_IPC_NS is not set
# CONFIG_USER_NS is not set
# CONFIG_PID_NS is not set
# CONFIG_NET_NS is not set
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""
CONFIG_RD_GZIP=y
CONFIG_RD_BZIP2=y
CONFIG_RD_LZMA=y
CONFIG_CC_OPTIMIZE_FOR_SIZE=y
CONFIG_SYSCTL=y
CONFIG_ANON_INODES=y
# CONFIG_EMBEDDED is not set
CONFIG_UID16=y
CONFIG_SYSCTL_SYSCALL=y
CONFIG_KALLSYMS=y
CONFIG_KALLSYMS_ALL=y
CONFIG_KALLSYMS_EXTRA_PASS=y
CONFIG_HOTPLUG=y
CONFIG_PRINTK=y
CONFIG_BUG=y
CONFIG_ELF_CORE=y
CONFIG_PCSPKR_PLATFORM=y
CONFIG_BASE_FULL=y
CONFIG_FUTEX=y
CONFIG_EPOLL=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_EVENTFD=y
CONFIG_SHMEM=y
CONFIG_AIO=y
CONFIG_HAVE_PERF_EVENTS=y

#
# Kernel Performance Events And Counters
#
CONFIG_PERF_EVENTS=y
CONFIG_EVENT_PROFILE=y
CONFIG_PERF_COUNTERS=y
CONFIG_VM_EVENT_COUNTERS=y
CONFIG_PCI_QUIRKS=y
# CONFIG_COMPAT_BRK is not set
CONFIG_SLAB=y
# CONFIG_SLUB is not set
# CONFIG_SLOB is not set
CONFIG_PROFILING=y
CONFIG_TRACEPOINTS=y
CONFIG_OPROFILE=y
# CONFIG_OPROFILE_IBS is not set
# CONFIG_OPROFILE_EVENT_MULTIPLEX is not set
CONFIG_HAVE_OPROFILE=y
# CONFIG_KPROBES is not set
CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS=y
CONFIG_HAVE_IOREMAP_PROT=y
CONFIG_HAVE_KPROBES=y
CONFIG_HAVE_KRETPROBES=y
CONFIG_HAVE_ARCH_TRACEHOOK=y
CONFIG_HAVE_DMA_ATTRS=y
CONFIG_HAVE_DMA_API_DEBUG=y

#
# GCOV-based kernel profiling
#
# CONFIG_GCOV_KERNEL is not set
CONFIG_SLOW_WORK=y
CONFIG_HAVE_GENERIC_DMA_COHERENT=y
CONFIG_SLABINFO=y
CONFIG_RT_MUTEXES=y
CONFIG_BASE_SMALL=0
CONFIG_MODULES=y
# CONFIG_MODULE_FORCE_LOAD is not set
CONFIG_MODULE_UNLOAD=y
# CONFIG_MODULE_FORCE_UNLOAD is not set
# CONFIG_MODVERSIONS is not set
# CONFIG_MODULE_SRCVERSION_ALL is not set
CONFIG_STOP_MACHINE=y
CONFIG_BLOCK=y
CONFIG_LBDAF=y
CONFIG_BLK_DEV_BSG=y
# CONFIG_BLK_DEV_INTEGRITY is not set

#
# IO Schedulers
#
CONFIG_IOSCHED_NOOP=y
# CONFIG_IOSCHED_AS is not set
# CONFIG_IOSCHED_DEADLINE is not set
CONFIG_IOSCHED_CFQ=y
# CONFIG_DEFAULT_AS is not set
# CONFIG_DEFAULT_DEADLINE is not set
CONFIG_DEFAULT_CFQ=y
# CONFIG_DEFAULT_NOOP is not set
CONFIG_DEFAULT_IOSCHED="cfq"
CONFIG_PREEMPT_NOTIFIERS=y
CONFIG_FREEZER=y

#
# Processor type and features
#
CONFIG_TICK_ONESHOT=y
CONFIG_NO_HZ=y
CONFIG_HIGH_RES_TIMERS=y
CONFIG_GENERIC_CLOCKEVENTS_BUILD=y
CONFIG_SMP=y
# CONFIG_SPARSE_IRQ is not set
CONFIG_X86_MPPARSE=y
# CONFIG_X86_BIGSMP is not set
# CONFIG_X86_EXTENDED_PLATFORM is not set
CONFIG_X86_SUPPORTS_MEMORY_FAILURE=y
# CONFIG_SCHED_OMIT_FRAME_POINTER is not set
# CONFIG_PARAVIRT_GUEST is not set
# CONFIG_MEMTEST is not set
# CONFIG_M386 is not set
# CONFIG_M486 is not set
# CONFIG_M586 is not set
# CONFIG_M586TSC is not set
# CONFIG_M586MMX is not set
# CONFIG_M686 is not set
# CONFIG_MPENTIUMII is not set
# CONFIG_MPENTIUMIII is not set
# CONFIG_MPENTIUMM is not set
# CONFIG_MPENTIUM4 is not set
# CONFIG_MK6 is not set
# CONFIG_MK7 is not set
# CONFIG_MK8 is not set
# CONFIG_MCRUSOE is not set
# CONFIG_MEFFICEON is not set
# CONFIG_MWINCHIPC6 is not set
# CONFIG_MWINCHIP3D is not set
# CONFIG_MGEODEGX1 is not set
# CONFIG_MGEODE_LX is not set
# CONFIG_MCYRIXIII is not set
# CONFIG_MVIAC3_2 is not set
# CONFIG_MVIAC7 is not set
# CONFIG_MPSC is not set
# CONFIG_MCORE2 is not set
CONFIG_MATOM=y
# CONFIG_GENERIC_CPU is not set
CONFIG_X86_GENERIC=y
CONFIG_X86_CPU=y
CONFIG_X86_L1_CACHE_BYTES=64
CONFIG_X86_INTERNODE_CACHE_BYTES=64
CONFIG_X86_CMPXCHG=y
CONFIG_X86_L1_CACHE_SHIFT=6
CONFIG_X86_XADD=y
CONFIG_X86_WP_WORKS_OK=y
CONFIG_X86_INVLPG=y
CONFIG_X86_BSWAP=y
CONFIG_X86_POPAD_OK=y
CONFIG_X86_INTEL_USERCOPY=y
CONFIG_X86_USE_PPRO_CHECKSUM=y
CONFIG_X86_TSC=y
CONFIG_X86_CMPXCHG64=y
CONFIG_X86_CMOV=y
CONFIG_X86_MINIMUM_CPU_FAMILY=4
CONFIG_X86_DEBUGCTLMSR=y
CONFIG_CPU_SUP_INTEL=y
CONFIG_CPU_SUP_CYRIX_32=y
CONFIG_CPU_SUP_AMD=y
CONFIG_CPU_SUP_CENTAUR=y
CONFIG_CPU_SUP_TRANSMETA_32=y
CONFIG_CPU_SUP_UMC_32=y
# CONFIG_X86_DS is not set
CONFIG_HPET_TIMER=y
CONFIG_HPET_EMULATE_RTC=y
CONFIG_DMI=y
# CONFIG_IOMMU_HELPER is not set
# CONFIG_IOMMU_API is not set
CONFIG_NR_CPUS=8
CONFIG_SCHED_SMT=y
CONFIG_SCHED_MC=y
# CONFIG_PREEMPT_NONE is not set
# CONFIG_PREEMPT_VOLUNTARY is not set
CONFIG_PREEMPT=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y
# CONFIG_X86_REROUTE_FOR_BROKEN_BOOT_IRQS is not set
CONFIG_X86_MCE=y
CONFIG_X86_MCE_INTEL=y
# CONFIG_X86_MCE_AMD is not set
# CONFIG_X86_ANCIENT_MCE is not set
CONFIG_X86_MCE_THRESHOLD=y
# CONFIG_X86_MCE_INJECT is not set
CONFIG_X86_THERMAL_VECTOR=y
CONFIG_VM86=y
CONFIG_TOSHIBA=m
CONFIG_I8K=m
CONFIG_X86_REBOOTFIXUPS=y
CONFIG_MICROCODE=y
CONFIG_MICROCODE_INTEL=y
# CONFIG_MICROCODE_AMD is not set
CONFIG_MICROCODE_OLD_INTERFACE=y
CONFIG_X86_MSR=y
CONFIG_X86_CPUID=y
# CONFIG_X86_CPU_DEBUG is not set
# CONFIG_NOHIGHMEM is not set
# CONFIG_HIGHMEM4G is not set
CONFIG_HIGHMEM64G=y
CONFIG_PAGE_OFFSET=0xC0000000
CONFIG_HIGHMEM=y
CONFIG_X86_PAE=y
CONFIG_ARCH_PHYS_ADDR_T_64BIT=y
CONFIG_ARCH_FLATMEM_ENABLE=y
CONFIG_ARCH_SPARSEMEM_ENABLE=y
CONFIG_ARCH_SELECT_MEMORY_MODEL=y
CONFIG_SELECT_MEMORY_MODEL=y
CONFIG_FLATMEM_MANUAL=y
# CONFIG_DISCONTIGMEM_MANUAL is not set
# CONFIG_SPARSEMEM_MANUAL is not set
CONFIG_FLATMEM=y
CONFIG_FLAT_NODE_MEM_MAP=y
CONFIG_SPARSEMEM_STATIC=y
CONFIG_PAGEFLAGS_EXTENDED=y
CONFIG_SPLIT_PTLOCK_CPUS=4
CONFIG_PHYS_ADDR_T_64BIT=y
CONFIG_ZONE_DMA_FLAG=1
CONFIG_BOUNCE=y
CONFIG_VIRT_TO_BUS=y
CONFIG_HAVE_MLOCK=y
CONFIG_HAVE_MLOCKED_PAGE_BIT=y
CONFIG_MMU_NOTIFIER=y
# CONFIG_KSM is not set
CONFIG_DEFAULT_MMAP_MIN_ADDR=4096
CONFIG_ARCH_SUPPORTS_MEMORY_FAILURE=y
# CONFIG_MEMORY_FAILURE is not set
CONFIG_HIGHPTE=y
# CONFIG_X86_CHECK_BIOS_CORRUPTION is not set
CONFIG_X86_RESERVE_LOW_64K=y
# CONFIG_MATH_EMULATION is not set
CONFIG_MTRR=y
CONFIG_MTRR_SANITIZER=y
CONFIG_MTRR_SANITIZER_ENABLE_DEFAULT=1
CONFIG_MTRR_SANITIZER_SPARE_REG_NR_DEFAULT=1
CONFIG_X86_PAT=y
CONFIG_ARCH_USES_PG_UNCACHED=y
CONFIG_EFI=y
# CONFIG_SECCOMP is not set
# CONFIG_CC_STACKPROTECTOR is not set
# CONFIG_HZ_100 is not set
# CONFIG_HZ_250 is not set
# CONFIG_HZ_300 is not set
CONFIG_HZ_1000=y
CONFIG_HZ=1000
CONFIG_SCHED_HRTICK=y
# CONFIG_KEXEC is not set
# CONFIG_CRASH_DUMP is not set
CONFIG_PHYSICAL_START=0x1000000
# CONFIG_RELOCATABLE is not set
CONFIG_PHYSICAL_ALIGN=0x400000
CONFIG_HOTPLUG_CPU=y
# CONFIG_COMPAT_VDSO is not set
# CONFIG_CMDLINE_BOOL is not set
CONFIG_ARCH_ENABLE_MEMORY_HOTPLUG=y

#
# Power management and ACPI options
#
CONFIG_PM=y
CONFIG_PM_DEBUG=y
# CONFIG_PM_VERBOSE is not set
CONFIG_CAN_PM_TRACE=y
CONFIG_PM_TRACE=y
CONFIG_PM_TRACE_RTC=y
CONFIG_PM_SLEEP_SMP=y
CONFIG_PM_SLEEP=y
CONFIG_SUSPEND=y
# CONFIG_PM_TEST_SUSPEND is not set
CONFIG_SUSPEND_FREEZER=y
CONFIG_HIBERNATION_NVS=y
CONFIG_HIBERNATION=y
CONFIG_PM_STD_PARTITION=""
# CONFIG_PM_RUNTIME is not set
CONFIG_ACPI=y
CONFIG_ACPI_SLEEP=y
CONFIG_ACPI_PROCFS=y
CONFIG_ACPI_PROCFS_POWER=y
# CONFIG_ACPI_POWER_METER is not set
CONFIG_ACPI_SYSFS_POWER=y
CONFIG_ACPI_PROC_EVENT=y
CONFIG_ACPI_AC=y
CONFIG_ACPI_BATTERY=m
CONFIG_ACPI_BUTTON=y
CONFIG_ACPI_VIDEO=y
CONFIG_ACPI_FAN=y
CONFIG_ACPI_DOCK=y
CONFIG_ACPI_PROCESSOR=y
CONFIG_ACPI_HOTPLUG_CPU=y
# CONFIG_ACPI_PROCESSOR_AGGREGATOR is not set
CONFIG_ACPI_THERMAL=y
# CONFIG_ACPI_CUSTOM_DSDT is not set
CONFIG_ACPI_BLACKLIST_YEAR=1999
# CONFIG_ACPI_DEBUG is not set
# CONFIG_ACPI_PCI_SLOT is not set
CONFIG_X86_PM_TIMER=y
CONFIG_ACPI_CONTAINER=y
CONFIG_ACPI_SBS=m
# CONFIG_SFI is not set
# CONFIG_APM is not set

#
# CPU Frequency scaling
#
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_TABLE=y
CONFIG_CPU_FREQ_DEBUG=y
CONFIG_CPU_FREQ_STAT=y
CONFIG_CPU_FREQ_STAT_DETAILS=y
# CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE is not set
# CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE is not set
# CONFIG_CPU_FREQ_DEFAULT_GOV_USERSPACE is not set
CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
# CONFIG_CPU_FREQ_DEFAULT_GOV_CONSERVATIVE is not set
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
# CONFIG_CPU_FREQ_GOV_POWERSAVE is not set
CONFIG_CPU_FREQ_GOV_USERSPACE=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
# CONFIG_CPU_FREQ_GOV_CONSERVATIVE is not set

#
# CPUFreq processor drivers
#
CONFIG_X86_ACPI_CPUFREQ=y
# CONFIG_X86_POWERNOW_K6 is not set
# CONFIG_X86_POWERNOW_K7 is not set
# CONFIG_X86_POWERNOW_K8 is not set
# CONFIG_X86_GX_SUSPMOD is not set
# CONFIG_X86_SPEEDSTEP_CENTRINO is not set
# CONFIG_X86_SPEEDSTEP_ICH is not set
# CONFIG_X86_SPEEDSTEP_SMI is not set
# CONFIG_X86_P4_CLOCKMOD is not set
# CONFIG_X86_CPUFREQ_NFORCE2 is not set
# CONFIG_X86_LONGRUN is not set
# CONFIG_X86_LONGHAUL is not set
# CONFIG_X86_E_POWERSAVER is not set

#
# shared options
#
# CONFIG_X86_SPEEDSTEP_LIB is not set
CONFIG_CPU_IDLE=y
CONFIG_CPU_IDLE_GOV_LADDER=y
CONFIG_CPU_IDLE_GOV_MENU=y

#
# Bus options (PCI etc.)
#
CONFIG_PCI=y
# CONFIG_PCI_GOBIOS is not set
# CONFIG_PCI_GOMMCONFIG is not set
# CONFIG_PCI_GODIRECT is not set
# CONFIG_PCI_GOOLPC is not set
CONFIG_PCI_GOANY=y
CONFIG_PCI_BIOS=y
CONFIG_PCI_DIRECT=y
CONFIG_PCI_MMCONFIG=y
CONFIG_PCI_DOMAINS=y
# CONFIG_DMAR is not set
CONFIG_PCIEPORTBUS=y
# CONFIG_HOTPLUG_PCI_PCIE is not set
# CONFIG_PCIEAER is not set
# CONFIG_PCIEASPM is not set
CONFIG_ARCH_SUPPORTS_MSI=y
CONFIG_PCI_MSI=y
# CONFIG_PCI_LEGACY is not set
# CONFIG_PCI_DEBUG is not set
# CONFIG_PCI_STUB is not set
# CONFIG_HT_IRQ is not set
# CONFIG_PCI_IOV is not set
CONFIG_ISA_DMA_API=y
CONFIG_ISA=y
# CONFIG_EISA is not set
# CONFIG_MCA is not set
# CONFIG_SCx200 is not set
# CONFIG_OLPC is not set
CONFIG_PCCARD=y
# CONFIG_PCMCIA_DEBUG is not set
# CONFIG_PCMCIA is not set
CONFIG_CARDBUS=y

#
# PC-card bridges
#
CONFIG_YENTA=y
CONFIG_YENTA_O2=y
CONFIG_YENTA_RICOH=y
CONFIG_YENTA_TI=y
CONFIG_YENTA_ENE_TUNE=y
CONFIG_YENTA_TOSHIBA=y
CONFIG_PCMCIA_PROBE=y
CONFIG_PCCARD_NONSTATIC=y
CONFIG_HOTPLUG_PCI=y
# CONFIG_HOTPLUG_PCI_FAKE is not set
# CONFIG_HOTPLUG_PCI_COMPAQ is not set
# CONFIG_HOTPLUG_PCI_IBM is not set
# CONFIG_HOTPLUG_PCI_ACPI is not set
# CONFIG_HOTPLUG_PCI_CPCI is not set
# CONFIG_HOTPLUG_PCI_SHPC is not set

#
# Executable file formats / Emulations
#
CONFIG_BINFMT_ELF=y
# CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
CONFIG_HAVE_AOUT=y
# CONFIG_BINFMT_AOUT is not set
CONFIG_BINFMT_MISC=y
CONFIG_HAVE_ATOMIC_IOMAP=y
CONFIG_NET=y

#
# Networking options
#
CONFIG_PACKET=y
CONFIG_PACKET_MMAP=y
CONFIG_UNIX=y
CONFIG_XFRM=y
CONFIG_XFRM_USER=y
CONFIG_XFRM_SUB_POLICY=y
CONFIG_XFRM_MIGRATE=y
CONFIG_XFRM_STATISTICS=y
CONFIG_XFRM_IPCOMP=m
CONFIG_NET_KEY=m
CONFIG_NET_KEY_MIGRATE=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
# CONFIG_IP_ADVANCED_ROUTER is not set
CONFIG_IP_FIB_HASH=y
# CONFIG_IP_PNP is not set
# CONFIG_NET_IPIP is not set
# CONFIG_NET_IPGRE is not set
CONFIG_IP_MROUTE=y
CONFIG_IP_PIMSM_V1=y
CONFIG_IP_PIMSM_V2=y
# CONFIG_ARPD is not set
CONFIG_SYN_COOKIES=y
CONFIG_INET_AH=m
CONFIG_INET_ESP=m
CONFIG_INET_IPCOMP=m
CONFIG_INET_XFRM_TUNNEL=m
CONFIG_INET_TUNNEL=m
CONFIG_INET_XFRM_MODE_TRANSPORT=m
CONFIG_INET_XFRM_MODE_TUNNEL=m
CONFIG_INET_XFRM_MODE_BEET=m
CONFIG_INET_LRO=y
CONFIG_INET_DIAG=m
CONFIG_INET_TCP_DIAG=m
CONFIG_TCP_CONG_ADVANCED=y
CONFIG_TCP_CONG_BIC=m
CONFIG_TCP_CONG_CUBIC=y
# CONFIG_TCP_CONG_WESTWOOD is not set
# CONFIG_TCP_CONG_HTCP is not set
# CONFIG_TCP_CONG_HSTCP is not set
# CONFIG_TCP_CONG_HYBLA is not set
# CONFIG_TCP_CONG_VEGAS is not set
# CONFIG_TCP_CONG_SCALABLE is not set
# CONFIG_TCP_CONG_LP is not set
# CONFIG_TCP_CONG_VENO is not set
# CONFIG_TCP_CONG_YEAH is not set
# CONFIG_TCP_CONG_ILLINOIS is not set
# CONFIG_DEFAULT_BIC is not set
CONFIG_DEFAULT_CUBIC=y
# CONFIG_DEFAULT_HTCP is not set
# CONFIG_DEFAULT_VEGAS is not set
# CONFIG_DEFAULT_WESTWOOD is not set
# CONFIG_DEFAULT_RENO is not set
CONFIG_DEFAULT_TCP_CONG="cubic"
CONFIG_TCP_MD5SIG=y
CONFIG_IPV6=y
CONFIG_IPV6_PRIVACY=y
CONFIG_IPV6_ROUTER_PREF=y
CONFIG_IPV6_ROUTE_INFO=y
CONFIG_IPV6_OPTIMISTIC_DAD=y
CONFIG_INET6_AH=m
CONFIG_INET6_ESP=m
CONFIG_INET6_IPCOMP=m
CONFIG_IPV6_MIP6=m
CONFIG_INET6_XFRM_TUNNEL=m
CONFIG_INET6_TUNNEL=m
CONFIG_INET6_XFRM_MODE_TRANSPORT=m
CONFIG_INET6_XFRM_MODE_TUNNEL=m
CONFIG_INET6_XFRM_MODE_BEET=m
CONFIG_INET6_XFRM_MODE_ROUTEOPTIMIZATION=m
CONFIG_IPV6_SIT=m
CONFIG_IPV6_NDISC_NODETYPE=y
CONFIG_IPV6_TUNNEL=m
CONFIG_IPV6_MULTIPLE_TABLES=y
CONFIG_IPV6_SUBTREES=y
# CONFIG_IPV6_MROUTE is not set
CONFIG_NETWORK_SECMARK=y
CONFIG_NETFILTER=y
# CONFIG_NETFILTER_DEBUG is not set
CONFIG_NETFILTER_ADVANCED=y

#
# Core Netfilter Configuration
#
CONFIG_NETFILTER_NETLINK=m
CONFIG_NETFILTER_NETLINK_QUEUE=m
CONFIG_NETFILTER_NETLINK_LOG=m
CONFIG_NF_CONNTRACK=y
CONFIG_NF_CT_ACCT=y
CONFIG_NF_CONNTRACK_MARK=y
CONFIG_NF_CONNTRACK_SECMARK=y
CONFIG_NF_CONNTRACK_EVENTS=y
# CONFIG_NF_CT_PROTO_DCCP is not set
CONFIG_NF_CT_PROTO_GRE=m
CONFIG_NF_CT_PROTO_SCTP=m
CONFIG_NF_CT_PROTO_UDPLITE=m
CONFIG_NF_CONNTRACK_AMANDA=m
CONFIG_NF_CONNTRACK_FTP=m
CONFIG_NF_CONNTRACK_H323=m
CONFIG_NF_CONNTRACK_IRC=m
CONFIG_NF_CONNTRACK_NETBIOS_NS=m
CONFIG_NF_CONNTRACK_PPTP=m
CONFIG_NF_CONNTRACK_SANE=m
CONFIG_NF_CONNTRACK_SIP=m
CONFIG_NF_CONNTRACK_TFTP=m
CONFIG_NF_CT_NETLINK=m
# CONFIG_NETFILTER_TPROXY is not set
CONFIG_NETFILTER_XTABLES=y
CONFIG_NETFILTER_XT_TARGET_CLASSIFY=m
CONFIG_NETFILTER_XT_TARGET_CONNMARK=m
CONFIG_NETFILTER_XT_TARGET_CONNSECMARK=m
CONFIG_NETFILTER_XT_TARGET_DSCP=m
CONFIG_NETFILTER_XT_TARGET_HL=m
# CONFIG_NETFILTER_XT_TARGET_LED is not set
CONFIG_NETFILTER_XT_TARGET_MARK=m
CONFIG_NETFILTER_XT_TARGET_NFLOG=m
CONFIG_NETFILTER_XT_TARGET_NFQUEUE=m
CONFIG_NETFILTER_XT_TARGET_NOTRACK=m
CONFIG_NETFILTER_XT_TARGET_RATEEST=m
CONFIG_NETFILTER_XT_TARGET_TRACE=m
CONFIG_NETFILTER_XT_TARGET_SECMARK=m
CONFIG_NETFILTER_XT_TARGET_TCPMSS=m
CONFIG_NETFILTER_XT_TARGET_TCPOPTSTRIP=m
# CONFIG_NETFILTER_XT_MATCH_CLUSTER is not set
CONFIG_NETFILTER_XT_MATCH_COMMENT=m
CONFIG_NETFILTER_XT_MATCH_CONNBYTES=m
CONFIG_NETFILTER_XT_MATCH_CONNLIMIT=m
CONFIG_NETFILTER_XT_MATCH_CONNMARK=m
CONFIG_NETFILTER_XT_MATCH_CONNTRACK=m
# CONFIG_NETFILTER_XT_MATCH_DCCP is not set
CONFIG_NETFILTER_XT_MATCH_DSCP=m
CONFIG_NETFILTER_XT_MATCH_ESP=m
CONFIG_NETFILTER_XT_MATCH_HASHLIMIT=m
CONFIG_NETFILTER_XT_MATCH_HELPER=m
CONFIG_NETFILTER_XT_MATCH_HL=m
CONFIG_NETFILTER_XT_MATCH_IPRANGE=m
CONFIG_NETFILTER_XT_MATCH_LENGTH=m
CONFIG_NETFILTER_XT_MATCH_LIMIT=m
CONFIG_NETFILTER_XT_MATCH_MAC=m
CONFIG_NETFILTER_XT_MATCH_MARK=m
CONFIG_NETFILTER_XT_MATCH_MULTIPORT=m
CONFIG_NETFILTER_XT_MATCH_OWNER=m
CONFIG_NETFILTER_XT_MATCH_POLICY=m
CONFIG_NETFILTER_XT_MATCH_PKTTYPE=m
CONFIG_NETFILTER_XT_MATCH_QUOTA=m
CONFIG_NETFILTER_XT_MATCH_RATEEST=m
CONFIG_NETFILTER_XT_MATCH_REALM=m
# CONFIG_NETFILTER_XT_MATCH_RECENT is not set
CONFIG_NETFILTER_XT_MATCH_SCTP=m
CONFIG_NETFILTER_XT_MATCH_STATE=y
CONFIG_NETFILTER_XT_MATCH_STATISTIC=m
CONFIG_NETFILTER_XT_MATCH_STRING=m
CONFIG_NETFILTER_XT_MATCH_TCPMSS=m
CONFIG_NETFILTER_XT_MATCH_TIME=m
CONFIG_NETFILTER_XT_MATCH_U32=m
# CONFIG_NETFILTER_XT_MATCH_OSF is not set
# CONFIG_IP_VS is not set

#
# IP: Netfilter Configuration
#
CONFIG_NF_DEFRAG_IPV4=y
CONFIG_NF_CONNTRACK_IPV4=y
# CONFIG_NF_CONNTRACK_PROC_COMPAT is not set
CONFIG_IP_NF_QUEUE=m
CONFIG_IP_NF_IPTABLES=y
CONFIG_IP_NF_MATCH_ADDRTYPE=m
CONFIG_IP_NF_MATCH_AH=m
CONFIG_IP_NF_MATCH_ECN=m
CONFIG_IP_NF_MATCH_TTL=m
CONFIG_IP_NF_FILTER=y
CONFIG_IP_NF_TARGET_REJECT=y
CONFIG_IP_NF_TARGET_LOG=m
CONFIG_IP_NF_TARGET_ULOG=m
CONFIG_NF_NAT=m
CONFIG_NF_NAT_NEEDED=y
CONFIG_IP_NF_TARGET_MASQUERADE=m
CONFIG_IP_NF_TARGET_NETMAP=m
CONFIG_IP_NF_TARGET_REDIRECT=m
CONFIG_NF_NAT_SNMP_BASIC=m
CONFIG_NF_NAT_PROTO_GRE=m
CONFIG_NF_NAT_PROTO_UDPLITE=m
CONFIG_NF_NAT_PROTO_SCTP=m
CONFIG_NF_NAT_FTP=m
CONFIG_NF_NAT_IRC=m
CONFIG_NF_NAT_TFTP=m
CONFIG_NF_NAT_AMANDA=m
CONFIG_NF_NAT_PPTP=m
CONFIG_NF_NAT_H323=m
CONFIG_NF_NAT_SIP=m
CONFIG_IP_NF_MANGLE=m
CONFIG_IP_NF_TARGET_CLUSTERIP=m
CONFIG_IP_NF_TARGET_ECN=m
CONFIG_IP_NF_TARGET_TTL=m
CONFIG_IP_NF_RAW=m
CONFIG_IP_NF_ARPTABLES=m
CONFIG_IP_NF_ARPFILTER=m
CONFIG_IP_NF_ARP_MANGLE=m

#
# IPv6: Netfilter Configuration
#
CONFIG_NF_CONNTRACK_IPV6=y
CONFIG_IP6_NF_QUEUE=m
CONFIG_IP6_NF_IPTABLES=y
CONFIG_IP6_NF_MATCH_AH=m
CONFIG_IP6_NF_MATCH_EUI64=m
CONFIG_IP6_NF_MATCH_FRAG=m
CONFIG_IP6_NF_MATCH_OPTS=m
CONFIG_IP6_NF_MATCH_HL=m
CONFIG_IP6_NF_MATCH_IPV6HEADER=m
CONFIG_IP6_NF_MATCH_MH=m
CONFIG_IP6_NF_MATCH_RT=m
CONFIG_IP6_NF_TARGET_HL=m
CONFIG_IP6_NF_TARGET_LOG=m
CONFIG_IP6_NF_FILTER=y
CONFIG_IP6_NF_TARGET_REJECT=y
CONFIG_IP6_NF_MANGLE=m
CONFIG_IP6_NF_RAW=m
# CONFIG_IP_DCCP is not set
# CONFIG_IP_SCTP is not set
# CONFIG_RDS is not set
# CONFIG_TIPC is not set
# CONFIG_ATM is not set
# CONFIG_BRIDGE is not set
# CONFIG_NET_DSA is not set
# CONFIG_VLAN_8021Q is not set
# CONFIG_DECNET is not set
# CONFIG_LLC2 is not set
# CONFIG_IPX is not set
# CONFIG_ATALK is not set
# CONFIG_X25 is not set
# CONFIG_LAPB is not set
# CONFIG_ECONET is not set
# CONFIG_WAN_ROUTER is not set
# CONFIG_PHONET is not set
# CONFIG_IEEE802154 is not set
# CONFIG_NET_SCHED is not set
CONFIG_NET_CLS_ROUTE=y
# CONFIG_DCB is not set

#
# Network testing
#
# CONFIG_NET_PKTGEN is not set
# CONFIG_NET_DROP_MONITOR is not set
# CONFIG_HAMRADIO is not set
# CONFIG_CAN is not set
# CONFIG_IRDA is not set
CONFIG_BT=y
CONFIG_BT_L2CAP=y
CONFIG_BT_SCO=y
CONFIG_BT_RFCOMM=y
CONFIG_BT_RFCOMM_TTY=y
CONFIG_BT_BNEP=y
CONFIG_BT_BNEP_MC_FILTER=y
CONFIG_BT_BNEP_PROTO_FILTER=y
CONFIG_BT_HIDP=y

#
# Bluetooth device drivers
#
CONFIG_BT_HCIBTUSB=y
CONFIG_BT_HCIBTSDIO=m
CONFIG_BT_HCIUART=m
CONFIG_BT_HCIUART_H4=y
CONFIG_BT_HCIUART_BCSP=y
CONFIG_BT_HCIUART_LL=y
CONFIG_BT_HCIBCM203X=m
CONFIG_BT_HCIBPA10X=m
CONFIG_BT_HCIBFUSB=m
CONFIG_BT_HCIVHCI=m
CONFIG_BT_MRVL=m
# CONFIG_BT_MRVL_SDIO is not set
# CONFIG_AF_RXRPC is not set
CONFIG_FIB_RULES=y
CONFIG_WIRELESS=y
CONFIG_CFG80211=y
# CONFIG_NL80211_TESTMODE is not set
# CONFIG_CFG80211_DEVELOPER_WARNINGS is not set
# CONFIG_CFG80211_REG_DEBUG is not set
CONFIG_CFG80211_DEFAULT_PS=y
CONFIG_CFG80211_DEFAULT_PS_VALUE=1
# CONFIG_CFG80211_DEBUGFS is not set
CONFIG_WIRELESS_OLD_REGULATORY=y
CONFIG_WIRELESS_EXT=y
CONFIG_WIRELESS_EXT_SYSFS=y
CONFIG_LIB80211=y
CONFIG_LIB80211_CRYPT_WEP=m
CONFIG_LIB80211_CRYPT_CCMP=m
CONFIG_LIB80211_CRYPT_TKIP=m
# CONFIG_LIB80211_DEBUG is not set
CONFIG_MAC80211=y
CONFIG_MAC80211_RC_MINSTREL=y
# CONFIG_MAC80211_RC_DEFAULT_PID is not set
CONFIG_MAC80211_RC_DEFAULT_MINSTREL=y
CONFIG_MAC80211_RC_DEFAULT="minstrel"
# CONFIG_MAC80211_MESH is not set
CONFIG_MAC80211_LEDS=y
CONFIG_MAC80211_DEBUGFS=y
# CONFIG_MAC80211_DEBUG_MENU is not set
CONFIG_WIMAX=m
CONFIG_WIMAX_DEBUG_LEVEL=8
CONFIG_RFKILL=y
CONFIG_RFKILL_LEDS=y
CONFIG_RFKILL_INPUT=y
# CONFIG_NET_9P is not set

#
# Device Drivers
#

#
# Generic Driver Options
#
CONFIG_UEVENT_HELPER_PATH=""
# CONFIG_DEVTMPFS is not set
CONFIG_STANDALONE=y
CONFIG_PREVENT_FIRMWARE_BUILD=y
CONFIG_FW_LOADER=y
CONFIG_FIRMWARE_IN_KERNEL=y
CONFIG_EXTRA_FIRMWARE=""
# CONFIG_DEBUG_DRIVER is not set
CONFIG_DEBUG_DEVRES=y
# CONFIG_SYS_HYPERVISOR is not set
# CONFIG_CONNECTOR is not set
# CONFIG_MTD is not set
# CONFIG_PARPORT is not set
CONFIG_PNP=y
# CONFIG_PNP_DEBUG_MESSAGES is not set

#
# Protocols
#
# CONFIG_ISAPNP is not set
# CONFIG_PNPBIOS is not set
CONFIG_PNPACPI=y
CONFIG_BLK_DEV=y
# CONFIG_BLK_DEV_FD is not set
# CONFIG_BLK_DEV_XD is not set
# CONFIG_BLK_CPQ_DA is not set
# CONFIG_BLK_CPQ_CISS_DA is not set
# CONFIG_BLK_DEV_DAC960 is not set
# CONFIG_BLK_DEV_UMEM is not set
# CONFIG_BLK_DEV_COW_COMMON is not set
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLK_DEV_CRYPTOLOOP=m
# CONFIG_BLK_DEV_NBD is not set
# CONFIG_BLK_DEV_SX8 is not set
# CONFIG_BLK_DEV_UB is not set
CONFIG_BLK_DEV_RAM=m
CONFIG_BLK_DEV_RAM_COUNT=16
CONFIG_BLK_DEV_RAM_SIZE=16384
# CONFIG_BLK_DEV_XIP is not set
CONFIG_CDROM_PKTCDVD=m
CONFIG_CDROM_PKTCDVD_BUFFERS=8
# CONFIG_CDROM_PKTCDVD_WCACHE is not set
# CONFIG_ATA_OVER_ETH is not set
# CONFIG_BLK_DEV_HD is not set
CONFIG_MISC_DEVICES=y
# CONFIG_IBM_ASM is not set
# CONFIG_PHANTOM is not set
# CONFIG_SGI_IOC4 is not set
CONFIG_TIFM_CORE=m
# CONFIG_TIFM_7XX1 is not set
# CONFIG_ICS932S401 is not set
# CONFIG_ENCLOSURE_SERVICES is not set
# CONFIG_HP_ILO is not set
# CONFIG_ISL29003 is not set
# CONFIG_C2PORT is not set

#
# EEPROM support
#
# CONFIG_EEPROM_AT24 is not set
# CONFIG_EEPROM_LEGACY is not set
# CONFIG_EEPROM_MAX6875 is not set
CONFIG_EEPROM_93CX6=m
# CONFIG_CB710_CORE is not set
CONFIG_HAVE_IDE=y
# CONFIG_IDE is not set

#
# SCSI device support
#
CONFIG_RAID_ATTRS=m
CONFIG_SCSI=y
CONFIG_SCSI_DMA=y
# CONFIG_SCSI_TGT is not set
CONFIG_SCSI_NETLINK=y
CONFIG_SCSI_PROC_FS=y

#
# SCSI support type (disk, tape, CD-ROM)
#
CONFIG_BLK_DEV_SD=y
# CONFIG_CHR_DEV_ST is not set
# CONFIG_CHR_DEV_OSST is not set
CONFIG_BLK_DEV_SR=y
CONFIG_BLK_DEV_SR_VENDOR=y
CONFIG_CHR_DEV_SG=y
# CONFIG_CHR_DEV_SCH is not set
CONFIG_SCSI_MULTI_LUN=y
CONFIG_SCSI_CONSTANTS=y
CONFIG_SCSI_LOGGING=y
CONFIG_SCSI_SCAN_ASYNC=y
CONFIG_SCSI_WAIT_SCAN=m

#
# SCSI Transports
#
CONFIG_SCSI_SPI_ATTRS=y
CONFIG_SCSI_FC_ATTRS=m
# CONFIG_SCSI_ISCSI_ATTRS is not set
CONFIG_SCSI_SAS_ATTRS=m
# CONFIG_SCSI_SAS_LIBSAS is not set
# CONFIG_SCSI_SRP_ATTRS is not set
CONFIG_SCSI_LOWLEVEL=y
# CONFIG_ISCSI_TCP is not set
# CONFIG_SCSI_CXGB3_ISCSI is not set
# CONFIG_SCSI_BNX2_ISCSI is not set
# CONFIG_BLK_DEV_3W_XXXX_RAID is not set
# CONFIG_SCSI_3W_9XXX is not set
# CONFIG_SCSI_7000FASST is not set
# CONFIG_SCSI_ACARD is not set
# CONFIG_SCSI_AHA152X is not set
# CONFIG_SCSI_AHA1542 is not set
# CONFIG_SCSI_AACRAID is not set
# CONFIG_SCSI_AIC7XXX is not set
# CONFIG_SCSI_AIC7XXX_OLD is not set
# CONFIG_SCSI_AIC79XX is not set
# CONFIG_SCSI_AIC94XX is not set
# CONFIG_SCSI_MVSAS is not set
# CONFIG_SCSI_DPT_I2O is not set
# CONFIG_SCSI_ADVANSYS is not set
# CONFIG_SCSI_IN2000 is not set
# CONFIG_SCSI_ARCMSR is not set
# CONFIG_MEGARAID_NEWGEN is not set
# CONFIG_MEGARAID_LEGACY is not set
# CONFIG_MEGARAID_SAS is not set
# CONFIG_SCSI_MPT2SAS is not set
# CONFIG_SCSI_HPTIOP is not set
# CONFIG_SCSI_BUSLOGIC is not set
# CONFIG_LIBFC is not set
# CONFIG_LIBFCOE is not set
# CONFIG_FCOE is not set
# CONFIG_FCOE_FNIC is not set
# CONFIG_SCSI_DMX3191D is not set
# CONFIG_SCSI_DTC3280 is not set
# CONFIG_SCSI_EATA is not set
# CONFIG_SCSI_FUTURE_DOMAIN is not set
# CONFIG_SCSI_GDTH is not set
# CONFIG_SCSI_GENERIC_NCR5380 is not set
# CONFIG_SCSI_GENERIC_NCR5380_MMIO is not set
# CONFIG_SCSI_IPS is not set
# CONFIG_SCSI_INITIO is not set
# CONFIG_SCSI_INIA100 is not set
# CONFIG_SCSI_NCR53C406A is not set
# CONFIG_SCSI_STEX is not set
# CONFIG_SCSI_SYM53C8XX_2 is not set
# CONFIG_SCSI_IPR is not set
# CONFIG_SCSI_PAS16 is not set
# CONFIG_SCSI_QLOGIC_FAS is not set
# CONFIG_SCSI_QLOGIC_1280 is not set
# CONFIG_SCSI_QLA_FC is not set
# CONFIG_SCSI_QLA_ISCSI is not set
# CONFIG_SCSI_LPFC is not set
# CONFIG_SCSI_SYM53C416 is not set
# CONFIG_SCSI_DC395x is not set
# CONFIG_SCSI_DC390T is not set
# CONFIG_SCSI_T128 is not set
# CONFIG_SCSI_U14_34F is not set
# CONFIG_SCSI_ULTRASTOR is not set
# CONFIG_SCSI_NSP32 is not set
# CONFIG_SCSI_DEBUG is not set
# CONFIG_SCSI_PMCRAID is not set
# CONFIG_SCSI_SRP is not set
# CONFIG_SCSI_DH is not set
# CONFIG_SCSI_OSD_INITIATOR is not set
CONFIG_ATA=y
# CONFIG_ATA_NONSTANDARD is not set
CONFIG_ATA_VERBOSE_ERROR=y
CONFIG_ATA_ACPI=y
# CONFIG_SATA_PMP is not set
CONFIG_SATA_AHCI=y
# CONFIG_SATA_SIL24 is not set
CONFIG_ATA_SFF=y
# CONFIG_SATA_SVW is not set
CONFIG_ATA_PIIX=y
# CONFIG_SATA_MV is not set
# CONFIG_SATA_NV is not set
# CONFIG_PDC_ADMA is not set
# CONFIG_SATA_QSTOR is not set
# CONFIG_SATA_PROMISE is not set
# CONFIG_SATA_SX4 is not set
# CONFIG_SATA_SIL is not set
# CONFIG_SATA_SIS is not set
# CONFIG_SATA_ULI is not set
# CONFIG_SATA_VIA is not set
# CONFIG_SATA_VITESSE is not set
# CONFIG_SATA_INIC162X is not set
# CONFIG_PATA_ACPI is not set
# CONFIG_PATA_ALI is not set
# CONFIG_PATA_AMD is not set
# CONFIG_PATA_ARTOP is not set
# CONFIG_PATA_ATP867X is not set
# CONFIG_PATA_ATIIXP is not set
# CONFIG_PATA_CMD640_PCI is not set
# CONFIG_PATA_CMD64X is not set
# CONFIG_PATA_CS5520 is not set
# CONFIG_PATA_CS5530 is not set
# CONFIG_PATA_CS5535 is not set
# CONFIG_PATA_CS5536 is not set
# CONFIG_PATA_CYPRESS is not set
# CONFIG_PATA_EFAR is not set
CONFIG_ATA_GENERIC=y
# CONFIG_PATA_HPT366 is not set
# CONFIG_PATA_HPT37X is not set
# CONFIG_PATA_HPT3X2N is not set
# CONFIG_PATA_HPT3X3 is not set
# CONFIG_PATA_IT821X is not set
# CONFIG_PATA_IT8213 is not set
# CONFIG_PATA_JMICRON is not set
# CONFIG_PATA_LEGACY is not set
# CONFIG_PATA_TRIFLEX is not set
# CONFIG_PATA_MARVELL is not set
CONFIG_PATA_MPIIX=y
# CONFIG_PATA_OLDPIIX is not set
# CONFIG_PATA_NETCELL is not set
# CONFIG_PATA_NINJA32 is not set
# CONFIG_PATA_NS87410 is not set
# CONFIG_PATA_NS87415 is not set
# CONFIG_PATA_OPTI is not set
# CONFIG_PATA_OPTIDMA is not set
# CONFIG_PATA_PDC_OLD is not set
# CONFIG_PATA_QDI is not set
# CONFIG_PATA_RADISYS is not set
# CONFIG_PATA_RDC is not set
# CONFIG_PATA_RZ1000 is not set
# CONFIG_PATA_SC1200 is not set
# CONFIG_PATA_SERVERWORKS is not set
# CONFIG_PATA_PDC2027X is not set
# CONFIG_PATA_SIL680 is not set
# CONFIG_PATA_SIS is not set
# CONFIG_PATA_VIA is not set
# CONFIG_PATA_WINBOND is not set
# CONFIG_PATA_WINBOND_VLB is not set
CONFIG_PATA_SCH=y
CONFIG_MD=y
# CONFIG_BLK_DEV_MD is not set
CONFIG_BLK_DEV_DM=m
CONFIG_DM_DEBUG=y
# CONFIG_DM_CRYPT is not set
CONFIG_DM_SNAPSHOT=m
CONFIG_DM_MIRROR=m
# CONFIG_DM_LOG_USERSPACE is not set
CONFIG_DM_ZERO=m
CONFIG_DM_MULTIPATH=m
# CONFIG_DM_MULTIPATH_QL is not set
# CONFIG_DM_MULTIPATH_ST is not set
CONFIG_DM_DELAY=m
# CONFIG_DM_UEVENT is not set
CONFIG_FUSION=y
CONFIG_FUSION_SPI=y
CONFIG_FUSION_FC=m
CONFIG_FUSION_SAS=m
CONFIG_FUSION_MAX_SGE=40
CONFIG_FUSION_CTL=m
CONFIG_FUSION_LOGGING=y

#
# IEEE 1394 (FireWire) support
#

#
# You can enable one or both FireWire driver stacks.
#

#
# See the help texts for more information.
#
# CONFIG_FIREWIRE is not set
# CONFIG_IEEE1394 is not set
# CONFIG_I2O is not set
# CONFIG_MACINTOSH_DRIVERS is not set
CONFIG_NETDEVICES=y
# CONFIG_DUMMY is not set
# CONFIG_BONDING is not set
CONFIG_MACVLAN=m
# CONFIG_EQUALIZER is not set
CONFIG_TUN=y
# CONFIG_VETH is not set
# CONFIG_NET_SB1000 is not set
# CONFIG_ARCNET is not set
CONFIG_PHYLIB=m

#
# MII PHY device drivers
#
CONFIG_MARVELL_PHY=m
CONFIG_DAVICOM_PHY=m
CONFIG_QSEMI_PHY=m
CONFIG_LXT_PHY=m
CONFIG_CICADA_PHY=m
CONFIG_VITESSE_PHY=m
CONFIG_SMSC_PHY=m
CONFIG_BROADCOM_PHY=m
CONFIG_ICPLUS_PHY=m
CONFIG_REALTEK_PHY=m
# CONFIG_NATIONAL_PHY is not set
# CONFIG_STE10XP is not set
# CONFIG_LSI_ET1011C_PHY is not set
CONFIG_MDIO_BITBANG=m
CONFIG_NET_ETHERNET=y
CONFIG_MII=y
# CONFIG_HAPPYMEAL is not set
# CONFIG_SUNGEM is not set
# CONFIG_CASSINI is not set
# CONFIG_NET_VENDOR_3COM is not set
# CONFIG_LANCE is not set
# CONFIG_NET_VENDOR_SMC is not set
# CONFIG_ETHOC is not set
# CONFIG_NET_VENDOR_RACAL is not set
# CONFIG_DNET is not set
# CONFIG_NET_TULIP is not set
# CONFIG_AT1700 is not set
# CONFIG_DEPCA is not set
# CONFIG_HP100 is not set
# CONFIG_NET_ISA is not set
# CONFIG_IBM_NEW_EMAC_ZMII is not set
# CONFIG_IBM_NEW_EMAC_RGMII is not set
# CONFIG_IBM_NEW_EMAC_TAH is not set
# CONFIG_IBM_NEW_EMAC_EMAC4 is not set
# CONFIG_IBM_NEW_EMAC_NO_FLOW_CTRL is not set
# CONFIG_IBM_NEW_EMAC_MAL_CLR_ICINTSTAT is not set
# CONFIG_IBM_NEW_EMAC_MAL_COMMON_ERR is not set
CONFIG_NET_PCI=y
CONFIG_PCNET32=m
# CONFIG_AMD8111_ETH is not set
# CONFIG_ADAPTEC_STARFIRE is not set
# CONFIG_AC3200 is not set
# CONFIG_APRICOT is not set
# CONFIG_B44 is not set
# CONFIG_FORCEDETH is not set
# CONFIG_CS89x0 is not set
CONFIG_E100=y
# CONFIG_FEALNX is not set
# CONFIG_NATSEMI is not set
# CONFIG_NE2K_PCI is not set
CONFIG_8139CP=m
CONFIG_8139TOO=m
CONFIG_8139TOO_PIO=y
# CONFIG_8139TOO_TUNE_TWISTER is not set
# CONFIG_8139TOO_8129 is not set
# CONFIG_8139_OLD_RX_RESET is not set
# CONFIG_R6040 is not set
CONFIG_SIS900=m
# CONFIG_EPIC100 is not set
# CONFIG_SMSC9420 is not set
# CONFIG_SUNDANCE is not set
# CONFIG_TLAN is not set
# CONFIG_KS8842 is not set
# CONFIG_KS8851_MLL is not set
# CONFIG_VIA_RHINE is not set
# CONFIG_SC92031 is not set
CONFIG_ATL2=m
CONFIG_NETDEV_1000=y
# CONFIG_ACENIC is not set
# CONFIG_DL2K is not set
CONFIG_E1000=y
CONFIG_E1000E=y
# CONFIG_IP1000 is not set
CONFIG_IGB=y
# CONFIG_IGBVF is not set
# CONFIG_NS83820 is not set
# CONFIG_HAMACHI is not set
# CONFIG_YELLOWFIN is not set
CONFIG_R8169=y
CONFIG_SIS190=m
# CONFIG_SKGE is not set
CONFIG_SKY2=m
# CONFIG_SKY2_DEBUG is not set
# CONFIG_VIA_VELOCITY is not set
CONFIG_TIGON3=m
CONFIG_BNX2=m
# CONFIG_CNIC is not set
# CONFIG_QLA3XXX is not set
CONFIG_ATL1=m
CONFIG_ATL1E=y
# CONFIG_ATL1C is not set
# CONFIG_JME is not set
CONFIG_NETDEV_10000=y
CONFIG_MDIO=m
# CONFIG_CHELSIO_T1 is not set
CONFIG_CHELSIO_T3_DEPENDS=y
# CONFIG_CHELSIO_T3 is not set
# CONFIG_ENIC is not set
CONFIG_IXGBE=m
CONFIG_IXGB=m
# CONFIG_S2IO is not set
# CONFIG_VXGE is not set
# CONFIG_MYRI10GE is not set
# CONFIG_NETXEN_NIC is not set
# CONFIG_NIU is not set
# CONFIG_MLX4_EN is not set
# CONFIG_MLX4_CORE is not set
# CONFIG_TEHUTI is not set
CONFIG_BNX2X=m
# CONFIG_QLGE is not set
# CONFIG_SFC is not set
# CONFIG_BE2NET is not set
# CONFIG_TR is not set
CONFIG_WLAN=y
CONFIG_WLAN_PRE80211=y
# CONFIG_STRIP is not set
# CONFIG_ARLAN is not set
# CONFIG_WAVELAN is not set
CONFIG_WLAN_80211=y
CONFIG_LIBERTAS=y
CONFIG_LIBERTAS_USB=m
CONFIG_LIBERTAS_SDIO=y
# CONFIG_LIBERTAS_DEBUG is not set
# CONFIG_LIBERTAS_THINFIRM is not set
# CONFIG_AIRO is not set
# CONFIG_ATMEL is not set
CONFIG_AT76C50X_USB=m
# CONFIG_PRISM54 is not set
CONFIG_USB_ZD1201=m
CONFIG_USB_NET_RNDIS_WLAN=m
CONFIG_RTL8180=m
CONFIG_RTL8187=m
CONFIG_RTL8187_LEDS=y
# CONFIG_ADM8211 is not set
# CONFIG_MAC80211_HWSIM is not set
# CONFIG_MWL8K is not set
CONFIG_P54_COMMON=m
CONFIG_P54_USB=m
CONFIG_P54_PCI=m
CONFIG_P54_LEDS=y
CONFIG_ATH_COMMON=y
CONFIG_ATH5K=y
# CONFIG_ATH5K_DEBUG is not set
CONFIG_ATH9K=m
# CONFIG_ATH9K_DEBUG is not set
CONFIG_AR9170_USB=m
CONFIG_AR9170_LEDS=y
CONFIG_IPW2100=m
# CONFIG_IPW2100_MONITOR is not set
# CONFIG_IPW2100_DEBUG is not set
CONFIG_IPW2200=m
# CONFIG_IPW2200_MONITOR is not set
CONFIG_IPW2200_QOS=y
# CONFIG_IPW2200_DEBUG is not set
CONFIG_LIBIPW=m
# CONFIG_LIBIPW_DEBUG is not set
CONFIG_IWLWIFI=m
# CONFIG_IWLWIFI_LEDS is not set
# CONFIG_IWLWIFI_SPECTRUM_MEASUREMENT is not set
# CONFIG_IWLWIFI_DEBUG is not set
CONFIG_IWLAGN=m
CONFIG_IWL4965=y
CONFIG_IWL5000=y
CONFIG_IWL3945=m
# CONFIG_IWL3945_SPECTRUM_MEASUREMENT is not set
# CONFIG_HOSTAP is not set
CONFIG_B43=m
CONFIG_B43_PCI_AUTOSELECT=y
CONFIG_B43_PCICORE_AUTOSELECT=y
# CONFIG_B43_SDIO is not set
CONFIG_B43_PHY_LP=y
CONFIG_B43_LEDS=y
CONFIG_B43_HWRNG=y
# CONFIG_B43_DEBUG is not set
# CONFIG_B43LEGACY is not set
# CONFIG_ZD1211RW is not set
CONFIG_RT2X00=m
CONFIG_RT2400PCI=m
CONFIG_RT2500PCI=m
CONFIG_RT61PCI=m
CONFIG_RT2500USB=m
CONFIG_RT73USB=m
# CONFIG_RT2800USB is not set
CONFIG_RT2X00_LIB_PCI=m
CONFIG_RT2X00_LIB_USB=m
CONFIG_RT2X00_LIB=m
CONFIG_RT2X00_LIB_FIRMWARE=y
CONFIG_RT2X00_LIB_CRYPTO=y
CONFIG_RT2X00_LIB_LEDS=y
# CONFIG_RT2X00_LIB_DEBUGFS is not set
# CONFIG_RT2X00_DEBUG is not set
# CONFIG_HERMES is not set
# CONFIG_WL12XX is not set
# CONFIG_IWM is not set

#
# WiMAX Wireless Broadband devices
#
CONFIG_WIMAX_I2400M=m
CONFIG_WIMAX_I2400M_USB=m
# CONFIG_WIMAX_I2400M_SDIO is not set
CONFIG_WIMAX_I2400M_DEBUG_LEVEL=8

#
# USB Network Adapters
#
CONFIG_USB_CATC=m
CONFIG_USB_KAWETH=m
CONFIG_USB_PEGASUS=m
CONFIG_USB_RTL8150=m
CONFIG_USB_USBNET=m
CONFIG_USB_NET_AX8817X=m
CONFIG_USB_NET_CDCETHER=m
CONFIG_USB_NET_CDC_EEM=m
CONFIG_USB_NET_DM9601=m
CONFIG_USB_NET_SMSC95XX=m
CONFIG_USB_NET_GL620A=m
CONFIG_USB_NET_NET1080=m
CONFIG_USB_NET_PLUSB=m
CONFIG_USB_NET_MCS7830=m
CONFIG_USB_NET_RNDIS_HOST=m
CONFIG_USB_NET_CDC_SUBSET=m
CONFIG_USB_ALI_M5632=y
CONFIG_USB_AN2720=y
CONFIG_USB_BELKIN=y
CONFIG_USB_ARMLINUX=y
CONFIG_USB_EPSON2888=y
CONFIG_USB_KC2190=y
CONFIG_USB_NET_ZAURUS=m
# CONFIG_USB_HSO is not set
# CONFIG_USB_NET_INT51X1 is not set
# CONFIG_WAN is not set
# CONFIG_FDDI is not set
# CONFIG_HIPPI is not set
CONFIG_PPP=m
CONFIG_PPP_MULTILINK=y
CONFIG_PPP_FILTER=y
CONFIG_PPP_ASYNC=m
CONFIG_PPP_SYNC_TTY=m
CONFIG_PPP_DEFLATE=m
CONFIG_PPP_BSDCOMP=m
CONFIG_PPP_MPPE=m
CONFIG_PPPOE=m
CONFIG_PPPOL2TP=m
# CONFIG_SLIP is not set
CONFIG_SLHC=m
# CONFIG_NET_FC is not set
# CONFIG_NETCONSOLE is not set
# CONFIG_NETPOLL is not set
# CONFIG_NET_POLL_CONTROLLER is not set
# CONFIG_ISDN is not set
# CONFIG_PHONE is not set

#
# Input device support
#
CONFIG_INPUT=y
CONFIG_INPUT_FF_MEMLESS=y
CONFIG_INPUT_POLLDEV=m

#
# Userland interfaces
#
CONFIG_INPUT_MOUSEDEV=y
# CONFIG_INPUT_MOUSEDEV_PSAUX is not set
CONFIG_INPUT_MOUSEDEV_SCREEN_X=1024
CONFIG_INPUT_MOUSEDEV_SCREEN_Y=768
CONFIG_INPUT_JOYDEV=m
CONFIG_INPUT_EVDEV=y
# CONFIG_INPUT_EVBUG is not set

#
# Input Device Drivers
#
CONFIG_INPUT_KEYBOARD=y
# CONFIG_KEYBOARD_ADP5588 is not set
CONFIG_KEYBOARD_ATKBD=y
# CONFIG_QT2160 is not set
# CONFIG_KEYBOARD_LKKBD is not set
# CONFIG_KEYBOARD_LM8323 is not set
# CONFIG_KEYBOARD_MAX7359 is not set
# CONFIG_KEYBOARD_NEWTON is not set
# CONFIG_KEYBOARD_OPENCORES is not set
# CONFIG_KEYBOARD_STOWAWAY is not set
# CONFIG_KEYBOARD_SUNKBD is not set
# CONFIG_KEYBOARD_XTKBD is not set
CONFIG_INPUT_MOUSE=y
CONFIG_MOUSE_PS2=y
CONFIG_MOUSE_PS2_ALPS=y
CONFIG_MOUSE_PS2_LOGIPS2PP=y
CONFIG_MOUSE_PS2_SYNAPTICS=y
CONFIG_MOUSE_PS2_LIFEBOOK=y
CONFIG_MOUSE_PS2_TRACKPOINT=y
# CONFIG_MOUSE_PS2_ELANTECH is not set
# CONFIG_MOUSE_PS2_SENTELIC is not set
CONFIG_MOUSE_PS2_TOUCHKIT=y
CONFIG_MOUSE_SERIAL=m
# CONFIG_MOUSE_APPLETOUCH is not set
# CONFIG_MOUSE_BCM5974 is not set
# CONFIG_MOUSE_INPORT is not set
# CONFIG_MOUSE_LOGIBM is not set
# CONFIG_MOUSE_PC110PAD is not set
CONFIG_MOUSE_VSXXXAA=m
# CONFIG_MOUSE_SYNAPTICS_I2C is not set
CONFIG_INPUT_JOYSTICK=y
# CONFIG_JOYSTICK_ANALOG is not set
# CONFIG_JOYSTICK_A3D is not set
# CONFIG_JOYSTICK_ADI is not set
# CONFIG_JOYSTICK_COBRA is not set
# CONFIG_JOYSTICK_GF2K is not set
# CONFIG_JOYSTICK_GRIP is not set
# CONFIG_JOYSTICK_GRIP_MP is not set
# CONFIG_JOYSTICK_GUILLEMOT is not set
# CONFIG_JOYSTICK_INTERACT is not set
# CONFIG_JOYSTICK_SIDEWINDER is not set
# CONFIG_JOYSTICK_TMDC is not set
# CONFIG_JOYSTICK_IFORCE is not set
# CONFIG_JOYSTICK_WARRIOR is not set
# CONFIG_JOYSTICK_MAGELLAN is not set
# CONFIG_JOYSTICK_SPACEORB is not set
# CONFIG_JOYSTICK_SPACEBALL is not set
# CONFIG_JOYSTICK_STINGER is not set
# CONFIG_JOYSTICK_TWIDJOY is not set
# CONFIG_JOYSTICK_ZHENHUA is not set
# CONFIG_JOYSTICK_JOYDUMP is not set
# CONFIG_JOYSTICK_XPAD is not set
# CONFIG_INPUT_TABLET is not set
CONFIG_INPUT_TOUCHSCREEN=y
CONFIG_TOUCHSCREEN_AD7879_I2C=m
CONFIG_TOUCHSCREEN_AD7879=m
# CONFIG_TOUCHSCREEN_EETI is not set
CONFIG_TOUCHSCREEN_FUJITSU=m
CONFIG_TOUCHSCREEN_GUNZE=m
CONFIG_TOUCHSCREEN_ELO=m
# CONFIG_TOUCHSCREEN_WACOM_W8001 is not set
# CONFIG_TOUCHSCREEN_MCS5000 is not set
CONFIG_TOUCHSCREEN_MTOUCH=m
CONFIG_TOUCHSCREEN_INEXIO=m
CONFIG_TOUCHSCREEN_MK712=m
CONFIG_TOUCHSCREEN_HTCPEN=m
CONFIG_TOUCHSCREEN_PENMOUNT=m
CONFIG_TOUCHSCREEN_TOUCHRIGHT=m
CONFIG_TOUCHSCREEN_TOUCHWIN=m
CONFIG_TOUCHSCREEN_WM97XX=m
CONFIG_TOUCHSCREEN_WM9705=y
CONFIG_TOUCHSCREEN_WM9712=y
CONFIG_TOUCHSCREEN_WM9713=y
CONFIG_TOUCHSCREEN_USB_COMPOSITE=m
CONFIG_TOUCHSCREEN_USB_EGALAX=y
CONFIG_TOUCHSCREEN_USB_PANJIT=y
CONFIG_TOUCHSCREEN_USB_3M=y
CONFIG_TOUCHSCREEN_USB_ITM=y
CONFIG_TOUCHSCREEN_USB_ETURBO=y
CONFIG_TOUCHSCREEN_USB_GUNZE=y
CONFIG_TOUCHSCREEN_USB_DMC_TSC10=y
CONFIG_TOUCHSCREEN_USB_IRTOUCH=y
CONFIG_TOUCHSCREEN_USB_IDEALTEK=y
CONFIG_TOUCHSCREEN_USB_GENERAL_TOUCH=y
CONFIG_TOUCHSCREEN_USB_GOTOP=y
CONFIG_TOUCHSCREEN_USB_JASTEC=y
CONFIG_TOUCHSCREEN_USB_E2I=y
CONFIG_TOUCHSCREEN_TOUCHIT213=m
# CONFIG_TOUCHSCREEN_TSC2007 is not set
CONFIG_INPUT_MISC=y
# CONFIG_INPUT_PCSPKR is not set
# CONFIG_INPUT_APANEL is not set
CONFIG_INPUT_WISTRON_BTNS=m
# CONFIG_INPUT_ATLAS_BTNS is not set
# CONFIG_INPUT_ATI_REMOTE is not set
# CONFIG_INPUT_ATI_REMOTE2 is not set
CONFIG_INPUT_KEYSPAN_REMOTE=m
CONFIG_INPUT_POWERMATE=m
CONFIG_INPUT_YEALINK=m
# CONFIG_INPUT_CM109 is not set
# CONFIG_INPUT_UINPUT is not set
# CONFIG_INPUT_WINBOND_CIR is not set

#
# Hardware I/O ports
#
CONFIG_SERIO=y
CONFIG_SERIO_I8042=y
CONFIG_SERIO_SERPORT=y
# CONFIG_SERIO_CT82C710 is not set
# CONFIG_SERIO_PCIPS2 is not set
CONFIG_SERIO_LIBPS2=y
CONFIG_SERIO_RAW=m
# CONFIG_GAMEPORT is not set

#
# Character devices
#
CONFIG_VT=y
CONFIG_CONSOLE_TRANSLATIONS=y
CONFIG_VT_CONSOLE=y
CONFIG_HW_CONSOLE=y
CONFIG_VT_HW_CONSOLE_BINDING=y
# CONFIG_DEVKMEM is not set
# CONFIG_SERIAL_NONSTANDARD is not set
# CONFIG_NOZOMI is not set

#
# Serial drivers
#
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_FIX_EARLYCON_MEM=y
CONFIG_SERIAL_8250_PCI=y
CONFIG_SERIAL_8250_PNP=y
CONFIG_SERIAL_8250_NR_UARTS=4
CONFIG_SERIAL_8250_RUNTIME_UARTS=4
# CONFIG_SERIAL_8250_EXTENDED is not set

#
# Non-8250 serial port support
#
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y
# CONFIG_SERIAL_JSM is not set
CONFIG_UNIX98_PTYS=y
# CONFIG_DEVPTS_MULTIPLE_INSTANCES is not set
# CONFIG_LEGACY_PTYS is not set
# CONFIG_IPMI_HANDLER is not set
CONFIG_HW_RANDOM=m
# CONFIG_HW_RANDOM_TIMERIOMEM is not set
# CONFIG_HW_RANDOM_INTEL is not set
# CONFIG_HW_RANDOM_AMD is not set
# CONFIG_HW_RANDOM_GEODE is not set
# CONFIG_HW_RANDOM_VIA is not set
CONFIG_NVRAM=m
# CONFIG_DTLK is not set
# CONFIG_R3964 is not set
# CONFIG_APPLICOM is not set
# CONFIG_SONYPI is not set
# CONFIG_MWAVE is not set
# CONFIG_PC8736x_GPIO is not set
# CONFIG_NSC_GPIO is not set
# CONFIG_CS5535_GPIO is not set
# CONFIG_RAW_DRIVER is not set
CONFIG_HPET=y
# CONFIG_HPET_MMAP is not set
# CONFIG_HANGCHECK_TIMER is not set
# CONFIG_TCG_TPM is not set
# CONFIG_TELCLOCK is not set
CONFIG_DEVPORT=y
CONFIG_I2C=y
CONFIG_I2C_BOARDINFO=y
CONFIG_I2C_COMPAT=y
# CONFIG_I2C_CHARDEV is not set
# CONFIG_I2C_HELPER_AUTO is not set

#
# I2C Algorithms
#
CONFIG_I2C_ALGOBIT=y
# CONFIG_I2C_ALGOPCF is not set
# CONFIG_I2C_ALGOPCA is not set

#
# I2C Hardware Bus support
#

#
# PC SMBus host controller drivers
#
# CONFIG_I2C_ALI1535 is not set
# CONFIG_I2C_ALI1563 is not set
# CONFIG_I2C_ALI15X3 is not set
# CONFIG_I2C_AMD756 is not set
# CONFIG_I2C_AMD8111 is not set
# CONFIG_I2C_I801 is not set
# CONFIG_I2C_ISCH is not set
# CONFIG_I2C_PIIX4 is not set
# CONFIG_I2C_NFORCE2 is not set
# CONFIG_I2C_SIS5595 is not set
# CONFIG_I2C_SIS630 is not set
# CONFIG_I2C_SIS96X is not set
# CONFIG_I2C_VIA is not set
# CONFIG_I2C_VIAPRO is not set

#
# ACPI drivers
#
# CONFIG_I2C_SCMI is not set

#
# I2C system bus drivers (mostly embedded / system-on-chip)
#
# CONFIG_I2C_OCORES is not set
# CONFIG_I2C_SIMTEC is not set

#
# External I2C/SMBus adapter drivers
#
# CONFIG_I2C_PARPORT_LIGHT is not set
# CONFIG_I2C_TAOS_EVM is not set
# CONFIG_I2C_TINY_USB is not set

#
# Graphics adapter I2C/DDC channel drivers
#
# CONFIG_I2C_VOODOO3 is not set

#
# Other I2C/SMBus bus drivers
#
# CONFIG_I2C_PCA_ISA is not set
# CONFIG_I2C_PCA_PLATFORM is not set
# CONFIG_I2C_STUB is not set
# CONFIG_SCx200_ACB is not set

#
# Miscellaneous I2C Chip support
#
# CONFIG_DS1682 is not set
# CONFIG_SENSORS_TSL2550 is not set
# CONFIG_I2C_DEBUG_CORE is not set
# CONFIG_I2C_DEBUG_ALGO is not set
# CONFIG_I2C_DEBUG_BUS is not set
# CONFIG_I2C_DEBUG_CHIP is not set
# CONFIG_SPI is not set

#
# PPS support
#
# CONFIG_PPS is not set
CONFIG_ARCH_WANT_OPTIONAL_GPIOLIB=y
# CONFIG_GPIOLIB is not set
# CONFIG_W1 is not set
CONFIG_POWER_SUPPLY=y
# CONFIG_POWER_SUPPLY_DEBUG is not set
# CONFIG_PDA_POWER is not set
# CONFIG_BATTERY_DS2760 is not set
# CONFIG_BATTERY_DS2782 is not set
# CONFIG_BATTERY_BQ27x00 is not set
# CONFIG_BATTERY_MAX17040 is not set
CONFIG_HWMON=y
# CONFIG_HWMON_VID is not set
# CONFIG_HWMON_DEBUG_CHIP is not set

#
# Native drivers
#
# CONFIG_SENSORS_ABITUGURU is not set
# CONFIG_SENSORS_ABITUGURU3 is not set
# CONFIG_SENSORS_AD7414 is not set
# CONFIG_SENSORS_AD7418 is not set
# CONFIG_SENSORS_ADM1021 is not set
# CONFIG_SENSORS_ADM1025 is not set
# CONFIG_SENSORS_ADM1026 is not set
# CONFIG_SENSORS_ADM1029 is not set
# CONFIG_SENSORS_ADM1031 is not set
# CONFIG_SENSORS_ADM9240 is not set
# CONFIG_SENSORS_ADT7462 is not set
# CONFIG_SENSORS_ADT7470 is not set
# CONFIG_SENSORS_ADT7473 is not set
# CONFIG_SENSORS_ADT7475 is not set
# CONFIG_SENSORS_K8TEMP is not set
# CONFIG_SENSORS_ASB100 is not set
# CONFIG_SENSORS_ATXP1 is not set
# CONFIG_SENSORS_DS1621 is not set
# CONFIG_SENSORS_I5K_AMB is not set
# CONFIG_SENSORS_F71805F is not set
# CONFIG_SENSORS_F71882FG is not set
# CONFIG_SENSORS_F75375S is not set
# CONFIG_SENSORS_FSCHMD is not set
# CONFIG_SENSORS_G760A is not set
# CONFIG_SENSORS_GL518SM is not set
# CONFIG_SENSORS_GL520SM is not set
# CONFIG_SENSORS_CORETEMP is not set
# CONFIG_SENSORS_IT87 is not set
# CONFIG_SENSORS_LM63 is not set
# CONFIG_SENSORS_LM75 is not set
# CONFIG_SENSORS_LM77 is not set
# CONFIG_SENSORS_LM78 is not set
# CONFIG_SENSORS_LM80 is not set
# CONFIG_SENSORS_LM83 is not set
# CONFIG_SENSORS_LM85 is not set
# CONFIG_SENSORS_LM87 is not set
# CONFIG_SENSORS_LM90 is not set
# CONFIG_SENSORS_LM92 is not set
# CONFIG_SENSORS_LM93 is not set
# CONFIG_SENSORS_LTC4215 is not set
# CONFIG_SENSORS_LTC4245 is not set
# CONFIG_SENSORS_LM95241 is not set
# CONFIG_SENSORS_MAX1619 is not set
# CONFIG_SENSORS_MAX6650 is not set
# CONFIG_SENSORS_PC87360 is not set
# CONFIG_SENSORS_PC87427 is not set
# CONFIG_SENSORS_PCF8591 is not set
# CONFIG_SENSORS_SIS5595 is not set
# CONFIG_SENSORS_DME1737 is not set
# CONFIG_SENSORS_SMSC47M1 is not set
# CONFIG_SENSORS_SMSC47M192 is not set
# CONFIG_SENSORS_SMSC47B397 is not set
# CONFIG_SENSORS_ADS7828 is not set
# CONFIG_SENSORS_THMC50 is not set
# CONFIG_SENSORS_TMP401 is not set
# CONFIG_SENSORS_TMP421 is not set
# CONFIG_SENSORS_VIA686A is not set
# CONFIG_SENSORS_VT1211 is not set
# CONFIG_SENSORS_VT8231 is not set
# CONFIG_SENSORS_W83781D is not set
# CONFIG_SENSORS_W83791D is not set
# CONFIG_SENSORS_W83792D is not set
# CONFIG_SENSORS_W83793 is not set
# CONFIG_SENSORS_W83L785TS is not set
# CONFIG_SENSORS_W83L786NG is not set
# CONFIG_SENSORS_W83627HF is not set
# CONFIG_SENSORS_W83627EHF is not set
# CONFIG_SENSORS_HDAPS is not set
# CONFIG_SENSORS_APPLESMC is not set

#
# ACPI drivers
#
# CONFIG_SENSORS_ATK0110 is not set
# CONFIG_SENSORS_LIS3LV02D is not set
CONFIG_THERMAL=y
CONFIG_THERMAL_HWMON=y
# CONFIG_WATCHDOG is not set
CONFIG_SSB_POSSIBLE=y

#
# Sonics Silicon Backplane
#
CONFIG_SSB=m
CONFIG_SSB_SPROM=y
CONFIG_SSB_PCIHOST_POSSIBLE=y
CONFIG_SSB_PCIHOST=y
CONFIG_SSB_B43_PCI_BRIDGE=y
CONFIG_SSB_SDIOHOST_POSSIBLE=y
# CONFIG_SSB_SDIOHOST is not set
# CONFIG_SSB_DEBUG is not set
CONFIG_SSB_DRIVER_PCICORE_POSSIBLE=y
CONFIG_SSB_DRIVER_PCICORE=y

#
# Multifunction device drivers
#
# CONFIG_MFD_CORE is not set
# CONFIG_MFD_SM501 is not set
# CONFIG_HTC_PASIC3 is not set
# CONFIG_TWL4030_CORE is not set
# CONFIG_MFD_TMIO is not set
# CONFIG_PMIC_DA903X is not set
# CONFIG_MFD_WM8400 is not set
# CONFIG_MFD_WM831X is not set
# CONFIG_MFD_WM8350_I2C is not set
# CONFIG_MFD_PCF50633 is not set
# CONFIG_AB3100_CORE is not set
# CONFIG_REGULATOR is not set
CONFIG_MEDIA_SUPPORT=y

#
# Multimedia core support
#
CONFIG_VIDEO_DEV=y
CONFIG_VIDEO_V4L2_COMMON=y
# CONFIG_VIDEO_ALLOW_V4L1 is not set
CONFIG_VIDEO_V4L1_COMPAT=y
CONFIG_DVB_CORE=m
CONFIG_VIDEO_MEDIA=m

#
# Multimedia drivers
#
CONFIG_MEDIA_ATTACH=y
CONFIG_MEDIA_TUNER=m
# CONFIG_MEDIA_TUNER_CUSTOMISE is not set
CONFIG_MEDIA_TUNER_SIMPLE=m
CONFIG_MEDIA_TUNER_TDA8290=m
CONFIG_MEDIA_TUNER_TDA9887=m
CONFIG_MEDIA_TUNER_TEA5761=m
CONFIG_MEDIA_TUNER_TEA5767=m
CONFIG_MEDIA_TUNER_MT20XX=m
CONFIG_MEDIA_TUNER_XC2028=m
CONFIG_MEDIA_TUNER_XC5000=m
CONFIG_MEDIA_TUNER_MC44S803=m
CONFIG_VIDEO_V4L2=y
CONFIG_VIDEOBUF_GEN=m
CONFIG_VIDEOBUF_VMALLOC=m
CONFIG_VIDEO_CAPTURE_DRIVERS=y
# CONFIG_VIDEO_ADV_DEBUG is not set
# CONFIG_VIDEO_FIXED_MINOR_RANGES is not set
CONFIG_VIDEO_HELPER_CHIPS_AUTO=y
# CONFIG_VIDEO_VIVI is not set
# CONFIG_VIDEO_BT848 is not set
# CONFIG_VIDEO_SAA5246A is not set
# CONFIG_VIDEO_SAA5249 is not set
# CONFIG_VIDEO_ZORAN is not set
# CONFIG_VIDEO_SAA7134 is not set
# CONFIG_VIDEO_HEXIUM_ORION is not set
# CONFIG_VIDEO_HEXIUM_GEMINI is not set
# CONFIG_VIDEO_CX88 is not set
# CONFIG_VIDEO_CX23885 is not set
# CONFIG_VIDEO_AU0828 is not set
# CONFIG_VIDEO_IVTV is not set
# CONFIG_VIDEO_CX18 is not set
# CONFIG_VIDEO_SAA7164 is not set
# CONFIG_VIDEO_CAFE_CCIC is not set
# CONFIG_SOC_CAMERA is not set
CONFIG_V4L_USB_DRIVERS=y
CONFIG_USB_VIDEO_CLASS=m
CONFIG_USB_VIDEO_CLASS_INPUT_EVDEV=y
CONFIG_USB_GSPCA=m
# CONFIG_USB_M5602 is not set
# CONFIG_USB_STV06XX is not set
# CONFIG_USB_GL860 is not set
# CONFIG_USB_GSPCA_CONEX is not set
# CONFIG_USB_GSPCA_ETOMS is not set
# CONFIG_USB_GSPCA_FINEPIX is not set
# CONFIG_USB_GSPCA_JEILINJ is not set
# CONFIG_USB_GSPCA_MARS is not set
CONFIG_USB_GSPCA_MR97310A=m
# CONFIG_USB_GSPCA_OV519 is not set
# CONFIG_USB_GSPCA_OV534 is not set
# CONFIG_USB_GSPCA_PAC207 is not set
# CONFIG_USB_GSPCA_PAC7311 is not set
CONFIG_USB_GSPCA_SN9C20X=m
CONFIG_USB_GSPCA_SN9C20X_EVDEV=y
# CONFIG_USB_GSPCA_SONIXB is not set
# CONFIG_USB_GSPCA_SONIXJ is not set
# CONFIG_USB_GSPCA_SPCA500 is not set
# CONFIG_USB_GSPCA_SPCA501 is not set
# CONFIG_USB_GSPCA_SPCA505 is not set
# CONFIG_USB_GSPCA_SPCA506 is not set
# CONFIG_USB_GSPCA_SPCA508 is not set
# CONFIG_USB_GSPCA_SPCA561 is not set
CONFIG_USB_GSPCA_SQ905=m
CONFIG_USB_GSPCA_SQ905C=m
# CONFIG_USB_GSPCA_STK014 is not set
# CONFIG_USB_GSPCA_SUNPLUS is not set
# CONFIG_USB_GSPCA_T613 is not set
# CONFIG_USB_GSPCA_TV8532 is not set
# CONFIG_USB_GSPCA_VC032X is not set
# CONFIG_USB_GSPCA_ZC3XX is not set
# CONFIG_VIDEO_PVRUSB2 is not set
# CONFIG_VIDEO_HDPVR is not set
# CONFIG_VIDEO_EM28XX is not set
# CONFIG_VIDEO_CX231XX is not set
# CONFIG_VIDEO_USBVISION is not set
CONFIG_USB_ET61X251=m
CONFIG_USB_SN9C102=m
CONFIG_USB_ZC0301=m
# CONFIG_USB_PWC_INPUT_EVDEV is not set
CONFIG_USB_ZR364XX=m
CONFIG_USB_STKWEBCAM=m
CONFIG_USB_S2255=m
# CONFIG_RADIO_ADAPTERS is not set
CONFIG_DVB_MAX_ADAPTERS=8
# CONFIG_DVB_DYNAMIC_MINORS is not set
# CONFIG_DVB_CAPTURE_DRIVERS is not set
# CONFIG_DAB is not set

#
# Graphics support
#
CONFIG_AGP=y
# CONFIG_AGP_ALI is not set
# CONFIG_AGP_ATI is not set
# CONFIG_AGP_AMD is not set
# CONFIG_AGP_AMD64 is not set
CONFIG_AGP_INTEL=y
# CONFIG_AGP_NVIDIA is not set
# CONFIG_AGP_SIS is not set
# CONFIG_AGP_SWORKS is not set
# CONFIG_AGP_VIA is not set
# CONFIG_AGP_EFFICEON is not set
CONFIG_VGA_ARB=y
CONFIG_DRM=y
CONFIG_DRM_KMS_HELPER=y
# CONFIG_DRM_TDFX is not set
# CONFIG_DRM_R128 is not set
# CONFIG_DRM_RADEON is not set
CONFIG_DRM_I810=y
# CONFIG_DRM_I830 is not set
CONFIG_DRM_I915=y
CONFIG_DRM_I915_KMS=y
# CONFIG_DRM_MGA is not set
# CONFIG_DRM_SIS is not set
# CONFIG_DRM_VIA is not set
# CONFIG_DRM_SAVAGE is not set
CONFIG_VGASTATE=m
CONFIG_VIDEO_OUTPUT_CONTROL=y
CONFIG_FB=y
# CONFIG_FIRMWARE_EDID is not set
# CONFIG_FB_DDC is not set
# CONFIG_FB_BOOT_VESA_SUPPORT is not set
CONFIG_FB_CFB_FILLRECT=y
CONFIG_FB_CFB_COPYAREA=y
CONFIG_FB_CFB_IMAGEBLIT=y
# CONFIG_FB_CFB_REV_PIXELS_IN_BYTE is not set
# CONFIG_FB_SYS_FILLRECT is not set
# CONFIG_FB_SYS_COPYAREA is not set
# CONFIG_FB_SYS_IMAGEBLIT is not set
# CONFIG_FB_FOREIGN_ENDIAN is not set
# CONFIG_FB_SYS_FOPS is not set
# CONFIG_FB_SVGALIB is not set
# CONFIG_FB_MACMODES is not set
# CONFIG_FB_BACKLIGHT is not set
CONFIG_FB_MODE_HELPERS=y
# CONFIG_FB_TILEBLITTING is not set

#
# Frame buffer hardware drivers
#
# CONFIG_FB_CIRRUS is not set
# CONFIG_FB_PM2 is not set
# CONFIG_FB_CYBER2000 is not set
# CONFIG_FB_ARC is not set
# CONFIG_FB_ASILIANT is not set
# CONFIG_FB_IMSTT is not set
# CONFIG_FB_VGA16 is not set
# CONFIG_FB_VESA is not set
# CONFIG_FB_EFI is not set
# CONFIG_FB_N411 is not set
# CONFIG_FB_HGA is not set
# CONFIG_FB_S1D13XXX is not set
# CONFIG_FB_NVIDIA is not set
# CONFIG_FB_RIVA is not set
CONFIG_FB_I810=m
# CONFIG_FB_I810_GTF is not set
# CONFIG_FB_LE80578 is not set
# CONFIG_FB_MATROX is not set
# CONFIG_FB_RADEON is not set
# CONFIG_FB_ATY128 is not set
# CONFIG_FB_ATY is not set
# CONFIG_FB_S3 is not set
# CONFIG_FB_SAVAGE is not set
# CONFIG_FB_SIS is not set
# CONFIG_FB_VIA is not set
# CONFIG_FB_NEOMAGIC is not set
# CONFIG_FB_KYRO is not set
# CONFIG_FB_3DFX is not set
# CONFIG_FB_VOODOO1 is not set
# CONFIG_FB_VT8623 is not set
# CONFIG_FB_TRIDENT is not set
# CONFIG_FB_ARK is not set
# CONFIG_FB_PM3 is not set
# CONFIG_FB_CARMINE is not set
# CONFIG_FB_GEODE is not set
# CONFIG_FB_VIRTUAL is not set
# CONFIG_FB_METRONOME is not set
# CONFIG_FB_MB862XX is not set
# CONFIG_FB_BROADSHEET is not set
CONFIG_BACKLIGHT_LCD_SUPPORT=y
# CONFIG_LCD_CLASS_DEVICE is not set
CONFIG_BACKLIGHT_CLASS_DEVICE=y
CONFIG_BACKLIGHT_GENERIC=y
# CONFIG_BACKLIGHT_PROGEAR is not set
# CONFIG_BACKLIGHT_MBP_NVIDIA is not set
# CONFIG_BACKLIGHT_SAHARA is not set

#
# Display device support
#
# CONFIG_DISPLAY_SUPPORT is not set

#
# Console display driver support
#
CONFIG_VGA_CONSOLE=y
CONFIG_VGACON_SOFT_SCROLLBACK=y
CONFIG_VGACON_SOFT_SCROLLBACK_SIZE=64
# CONFIG_MDA_CONSOLE is not set
CONFIG_DUMMY_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE_DETECT_PRIMARY=y
# CONFIG_FRAMEBUFFER_CONSOLE_ROTATION is not set
CONFIG_FONTS=y
CONFIG_FONT_8x8=y
CONFIG_FONT_8x16=y
CONFIG_FONT_6x11=y
CONFIG_FONT_7x14=y
# CONFIG_FONT_PEARL_8x8 is not set
# CONFIG_FONT_ACORN_8x8 is not set
# CONFIG_FONT_MINI_4x6 is not set
# CONFIG_FONT_SUN8x16 is not set
# CONFIG_FONT_SUN12x22 is not set
CONFIG_FONT_10x18=y
# CONFIG_LOGO is not set
CONFIG_SOUND=y
# CONFIG_SOUND_OSS_CORE is not set
CONFIG_SND=y
CONFIG_SND_TIMER=y
CONFIG_SND_PCM=y
CONFIG_SND_HWDEP=y
CONFIG_SND_RAWMIDI=m
CONFIG_SND_SEQUENCER=y
CONFIG_SND_SEQ_DUMMY=y
# CONFIG_SND_MIXER_OSS is not set
# CONFIG_SND_PCM_OSS is not set
# CONFIG_SND_SEQUENCER_OSS is not set
# CONFIG_SND_HRTIMER is not set
CONFIG_SND_DYNAMIC_MINORS=y
# CONFIG_SND_SUPPORT_OLD_API is not set
CONFIG_SND_VERBOSE_PROCFS=y
CONFIG_SND_VERBOSE_PRINTK=y
CONFIG_SND_DEBUG=y
# CONFIG_SND_DEBUG_VERBOSE is not set
CONFIG_SND_PCM_XRUN_DEBUG=y
CONFIG_SND_VMASTER=y
CONFIG_SND_DMA_SGBUF=y
CONFIG_SND_RAWMIDI_SEQ=m
# CONFIG_SND_OPL3_LIB_SEQ is not set
# CONFIG_SND_OPL4_LIB_SEQ is not set
# CONFIG_SND_SBAWE_SEQ is not set
# CONFIG_SND_EMU10K1_SEQ is not set
CONFIG_SND_AC97_CODEC=y
CONFIG_SND_DRIVERS=y
# CONFIG_SND_PCSP is not set
# CONFIG_SND_DUMMY is not set
# CONFIG_SND_VIRMIDI is not set
# CONFIG_SND_MTPAV is not set
# CONFIG_SND_SERIAL_U16550 is not set
# CONFIG_SND_MPU401 is not set
CONFIG_SND_AC97_POWER_SAVE=y
CONFIG_SND_AC97_POWER_SAVE_DEFAULT=5
# CONFIG_SND_ISA is not set
CONFIG_SND_PCI=y
# CONFIG_SND_AD1889 is not set
# CONFIG_SND_ALS300 is not set
# CONFIG_SND_ALS4000 is not set
# CONFIG_SND_ALI5451 is not set
# CONFIG_SND_ATIIXP is not set
# CONFIG_SND_ATIIXP_MODEM is not set
# CONFIG_SND_AU8810 is not set
# CONFIG_SND_AU8820 is not set
# CONFIG_SND_AU8830 is not set
# CONFIG_SND_AW2 is not set
# CONFIG_SND_AZT3328 is not set
# CONFIG_SND_BT87X is not set
# CONFIG_SND_CA0106 is not set
# CONFIG_SND_CMIPCI is not set
# CONFIG_SND_OXYGEN is not set
# CONFIG_SND_CS4281 is not set
# CONFIG_SND_CS46XX is not set
# CONFIG_SND_CS5530 is not set
# CONFIG_SND_CS5535AUDIO is not set
# CONFIG_SND_CTXFI is not set
# CONFIG_SND_DARLA20 is not set
# CONFIG_SND_GINA20 is not set
# CONFIG_SND_LAYLA20 is not set
# CONFIG_SND_DARLA24 is not set
# CONFIG_SND_GINA24 is not set
# CONFIG_SND_LAYLA24 is not set
# CONFIG_SND_MONA is not set
# CONFIG_SND_MIA is not set
# CONFIG_SND_ECHO3G is not set
# CONFIG_SND_INDIGO is not set
# CONFIG_SND_INDIGOIO is not set
# CONFIG_SND_INDIGODJ is not set
# CONFIG_SND_INDIGOIOX is not set
# CONFIG_SND_INDIGODJX is not set
# CONFIG_SND_EMU10K1 is not set
# CONFIG_SND_EMU10K1X is not set
# CONFIG_SND_ENS1370 is not set
CONFIG_SND_ENS1371=m
# CONFIG_SND_ES1938 is not set
# CONFIG_SND_ES1968 is not set
# CONFIG_SND_FM801 is not set
CONFIG_SND_HDA_INTEL=y
CONFIG_SND_HDA_HWDEP=y
# CONFIG_SND_HDA_RECONFIG is not set
# CONFIG_SND_HDA_INPUT_BEEP is not set
# CONFIG_SND_HDA_INPUT_JACK is not set
# CONFIG_SND_HDA_PATCH_LOADER is not set
CONFIG_SND_HDA_CODEC_REALTEK=y
CONFIG_SND_HDA_CODEC_ANALOG=y
CONFIG_SND_HDA_CODEC_SIGMATEL=y
CONFIG_SND_HDA_CODEC_VIA=y
CONFIG_SND_HDA_CODEC_ATIHDMI=y
CONFIG_SND_HDA_CODEC_NVHDMI=y
CONFIG_SND_HDA_CODEC_INTELHDMI=y
CONFIG_SND_HDA_ELD=y
CONFIG_SND_HDA_CODEC_CIRRUS=y
CONFIG_SND_HDA_CODEC_CONEXANT=y
CONFIG_SND_HDA_CODEC_CA0110=y
CONFIG_SND_HDA_CODEC_CMEDIA=y
CONFIG_SND_HDA_CODEC_SI3054=y
CONFIG_SND_HDA_GENERIC=y
CONFIG_SND_HDA_POWER_SAVE=y
CONFIG_SND_HDA_POWER_SAVE_DEFAULT=5
# CONFIG_SND_HDSP is not set
# CONFIG_SND_HDSPM is not set
# CONFIG_SND_HIFIER is not set
# CONFIG_SND_ICE1712 is not set
# CONFIG_SND_ICE1724 is not set
CONFIG_SND_INTEL8X0=y
# CONFIG_SND_INTEL8X0M is not set
# CONFIG_SND_KORG1212 is not set
# CONFIG_SND_LX6464ES is not set
# CONFIG_SND_MAESTRO3 is not set
# CONFIG_SND_MIXART is not set
# CONFIG_SND_NM256 is not set
# CONFIG_SND_PCXHR is not set
# CONFIG_SND_RIPTIDE is not set
# CONFIG_SND_RME32 is not set
# CONFIG_SND_RME96 is not set
# CONFIG_SND_RME9652 is not set
# CONFIG_SND_SIS7019 is not set
# CONFIG_SND_SONICVIBES is not set
# CONFIG_SND_TRIDENT is not set
# CONFIG_SND_VIA82XX is not set
# CONFIG_SND_VIA82XX_MODEM is not set
# CONFIG_SND_VIRTUOSO is not set
# CONFIG_SND_VX222 is not set
# CONFIG_SND_YMFPCI is not set
CONFIG_SND_USB=y
CONFIG_SND_USB_AUDIO=m
CONFIG_SND_USB_USX2Y=m
CONFIG_SND_USB_CAIAQ=m
CONFIG_SND_USB_CAIAQ_INPUT=y
# CONFIG_SND_USB_US122L is not set
# CONFIG_SND_SOC is not set
# CONFIG_SOUND_PRIME is not set
CONFIG_AC97_BUS=y
CONFIG_HID_SUPPORT=y
CONFIG_HID=y
CONFIG_HIDRAW=y

#
# USB Input Devices
#
CONFIG_USB_HID=y
CONFIG_HID_PID=y
CONFIG_USB_HIDDEV=y

#
# Special HID drivers
#
CONFIG_HID_A4TECH=y
CONFIG_HID_APPLE=y
CONFIG_HID_BELKIN=y
CONFIG_HID_CHERRY=y
CONFIG_HID_CHICONY=y
CONFIG_HID_CYPRESS=y
CONFIG_HID_DRAGONRISE=y
# CONFIG_DRAGONRISE_FF is not set
CONFIG_HID_EZKEY=y
CONFIG_HID_KYE=y
CONFIG_HID_GYRATION=y
CONFIG_HID_TWINHAN=y
CONFIG_HID_KENSINGTON=y
CONFIG_HID_LOGITECH=y
# CONFIG_LOGITECH_FF is not set
# CONFIG_LOGIRUMBLEPAD2_FF is not set
CONFIG_HID_MICROSOFT=y
CONFIG_HID_MONTEREY=y
CONFIG_HID_NTRIG=y
CONFIG_HID_PANTHERLORD=y
# CONFIG_PANTHERLORD_FF is not set
CONFIG_HID_PETALYNX=y
CONFIG_HID_SAMSUNG=y
CONFIG_HID_SONY=y
CONFIG_HID_SUNPLUS=y
CONFIG_HID_GREENASIA=y
# CONFIG_GREENASIA_FF is not set
CONFIG_HID_SMARTJOYPLUS=y
# CONFIG_SMARTJOYPLUS_FF is not set
CONFIG_HID_TOPSEED=y
CONFIG_HID_THRUSTMASTER=y
# CONFIG_THRUSTMASTER_FF is not set
CONFIG_HID_WACOM=y
CONFIG_HID_ZEROPLUS=y
# CONFIG_ZEROPLUS_FF is not set
CONFIG_USB_SUPPORT=y
CONFIG_USB_ARCH_HAS_HCD=y
CONFIG_USB_ARCH_HAS_OHCI=y
CONFIG_USB_ARCH_HAS_EHCI=y
CONFIG_USB=y
# CONFIG_USB_DEBUG is not set
CONFIG_USB_ANNOUNCE_NEW_DEVICES=y

#
# Miscellaneous USB options
#
CONFIG_USB_DEVICEFS=y
# CONFIG_USB_DEVICE_CLASS is not set
# CONFIG_USB_DYNAMIC_MINORS is not set
CONFIG_USB_SUSPEND=y
# CONFIG_USB_OTG is not set
CONFIG_USB_MON=y
CONFIG_USB_WUSB=m
# CONFIG_USB_WUSB_CBAF is not set

#
# USB Host Controller Drivers
#
# CONFIG_USB_C67X00_HCD is not set
# CONFIG_USB_XHCI_HCD is not set
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_EHCI_ROOT_HUB_TT=y
CONFIG_USB_EHCI_TT_NEWSCHED=y
# CONFIG_USB_OXU210HP_HCD is not set
CONFIG_USB_ISP116X_HCD=m
# CONFIG_USB_ISP1760_HCD is not set
# CONFIG_USB_ISP1362_HCD is not set
CONFIG_USB_OHCI_HCD=y
# CONFIG_USB_OHCI_BIG_ENDIAN_DESC is not set
# CONFIG_USB_OHCI_BIG_ENDIAN_MMIO is not set
CONFIG_USB_OHCI_LITTLE_ENDIAN=y
CONFIG_USB_UHCI_HCD=y
CONFIG_USB_U132_HCD=m
CONFIG_USB_SL811_HCD=m
# CONFIG_USB_R8A66597_HCD is not set
CONFIG_USB_WHCI_HCD=m
CONFIG_USB_HWA_HCD=m

#
# USB Device Class drivers
#
CONFIG_USB_ACM=m
CONFIG_USB_PRINTER=m
CONFIG_USB_WDM=m
# CONFIG_USB_TMC is not set

#
# NOTE: USB_STORAGE depends on SCSI but BLK_DEV_SD may
#

#
# also be needed; see USB_STORAGE Help for more info
#
CONFIG_USB_STORAGE=y
# CONFIG_USB_STORAGE_DEBUG is not set
CONFIG_USB_STORAGE_DATAFAB=y
CONFIG_USB_STORAGE_FREECOM=y
CONFIG_USB_STORAGE_ISD200=y
CONFIG_USB_STORAGE_USBAT=y
CONFIG_USB_STORAGE_SDDR09=y
CONFIG_USB_STORAGE_SDDR55=y
CONFIG_USB_STORAGE_JUMPSHOT=y
CONFIG_USB_STORAGE_ALAUDA=y
# CONFIG_USB_STORAGE_ONETOUCH is not set
CONFIG_USB_STORAGE_KARMA=y
# CONFIG_USB_STORAGE_CYPRESS_ATACB is not set
CONFIG_USB_LIBUSUAL=y

#
# USB Imaging devices
#
CONFIG_USB_MDC800=m
CONFIG_USB_MICROTEK=m

#
# USB port drivers
#
CONFIG_USB_SERIAL=m
CONFIG_USB_EZUSB=y
CONFIG_USB_SERIAL_GENERIC=y
CONFIG_USB_SERIAL_AIRCABLE=m
CONFIG_USB_SERIAL_ARK3116=m
CONFIG_USB_SERIAL_BELKIN=m
CONFIG_USB_SERIAL_CH341=m
CONFIG_USB_SERIAL_WHITEHEAT=m
CONFIG_USB_SERIAL_DIGI_ACCELEPORT=m
CONFIG_USB_SERIAL_CP210X=m
CONFIG_USB_SERIAL_CYPRESS_M8=m
CONFIG_USB_SERIAL_EMPEG=m
CONFIG_USB_SERIAL_FTDI_SIO=m
CONFIG_USB_SERIAL_FUNSOFT=m
CONFIG_USB_SERIAL_VISOR=m
CONFIG_USB_SERIAL_IPAQ=m
CONFIG_USB_SERIAL_IR=m
CONFIG_USB_SERIAL_EDGEPORT=m
CONFIG_USB_SERIAL_EDGEPORT_TI=m
CONFIG_USB_SERIAL_GARMIN=m
CONFIG_USB_SERIAL_IPW=m
CONFIG_USB_SERIAL_IUU=m
CONFIG_USB_SERIAL_KEYSPAN_PDA=m
CONFIG_USB_SERIAL_KEYSPAN=m
CONFIG_USB_SERIAL_KEYSPAN_MPR=y
CONFIG_USB_SERIAL_KEYSPAN_USA28=y
CONFIG_USB_SERIAL_KEYSPAN_USA28X=y
CONFIG_USB_SERIAL_KEYSPAN_USA28XA=y
CONFIG_USB_SERIAL_KEYSPAN_USA28XB=y
CONFIG_USB_SERIAL_KEYSPAN_USA19=y
CONFIG_USB_SERIAL_KEYSPAN_USA18X=y
CONFIG_USB_SERIAL_KEYSPAN_USA19W=y
CONFIG_USB_SERIAL_KEYSPAN_USA19QW=y
CONFIG_USB_SERIAL_KEYSPAN_USA19QI=y
CONFIG_USB_SERIAL_KEYSPAN_USA49W=y
CONFIG_USB_SERIAL_KEYSPAN_USA49WLC=y
CONFIG_USB_SERIAL_KLSI=m
CONFIG_USB_SERIAL_KOBIL_SCT=m
CONFIG_USB_SERIAL_MCT_U232=m
CONFIG_USB_SERIAL_MOS7720=m
CONFIG_USB_SERIAL_MOS7840=m
# CONFIG_USB_SERIAL_MOTOROLA is not set
CONFIG_USB_SERIAL_NAVMAN=m
CONFIG_USB_SERIAL_PL2303=m
CONFIG_USB_SERIAL_OTI6858=m
CONFIG_USB_SERIAL_QUALCOMM=m
# CONFIG_USB_SERIAL_SPCP8X5 is not set
CONFIG_USB_SERIAL_HP4X=m
CONFIG_USB_SERIAL_SAFE=m
CONFIG_USB_SERIAL_SAFE_PADDED=y
# CONFIG_USB_SERIAL_SIEMENS_MPI is not set
CONFIG_USB_SERIAL_SIERRAWIRELESS=m
CONFIG_USB_SERIAL_SYMBOL=m
CONFIG_USB_SERIAL_TI=m
CONFIG_USB_SERIAL_CYBERJACK=m
CONFIG_USB_SERIAL_XIRCOM=m
CONFIG_USB_SERIAL_OPTION=m
CONFIG_USB_SERIAL_OMNINET=m
# CONFIG_USB_SERIAL_OPTICON is not set
CONFIG_USB_SERIAL_DEBUG=m

#
# USB Miscellaneous drivers
#
CONFIG_USB_EMI62=m
CONFIG_USB_EMI26=m
CONFIG_USB_ADUTUX=m
# CONFIG_USB_SEVSEG is not set
# CONFIG_USB_RIO500 is not set
CONFIG_USB_LEGOTOWER=m
CONFIG_USB_LCD=m
CONFIG_USB_BERRY_CHARGE=m
CONFIG_USB_LED=m
# CONFIG_USB_CYPRESS_CY7C63 is not set
# CONFIG_USB_CYTHERM is not set
CONFIG_USB_IDMOUSE=m
CONFIG_USB_FTDI_ELAN=m
CONFIG_USB_APPLEDISPLAY=m
CONFIG_USB_SISUSBVGA=m
CONFIG_USB_SISUSBVGA_CON=y
CONFIG_USB_LD=m
CONFIG_USB_TRANCEVIBRATOR=m
CONFIG_USB_IOWARRIOR=m
# CONFIG_USB_TEST is not set
# CONFIG_USB_ISIGHTFW is not set
# CONFIG_USB_VST is not set
# CONFIG_USB_GADGET is not set

#
# OTG and related infrastructure
#
# CONFIG_NOP_USB_XCEIV is not set
CONFIG_UWB=m
CONFIG_UWB_HWA=m
CONFIG_UWB_WHCI=m
# CONFIG_UWB_WLP is not set
# CONFIG_UWB_I1480U is not set
CONFIG_MMC=y
# CONFIG_MMC_DEBUG is not set
# CONFIG_MMC_UNSAFE_RESUME is not set

#
# MMC/SD/SDIO Card Drivers
#
CONFIG_MMC_BLOCK=y
CONFIG_MMC_BLOCK_BOUNCE=y
CONFIG_SDIO_UART=m
# CONFIG_MMC_TEST is not set

#
# MMC/SD/SDIO Host Controller Drivers
#
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_PCI=y
# CONFIG_MMC_RICOH_MMC is not set
# CONFIG_MMC_SDHCI_PLTFM is not set
CONFIG_MMC_WBSD=m
# CONFIG_MMC_AT91 is not set
# CONFIG_MMC_ATMELMCI is not set
CONFIG_MMC_TIFM_SD=m
# CONFIG_MMC_CB710 is not set
# CONFIG_MMC_VIA_SDMMC is not set
# CONFIG_MEMSTICK is not set
CONFIG_NEW_LEDS=y
CONFIG_LEDS_CLASS=y

#
# LED drivers
#
# CONFIG_LEDS_ALIX2 is not set
# CONFIG_LEDS_PCA9532 is not set
# CONFIG_LEDS_LP3944 is not set
# CONFIG_LEDS_CLEVO_MAIL is not set
# CONFIG_LEDS_PCA955X is not set
# CONFIG_LEDS_BD2802 is not set

#
# LED Triggers
#
CONFIG_LEDS_TRIGGERS=y
# CONFIG_LEDS_TRIGGER_TIMER is not set
# CONFIG_LEDS_TRIGGER_HEARTBEAT is not set
# CONFIG_LEDS_TRIGGER_BACKLIGHT is not set
# CONFIG_LEDS_TRIGGER_DEFAULT_ON is not set

#
# iptables trigger is under Netfilter config (LED target)
#
# CONFIG_ACCESSIBILITY is not set
# CONFIG_INFINIBAND is not set
# CONFIG_EDAC is not set
CONFIG_RTC_LIB=y
CONFIG_RTC_CLASS=y
# CONFIG_RTC_HCTOSYS is not set
# CONFIG_RTC_DEBUG is not set

#
# RTC interfaces
#
CONFIG_RTC_INTF_SYSFS=y
CONFIG_RTC_INTF_PROC=y
CONFIG_RTC_INTF_DEV=y
# CONFIG_RTC_INTF_DEV_UIE_EMUL is not set
# CONFIG_RTC_DRV_TEST is not set

#
# I2C RTC drivers
#
# CONFIG_RTC_DRV_DS1307 is not set
# CONFIG_RTC_DRV_DS1374 is not set
# CONFIG_RTC_DRV_DS1672 is not set
# CONFIG_RTC_DRV_MAX6900 is not set
# CONFIG_RTC_DRV_RS5C372 is not set
# CONFIG_RTC_DRV_ISL1208 is not set
# CONFIG_RTC_DRV_X1205 is not set
# CONFIG_RTC_DRV_PCF8563 is not set
# CONFIG_RTC_DRV_PCF8583 is not set
# CONFIG_RTC_DRV_M41T80 is not set
# CONFIG_RTC_DRV_S35390A is not set
# CONFIG_RTC_DRV_FM3130 is not set
# CONFIG_RTC_DRV_RX8581 is not set
# CONFIG_RTC_DRV_RX8025 is not set

#
# SPI RTC drivers
#

#
# Platform RTC drivers
#
CONFIG_RTC_DRV_CMOS=y
# CONFIG_RTC_DRV_DS1286 is not set
# CONFIG_RTC_DRV_DS1511 is not set
# CONFIG_RTC_DRV_DS1553 is not set
# CONFIG_RTC_DRV_DS1742 is not set
# CONFIG_RTC_DRV_STK17TA8 is not set
# CONFIG_RTC_DRV_M48T86 is not set
# CONFIG_RTC_DRV_M48T35 is not set
# CONFIG_RTC_DRV_M48T59 is not set
# CONFIG_RTC_DRV_BQ4802 is not set
# CONFIG_RTC_DRV_V3020 is not set

#
# on-CPU RTC drivers
#
# CONFIG_DMADEVICES is not set
# CONFIG_AUXDISPLAY is not set
# CONFIG_UIO is not set

#
# TI VLYNQ
#
CONFIG_STAGING=y
# CONFIG_STAGING_EXCLUDE_BUILD is not set
# CONFIG_ET131X is not set
# CONFIG_SLICOSS is not set
# CONFIG_VIDEO_GO7007 is not set
# CONFIG_VIDEO_CX25821 is not set
CONFIG_USB_IP_COMMON=m
CONFIG_USB_IP_VHCI_HCD=m
CONFIG_USB_IP_HOST=m
# CONFIG_W35UND is not set
CONFIG_PRISM2_USB=m
# CONFIG_ECHO is not set
# CONFIG_AGNX is not set
# CONFIG_OTUS is not set
CONFIG_RT2860=m
CONFIG_RT2870=m
# CONFIG_RT3090 is not set
# CONFIG_COMEDI is not set
# CONFIG_ASUS_OLED is not set
# CONFIG_ALTERA_PCIE_CHDMA is not set
CONFIG_RTL8187SE=m
# CONFIG_RTL8192SU is not set
# CONFIG_RTL8192E is not set
# CONFIG_INPUT_MIMIO is not set
# CONFIG_TRANZPORT is not set

#
# Android
#
# CONFIG_ANDROID is not set

#
# Qualcomm MSM Camera And Video
#

#
# Camera Sensor Selection
#
# CONFIG_INPUT_GPIO is not set
# CONFIG_DST is not set
# CONFIG_POHMELFS is not set
# CONFIG_B3DFG is not set
# CONFIG_IDE_PHISON is not set
# CONFIG_PLAN9AUTH is not set
CONFIG_LINE6_USB=m
# CONFIG_USB_SERIAL_QUATECH2 is not set
# CONFIG_USB_SERIAL_QUATECH_USB2 is not set
# CONFIG_VT6655 is not set
# CONFIG_VT6656 is not set
# CONFIG_FB_UDL is not set
# CONFIG_HYPERV is not set
# CONFIG_VME_BUS is not set

#
# RAR Register Driver
#
# CONFIG_RAR_REGISTER is not set
# CONFIG_IIO is not set
# CONFIG_COWLOOP is not set
CONFIG_X86_PLATFORM_DEVICES=y
CONFIG_ACER_WMI=y
# CONFIG_ACERHDF is not set
CONFIG_ASUS_LAPTOP=m
CONFIG_DELL_WMI=m
CONFIG_FUJITSU_LAPTOP=m
# CONFIG_FUJITSU_LAPTOP_DEBUG is not set
CONFIG_TC1100_WMI=m
CONFIG_HP_WMI=m
CONFIG_MSI_LAPTOP=m
CONFIG_PANASONIC_LAPTOP=m
CONFIG_COMPAL_LAPTOP=m
CONFIG_SONY_LAPTOP=m
# CONFIG_SONYPI_COMPAT is not set
CONFIG_THINKPAD_ACPI=m
# CONFIG_THINKPAD_ACPI_DEBUGFACILITIES is not set
# CONFIG_THINKPAD_ACPI_DEBUG is not set
# CONFIG_THINKPAD_ACPI_UNSAFE_LEDS is not set
CONFIG_THINKPAD_ACPI_VIDEO=y
CONFIG_THINKPAD_ACPI_HOTKEY_POLL=y
CONFIG_INTEL_MENLOW=y
CONFIG_EEEPC_LAPTOP=m
CONFIG_ACPI_WMI=y
CONFIG_ACPI_ASUS=m
# CONFIG_TOPSTAR_LAPTOP is not set
CONFIG_ACPI_TOSHIBA=m

#
# Firmware Drivers
#
# CONFIG_EDD is not set
CONFIG_FIRMWARE_MEMMAP=y
CONFIG_EFI_VARS=m
# CONFIG_DELL_RBU is not set
# CONFIG_DCDBAS is not set
CONFIG_DMIID=y
# CONFIG_ISCSI_IBFT_FIND is not set

#
# File systems
#
CONFIG_EXT2_FS=y
# CONFIG_EXT2_FS_XATTR is not set
# CONFIG_EXT2_FS_XIP is not set
CONFIG_EXT3_FS=y
# CONFIG_EXT3_DEFAULTS_TO_ORDERED is not set
CONFIG_EXT3_FS_XATTR=y
CONFIG_EXT3_FS_POSIX_ACL=y
CONFIG_EXT3_FS_SECURITY=y
# CONFIG_EXT4_FS is not set
CONFIG_JBD=y
# CONFIG_JBD_DEBUG is not set
CONFIG_FS_MBCACHE=y
# CONFIG_REISERFS_FS is not set
# CONFIG_JFS_FS is not set
CONFIG_FS_POSIX_ACL=y
# CONFIG_XFS_FS is not set
# CONFIG_GFS2_FS is not set
# CONFIG_OCFS2_FS is not set
CONFIG_BTRFS_FS=y
CONFIG_BTRFS_FS_POSIX_ACL=y
# CONFIG_NILFS2_FS is not set
CONFIG_FILE_LOCKING=y
CONFIG_FSNOTIFY=y
CONFIG_DNOTIFY=y
CONFIG_INOTIFY=y
CONFIG_INOTIFY_USER=y
# CONFIG_QUOTA is not set
# CONFIG_AUTOFS_FS is not set
# CONFIG_AUTOFS4_FS is not set
CONFIG_FUSE_FS=m
# CONFIG_CUSE is not set
CONFIG_GENERIC_ACL=y

#
# Caches
#
# CONFIG_FSCACHE is not set

#
# CD-ROM/DVD Filesystems
#
CONFIG_ISO9660_FS=y
CONFIG_JOLIET=y
CONFIG_ZISOFS=y
CONFIG_UDF_FS=m
CONFIG_UDF_NLS=y

#
# DOS/FAT/NT Filesystems
#
CONFIG_FAT_FS=y
CONFIG_MSDOS_FS=y
CONFIG_VFAT_FS=y
CONFIG_FAT_DEFAULT_CODEPAGE=437
CONFIG_FAT_DEFAULT_IOCHARSET="ascii"
# CONFIG_NTFS_FS is not set

#
# Pseudo filesystems
#
CONFIG_PROC_FS=y
# CONFIG_PROC_KCORE is not set
CONFIG_PROC_SYSCTL=y
CONFIG_PROC_PAGE_MONITOR=y
CONFIG_SYSFS=y
CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
# CONFIG_HUGETLBFS is not set
# CONFIG_HUGETLB_PAGE is not set
CONFIG_CONFIGFS_FS=m
CONFIG_MISC_FILESYSTEMS=y
# CONFIG_ADFS_FS is not set
# CONFIG_AFFS_FS is not set
# CONFIG_HFS_FS is not set
# CONFIG_HFSPLUS_FS is not set
# CONFIG_BEFS_FS is not set
# CONFIG_BFS_FS is not set
# CONFIG_EFS_FS is not set
# CONFIG_CRAMFS is not set
CONFIG_SQUASHFS=y
# CONFIG_SQUASHFS_EMBEDDED is not set
CONFIG_SQUASHFS_FRAGMENT_CACHE_SIZE=3
# CONFIG_VXFS_FS is not set
# CONFIG_MINIX_FS is not set
# CONFIG_OMFS_FS is not set
# CONFIG_HPFS_FS is not set
# CONFIG_QNX4FS_FS is not set
# CONFIG_ROMFS_FS is not set
# CONFIG_SYSV_FS is not set
# CONFIG_UFS_FS is not set
CONFIG_NETWORK_FILESYSTEMS=y
# CONFIG_NFS_FS is not set
# CONFIG_NFSD is not set
# CONFIG_SMB_FS is not set
CONFIG_CIFS=m
# CONFIG_CIFS_STATS is not set
CONFIG_CIFS_WEAK_PW_HASH=y
# CONFIG_CIFS_XATTR is not set
# CONFIG_CIFS_DEBUG2 is not set
# CONFIG_CIFS_EXPERIMENTAL is not set
# CONFIG_NCP_FS is not set
# CONFIG_CODA_FS is not set
# CONFIG_AFS_FS is not set

#
# Partition Types
#
CONFIG_PARTITION_ADVANCED=y
# CONFIG_ACORN_PARTITION is not set
# CONFIG_OSF_PARTITION is not set
# CONFIG_AMIGA_PARTITION is not set
# CONFIG_ATARI_PARTITION is not set
# CONFIG_MAC_PARTITION is not set
CONFIG_MSDOS_PARTITION=y
CONFIG_BSD_DISKLABEL=y
# CONFIG_MINIX_SUBPARTITION is not set
# CONFIG_SOLARIS_X86_PARTITION is not set
# CONFIG_UNIXWARE_DISKLABEL is not set
CONFIG_LDM_PARTITION=y
# CONFIG_LDM_DEBUG is not set
# CONFIG_SGI_PARTITION is not set
# CONFIG_ULTRIX_PARTITION is not set
# CONFIG_SUN_PARTITION is not set
# CONFIG_KARMA_PARTITION is not set
CONFIG_EFI_PARTITION=y
# CONFIG_SYSV68_PARTITION is not set
CONFIG_NLS=y
CONFIG_NLS_DEFAULT="utf8"
CONFIG_NLS_CODEPAGE_437=y
CONFIG_NLS_CODEPAGE_737=m
CONFIG_NLS_CODEPAGE_775=m
CONFIG_NLS_CODEPAGE_850=m
CONFIG_NLS_CODEPAGE_852=m
CONFIG_NLS_CODEPAGE_855=m
CONFIG_NLS_CODEPAGE_857=m
CONFIG_NLS_CODEPAGE_860=m
CONFIG_NLS_CODEPAGE_861=m
CONFIG_NLS_CODEPAGE_862=m
CONFIG_NLS_CODEPAGE_863=m
CONFIG_NLS_CODEPAGE_864=m
CONFIG_NLS_CODEPAGE_865=m
CONFIG_NLS_CODEPAGE_866=m
CONFIG_NLS_CODEPAGE_869=m
CONFIG_NLS_CODEPAGE_936=m
CONFIG_NLS_CODEPAGE_950=m
CONFIG_NLS_CODEPAGE_932=m
CONFIG_NLS_CODEPAGE_949=m
CONFIG_NLS_CODEPAGE_874=m
CONFIG_NLS_ISO8859_8=m
CONFIG_NLS_CODEPAGE_1250=m
CONFIG_NLS_CODEPAGE_1251=m
CONFIG_NLS_ASCII=y
CONFIG_NLS_ISO8859_1=m
CONFIG_NLS_ISO8859_2=m
CONFIG_NLS_ISO8859_3=m
CONFIG_NLS_ISO8859_4=m
CONFIG_NLS_ISO8859_5=m
CONFIG_NLS_ISO8859_6=m
CONFIG_NLS_ISO8859_7=m
CONFIG_NLS_ISO8859_9=m
CONFIG_NLS_ISO8859_13=m
CONFIG_NLS_ISO8859_14=m
CONFIG_NLS_ISO8859_15=m
CONFIG_NLS_KOI8_R=m
CONFIG_NLS_KOI8_U=m
CONFIG_NLS_UTF8=m
# CONFIG_DLM is not set

#
# Kernel hacking
#
CONFIG_TRACE_IRQFLAGS_SUPPORT=y
CONFIG_PRINTK_TIME=y
# CONFIG_ENABLE_WARN_DEPRECATED is not set
CONFIG_ENABLE_MUST_CHECK=y
CONFIG_FRAME_WARN=1024
CONFIG_MAGIC_SYSRQ=y
# CONFIG_STRIP_ASM_SYMS is not set
# CONFIG_UNUSED_SYMBOLS is not set
CONFIG_DEBUG_FS=y
# CONFIG_HEADERS_CHECK is not set
CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_SHIRQ=y
CONFIG_DETECT_SOFTLOCKUP=y
# CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC is not set
CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC_VALUE=0
# CONFIG_DETECT_HUNG_TASK is not set
CONFIG_SCHED_DEBUG=y
CONFIG_SCHEDSTATS=y
CONFIG_TIMER_STATS=y
# CONFIG_DEBUG_OBJECTS is not set
# CONFIG_DEBUG_SLAB is not set
# CONFIG_DEBUG_KMEMLEAK is not set
# CONFIG_DEBUG_PREEMPT is not set
# CONFIG_DEBUG_RT_MUTEXES is not set
# CONFIG_RT_MUTEX_TESTER is not set
CONFIG_DEBUG_SPINLOCK=y
# CONFIG_DEBUG_MUTEXES is not set
# CONFIG_DEBUG_LOCK_ALLOC is not set
# CONFIG_PROVE_LOCKING is not set
# CONFIG_LOCK_STAT is not set
CONFIG_DEBUG_SPINLOCK_SLEEP=y
# CONFIG_DEBUG_LOCKING_API_SELFTESTS is not set
CONFIG_STACKTRACE=y
# CONFIG_DEBUG_KOBJECT is not set
CONFIG_DEBUG_HIGHMEM=y
CONFIG_DEBUG_BUGVERBOSE=y
CONFIG_DEBUG_INFO=y
# CONFIG_DEBUG_VM is not set
# CONFIG_DEBUG_VIRTUAL is not set
# CONFIG_DEBUG_WRITECOUNT is not set
CONFIG_DEBUG_MEMORY_INIT=y
CONFIG_DEBUG_LIST=y
# CONFIG_DEBUG_SG is not set
CONFIG_DEBUG_NOTIFIERS=y
# CONFIG_DEBUG_CREDENTIALS is not set
CONFIG_ARCH_WANT_FRAME_POINTERS=y
CONFIG_FRAME_POINTER=y
CONFIG_BOOT_PRINTK_DELAY=y
# CONFIG_RCU_TORTURE_TEST is not set
# CONFIG_RCU_CPU_STALL_DETECTOR is not set
# CONFIG_BACKTRACE_SELF_TEST is not set
# CONFIG_DEBUG_BLOCK_EXT_DEVT is not set
# CONFIG_DEBUG_FORCE_WEAK_PER_CPU is not set
# CONFIG_FAULT_INJECTION is not set
CONFIG_LATENCYTOP=y
CONFIG_SYSCTL_SYSCALL_CHECK=y
# CONFIG_DEBUG_PAGEALLOC is not set
CONFIG_USER_STACKTRACE_SUPPORT=y
CONFIG_NOP_TRACER=y
CONFIG_HAVE_FUNCTION_TRACER=y
CONFIG_HAVE_FUNCTION_GRAPH_TRACER=y
CONFIG_HAVE_FUNCTION_GRAPH_FP_TEST=y
CONFIG_HAVE_FUNCTION_TRACE_MCOUNT_TEST=y
CONFIG_HAVE_DYNAMIC_FTRACE=y
CONFIG_HAVE_FTRACE_MCOUNT_RECORD=y
CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
CONFIG_TRACER_MAX_TRACE=y
CONFIG_RING_BUFFER=y
CONFIG_EVENT_TRACING=y
CONFIG_CONTEXT_SWITCH_TRACER=y
CONFIG_RING_BUFFER_ALLOW_SWAP=y
CONFIG_TRACING=y
CONFIG_GENERIC_TRACER=y
CONFIG_TRACING_SUPPORT=y
CONFIG_FTRACE=y
# CONFIG_FUNCTION_TRACER is not set
# CONFIG_IRQSOFF_TRACER is not set
# CONFIG_PREEMPT_TRACER is not set
CONFIG_SYSPROF_TRACER=y
CONFIG_SCHED_TRACER=y
# CONFIG_FTRACE_SYSCALLS is not set
# CONFIG_BOOT_TRACER is not set
CONFIG_BRANCH_PROFILE_NONE=y
# CONFIG_PROFILE_ANNOTATED_BRANCHES is not set
# CONFIG_PROFILE_ALL_BRANCHES is not set
CONFIG_POWER_TRACER=y
# CONFIG_STACK_TRACER is not set
# CONFIG_KMEMTRACE is not set
# CONFIG_WORKQUEUE_TRACER is not set
CONFIG_BLK_DEV_IO_TRACE=y
# CONFIG_FTRACE_STARTUP_TEST is not set
# CONFIG_MMIOTRACE is not set
# CONFIG_RING_BUFFER_BENCHMARK is not set
# CONFIG_PROVIDE_OHCI1394_DMA_INIT is not set
# CONFIG_DYNAMIC_DEBUG is not set
# CONFIG_DMA_API_DEBUG is not set
# CONFIG_SAMPLES is not set
CONFIG_HAVE_ARCH_KGDB=y
# CONFIG_KGDB is not set
CONFIG_HAVE_ARCH_KMEMCHECK=y
CONFIG_STRICT_DEVMEM=y
CONFIG_X86_VERBOSE_BOOTUP=y
CONFIG_EARLY_PRINTK=y
# CONFIG_EARLY_PRINTK_DBGP is not set
# CONFIG_DEBUG_STACKOVERFLOW is not set
# CONFIG_DEBUG_STACK_USAGE is not set
# CONFIG_DEBUG_PER_CPU_MAPS is not set
# CONFIG_X86_PTDUMP is not set
CONFIG_DEBUG_RODATA=y
# CONFIG_DEBUG_RODATA_TEST is not set
# CONFIG_DEBUG_NX_TEST is not set
# CONFIG_4KSTACKS is not set
CONFIG_DOUBLEFAULT=y
# CONFIG_IOMMU_STRESS is not set
CONFIG_HAVE_MMIOTRACE_SUPPORT=y
CONFIG_IO_DELAY_TYPE_0X80=0
CONFIG_IO_DELAY_TYPE_0XED=1
CONFIG_IO_DELAY_TYPE_UDELAY=2
CONFIG_IO_DELAY_TYPE_NONE=3
CONFIG_IO_DELAY_0X80=y
# CONFIG_IO_DELAY_0XED is not set
# CONFIG_IO_DELAY_UDELAY is not set
# CONFIG_IO_DELAY_NONE is not set
CONFIG_DEFAULT_IO_DELAY_TYPE=0
CONFIG_DEBUG_BOOT_PARAMS=y
# CONFIG_CPA_DEBUG is not set
# CONFIG_OPTIMIZE_INLINING is not set

#
# Security options
#
# CONFIG_KEYS is not set
# CONFIG_SECURITY is not set
# CONFIG_SECURITYFS is not set
# CONFIG_SECURITY_FILE_CAPABILITIES is not set
# CONFIG_IMA is not set
CONFIG_CRYPTO=y

#
# Crypto core or helper
#
CONFIG_CRYPTO_ALGAPI=y
CONFIG_CRYPTO_ALGAPI2=y
CONFIG_CRYPTO_AEAD=m
CONFIG_CRYPTO_AEAD2=y
CONFIG_CRYPTO_BLKCIPHER=y
CONFIG_CRYPTO_BLKCIPHER2=y
CONFIG_CRYPTO_HASH=y
CONFIG_CRYPTO_HASH2=y
CONFIG_CRYPTO_RNG=m
CONFIG_CRYPTO_RNG2=y
CONFIG_CRYPTO_PCOMP=y
CONFIG_CRYPTO_MANAGER=y
CONFIG_CRYPTO_MANAGER2=y
CONFIG_CRYPTO_GF128MUL=m
CONFIG_CRYPTO_NULL=m
CONFIG_CRYPTO_WORKQUEUE=y
# CONFIG_CRYPTO_CRYPTD is not set
CONFIG_CRYPTO_AUTHENC=m
CONFIG_CRYPTO_TEST=m

#
# Authenticated Encryption with Associated Data
#
CONFIG_CRYPTO_CCM=m
CONFIG_CRYPTO_GCM=m
CONFIG_CRYPTO_SEQIV=m

#
# Block modes
#
CONFIG_CRYPTO_CBC=m
CONFIG_CRYPTO_CTR=m
# CONFIG_CRYPTO_CTS is not set
CONFIG_CRYPTO_ECB=y
CONFIG_CRYPTO_LRW=m
CONFIG_CRYPTO_PCBC=m
CONFIG_CRYPTO_XTS=m

#
# Hash modes
#
CONFIG_CRYPTO_HMAC=y
CONFIG_CRYPTO_XCBC=m
# CONFIG_CRYPTO_VMAC is not set

#
# Digest
#
CONFIG_CRYPTO_CRC32C=y
# CONFIG_CRYPTO_CRC32C_INTEL is not set
CONFIG_CRYPTO_GHASH=m
CONFIG_CRYPTO_MD4=m
CONFIG_CRYPTO_MD5=y
CONFIG_CRYPTO_MICHAEL_MIC=m
# CONFIG_CRYPTO_RMD128 is not set
# CONFIG_CRYPTO_RMD160 is not set
# CONFIG_CRYPTO_RMD256 is not set
# CONFIG_CRYPTO_RMD320 is not set
CONFIG_CRYPTO_SHA1=y
CONFIG_CRYPTO_SHA256=m
CONFIG_CRYPTO_SHA512=m
CONFIG_CRYPTO_TGR192=m
CONFIG_CRYPTO_WP512=m

#
# Ciphers
#
CONFIG_CRYPTO_AES=y
CONFIG_CRYPTO_AES_586=m
CONFIG_CRYPTO_ANUBIS=m
CONFIG_CRYPTO_ARC4=y
CONFIG_CRYPTO_BLOWFISH=m
CONFIG_CRYPTO_CAMELLIA=m
CONFIG_CRYPTO_CAST5=m
CONFIG_CRYPTO_CAST6=m
CONFIG_CRYPTO_DES=m
CONFIG_CRYPTO_FCRYPT=m
CONFIG_CRYPTO_KHAZAD=m
CONFIG_CRYPTO_SALSA20=m
CONFIG_CRYPTO_SALSA20_586=m
CONFIG_CRYPTO_SEED=m
CONFIG_CRYPTO_SERPENT=m
CONFIG_CRYPTO_TEA=m
CONFIG_CRYPTO_TWOFISH=m
CONFIG_CRYPTO_TWOFISH_COMMON=m
CONFIG_CRYPTO_TWOFISH_586=m

#
# Compression
#
CONFIG_CRYPTO_DEFLATE=m
CONFIG_CRYPTO_ZLIB=y
# CONFIG_CRYPTO_LZO is not set

#
# Random Number Generation
#
# CONFIG_CRYPTO_ANSI_CPRNG is not set
CONFIG_CRYPTO_HW=y
# CONFIG_CRYPTO_DEV_PADLOCK is not set
# CONFIG_CRYPTO_DEV_GEODE is not set
# CONFIG_CRYPTO_DEV_HIFN_795X is not set
CONFIG_HAVE_KVM=y
CONFIG_HAVE_KVM_IRQCHIP=y
CONFIG_HAVE_KVM_EVENTFD=y
CONFIG_KVM_APIC_ARCHITECTURE=y
CONFIG_VIRTUALIZATION=y
CONFIG_KVM=m
CONFIG_KVM_INTEL=m
# CONFIG_KVM_AMD is not set
# CONFIG_LGUEST is not set
# CONFIG_VIRTIO_PCI is not set
# CONFIG_VIRTIO_BALLOON is not set
CONFIG_BINARY_PRINTF=y

#
# Library routines
#
CONFIG_BITREVERSE=y
CONFIG_GENERIC_FIND_FIRST_BIT=y
CONFIG_GENERIC_FIND_NEXT_BIT=y
CONFIG_GENERIC_FIND_LAST_BIT=y
CONFIG_CRC_CCITT=m
CONFIG_CRC16=y
# CONFIG_CRC_T10DIF is not set
CONFIG_CRC_ITU_T=m
CONFIG_CRC32=y
# CONFIG_CRC7 is not set
CONFIG_LIBCRC32C=y
CONFIG_ZLIB_INFLATE=y
CONFIG_ZLIB_DEFLATE=y
CONFIG_DECOMPRESS_GZIP=y
CONFIG_DECOMPRESS_BZIP2=y
CONFIG_DECOMPRESS_LZMA=y
CONFIG_TEXTSEARCH=y
CONFIG_TEXTSEARCH_KMP=m
CONFIG_TEXTSEARCH_BM=m
CONFIG_TEXTSEARCH_FSM=m
CONFIG_HAS_IOMEM=y
CONFIG_HAS_IOPORT=y
CONFIG_HAS_DMA=y
CONFIG_CHECK_SIGNATURE=y
CONFIG_NLATTR=y

Thanks,

Lance Hepler


From netrolller.3d at gmail.com  Tue Oct  6 12:48:14 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Tue, 6 Oct 2009 12:48:14 +0200
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com>
References: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com>
Message-ID: <69e28c910910060348l2351285aqb0577f622bebde10@mail.gmail.com>

On Tue, Oct 6, 2009 at 5:27 AM, Lance Hepler <nlhepler at gmail.com> wrote:
> Hello all,
>
> Like Charlie, I also have DMA errors, and not specifically to
> 2.6.31+compat-wireless. I have been testing the LP-PHY changes on
> 2.6.32-rc1/2 and
> 2.6.32-rc3+b43_Dont_use_struct_wldev_after_detach.patch (so I can
> unload the module without an oops) kernels and consistently get DMA
> errors while trying to associate to an AP.
>
> First, let me make my experiences explicit. If I cold-boot, sometimes
> I can connect using b43 (albeit with a few "NOHZ:
> local_softirq_pending 08" errors). Once I sleep+resume, the controller
> seems to be put into a broken state, and any subsequent attempt to
> connect will fail with a DMA error, even after module unload+reload,
> attempts to use the proprietary wl module, or anything else I could
> think of (retrying sleep+resume, ifconfig up/down, etc etc). To once
> again have use of my wireless card, I will have to cold-boot the
> machine.

So, this error happens specifically on suspend/resume?

>
> I am using the latest Moblin 2.1 preview on a Dell Mini 10v with the
> latest 478.104 firmware as grabbed from the instructions on
> linuxwireless.org.
>
> I'm willing to test basically anything, although I have noted in the
> past you have asked users to test the 5xx firmware, which isn't
> available in the current git b43-tools package, and requires some
> obscure patches and an absurdly large download of linksys source
> packages to grab.. Wouldn't it be easier to find a way to grab it from
> the STA wl driver "source" available on Broadcom's website
> (wlc_hybrid.o_shipped)?
>
> Please see the following logs for expanded info:
>
>>> uname -a
> Linux Frogstar 2.6.32-rc3-netbook #1 SMP PREEMPT Mon Oct 5 00:33:22
> PDT 2009 i686 i686 i386 GNU/Linux
>
>>> /sbin/lspci -vvnn
> 00:00.0 Host bridge [0600]: Intel Corporation Mobile 945GME Express
> Memory Controller Hub [8086:27ac] (rev 03)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR+ FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort+ >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: agpgart-intel
>
> 00:02.0 VGA compatible controller [0300]: Intel Corporation Mobile
> 945GME Express Integrated Graphics Controller [8086:27ae] (rev 03)
> (prog-if 00 [VGA controller])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin A routed to IRQ 16
> ? ? ? ?Region 0: Memory at f0000000 (32-bit, non-prefetchable) [size=512K]
> ? ? ? ?Region 1: I/O ports at 1800 [size=8]
> ? ? ? ?Region 2: Memory at d0000000 (32-bit, prefetchable) [size=256M]
> ? ? ? ?Region 3: Memory at f0200000 (32-bit, non-prefetchable) [size=256K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: i915
>
> 00:02.1 Display controller [0380]: Intel Corporation Mobile
> 945GM/GMS/GME, 943/940GML Express Integrated Graphics Controller
> [8086:27a6] (rev 03)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Region 0: Memory at f0080000 (32-bit, non-prefetchable) [size=512K]
> ? ? ? ?Capabilities: <access denied>
>
> 00:1b.0 Audio device [0403]: Intel Corporation 82801G (ICH7 Family)
> High Definition Audio Controller [8086:27d8] (rev 02)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Interrupt: pin A routed to IRQ 22
> ? ? ? ?Region 0: Memory at f0440000 (64-bit, non-prefetchable) [size=16K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: HDA Intel
>
> 00:1c.0 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
> Express Port 1 [8086:27d0] (rev 02) (prog-if 00 [Normal decode])
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx+
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Bus: primary=00, secondary=02, subordinate=02, sec-latency=0
> ? ? ? ?I/O behind bridge: 00003000-00003fff
> ? ? ? ?Memory behind bridge: 40000000-401fffff
> ? ? ? ?Prefetchable memory behind bridge: 0000000040200000-00000000403fffff
> ? ? ? ?Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort+ <SERR- <PERR-
> ? ? ? ?BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
> ? ? ? ? ? ? ? ?PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: pcieport-driver
>
> 00:1c.1 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
> Express Port 2 [8086:27d2] (rev 02) (prog-if 00 [Normal decode])
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx+
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Bus: primary=00, secondary=03, subordinate=03, sec-latency=0
> ? ? ? ?I/O behind bridge: 00004000-00004fff
> ? ? ? ?Memory behind bridge: f0100000-f01fffff
> ? ? ? ?Prefetchable memory behind bridge: 0000000040400000-00000000405fffff
> ? ? ? ?Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort+ <SERR- <PERR-
> ? ? ? ?BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
> ? ? ? ? ? ? ? ?PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: pcieport-driver
>
> 00:1c.2 PCI bridge [0604]: Intel Corporation 82801G (ICH7 Family) PCI
> Express Port 3 [8086:27d4] (rev 02) (prog-if 00 [Normal decode])
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx+
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Bus: primary=00, secondary=04, subordinate=04, sec-latency=0
> ? ? ? ?I/O behind bridge: 00002000-00002fff
> ? ? ? ?Memory behind bridge: 40600000-409fffff
> ? ? ? ?Prefetchable memory behind bridge: 00000000f0500000-00000000f05fffff
> ? ? ? ?Secondary status: 66MHz- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort+ <SERR- <PERR-
> ? ? ? ?BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
> ? ? ? ? ? ? ? ?PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: pcieport-driver
>
> 00:1d.0 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
> USB UHCI Controller #1 [8086:27c8] (rev 02) (prog-if 00 [UHCI])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin A routed to IRQ 23
> ? ? ? ?Region 4: I/O ports at 1820 [size=32]
> ? ? ? ?Kernel driver in use: uhci_hcd
>
> 00:1d.1 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
> USB UHCI Controller #2 [8086:27c9] (rev 02) (prog-if 00 [UHCI])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin B routed to IRQ 19
> ? ? ? ?Region 4: I/O ports at 1840 [size=32]
> ? ? ? ?Kernel driver in use: uhci_hcd
>
> 00:1d.2 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
> USB UHCI Controller #3 [8086:27ca] (rev 02) (prog-if 00 [UHCI])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin C routed to IRQ 18
> ? ? ? ?Region 4: I/O ports at 1860 [size=32]
> ? ? ? ?Kernel driver in use: uhci_hcd
>
> 00:1d.3 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
> USB UHCI Controller #4 [8086:27cb] (rev 02) (prog-if 00 [UHCI])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin D routed to IRQ 16
> ? ? ? ?Region 4: I/O ports at 1880 [size=32]
> ? ? ? ?Kernel driver in use: uhci_hcd
>
> 00:1d.7 USB Controller [0c03]: Intel Corporation 82801G (ICH7 Family)
> USB2 EHCI Controller [8086:27cc] (rev 02) (prog-if 20 [EHCI])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin A routed to IRQ 23
> ? ? ? ?Region 0: Memory at f0444000 (32-bit, non-prefetchable) [size=1K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: ehci_hcd
>
> 00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge
> [8086:2448] (rev e2) (prog-if 01 [Subtractive decode])
> ? ? ? ?Control: I/O- Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Bus: primary=00, secondary=05, subordinate=05, sec-latency=32
> ? ? ? ?Secondary status: 66MHz- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort+ <SERR- <PERR-
> ? ? ? ?BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- >Reset- FastB2B-
> ? ? ? ? ? ? ? ?PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn-
> ? ? ? ?Capabilities: <access denied>
>
> 00:1f.0 ISA bridge [0601]: Intel Corporation 82801GBM (ICH7-M) LPC
> Interface Bridge [8086:27b9] (rev 02)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Capabilities: <access denied>
>
> 00:1f.2 IDE interface [0101]: Intel Corporation 82801GBM/GHM (ICH7
> Family) SATA IDE Controller [8086:27c4] (rev 02) (prog-if 8a [Master
> SecP PriP])
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz+ UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0
> ? ? ? ?Interrupt: pin B routed to IRQ 19
> ? ? ? ?Region 0: I/O ports at 01f0 [size=8]
> ? ? ? ?Region 1: I/O ports at 03f4 [size=1]
> ? ? ? ?Region 2: I/O ports at 0170 [size=8]
> ? ? ? ?Region 3: I/O ports at 0374 [size=1]
> ? ? ? ?Region 4: I/O ports at 1810 [size=16]
> ? ? ? ?Region 5: Memory at 40a00000 (32-bit, non-prefetchable) [size=1K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: ata_piix
>
> 00:1f.3 SMBus [0c05]: Intel Corporation 82801G (ICH7 Family) SMBus
> Controller [8086:27da] (rev 02)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem- BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap- 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Interrupt: pin B routed to IRQ 10
> ? ? ? ?Region 4: I/O ports at 18c0 [size=32]
>
> 03:00.0 Network controller [0280]: Broadcom Corporation BCM4312
> 802.11b/g [14e4:4315] (rev 01)
> ? ? ? ?Subsystem: Dell Wireless 1397 WLAN Mini-Card [1028:000c]
> ? ? ? ?Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Interrupt: pin A routed to IRQ 17
> ? ? ? ?Region 0: Memory at f0100000 (64-bit, non-prefetchable) [size=16K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: b43-pci-bridge
> ? ? ? ?Kernel modules: wl, ssb
>
> 04:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd.
> RTL8101E/RTL8102E PCI Express Fast Ethernet controller [10ec:8136]
> (rev 02)
> ? ? ? ?Subsystem: Dell Unknown device [1028:02f4]
> ? ? ? ?Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr-
> Stepping- SERR- FastB2B- DisINTx+
> ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ?Interrupt: pin A routed to IRQ 27
> ? ? ? ?Region 0: I/O ports at 2000 [size=256]
> ? ? ? ?Region 2: Memory at f0510000 (64-bit, prefetchable) [size=4K]
> ? ? ? ?Region 4: Memory at f0500000 (64-bit, prefetchable) [size=64K]
> ? ? ? ?[virtual] Expansion ROM at f0520000 [disabled] [size=128K]
> ? ? ? ?Capabilities: <access denied>
> ? ? ? ?Kernel driver in use: r8169
>
>
>>> dmesg
> [ ?220.487137] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?221.868442] b43-phy1 debug: Chip initialized
> [ ?221.868886] b43-phy1 debug: 64-bit DMA initialized
> [ ?221.869185] b43-phy1 debug: QoS enabled
> [ ?221.878480] b43-phy1 debug: Wireless interface started
> [ ?221.878508] b43-phy1: Controller restarted
> [ ?221.879669] b43-phy1 debug: Wireless interface stopped
> [ ?222.046440] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> [ ?222.049134] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?223.430374] b43-phy1 debug: Chip initialized
> [ ?223.430846] b43-phy1 debug: 64-bit DMA initialized
> [ ?223.431383] b43-phy1 debug: QoS enabled
> [ ?223.440380] b43-phy1 debug: Wireless interface started
> [ ?223.440404] __ratelimit: 2 callbacks suppressed
> [ ?223.440417] b43-phy1:
> [ ?223.440426] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
> 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> [ ?223.440450] b43-phy1: Controller RESET (DMA error) ...
> [ ?223.440464] Controller restarted
> [ ?223.441218] b43-phy1 debug: Wireless interface stopped
> [ ?223.610596] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> [ ?223.613314] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?224.997453] b43-phy1 debug: Chip initialized
> [ ?224.997893] b43-phy1 debug: 64-bit DMA initialized
> [ ?224.998190] b43-phy1 debug: QoS enabled
> [ ?225.007481] b43-phy1 debug: Wireless interface started
> [ ?225.007500] b43-phy1: Controller restarted
> [ ?225.007554] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
> 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> [ ?225.007575] b43-phy1: Controller RESET (DMA error) ...
> [ ?225.008102] b43-phy1 debug: Wireless interface stopped
> [ ?225.176380] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> [ ?225.179102] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?226.560502] b43-phy1 debug: Chip initialized
> [ ?226.560945] b43-phy1 debug: 64-bit DMA initialized
> [ ?226.561243] b43-phy1 debug: QoS enabled
> [ ?226.570534] b43-phy1 debug: Wireless interface started
> [ ?226.570555] b43-phy1: Controller restarted
> [ ?226.570598] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
> 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> [ ?226.570619] b43-phy1: Controller RESET (DMA error) ...
> [ ?226.571146] b43-phy1 debug: Wireless interface stopped
> [ ?226.740453] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> [ ?226.743139] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?228.125476] b43-phy1 debug: Chip initialized
> [ ?228.125914] b43-phy1 debug: 64-bit DMA initialized
> [ ?228.126213] b43-phy1 debug: QoS enabled
> [ ?228.135381] b43-phy1 debug: Wireless interface started
> [ ?228.135408] b43-phy1: Controller restarted
> [ ?228.135745] b43-phy1 debug: Wireless interface stopped
> [ ?228.304381] b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> [ ?228.307117] b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> [ ?229.687826] b43-phy1 debug: Chip initialized
> [ ?229.688393] b43-phy1 debug: 64-bit DMA initialized
> [ ?229.688680] b43-phy1 debug: QoS enabled
> [ ?229.697865] b43-phy1 debug: Wireless interface started
> [ ?229.697888] __ratelimit: 2 callbacks suppressed
> [ ?229.697900] b43-phy1: Controller restarted
> [ ?229.697947] b43-phy1 ERROR: Fatal DMA error: 0x00000400,
> 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> [ ?229.697968] b43-phy1: Controller RESET (DMA error) ...
> [ ?229.698894] b43-phy1 debug: Wireless interface stopped
> {truncated to remove further duplicates of the above load/reset loop}
>
>>> cat ~/build/kernel/.config
> #
> # Automatically generated make config: don't edit
> # Linux kernel version: 2.6.32-rc3
> # Sun Oct ?4 23:23:27 2009
> #
> # CONFIG_64BIT is not set
> CONFIG_X86_32=y
> # CONFIG_X86_64 is not set
> CONFIG_X86=y
> CONFIG_OUTPUT_FORMAT="elf32-i386"
> CONFIG_ARCH_DEFCONFIG="arch/x86/configs/i386_defconfig"
> CONFIG_GENERIC_TIME=y
> CONFIG_GENERIC_CMOS_UPDATE=y
> CONFIG_CLOCKSOURCE_WATCHDOG=y
> CONFIG_GENERIC_CLOCKEVENTS=y
> CONFIG_GENERIC_CLOCKEVENTS_BROADCAST=y
> CONFIG_LOCKDEP_SUPPORT=y
> CONFIG_STACKTRACE_SUPPORT=y
> CONFIG_HAVE_LATENCYTOP_SUPPORT=y
> CONFIG_FAST_CMPXCHG_LOCAL=y
> CONFIG_MMU=y
> CONFIG_ZONE_DMA=y
> CONFIG_GENERIC_ISA_DMA=y
> CONFIG_GENERIC_IOMAP=y
> CONFIG_GENERIC_BUG=y
> CONFIG_GENERIC_HWEIGHT=y
> CONFIG_ARCH_MAY_HAVE_PC_FDC=y
> # CONFIG_RWSEM_GENERIC_SPINLOCK is not set
> CONFIG_RWSEM_XCHGADD_ALGORITHM=y
> CONFIG_ARCH_HAS_CPU_IDLE_WAIT=y
> CONFIG_GENERIC_CALIBRATE_DELAY=y
> # CONFIG_GENERIC_TIME_VSYSCALL is not set
> CONFIG_ARCH_HAS_CPU_RELAX=y
> CONFIG_ARCH_HAS_DEFAULT_IDLE=y
> CONFIG_ARCH_HAS_CACHE_LINE_SIZE=y
> CONFIG_HAVE_SETUP_PER_CPU_AREA=y
> CONFIG_NEED_PER_CPU_EMBED_FIRST_CHUNK=y
> CONFIG_NEED_PER_CPU_PAGE_FIRST_CHUNK=y
> # CONFIG_HAVE_CPUMASK_OF_CPU_MAP is not set
> CONFIG_ARCH_HIBERNATION_POSSIBLE=y
> CONFIG_ARCH_SUSPEND_POSSIBLE=y
> # CONFIG_ZONE_DMA32 is not set
> CONFIG_ARCH_POPULATES_NODE_MAP=y
> # CONFIG_AUDIT_ARCH is not set
> CONFIG_ARCH_SUPPORTS_OPTIMIZED_INLINING=y
> CONFIG_ARCH_SUPPORTS_DEBUG_PAGEALLOC=y
> CONFIG_GENERIC_HARDIRQS=y
> CONFIG_GENERIC_HARDIRQS_NO__DO_IRQ=y
> CONFIG_GENERIC_IRQ_PROBE=y
> CONFIG_GENERIC_PENDING_IRQ=y
> CONFIG_USE_GENERIC_SMP_HELPERS=y
> CONFIG_X86_32_SMP=y
> CONFIG_X86_HT=y
> CONFIG_X86_TRAMPOLINE=y
> CONFIG_X86_32_LAZY_GS=y
> CONFIG_KTIME_SCALAR=y
> CONFIG_DEFCONFIG_LIST="/lib/modules/$UNAME_RELEASE/.config"
> CONFIG_CONSTRUCTORS=y
>
> #
> # General setup
> #
> CONFIG_EXPERIMENTAL=y
> CONFIG_LOCK_KERNEL=y
> CONFIG_INIT_ENV_ARG_LIMIT=32
> CONFIG_LOCALVERSION="-netbook"
> # CONFIG_LOCALVERSION_AUTO is not set
> CONFIG_HAVE_KERNEL_GZIP=y
> CONFIG_HAVE_KERNEL_BZIP2=y
> CONFIG_HAVE_KERNEL_LZMA=y
> CONFIG_KERNEL_GZIP=y
> # CONFIG_KERNEL_BZIP2 is not set
> # CONFIG_KERNEL_LZMA is not set
> CONFIG_SWAP=y
> CONFIG_SYSVIPC=y
> CONFIG_SYSVIPC_SYSCTL=y
> CONFIG_POSIX_MQUEUE=y
> CONFIG_POSIX_MQUEUE_SYSCTL=y
> CONFIG_BSD_PROCESS_ACCT=y
> CONFIG_BSD_PROCESS_ACCT_V3=y
> # CONFIG_TASKSTATS is not set
> # CONFIG_AUDIT is not set
>
> #
> # RCU Subsystem
> #
> # CONFIG_TREE_RCU is not set
> CONFIG_TREE_PREEMPT_RCU=y
> # CONFIG_RCU_TRACE is not set
> CONFIG_RCU_FANOUT=32
> # CONFIG_RCU_FANOUT_EXACT is not set
> # CONFIG_TREE_RCU_TRACE is not set
> # CONFIG_IKCONFIG is not set
> CONFIG_LOG_BUF_SHIFT=17
> CONFIG_HAVE_UNSTABLE_SCHED_CLOCK=y
> # CONFIG_GROUP_SCHED is not set
> # CONFIG_CGROUPS is not set
> # CONFIG_SYSFS_DEPRECATED_V2 is not set
> CONFIG_RELAY=y
> CONFIG_NAMESPACES=y
> # CONFIG_UTS_NS is not set
> # CONFIG_IPC_NS is not set
> # CONFIG_USER_NS is not set
> # CONFIG_PID_NS is not set
> # CONFIG_NET_NS is not set
> CONFIG_BLK_DEV_INITRD=y
> CONFIG_INITRAMFS_SOURCE=""
> CONFIG_RD_GZIP=y
> CONFIG_RD_BZIP2=y
> CONFIG_RD_LZMA=y
> CONFIG_CC_OPTIMIZE_FOR_SIZE=y
> CONFIG_SYSCTL=y
> CONFIG_ANON_INODES=y
> # CONFIG_EMBEDDED is not set
> CONFIG_UID16=y
> CONFIG_SYSCTL_SYSCALL=y
> CONFIG_KALLSYMS=y
> CONFIG_KALLSYMS_ALL=y
> CONFIG_KALLSYMS_EXTRA_PASS=y
> CONFIG_HOTPLUG=y
> CONFIG_PRINTK=y
> CONFIG_BUG=y
> CONFIG_ELF_CORE=y
> CONFIG_PCSPKR_PLATFORM=y
> CONFIG_BASE_FULL=y
> CONFIG_FUTEX=y
> CONFIG_EPOLL=y
> CONFIG_SIGNALFD=y
> CONFIG_TIMERFD=y
> CONFIG_EVENTFD=y
> CONFIG_SHMEM=y
> CONFIG_AIO=y
> CONFIG_HAVE_PERF_EVENTS=y
>
> #
> # Kernel Performance Events And Counters
> #
> CONFIG_PERF_EVENTS=y
> CONFIG_EVENT_PROFILE=y
> CONFIG_PERF_COUNTERS=y
> CONFIG_VM_EVENT_COUNTERS=y
> CONFIG_PCI_QUIRKS=y
> # CONFIG_COMPAT_BRK is not set
> CONFIG_SLAB=y
> # CONFIG_SLUB is not set
> # CONFIG_SLOB is not set
> CONFIG_PROFILING=y
> CONFIG_TRACEPOINTS=y
> CONFIG_OPROFILE=y
> # CONFIG_OPROFILE_IBS is not set
> # CONFIG_OPROFILE_EVENT_MULTIPLEX is not set
> CONFIG_HAVE_OPROFILE=y
> # CONFIG_KPROBES is not set
> CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS=y
> CONFIG_HAVE_IOREMAP_PROT=y
> CONFIG_HAVE_KPROBES=y
> CONFIG_HAVE_KRETPROBES=y
> CONFIG_HAVE_ARCH_TRACEHOOK=y
> CONFIG_HAVE_DMA_ATTRS=y
> CONFIG_HAVE_DMA_API_DEBUG=y
>
> #
> # GCOV-based kernel profiling
> #
> # CONFIG_GCOV_KERNEL is not set
> CONFIG_SLOW_WORK=y
> CONFIG_HAVE_GENERIC_DMA_COHERENT=y
> CONFIG_SLABINFO=y
> CONFIG_RT_MUTEXES=y
> CONFIG_BASE_SMALL=0
> CONFIG_MODULES=y
> # CONFIG_MODULE_FORCE_LOAD is not set
> CONFIG_MODULE_UNLOAD=y
> # CONFIG_MODULE_FORCE_UNLOAD is not set
> # CONFIG_MODVERSIONS is not set
> # CONFIG_MODULE_SRCVERSION_ALL is not set
> CONFIG_STOP_MACHINE=y
> CONFIG_BLOCK=y
> CONFIG_LBDAF=y
> CONFIG_BLK_DEV_BSG=y
> # CONFIG_BLK_DEV_INTEGRITY is not set
>
> #
> # IO Schedulers
> #
> CONFIG_IOSCHED_NOOP=y
> # CONFIG_IOSCHED_AS is not set
> # CONFIG_IOSCHED_DEADLINE is not set
> CONFIG_IOSCHED_CFQ=y
> # CONFIG_DEFAULT_AS is not set
> # CONFIG_DEFAULT_DEADLINE is not set
> CONFIG_DEFAULT_CFQ=y
> # CONFIG_DEFAULT_NOOP is not set
> CONFIG_DEFAULT_IOSCHED="cfq"
> CONFIG_PREEMPT_NOTIFIERS=y
> CONFIG_FREEZER=y
>
> #
> # Processor type and features
> #
> CONFIG_TICK_ONESHOT=y
> CONFIG_NO_HZ=y
> CONFIG_HIGH_RES_TIMERS=y
> CONFIG_GENERIC_CLOCKEVENTS_BUILD=y
> CONFIG_SMP=y
> # CONFIG_SPARSE_IRQ is not set
> CONFIG_X86_MPPARSE=y
> # CONFIG_X86_BIGSMP is not set
> # CONFIG_X86_EXTENDED_PLATFORM is not set
> CONFIG_X86_SUPPORTS_MEMORY_FAILURE=y
> # CONFIG_SCHED_OMIT_FRAME_POINTER is not set
> # CONFIG_PARAVIRT_GUEST is not set
> # CONFIG_MEMTEST is not set
> # CONFIG_M386 is not set
> # CONFIG_M486 is not set
> # CONFIG_M586 is not set
> # CONFIG_M586TSC is not set
> # CONFIG_M586MMX is not set
> # CONFIG_M686 is not set
> # CONFIG_MPENTIUMII is not set
> # CONFIG_MPENTIUMIII is not set
> # CONFIG_MPENTIUMM is not set
> # CONFIG_MPENTIUM4 is not set
> # CONFIG_MK6 is not set
> # CONFIG_MK7 is not set
> # CONFIG_MK8 is not set
> # CONFIG_MCRUSOE is not set
> # CONFIG_MEFFICEON is not set
> # CONFIG_MWINCHIPC6 is not set
> # CONFIG_MWINCHIP3D is not set
> # CONFIG_MGEODEGX1 is not set
> # CONFIG_MGEODE_LX is not set
> # CONFIG_MCYRIXIII is not set
> # CONFIG_MVIAC3_2 is not set
> # CONFIG_MVIAC7 is not set
> # CONFIG_MPSC is not set
> # CONFIG_MCORE2 is not set
> CONFIG_MATOM=y
> # CONFIG_GENERIC_CPU is not set
> CONFIG_X86_GENERIC=y
> CONFIG_X86_CPU=y
> CONFIG_X86_L1_CACHE_BYTES=64
> CONFIG_X86_INTERNODE_CACHE_BYTES=64
> CONFIG_X86_CMPXCHG=y
> CONFIG_X86_L1_CACHE_SHIFT=6
> CONFIG_X86_XADD=y
> CONFIG_X86_WP_WORKS_OK=y
> CONFIG_X86_INVLPG=y
> CONFIG_X86_BSWAP=y
> CONFIG_X86_POPAD_OK=y
> CONFIG_X86_INTEL_USERCOPY=y
> CONFIG_X86_USE_PPRO_CHECKSUM=y
> CONFIG_X86_TSC=y
> CONFIG_X86_CMPXCHG64=y
> CONFIG_X86_CMOV=y
> CONFIG_X86_MINIMUM_CPU_FAMILY=4
> CONFIG_X86_DEBUGCTLMSR=y
> CONFIG_CPU_SUP_INTEL=y
> CONFIG_CPU_SUP_CYRIX_32=y
> CONFIG_CPU_SUP_AMD=y
> CONFIG_CPU_SUP_CENTAUR=y
> CONFIG_CPU_SUP_TRANSMETA_32=y
> CONFIG_CPU_SUP_UMC_32=y
> # CONFIG_X86_DS is not set
> CONFIG_HPET_TIMER=y
> CONFIG_HPET_EMULATE_RTC=y
> CONFIG_DMI=y
> # CONFIG_IOMMU_HELPER is not set
> # CONFIG_IOMMU_API is not set
> CONFIG_NR_CPUS=8
> CONFIG_SCHED_SMT=y
> CONFIG_SCHED_MC=y
> # CONFIG_PREEMPT_NONE is not set
> # CONFIG_PREEMPT_VOLUNTARY is not set
> CONFIG_PREEMPT=y
> CONFIG_X86_LOCAL_APIC=y
> CONFIG_X86_IO_APIC=y
> # CONFIG_X86_REROUTE_FOR_BROKEN_BOOT_IRQS is not set
> CONFIG_X86_MCE=y
> CONFIG_X86_MCE_INTEL=y
> # CONFIG_X86_MCE_AMD is not set
> # CONFIG_X86_ANCIENT_MCE is not set
> CONFIG_X86_MCE_THRESHOLD=y
> # CONFIG_X86_MCE_INJECT is not set
> CONFIG_X86_THERMAL_VECTOR=y
> CONFIG_VM86=y
> CONFIG_TOSHIBA=m
> CONFIG_I8K=m
> CONFIG_X86_REBOOTFIXUPS=y
> CONFIG_MICROCODE=y
> CONFIG_MICROCODE_INTEL=y
> # CONFIG_MICROCODE_AMD is not set
> CONFIG_MICROCODE_OLD_INTERFACE=y
> CONFIG_X86_MSR=y
> CONFIG_X86_CPUID=y
> # CONFIG_X86_CPU_DEBUG is not set
> # CONFIG_NOHIGHMEM is not set
> # CONFIG_HIGHMEM4G is not set
> CONFIG_HIGHMEM64G=y
> CONFIG_PAGE_OFFSET=0xC0000000
> CONFIG_HIGHMEM=y
> CONFIG_X86_PAE=y
> CONFIG_ARCH_PHYS_ADDR_T_64BIT=y
> CONFIG_ARCH_FLATMEM_ENABLE=y
> CONFIG_ARCH_SPARSEMEM_ENABLE=y
> CONFIG_ARCH_SELECT_MEMORY_MODEL=y
> CONFIG_SELECT_MEMORY_MODEL=y
> CONFIG_FLATMEM_MANUAL=y
> # CONFIG_DISCONTIGMEM_MANUAL is not set
> # CONFIG_SPARSEMEM_MANUAL is not set
> CONFIG_FLATMEM=y
> CONFIG_FLAT_NODE_MEM_MAP=y
> CONFIG_SPARSEMEM_STATIC=y
> CONFIG_PAGEFLAGS_EXTENDED=y
> CONFIG_SPLIT_PTLOCK_CPUS=4
> CONFIG_PHYS_ADDR_T_64BIT=y
> CONFIG_ZONE_DMA_FLAG=1
> CONFIG_BOUNCE=y
> CONFIG_VIRT_TO_BUS=y
> CONFIG_HAVE_MLOCK=y
> CONFIG_HAVE_MLOCKED_PAGE_BIT=y
> CONFIG_MMU_NOTIFIER=y
> # CONFIG_KSM is not set
> CONFIG_DEFAULT_MMAP_MIN_ADDR=4096
> CONFIG_ARCH_SUPPORTS_MEMORY_FAILURE=y
> # CONFIG_MEMORY_FAILURE is not set
> CONFIG_HIGHPTE=y
> # CONFIG_X86_CHECK_BIOS_CORRUPTION is not set
> CONFIG_X86_RESERVE_LOW_64K=y
> # CONFIG_MATH_EMULATION is not set
> CONFIG_MTRR=y
> CONFIG_MTRR_SANITIZER=y
> CONFIG_MTRR_SANITIZER_ENABLE_DEFAULT=1
> CONFIG_MTRR_SANITIZER_SPARE_REG_NR_DEFAULT=1
> CONFIG_X86_PAT=y
> CONFIG_ARCH_USES_PG_UNCACHED=y
> CONFIG_EFI=y
> # CONFIG_SECCOMP is not set
> # CONFIG_CC_STACKPROTECTOR is not set
> # CONFIG_HZ_100 is not set
> # CONFIG_HZ_250 is not set
> # CONFIG_HZ_300 is not set
> CONFIG_HZ_1000=y
> CONFIG_HZ=1000
> CONFIG_SCHED_HRTICK=y
> # CONFIG_KEXEC is not set
> # CONFIG_CRASH_DUMP is not set
> CONFIG_PHYSICAL_START=0x1000000
> # CONFIG_RELOCATABLE is not set
> CONFIG_PHYSICAL_ALIGN=0x400000
> CONFIG_HOTPLUG_CPU=y
> # CONFIG_COMPAT_VDSO is not set
> # CONFIG_CMDLINE_BOOL is not set
> CONFIG_ARCH_ENABLE_MEMORY_HOTPLUG=y
>
> #
> # Power management and ACPI options
> #
> CONFIG_PM=y
> CONFIG_PM_DEBUG=y
> # CONFIG_PM_VERBOSE is not set
> CONFIG_CAN_PM_TRACE=y
> CONFIG_PM_TRACE=y
> CONFIG_PM_TRACE_RTC=y
> CONFIG_PM_SLEEP_SMP=y
> CONFIG_PM_SLEEP=y
> CONFIG_SUSPEND=y
> # CONFIG_PM_TEST_SUSPEND is not set
> CONFIG_SUSPEND_FREEZER=y
> CONFIG_HIBERNATION_NVS=y
> CONFIG_HIBERNATION=y
> CONFIG_PM_STD_PARTITION=""
> # CONFIG_PM_RUNTIME is not set
> CONFIG_ACPI=y
> CONFIG_ACPI_SLEEP=y
> CONFIG_ACPI_PROCFS=y
> CONFIG_ACPI_PROCFS_POWER=y
> # CONFIG_ACPI_POWER_METER is not set
> CONFIG_ACPI_SYSFS_POWER=y
> CONFIG_ACPI_PROC_EVENT=y
> CONFIG_ACPI_AC=y
> CONFIG_ACPI_BATTERY=m
> CONFIG_ACPI_BUTTON=y
> CONFIG_ACPI_VIDEO=y
> CONFIG_ACPI_FAN=y
> CONFIG_ACPI_DOCK=y
> CONFIG_ACPI_PROCESSOR=y
> CONFIG_ACPI_HOTPLUG_CPU=y
> # CONFIG_ACPI_PROCESSOR_AGGREGATOR is not set
> CONFIG_ACPI_THERMAL=y
> # CONFIG_ACPI_CUSTOM_DSDT is not set
> CONFIG_ACPI_BLACKLIST_YEAR=1999
> # CONFIG_ACPI_DEBUG is not set
> # CONFIG_ACPI_PCI_SLOT is not set
> CONFIG_X86_PM_TIMER=y
> CONFIG_ACPI_CONTAINER=y
> CONFIG_ACPI_SBS=m
> # CONFIG_SFI is not set
> # CONFIG_APM is not set
>
> #
> # CPU Frequency scaling
> #
> CONFIG_CPU_FREQ=y
> CONFIG_CPU_FREQ_TABLE=y
> CONFIG_CPU_FREQ_DEBUG=y
> CONFIG_CPU_FREQ_STAT=y
> CONFIG_CPU_FREQ_STAT_DETAILS=y
> # CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE is not set
> # CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE is not set
> # CONFIG_CPU_FREQ_DEFAULT_GOV_USERSPACE is not set
> CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
> # CONFIG_CPU_FREQ_DEFAULT_GOV_CONSERVATIVE is not set
> CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
> # CONFIG_CPU_FREQ_GOV_POWERSAVE is not set
> CONFIG_CPU_FREQ_GOV_USERSPACE=y
> CONFIG_CPU_FREQ_GOV_ONDEMAND=y
> # CONFIG_CPU_FREQ_GOV_CONSERVATIVE is not set
>
> #
> # CPUFreq processor drivers
> #
> CONFIG_X86_ACPI_CPUFREQ=y
> # CONFIG_X86_POWERNOW_K6 is not set
> # CONFIG_X86_POWERNOW_K7 is not set
> # CONFIG_X86_POWERNOW_K8 is not set
> # CONFIG_X86_GX_SUSPMOD is not set
> # CONFIG_X86_SPEEDSTEP_CENTRINO is not set
> # CONFIG_X86_SPEEDSTEP_ICH is not set
> # CONFIG_X86_SPEEDSTEP_SMI is not set
> # CONFIG_X86_P4_CLOCKMOD is not set
> # CONFIG_X86_CPUFREQ_NFORCE2 is not set
> # CONFIG_X86_LONGRUN is not set
> # CONFIG_X86_LONGHAUL is not set
> # CONFIG_X86_E_POWERSAVER is not set
>
> #
> # shared options
> #
> # CONFIG_X86_SPEEDSTEP_LIB is not set
> CONFIG_CPU_IDLE=y
> CONFIG_CPU_IDLE_GOV_LADDER=y
> CONFIG_CPU_IDLE_GOV_MENU=y
>
> #
> # Bus options (PCI etc.)
> #
> CONFIG_PCI=y
> # CONFIG_PCI_GOBIOS is not set
> # CONFIG_PCI_GOMMCONFIG is not set
> # CONFIG_PCI_GODIRECT is not set
> # CONFIG_PCI_GOOLPC is not set
> CONFIG_PCI_GOANY=y
> CONFIG_PCI_BIOS=y
> CONFIG_PCI_DIRECT=y
> CONFIG_PCI_MMCONFIG=y
> CONFIG_PCI_DOMAINS=y
> # CONFIG_DMAR is not set
> CONFIG_PCIEPORTBUS=y
> # CONFIG_HOTPLUG_PCI_PCIE is not set
> # CONFIG_PCIEAER is not set
> # CONFIG_PCIEASPM is not set
> CONFIG_ARCH_SUPPORTS_MSI=y
> CONFIG_PCI_MSI=y
> # CONFIG_PCI_LEGACY is not set
> # CONFIG_PCI_DEBUG is not set
> # CONFIG_PCI_STUB is not set
> # CONFIG_HT_IRQ is not set
> # CONFIG_PCI_IOV is not set
> CONFIG_ISA_DMA_API=y
> CONFIG_ISA=y
> # CONFIG_EISA is not set
> # CONFIG_MCA is not set
> # CONFIG_SCx200 is not set
> # CONFIG_OLPC is not set
> CONFIG_PCCARD=y
> # CONFIG_PCMCIA_DEBUG is not set
> # CONFIG_PCMCIA is not set
> CONFIG_CARDBUS=y
>
> #
> # PC-card bridges
> #
> CONFIG_YENTA=y
> CONFIG_YENTA_O2=y
> CONFIG_YENTA_RICOH=y
> CONFIG_YENTA_TI=y
> CONFIG_YENTA_ENE_TUNE=y
> CONFIG_YENTA_TOSHIBA=y
> CONFIG_PCMCIA_PROBE=y
> CONFIG_PCCARD_NONSTATIC=y
> CONFIG_HOTPLUG_PCI=y
> # CONFIG_HOTPLUG_PCI_FAKE is not set
> # CONFIG_HOTPLUG_PCI_COMPAQ is not set
> # CONFIG_HOTPLUG_PCI_IBM is not set
> # CONFIG_HOTPLUG_PCI_ACPI is not set
> # CONFIG_HOTPLUG_PCI_CPCI is not set
> # CONFIG_HOTPLUG_PCI_SHPC is not set
>
> #
> # Executable file formats / Emulations
> #
> CONFIG_BINFMT_ELF=y
> # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
> CONFIG_HAVE_AOUT=y
> # CONFIG_BINFMT_AOUT is not set
> CONFIG_BINFMT_MISC=y
> CONFIG_HAVE_ATOMIC_IOMAP=y
> CONFIG_NET=y
>
> #
> # Networking options
> #
> CONFIG_PACKET=y
> CONFIG_PACKET_MMAP=y
> CONFIG_UNIX=y
> CONFIG_XFRM=y
> CONFIG_XFRM_USER=y
> CONFIG_XFRM_SUB_POLICY=y
> CONFIG_XFRM_MIGRATE=y
> CONFIG_XFRM_STATISTICS=y
> CONFIG_XFRM_IPCOMP=m
> CONFIG_NET_KEY=m
> CONFIG_NET_KEY_MIGRATE=y
> CONFIG_INET=y
> CONFIG_IP_MULTICAST=y
> # CONFIG_IP_ADVANCED_ROUTER is not set
> CONFIG_IP_FIB_HASH=y
> # CONFIG_IP_PNP is not set
> # CONFIG_NET_IPIP is not set
> # CONFIG_NET_IPGRE is not set
> CONFIG_IP_MROUTE=y
> CONFIG_IP_PIMSM_V1=y
> CONFIG_IP_PIMSM_V2=y
> # CONFIG_ARPD is not set
> CONFIG_SYN_COOKIES=y
> CONFIG_INET_AH=m
> CONFIG_INET_ESP=m
> CONFIG_INET_IPCOMP=m
> CONFIG_INET_XFRM_TUNNEL=m
> CONFIG_INET_TUNNEL=m
> CONFIG_INET_XFRM_MODE_TRANSPORT=m
> CONFIG_INET_XFRM_MODE_TUNNEL=m
> CONFIG_INET_XFRM_MODE_BEET=m
> CONFIG_INET_LRO=y
> CONFIG_INET_DIAG=m
> CONFIG_INET_TCP_DIAG=m
> CONFIG_TCP_CONG_ADVANCED=y
> CONFIG_TCP_CONG_BIC=m
> CONFIG_TCP_CONG_CUBIC=y
> # CONFIG_TCP_CONG_WESTWOOD is not set
> # CONFIG_TCP_CONG_HTCP is not set
> # CONFIG_TCP_CONG_HSTCP is not set
> # CONFIG_TCP_CONG_HYBLA is not set
> # CONFIG_TCP_CONG_VEGAS is not set
> # CONFIG_TCP_CONG_SCALABLE is not set
> # CONFIG_TCP_CONG_LP is not set
> # CONFIG_TCP_CONG_VENO is not set
> # CONFIG_TCP_CONG_YEAH is not set
> # CONFIG_TCP_CONG_ILLINOIS is not set
> # CONFIG_DEFAULT_BIC is not set
> CONFIG_DEFAULT_CUBIC=y
> # CONFIG_DEFAULT_HTCP is not set
> # CONFIG_DEFAULT_VEGAS is not set
> # CONFIG_DEFAULT_WESTWOOD is not set
> # CONFIG_DEFAULT_RENO is not set
> CONFIG_DEFAULT_TCP_CONG="cubic"
> CONFIG_TCP_MD5SIG=y
> CONFIG_IPV6=y
> CONFIG_IPV6_PRIVACY=y
> CONFIG_IPV6_ROUTER_PREF=y
> CONFIG_IPV6_ROUTE_INFO=y
> CONFIG_IPV6_OPTIMISTIC_DAD=y
> CONFIG_INET6_AH=m
> CONFIG_INET6_ESP=m
> CONFIG_INET6_IPCOMP=m
> CONFIG_IPV6_MIP6=m
> CONFIG_INET6_XFRM_TUNNEL=m
> CONFIG_INET6_TUNNEL=m
> CONFIG_INET6_XFRM_MODE_TRANSPORT=m
> CONFIG_INET6_XFRM_MODE_TUNNEL=m
> CONFIG_INET6_XFRM_MODE_BEET=m
> CONFIG_INET6_XFRM_MODE_ROUTEOPTIMIZATION=m
> CONFIG_IPV6_SIT=m
> CONFIG_IPV6_NDISC_NODETYPE=y
> CONFIG_IPV6_TUNNEL=m
> CONFIG_IPV6_MULTIPLE_TABLES=y
> CONFIG_IPV6_SUBTREES=y
> # CONFIG_IPV6_MROUTE is not set
> CONFIG_NETWORK_SECMARK=y
> CONFIG_NETFILTER=y
> # CONFIG_NETFILTER_DEBUG is not set
> CONFIG_NETFILTER_ADVANCED=y
>
> #
> # Core Netfilter Configuration
> #
> CONFIG_NETFILTER_NETLINK=m
> CONFIG_NETFILTER_NETLINK_QUEUE=m
> CONFIG_NETFILTER_NETLINK_LOG=m
> CONFIG_NF_CONNTRACK=y
> CONFIG_NF_CT_ACCT=y
> CONFIG_NF_CONNTRACK_MARK=y
> CONFIG_NF_CONNTRACK_SECMARK=y
> CONFIG_NF_CONNTRACK_EVENTS=y
> # CONFIG_NF_CT_PROTO_DCCP is not set
> CONFIG_NF_CT_PROTO_GRE=m
> CONFIG_NF_CT_PROTO_SCTP=m
> CONFIG_NF_CT_PROTO_UDPLITE=m
> CONFIG_NF_CONNTRACK_AMANDA=m
> CONFIG_NF_CONNTRACK_FTP=m
> CONFIG_NF_CONNTRACK_H323=m
> CONFIG_NF_CONNTRACK_IRC=m
> CONFIG_NF_CONNTRACK_NETBIOS_NS=m
> CONFIG_NF_CONNTRACK_PPTP=m
> CONFIG_NF_CONNTRACK_SANE=m
> CONFIG_NF_CONNTRACK_SIP=m
> CONFIG_NF_CONNTRACK_TFTP=m
> CONFIG_NF_CT_NETLINK=m
> # CONFIG_NETFILTER_TPROXY is not set
> CONFIG_NETFILTER_XTABLES=y
> CONFIG_NETFILTER_XT_TARGET_CLASSIFY=m
> CONFIG_NETFILTER_XT_TARGET_CONNMARK=m
> CONFIG_NETFILTER_XT_TARGET_CONNSECMARK=m
> CONFIG_NETFILTER_XT_TARGET_DSCP=m
> CONFIG_NETFILTER_XT_TARGET_HL=m
> # CONFIG_NETFILTER_XT_TARGET_LED is not set
> CONFIG_NETFILTER_XT_TARGET_MARK=m
> CONFIG_NETFILTER_XT_TARGET_NFLOG=m
> CONFIG_NETFILTER_XT_TARGET_NFQUEUE=m
> CONFIG_NETFILTER_XT_TARGET_NOTRACK=m
> CONFIG_NETFILTER_XT_TARGET_RATEEST=m
> CONFIG_NETFILTER_XT_TARGET_TRACE=m
> CONFIG_NETFILTER_XT_TARGET_SECMARK=m
> CONFIG_NETFILTER_XT_TARGET_TCPMSS=m
> CONFIG_NETFILTER_XT_TARGET_TCPOPTSTRIP=m
> # CONFIG_NETFILTER_XT_MATCH_CLUSTER is not set
> CONFIG_NETFILTER_XT_MATCH_COMMENT=m
> CONFIG_NETFILTER_XT_MATCH_CONNBYTES=m
> CONFIG_NETFILTER_XT_MATCH_CONNLIMIT=m
> CONFIG_NETFILTER_XT_MATCH_CONNMARK=m
> CONFIG_NETFILTER_XT_MATCH_CONNTRACK=m
> # CONFIG_NETFILTER_XT_MATCH_DCCP is not set
> CONFIG_NETFILTER_XT_MATCH_DSCP=m
> CONFIG_NETFILTER_XT_MATCH_ESP=m
> CONFIG_NETFILTER_XT_MATCH_HASHLIMIT=m
> CONFIG_NETFILTER_XT_MATCH_HELPER=m
> CONFIG_NETFILTER_XT_MATCH_HL=m
> CONFIG_NETFILTER_XT_MATCH_IPRANGE=m
> CONFIG_NETFILTER_XT_MATCH_LENGTH=m
> CONFIG_NETFILTER_XT_MATCH_LIMIT=m
> CONFIG_NETFILTER_XT_MATCH_MAC=m
> CONFIG_NETFILTER_XT_MATCH_MARK=m
> CONFIG_NETFILTER_XT_MATCH_MULTIPORT=m
> CONFIG_NETFILTER_XT_MATCH_OWNER=m
> CONFIG_NETFILTER_XT_MATCH_POLICY=m
> CONFIG_NETFILTER_XT_MATCH_PKTTYPE=m
> CONFIG_NETFILTER_XT_MATCH_QUOTA=m
> CONFIG_NETFILTER_XT_MATCH_RATEEST=m
> CONFIG_NETFILTER_XT_MATCH_REALM=m
> # CONFIG_NETFILTER_XT_MATCH_RECENT is not set
> CONFIG_NETFILTER_XT_MATCH_SCTP=m
> CONFIG_NETFILTER_XT_MATCH_STATE=y
> CONFIG_NETFILTER_XT_MATCH_STATISTIC=m
> CONFIG_NETFILTER_XT_MATCH_STRING=m
> CONFIG_NETFILTER_XT_MATCH_TCPMSS=m
> CONFIG_NETFILTER_XT_MATCH_TIME=m
> CONFIG_NETFILTER_XT_MATCH_U32=m
> # CONFIG_NETFILTER_XT_MATCH_OSF is not set
> # CONFIG_IP_VS is not set
>
> #
> # IP: Netfilter Configuration
> #
> CONFIG_NF_DEFRAG_IPV4=y
> CONFIG_NF_CONNTRACK_IPV4=y
> # CONFIG_NF_CONNTRACK_PROC_COMPAT is not set
> CONFIG_IP_NF_QUEUE=m
> CONFIG_IP_NF_IPTABLES=y
> CONFIG_IP_NF_MATCH_ADDRTYPE=m
> CONFIG_IP_NF_MATCH_AH=m
> CONFIG_IP_NF_MATCH_ECN=m
> CONFIG_IP_NF_MATCH_TTL=m
> CONFIG_IP_NF_FILTER=y
> CONFIG_IP_NF_TARGET_REJECT=y
> CONFIG_IP_NF_TARGET_LOG=m
> CONFIG_IP_NF_TARGET_ULOG=m
> CONFIG_NF_NAT=m
> CONFIG_NF_NAT_NEEDED=y
> CONFIG_IP_NF_TARGET_MASQUERADE=m
> CONFIG_IP_NF_TARGET_NETMAP=m
> CONFIG_IP_NF_TARGET_REDIRECT=m
> CONFIG_NF_NAT_SNMP_BASIC=m
> CONFIG_NF_NAT_PROTO_GRE=m
> CONFIG_NF_NAT_PROTO_UDPLITE=m
> CONFIG_NF_NAT_PROTO_SCTP=m
> CONFIG_NF_NAT_FTP=m
> CONFIG_NF_NAT_IRC=m
> CONFIG_NF_NAT_TFTP=m
> CONFIG_NF_NAT_AMANDA=m
> CONFIG_NF_NAT_PPTP=m
> CONFIG_NF_NAT_H323=m
> CONFIG_NF_NAT_SIP=m
> CONFIG_IP_NF_MANGLE=m
> CONFIG_IP_NF_TARGET_CLUSTERIP=m
> CONFIG_IP_NF_TARGET_ECN=m
> CONFIG_IP_NF_TARGET_TTL=m
> CONFIG_IP_NF_RAW=m
> CONFIG_IP_NF_ARPTABLES=m
> CONFIG_IP_NF_ARPFILTER=m
> CONFIG_IP_NF_ARP_MANGLE=m
>
> #
> # IPv6: Netfilter Configuration
> #
> CONFIG_NF_CONNTRACK_IPV6=y
> CONFIG_IP6_NF_QUEUE=m
> CONFIG_IP6_NF_IPTABLES=y
> CONFIG_IP6_NF_MATCH_AH=m
> CONFIG_IP6_NF_MATCH_EUI64=m
> CONFIG_IP6_NF_MATCH_FRAG=m
> CONFIG_IP6_NF_MATCH_OPTS=m
> CONFIG_IP6_NF_MATCH_HL=m
> CONFIG_IP6_NF_MATCH_IPV6HEADER=m
> CONFIG_IP6_NF_MATCH_MH=m
> CONFIG_IP6_NF_MATCH_RT=m
> CONFIG_IP6_NF_TARGET_HL=m
> CONFIG_IP6_NF_TARGET_LOG=m
> CONFIG_IP6_NF_FILTER=y
> CONFIG_IP6_NF_TARGET_REJECT=y
> CONFIG_IP6_NF_MANGLE=m
> CONFIG_IP6_NF_RAW=m
> # CONFIG_IP_DCCP is not set
> # CONFIG_IP_SCTP is not set
> # CONFIG_RDS is not set
> # CONFIG_TIPC is not set
> # CONFIG_ATM is not set
> # CONFIG_BRIDGE is not set
> # CONFIG_NET_DSA is not set
> # CONFIG_VLAN_8021Q is not set
> # CONFIG_DECNET is not set
> # CONFIG_LLC2 is not set
> # CONFIG_IPX is not set
> # CONFIG_ATALK is not set
> # CONFIG_X25 is not set
> # CONFIG_LAPB is not set
> # CONFIG_ECONET is not set
> # CONFIG_WAN_ROUTER is not set
> # CONFIG_PHONET is not set
> # CONFIG_IEEE802154 is not set
> # CONFIG_NET_SCHED is not set
> CONFIG_NET_CLS_ROUTE=y
> # CONFIG_DCB is not set
>
> #
> # Network testing
> #
> # CONFIG_NET_PKTGEN is not set
> # CONFIG_NET_DROP_MONITOR is not set
> # CONFIG_HAMRADIO is not set
> # CONFIG_CAN is not set
> # CONFIG_IRDA is not set
> CONFIG_BT=y
> CONFIG_BT_L2CAP=y
> CONFIG_BT_SCO=y
> CONFIG_BT_RFCOMM=y
> CONFIG_BT_RFCOMM_TTY=y
> CONFIG_BT_BNEP=y
> CONFIG_BT_BNEP_MC_FILTER=y
> CONFIG_BT_BNEP_PROTO_FILTER=y
> CONFIG_BT_HIDP=y
>
> #
> # Bluetooth device drivers
> #
> CONFIG_BT_HCIBTUSB=y
> CONFIG_BT_HCIBTSDIO=m
> CONFIG_BT_HCIUART=m
> CONFIG_BT_HCIUART_H4=y
> CONFIG_BT_HCIUART_BCSP=y
> CONFIG_BT_HCIUART_LL=y
> CONFIG_BT_HCIBCM203X=m
> CONFIG_BT_HCIBPA10X=m
> CONFIG_BT_HCIBFUSB=m
> CONFIG_BT_HCIVHCI=m
> CONFIG_BT_MRVL=m
> # CONFIG_BT_MRVL_SDIO is not set
> # CONFIG_AF_RXRPC is not set
> CONFIG_FIB_RULES=y
> CONFIG_WIRELESS=y
> CONFIG_CFG80211=y
> # CONFIG_NL80211_TESTMODE is not set
> # CONFIG_CFG80211_DEVELOPER_WARNINGS is not set
> # CONFIG_CFG80211_REG_DEBUG is not set
> CONFIG_CFG80211_DEFAULT_PS=y
> CONFIG_CFG80211_DEFAULT_PS_VALUE=1
> # CONFIG_CFG80211_DEBUGFS is not set
> CONFIG_WIRELESS_OLD_REGULATORY=y
> CONFIG_WIRELESS_EXT=y
> CONFIG_WIRELESS_EXT_SYSFS=y
> CONFIG_LIB80211=y
> CONFIG_LIB80211_CRYPT_WEP=m
> CONFIG_LIB80211_CRYPT_CCMP=m
> CONFIG_LIB80211_CRYPT_TKIP=m
> # CONFIG_LIB80211_DEBUG is not set
> CONFIG_MAC80211=y
> CONFIG_MAC80211_RC_MINSTREL=y
> # CONFIG_MAC80211_RC_DEFAULT_PID is not set
> CONFIG_MAC80211_RC_DEFAULT_MINSTREL=y
> CONFIG_MAC80211_RC_DEFAULT="minstrel"
> # CONFIG_MAC80211_MESH is not set
> CONFIG_MAC80211_LEDS=y
> CONFIG_MAC80211_DEBUGFS=y
> # CONFIG_MAC80211_DEBUG_MENU is not set
> CONFIG_WIMAX=m
> CONFIG_WIMAX_DEBUG_LEVEL=8
> CONFIG_RFKILL=y
> CONFIG_RFKILL_LEDS=y
> CONFIG_RFKILL_INPUT=y
> # CONFIG_NET_9P is not set
>
> #
> # Device Drivers
> #
>
> #
> # Generic Driver Options
> #
> CONFIG_UEVENT_HELPER_PATH=""
> # CONFIG_DEVTMPFS is not set
> CONFIG_STANDALONE=y
> CONFIG_PREVENT_FIRMWARE_BUILD=y
> CONFIG_FW_LOADER=y
> CONFIG_FIRMWARE_IN_KERNEL=y
> CONFIG_EXTRA_FIRMWARE=""
> # CONFIG_DEBUG_DRIVER is not set
> CONFIG_DEBUG_DEVRES=y
> # CONFIG_SYS_HYPERVISOR is not set
> # CONFIG_CONNECTOR is not set
> # CONFIG_MTD is not set
> # CONFIG_PARPORT is not set
> CONFIG_PNP=y
> # CONFIG_PNP_DEBUG_MESSAGES is not set
>
> #
> # Protocols
> #
> # CONFIG_ISAPNP is not set
> # CONFIG_PNPBIOS is not set
> CONFIG_PNPACPI=y
> CONFIG_BLK_DEV=y
> # CONFIG_BLK_DEV_FD is not set
> # CONFIG_BLK_DEV_XD is not set
> # CONFIG_BLK_CPQ_DA is not set
> # CONFIG_BLK_CPQ_CISS_DA is not set
> # CONFIG_BLK_DEV_DAC960 is not set
> # CONFIG_BLK_DEV_UMEM is not set
> # CONFIG_BLK_DEV_COW_COMMON is not set
> CONFIG_BLK_DEV_LOOP=y
> CONFIG_BLK_DEV_CRYPTOLOOP=m
> # CONFIG_BLK_DEV_NBD is not set
> # CONFIG_BLK_DEV_SX8 is not set
> # CONFIG_BLK_DEV_UB is not set
> CONFIG_BLK_DEV_RAM=m
> CONFIG_BLK_DEV_RAM_COUNT=16
> CONFIG_BLK_DEV_RAM_SIZE=16384
> # CONFIG_BLK_DEV_XIP is not set
> CONFIG_CDROM_PKTCDVD=m
> CONFIG_CDROM_PKTCDVD_BUFFERS=8
> # CONFIG_CDROM_PKTCDVD_WCACHE is not set
> # CONFIG_ATA_OVER_ETH is not set
> # CONFIG_BLK_DEV_HD is not set
> CONFIG_MISC_DEVICES=y
> # CONFIG_IBM_ASM is not set
> # CONFIG_PHANTOM is not set
> # CONFIG_SGI_IOC4 is not set
> CONFIG_TIFM_CORE=m
> # CONFIG_TIFM_7XX1 is not set
> # CONFIG_ICS932S401 is not set
> # CONFIG_ENCLOSURE_SERVICES is not set
> # CONFIG_HP_ILO is not set
> # CONFIG_ISL29003 is not set
> # CONFIG_C2PORT is not set
>
> #
> # EEPROM support
> #
> # CONFIG_EEPROM_AT24 is not set
> # CONFIG_EEPROM_LEGACY is not set
> # CONFIG_EEPROM_MAX6875 is not set
> CONFIG_EEPROM_93CX6=m
> # CONFIG_CB710_CORE is not set
> CONFIG_HAVE_IDE=y
> # CONFIG_IDE is not set
>
> #
> # SCSI device support
> #
> CONFIG_RAID_ATTRS=m
> CONFIG_SCSI=y
> CONFIG_SCSI_DMA=y
> # CONFIG_SCSI_TGT is not set
> CONFIG_SCSI_NETLINK=y
> CONFIG_SCSI_PROC_FS=y
>
> #
> # SCSI support type (disk, tape, CD-ROM)
> #
> CONFIG_BLK_DEV_SD=y
> # CONFIG_CHR_DEV_ST is not set
> # CONFIG_CHR_DEV_OSST is not set
> CONFIG_BLK_DEV_SR=y
> CONFIG_BLK_DEV_SR_VENDOR=y
> CONFIG_CHR_DEV_SG=y
> # CONFIG_CHR_DEV_SCH is not set
> CONFIG_SCSI_MULTI_LUN=y
> CONFIG_SCSI_CONSTANTS=y
> CONFIG_SCSI_LOGGING=y
> CONFIG_SCSI_SCAN_ASYNC=y
> CONFIG_SCSI_WAIT_SCAN=m
>
> #
> # SCSI Transports
> #
> CONFIG_SCSI_SPI_ATTRS=y
> CONFIG_SCSI_FC_ATTRS=m
> # CONFIG_SCSI_ISCSI_ATTRS is not set
> CONFIG_SCSI_SAS_ATTRS=m
> # CONFIG_SCSI_SAS_LIBSAS is not set
> # CONFIG_SCSI_SRP_ATTRS is not set
> CONFIG_SCSI_LOWLEVEL=y
> # CONFIG_ISCSI_TCP is not set
> # CONFIG_SCSI_CXGB3_ISCSI is not set
> # CONFIG_SCSI_BNX2_ISCSI is not set
> # CONFIG_BLK_DEV_3W_XXXX_RAID is not set
> # CONFIG_SCSI_3W_9XXX is not set
> # CONFIG_SCSI_7000FASST is not set
> # CONFIG_SCSI_ACARD is not set
> # CONFIG_SCSI_AHA152X is not set
> # CONFIG_SCSI_AHA1542 is not set
> # CONFIG_SCSI_AACRAID is not set
> # CONFIG_SCSI_AIC7XXX is not set
> # CONFIG_SCSI_AIC7XXX_OLD is not set
> # CONFIG_SCSI_AIC79XX is not set
> # CONFIG_SCSI_AIC94XX is not set
> # CONFIG_SCSI_MVSAS is not set
> # CONFIG_SCSI_DPT_I2O is not set
> # CONFIG_SCSI_ADVANSYS is not set
> # CONFIG_SCSI_IN2000 is not set
> # CONFIG_SCSI_ARCMSR is not set
> # CONFIG_MEGARAID_NEWGEN is not set
> # CONFIG_MEGARAID_LEGACY is not set
> # CONFIG_MEGARAID_SAS is not set
> # CONFIG_SCSI_MPT2SAS is not set
> # CONFIG_SCSI_HPTIOP is not set
> # CONFIG_SCSI_BUSLOGIC is not set
> # CONFIG_LIBFC is not set
> # CONFIG_LIBFCOE is not set
> # CONFIG_FCOE is not set
> # CONFIG_FCOE_FNIC is not set
> # CONFIG_SCSI_DMX3191D is not set
> # CONFIG_SCSI_DTC3280 is not set
> # CONFIG_SCSI_EATA is not set
> # CONFIG_SCSI_FUTURE_DOMAIN is not set
> # CONFIG_SCSI_GDTH is not set
> # CONFIG_SCSI_GENERIC_NCR5380 is not set
> # CONFIG_SCSI_GENERIC_NCR5380_MMIO is not set
> # CONFIG_SCSI_IPS is not set
> # CONFIG_SCSI_INITIO is not set
> # CONFIG_SCSI_INIA100 is not set
> # CONFIG_SCSI_NCR53C406A is not set
> # CONFIG_SCSI_STEX is not set
> # CONFIG_SCSI_SYM53C8XX_2 is not set
> # CONFIG_SCSI_IPR is not set
> # CONFIG_SCSI_PAS16 is not set
> # CONFIG_SCSI_QLOGIC_FAS is not set
> # CONFIG_SCSI_QLOGIC_1280 is not set
> # CONFIG_SCSI_QLA_FC is not set
> # CONFIG_SCSI_QLA_ISCSI is not set
> # CONFIG_SCSI_LPFC is not set
> # CONFIG_SCSI_SYM53C416 is not set
> # CONFIG_SCSI_DC395x is not set
> # CONFIG_SCSI_DC390T is not set
> # CONFIG_SCSI_T128 is not set
> # CONFIG_SCSI_U14_34F is not set
> # CONFIG_SCSI_ULTRASTOR is not set
> # CONFIG_SCSI_NSP32 is not set
> # CONFIG_SCSI_DEBUG is not set
> # CONFIG_SCSI_PMCRAID is not set
> # CONFIG_SCSI_SRP is not set
> # CONFIG_SCSI_DH is not set
> # CONFIG_SCSI_OSD_INITIATOR is not set
> CONFIG_ATA=y
> # CONFIG_ATA_NONSTANDARD is not set
> CONFIG_ATA_VERBOSE_ERROR=y
> CONFIG_ATA_ACPI=y
> # CONFIG_SATA_PMP is not set
> CONFIG_SATA_AHCI=y
> # CONFIG_SATA_SIL24 is not set
> CONFIG_ATA_SFF=y
> # CONFIG_SATA_SVW is not set
> CONFIG_ATA_PIIX=y
> # CONFIG_SATA_MV is not set
> # CONFIG_SATA_NV is not set
> # CONFIG_PDC_ADMA is not set
> # CONFIG_SATA_QSTOR is not set
> # CONFIG_SATA_PROMISE is not set
> # CONFIG_SATA_SX4 is not set
> # CONFIG_SATA_SIL is not set
> # CONFIG_SATA_SIS is not set
> # CONFIG_SATA_ULI is not set
> # CONFIG_SATA_VIA is not set
> # CONFIG_SATA_VITESSE is not set
> # CONFIG_SATA_INIC162X is not set
> # CONFIG_PATA_ACPI is not set
> # CONFIG_PATA_ALI is not set
> # CONFIG_PATA_AMD is not set
> # CONFIG_PATA_ARTOP is not set
> # CONFIG_PATA_ATP867X is not set
> # CONFIG_PATA_ATIIXP is not set
> # CONFIG_PATA_CMD640_PCI is not set
> # CONFIG_PATA_CMD64X is not set
> # CONFIG_PATA_CS5520 is not set
> # CONFIG_PATA_CS5530 is not set
> # CONFIG_PATA_CS5535 is not set
> # CONFIG_PATA_CS5536 is not set
> # CONFIG_PATA_CYPRESS is not set
> # CONFIG_PATA_EFAR is not set
> CONFIG_ATA_GENERIC=y
> # CONFIG_PATA_HPT366 is not set
> # CONFIG_PATA_HPT37X is not set
> # CONFIG_PATA_HPT3X2N is not set
> # CONFIG_PATA_HPT3X3 is not set
> # CONFIG_PATA_IT821X is not set
> # CONFIG_PATA_IT8213 is not set
> # CONFIG_PATA_JMICRON is not set
> # CONFIG_PATA_LEGACY is not set
> # CONFIG_PATA_TRIFLEX is not set
> # CONFIG_PATA_MARVELL is not set
> CONFIG_PATA_MPIIX=y
> # CONFIG_PATA_OLDPIIX is not set
> # CONFIG_PATA_NETCELL is not set
> # CONFIG_PATA_NINJA32 is not set
> # CONFIG_PATA_NS87410 is not set
> # CONFIG_PATA_NS87415 is not set
> # CONFIG_PATA_OPTI is not set
> # CONFIG_PATA_OPTIDMA is not set
> # CONFIG_PATA_PDC_OLD is not set
> # CONFIG_PATA_QDI is not set
> # CONFIG_PATA_RADISYS is not set
> # CONFIG_PATA_RDC is not set
> # CONFIG_PATA_RZ1000 is not set
> # CONFIG_PATA_SC1200 is not set
> # CONFIG_PATA_SERVERWORKS is not set
> # CONFIG_PATA_PDC2027X is not set
> # CONFIG_PATA_SIL680 is not set
> # CONFIG_PATA_SIS is not set
> # CONFIG_PATA_VIA is not set
> # CONFIG_PATA_WINBOND is not set
> # CONFIG_PATA_WINBOND_VLB is not set
> CONFIG_PATA_SCH=y
> CONFIG_MD=y
> # CONFIG_BLK_DEV_MD is not set
> CONFIG_BLK_DEV_DM=m
> CONFIG_DM_DEBUG=y
> # CONFIG_DM_CRYPT is not set
> CONFIG_DM_SNAPSHOT=m
> CONFIG_DM_MIRROR=m
> # CONFIG_DM_LOG_USERSPACE is not set
> CONFIG_DM_ZERO=m
> CONFIG_DM_MULTIPATH=m
> # CONFIG_DM_MULTIPATH_QL is not set
> # CONFIG_DM_MULTIPATH_ST is not set
> CONFIG_DM_DELAY=m
> # CONFIG_DM_UEVENT is not set
> CONFIG_FUSION=y
> CONFIG_FUSION_SPI=y
> CONFIG_FUSION_FC=m
> CONFIG_FUSION_SAS=m
> CONFIG_FUSION_MAX_SGE=40
> CONFIG_FUSION_CTL=m
> CONFIG_FUSION_LOGGING=y
>
> #
> # IEEE 1394 (FireWire) support
> #
>
> #
> # You can enable one or both FireWire driver stacks.
> #
>
> #
> # See the help texts for more information.
> #
> # CONFIG_FIREWIRE is not set
> # CONFIG_IEEE1394 is not set
> # CONFIG_I2O is not set
> # CONFIG_MACINTOSH_DRIVERS is not set
> CONFIG_NETDEVICES=y
> # CONFIG_DUMMY is not set
> # CONFIG_BONDING is not set
> CONFIG_MACVLAN=m
> # CONFIG_EQUALIZER is not set
> CONFIG_TUN=y
> # CONFIG_VETH is not set
> # CONFIG_NET_SB1000 is not set
> # CONFIG_ARCNET is not set
> CONFIG_PHYLIB=m
>
> #
> # MII PHY device drivers
> #
> CONFIG_MARVELL_PHY=m
> CONFIG_DAVICOM_PHY=m
> CONFIG_QSEMI_PHY=m
> CONFIG_LXT_PHY=m
> CONFIG_CICADA_PHY=m
> CONFIG_VITESSE_PHY=m
> CONFIG_SMSC_PHY=m
> CONFIG_BROADCOM_PHY=m
> CONFIG_ICPLUS_PHY=m
> CONFIG_REALTEK_PHY=m
> # CONFIG_NATIONAL_PHY is not set
> # CONFIG_STE10XP is not set
> # CONFIG_LSI_ET1011C_PHY is not set
> CONFIG_MDIO_BITBANG=m
> CONFIG_NET_ETHERNET=y
> CONFIG_MII=y
> # CONFIG_HAPPYMEAL is not set
> # CONFIG_SUNGEM is not set
> # CONFIG_CASSINI is not set
> # CONFIG_NET_VENDOR_3COM is not set
> # CONFIG_LANCE is not set
> # CONFIG_NET_VENDOR_SMC is not set
> # CONFIG_ETHOC is not set
> # CONFIG_NET_VENDOR_RACAL is not set
> # CONFIG_DNET is not set
> # CONFIG_NET_TULIP is not set
> # CONFIG_AT1700 is not set
> # CONFIG_DEPCA is not set
> # CONFIG_HP100 is not set
> # CONFIG_NET_ISA is not set
> # CONFIG_IBM_NEW_EMAC_ZMII is not set
> # CONFIG_IBM_NEW_EMAC_RGMII is not set
> # CONFIG_IBM_NEW_EMAC_TAH is not set
> # CONFIG_IBM_NEW_EMAC_EMAC4 is not set
> # CONFIG_IBM_NEW_EMAC_NO_FLOW_CTRL is not set
> # CONFIG_IBM_NEW_EMAC_MAL_CLR_ICINTSTAT is not set
> # CONFIG_IBM_NEW_EMAC_MAL_COMMON_ERR is not set
> CONFIG_NET_PCI=y
> CONFIG_PCNET32=m
> # CONFIG_AMD8111_ETH is not set
> # CONFIG_ADAPTEC_STARFIRE is not set
> # CONFIG_AC3200 is not set
> # CONFIG_APRICOT is not set
> # CONFIG_B44 is not set
> # CONFIG_FORCEDETH is not set
> # CONFIG_CS89x0 is not set
> CONFIG_E100=y
> # CONFIG_FEALNX is not set
> # CONFIG_NATSEMI is not set
> # CONFIG_NE2K_PCI is not set
> CONFIG_8139CP=m
> CONFIG_8139TOO=m
> CONFIG_8139TOO_PIO=y
> # CONFIG_8139TOO_TUNE_TWISTER is not set
> # CONFIG_8139TOO_8129 is not set
> # CONFIG_8139_OLD_RX_RESET is not set
> # CONFIG_R6040 is not set
> CONFIG_SIS900=m
> # CONFIG_EPIC100 is not set
> # CONFIG_SMSC9420 is not set
> # CONFIG_SUNDANCE is not set
> # CONFIG_TLAN is not set
> # CONFIG_KS8842 is not set
> # CONFIG_KS8851_MLL is not set
> # CONFIG_VIA_RHINE is not set
> # CONFIG_SC92031 is not set
> CONFIG_ATL2=m
> CONFIG_NETDEV_1000=y
> # CONFIG_ACENIC is not set
> # CONFIG_DL2K is not set
> CONFIG_E1000=y
> CONFIG_E1000E=y
> # CONFIG_IP1000 is not set
> CONFIG_IGB=y
> # CONFIG_IGBVF is not set
> # CONFIG_NS83820 is not set
> # CONFIG_HAMACHI is not set
> # CONFIG_YELLOWFIN is not set
> CONFIG_R8169=y
> CONFIG_SIS190=m
> # CONFIG_SKGE is not set
> CONFIG_SKY2=m
> # CONFIG_SKY2_DEBUG is not set
> # CONFIG_VIA_VELOCITY is not set
> CONFIG_TIGON3=m
> CONFIG_BNX2=m
> # CONFIG_CNIC is not set
> # CONFIG_QLA3XXX is not set
> CONFIG_ATL1=m
> CONFIG_ATL1E=y
> # CONFIG_ATL1C is not set
> # CONFIG_JME is not set
> CONFIG_NETDEV_10000=y
> CONFIG_MDIO=m
> # CONFIG_CHELSIO_T1 is not set
> CONFIG_CHELSIO_T3_DEPENDS=y
> # CONFIG_CHELSIO_T3 is not set
> # CONFIG_ENIC is not set
> CONFIG_IXGBE=m
> CONFIG_IXGB=m
> # CONFIG_S2IO is not set
> # CONFIG_VXGE is not set
> # CONFIG_MYRI10GE is not set
> # CONFIG_NETXEN_NIC is not set
> # CONFIG_NIU is not set
> # CONFIG_MLX4_EN is not set
> # CONFIG_MLX4_CORE is not set
> # CONFIG_TEHUTI is not set
> CONFIG_BNX2X=m
> # CONFIG_QLGE is not set
> # CONFIG_SFC is not set
> # CONFIG_BE2NET is not set
> # CONFIG_TR is not set
> CONFIG_WLAN=y
> CONFIG_WLAN_PRE80211=y
> # CONFIG_STRIP is not set
> # CONFIG_ARLAN is not set
> # CONFIG_WAVELAN is not set
> CONFIG_WLAN_80211=y
> CONFIG_LIBERTAS=y
> CONFIG_LIBERTAS_USB=m
> CONFIG_LIBERTAS_SDIO=y
> # CONFIG_LIBERTAS_DEBUG is not set
> # CONFIG_LIBERTAS_THINFIRM is not set
> # CONFIG_AIRO is not set
> # CONFIG_ATMEL is not set
> CONFIG_AT76C50X_USB=m
> # CONFIG_PRISM54 is not set
> CONFIG_USB_ZD1201=m
> CONFIG_USB_NET_RNDIS_WLAN=m
> CONFIG_RTL8180=m
> CONFIG_RTL8187=m
> CONFIG_RTL8187_LEDS=y
> # CONFIG_ADM8211 is not set
> # CONFIG_MAC80211_HWSIM is not set
> # CONFIG_MWL8K is not set
> CONFIG_P54_COMMON=m
> CONFIG_P54_USB=m
> CONFIG_P54_PCI=m
> CONFIG_P54_LEDS=y
> CONFIG_ATH_COMMON=y
> CONFIG_ATH5K=y
> # CONFIG_ATH5K_DEBUG is not set
> CONFIG_ATH9K=m
> # CONFIG_ATH9K_DEBUG is not set
> CONFIG_AR9170_USB=m
> CONFIG_AR9170_LEDS=y
> CONFIG_IPW2100=m
> # CONFIG_IPW2100_MONITOR is not set
> # CONFIG_IPW2100_DEBUG is not set
> CONFIG_IPW2200=m
> # CONFIG_IPW2200_MONITOR is not set
> CONFIG_IPW2200_QOS=y
> # CONFIG_IPW2200_DEBUG is not set
> CONFIG_LIBIPW=m
> # CONFIG_LIBIPW_DEBUG is not set
> CONFIG_IWLWIFI=m
> # CONFIG_IWLWIFI_LEDS is not set
> # CONFIG_IWLWIFI_SPECTRUM_MEASUREMENT is not set
> # CONFIG_IWLWIFI_DEBUG is not set
> CONFIG_IWLAGN=m
> CONFIG_IWL4965=y
> CONFIG_IWL5000=y
> CONFIG_IWL3945=m
> # CONFIG_IWL3945_SPECTRUM_MEASUREMENT is not set
> # CONFIG_HOSTAP is not set
> CONFIG_B43=m
> CONFIG_B43_PCI_AUTOSELECT=y
> CONFIG_B43_PCICORE_AUTOSELECT=y
> # CONFIG_B43_SDIO is not set
> CONFIG_B43_PHY_LP=y
> CONFIG_B43_LEDS=y
> CONFIG_B43_HWRNG=y
> # CONFIG_B43_DEBUG is not set
> # CONFIG_B43LEGACY is not set
> # CONFIG_ZD1211RW is not set
> CONFIG_RT2X00=m
> CONFIG_RT2400PCI=m
> CONFIG_RT2500PCI=m
> CONFIG_RT61PCI=m
> CONFIG_RT2500USB=m
> CONFIG_RT73USB=m
> # CONFIG_RT2800USB is not set
> CONFIG_RT2X00_LIB_PCI=m
> CONFIG_RT2X00_LIB_USB=m
> CONFIG_RT2X00_LIB=m
> CONFIG_RT2X00_LIB_FIRMWARE=y
> CONFIG_RT2X00_LIB_CRYPTO=y
> CONFIG_RT2X00_LIB_LEDS=y
> # CONFIG_RT2X00_LIB_DEBUGFS is not set
> # CONFIG_RT2X00_DEBUG is not set
> # CONFIG_HERMES is not set
> # CONFIG_WL12XX is not set
> # CONFIG_IWM is not set
>
> #
> # WiMAX Wireless Broadband devices
> #
> CONFIG_WIMAX_I2400M=m
> CONFIG_WIMAX_I2400M_USB=m
> # CONFIG_WIMAX_I2400M_SDIO is not set
> CONFIG_WIMAX_I2400M_DEBUG_LEVEL=8
>
> #
> # USB Network Adapters
> #
> CONFIG_USB_CATC=m
> CONFIG_USB_KAWETH=m
> CONFIG_USB_PEGASUS=m
> CONFIG_USB_RTL8150=m
> CONFIG_USB_USBNET=m
> CONFIG_USB_NET_AX8817X=m
> CONFIG_USB_NET_CDCETHER=m
> CONFIG_USB_NET_CDC_EEM=m
> CONFIG_USB_NET_DM9601=m
> CONFIG_USB_NET_SMSC95XX=m
> CONFIG_USB_NET_GL620A=m
> CONFIG_USB_NET_NET1080=m
> CONFIG_USB_NET_PLUSB=m
> CONFIG_USB_NET_MCS7830=m
> CONFIG_USB_NET_RNDIS_HOST=m
> CONFIG_USB_NET_CDC_SUBSET=m
> CONFIG_USB_ALI_M5632=y
> CONFIG_USB_AN2720=y
> CONFIG_USB_BELKIN=y
> CONFIG_USB_ARMLINUX=y
> CONFIG_USB_EPSON2888=y
> CONFIG_USB_KC2190=y
> CONFIG_USB_NET_ZAURUS=m
> # CONFIG_USB_HSO is not set
> # CONFIG_USB_NET_INT51X1 is not set
> # CONFIG_WAN is not set
> # CONFIG_FDDI is not set
> # CONFIG_HIPPI is not set
> CONFIG_PPP=m
> CONFIG_PPP_MULTILINK=y
> CONFIG_PPP_FILTER=y
> CONFIG_PPP_ASYNC=m
> CONFIG_PPP_SYNC_TTY=m
> CONFIG_PPP_DEFLATE=m
> CONFIG_PPP_BSDCOMP=m
> CONFIG_PPP_MPPE=m
> CONFIG_PPPOE=m
> CONFIG_PPPOL2TP=m
> # CONFIG_SLIP is not set
> CONFIG_SLHC=m
> # CONFIG_NET_FC is not set
> # CONFIG_NETCONSOLE is not set
> # CONFIG_NETPOLL is not set
> # CONFIG_NET_POLL_CONTROLLER is not set
> # CONFIG_ISDN is not set
> # CONFIG_PHONE is not set
>
> #
> # Input device support
> #
> CONFIG_INPUT=y
> CONFIG_INPUT_FF_MEMLESS=y
> CONFIG_INPUT_POLLDEV=m
>
> #
> # Userland interfaces
> #
> CONFIG_INPUT_MOUSEDEV=y
> # CONFIG_INPUT_MOUSEDEV_PSAUX is not set
> CONFIG_INPUT_MOUSEDEV_SCREEN_X=1024
> CONFIG_INPUT_MOUSEDEV_SCREEN_Y=768
> CONFIG_INPUT_JOYDEV=m
> CONFIG_INPUT_EVDEV=y
> # CONFIG_INPUT_EVBUG is not set
>
> #
> # Input Device Drivers
> #
> CONFIG_INPUT_KEYBOARD=y
> # CONFIG_KEYBOARD_ADP5588 is not set
> CONFIG_KEYBOARD_ATKBD=y
> # CONFIG_QT2160 is not set
> # CONFIG_KEYBOARD_LKKBD is not set
> # CONFIG_KEYBOARD_LM8323 is not set
> # CONFIG_KEYBOARD_MAX7359 is not set
> # CONFIG_KEYBOARD_NEWTON is not set
> # CONFIG_KEYBOARD_OPENCORES is not set
> # CONFIG_KEYBOARD_STOWAWAY is not set
> # CONFIG_KEYBOARD_SUNKBD is not set
> # CONFIG_KEYBOARD_XTKBD is not set
> CONFIG_INPUT_MOUSE=y
> CONFIG_MOUSE_PS2=y
> CONFIG_MOUSE_PS2_ALPS=y
> CONFIG_MOUSE_PS2_LOGIPS2PP=y
> CONFIG_MOUSE_PS2_SYNAPTICS=y
> CONFIG_MOUSE_PS2_LIFEBOOK=y
> CONFIG_MOUSE_PS2_TRACKPOINT=y
> # CONFIG_MOUSE_PS2_ELANTECH is not set
> # CONFIG_MOUSE_PS2_SENTELIC is not set
> CONFIG_MOUSE_PS2_TOUCHKIT=y
> CONFIG_MOUSE_SERIAL=m
> # CONFIG_MOUSE_APPLETOUCH is not set
> # CONFIG_MOUSE_BCM5974 is not set
> # CONFIG_MOUSE_INPORT is not set
> # CONFIG_MOUSE_LOGIBM is not set
> # CONFIG_MOUSE_PC110PAD is not set
> CONFIG_MOUSE_VSXXXAA=m
> # CONFIG_MOUSE_SYNAPTICS_I2C is not set
> CONFIG_INPUT_JOYSTICK=y
> # CONFIG_JOYSTICK_ANALOG is not set
> # CONFIG_JOYSTICK_A3D is not set
> # CONFIG_JOYSTICK_ADI is not set
> # CONFIG_JOYSTICK_COBRA is not set
> # CONFIG_JOYSTICK_GF2K is not set
> # CONFIG_JOYSTICK_GRIP is not set
> # CONFIG_JOYSTICK_GRIP_MP is not set
> # CONFIG_JOYSTICK_GUILLEMOT is not set
> # CONFIG_JOYSTICK_INTERACT is not set
> # CONFIG_JOYSTICK_SIDEWINDER is not set
> # CONFIG_JOYSTICK_TMDC is not set
> # CONFIG_JOYSTICK_IFORCE is not set
> # CONFIG_JOYSTICK_WARRIOR is not set
> # CONFIG_JOYSTICK_MAGELLAN is not set
> # CONFIG_JOYSTICK_SPACEORB is not set
> # CONFIG_JOYSTICK_SPACEBALL is not set
> # CONFIG_JOYSTICK_STINGER is not set
> # CONFIG_JOYSTICK_TWIDJOY is not set
> # CONFIG_JOYSTICK_ZHENHUA is not set
> # CONFIG_JOYSTICK_JOYDUMP is not set
> # CONFIG_JOYSTICK_XPAD is not set
> # CONFIG_INPUT_TABLET is not set
> CONFIG_INPUT_TOUCHSCREEN=y
> CONFIG_TOUCHSCREEN_AD7879_I2C=m
> CONFIG_TOUCHSCREEN_AD7879=m
> # CONFIG_TOUCHSCREEN_EETI is not set
> CONFIG_TOUCHSCREEN_FUJITSU=m
> CONFIG_TOUCHSCREEN_GUNZE=m
> CONFIG_TOUCHSCREEN_ELO=m
> # CONFIG_TOUCHSCREEN_WACOM_W8001 is not set
> # CONFIG_TOUCHSCREEN_MCS5000 is not set
> CONFIG_TOUCHSCREEN_MTOUCH=m
> CONFIG_TOUCHSCREEN_INEXIO=m
> CONFIG_TOUCHSCREEN_MK712=m
> CONFIG_TOUCHSCREEN_HTCPEN=m
> CONFIG_TOUCHSCREEN_PENMOUNT=m
> CONFIG_TOUCHSCREEN_TOUCHRIGHT=m
> CONFIG_TOUCHSCREEN_TOUCHWIN=m
> CONFIG_TOUCHSCREEN_WM97XX=m
> CONFIG_TOUCHSCREEN_WM9705=y
> CONFIG_TOUCHSCREEN_WM9712=y
> CONFIG_TOUCHSCREEN_WM9713=y
> CONFIG_TOUCHSCREEN_USB_COMPOSITE=m
> CONFIG_TOUCHSCREEN_USB_EGALAX=y
> CONFIG_TOUCHSCREEN_USB_PANJIT=y
> CONFIG_TOUCHSCREEN_USB_3M=y
> CONFIG_TOUCHSCREEN_USB_ITM=y
> CONFIG_TOUCHSCREEN_USB_ETURBO=y
> CONFIG_TOUCHSCREEN_USB_GUNZE=y
> CONFIG_TOUCHSCREEN_USB_DMC_TSC10=y
> CONFIG_TOUCHSCREEN_USB_IRTOUCH=y
> CONFIG_TOUCHSCREEN_USB_IDEALTEK=y
> CONFIG_TOUCHSCREEN_USB_GENERAL_TOUCH=y
> CONFIG_TOUCHSCREEN_USB_GOTOP=y
> CONFIG_TOUCHSCREEN_USB_JASTEC=y
> CONFIG_TOUCHSCREEN_USB_E2I=y
> CONFIG_TOUCHSCREEN_TOUCHIT213=m
> # CONFIG_TOUCHSCREEN_TSC2007 is not set
> CONFIG_INPUT_MISC=y
> # CONFIG_INPUT_PCSPKR is not set
> # CONFIG_INPUT_APANEL is not set
> CONFIG_INPUT_WISTRON_BTNS=m
> # CONFIG_INPUT_ATLAS_BTNS is not set
> # CONFIG_INPUT_ATI_REMOTE is not set
> # CONFIG_INPUT_ATI_REMOTE2 is not set
> CONFIG_INPUT_KEYSPAN_REMOTE=m
> CONFIG_INPUT_POWERMATE=m
> CONFIG_INPUT_YEALINK=m
> # CONFIG_INPUT_CM109 is not set
> # CONFIG_INPUT_UINPUT is not set
> # CONFIG_INPUT_WINBOND_CIR is not set
>
> #
> # Hardware I/O ports
> #
> CONFIG_SERIO=y
> CONFIG_SERIO_I8042=y
> CONFIG_SERIO_SERPORT=y
> # CONFIG_SERIO_CT82C710 is not set
> # CONFIG_SERIO_PCIPS2 is not set
> CONFIG_SERIO_LIBPS2=y
> CONFIG_SERIO_RAW=m
> # CONFIG_GAMEPORT is not set
>
> #
> # Character devices
> #
> CONFIG_VT=y
> CONFIG_CONSOLE_TRANSLATIONS=y
> CONFIG_VT_CONSOLE=y
> CONFIG_HW_CONSOLE=y
> CONFIG_VT_HW_CONSOLE_BINDING=y
> # CONFIG_DEVKMEM is not set
> # CONFIG_SERIAL_NONSTANDARD is not set
> # CONFIG_NOZOMI is not set
>
> #
> # Serial drivers
> #
> CONFIG_SERIAL_8250=y
> CONFIG_SERIAL_8250_CONSOLE=y
> CONFIG_FIX_EARLYCON_MEM=y
> CONFIG_SERIAL_8250_PCI=y
> CONFIG_SERIAL_8250_PNP=y
> CONFIG_SERIAL_8250_NR_UARTS=4
> CONFIG_SERIAL_8250_RUNTIME_UARTS=4
> # CONFIG_SERIAL_8250_EXTENDED is not set
>
> #
> # Non-8250 serial port support
> #
> CONFIG_SERIAL_CORE=y
> CONFIG_SERIAL_CORE_CONSOLE=y
> # CONFIG_SERIAL_JSM is not set
> CONFIG_UNIX98_PTYS=y
> # CONFIG_DEVPTS_MULTIPLE_INSTANCES is not set
> # CONFIG_LEGACY_PTYS is not set
> # CONFIG_IPMI_HANDLER is not set
> CONFIG_HW_RANDOM=m
> # CONFIG_HW_RANDOM_TIMERIOMEM is not set
> # CONFIG_HW_RANDOM_INTEL is not set
> # CONFIG_HW_RANDOM_AMD is not set
> # CONFIG_HW_RANDOM_GEODE is not set
> # CONFIG_HW_RANDOM_VIA is not set
> CONFIG_NVRAM=m
> # CONFIG_DTLK is not set
> # CONFIG_R3964 is not set
> # CONFIG_APPLICOM is not set
> # CONFIG_SONYPI is not set
> # CONFIG_MWAVE is not set
> # CONFIG_PC8736x_GPIO is not set
> # CONFIG_NSC_GPIO is not set
> # CONFIG_CS5535_GPIO is not set
> # CONFIG_RAW_DRIVER is not set
> CONFIG_HPET=y
> # CONFIG_HPET_MMAP is not set
> # CONFIG_HANGCHECK_TIMER is not set
> # CONFIG_TCG_TPM is not set
> # CONFIG_TELCLOCK is not set
> CONFIG_DEVPORT=y
> CONFIG_I2C=y
> CONFIG_I2C_BOARDINFO=y
> CONFIG_I2C_COMPAT=y
> # CONFIG_I2C_CHARDEV is not set
> # CONFIG_I2C_HELPER_AUTO is not set
>
> #
> # I2C Algorithms
> #
> CONFIG_I2C_ALGOBIT=y
> # CONFIG_I2C_ALGOPCF is not set
> # CONFIG_I2C_ALGOPCA is not set
>
> #
> # I2C Hardware Bus support
> #
>
> #
> # PC SMBus host controller drivers
> #
> # CONFIG_I2C_ALI1535 is not set
> # CONFIG_I2C_ALI1563 is not set
> # CONFIG_I2C_ALI15X3 is not set
> # CONFIG_I2C_AMD756 is not set
> # CONFIG_I2C_AMD8111 is not set
> # CONFIG_I2C_I801 is not set
> # CONFIG_I2C_ISCH is not set
> # CONFIG_I2C_PIIX4 is not set
> # CONFIG_I2C_NFORCE2 is not set
> # CONFIG_I2C_SIS5595 is not set
> # CONFIG_I2C_SIS630 is not set
> # CONFIG_I2C_SIS96X is not set
> # CONFIG_I2C_VIA is not set
> # CONFIG_I2C_VIAPRO is not set
>
> #
> # ACPI drivers
> #
> # CONFIG_I2C_SCMI is not set
>
> #
> # I2C system bus drivers (mostly embedded / system-on-chip)
> #
> # CONFIG_I2C_OCORES is not set
> # CONFIG_I2C_SIMTEC is not set
>
> #
> # External I2C/SMBus adapter drivers
> #
> # CONFIG_I2C_PARPORT_LIGHT is not set
> # CONFIG_I2C_TAOS_EVM is not set
> # CONFIG_I2C_TINY_USB is not set
>
> #
> # Graphics adapter I2C/DDC channel drivers
> #
> # CONFIG_I2C_VOODOO3 is not set
>
> #
> # Other I2C/SMBus bus drivers
> #
> # CONFIG_I2C_PCA_ISA is not set
> # CONFIG_I2C_PCA_PLATFORM is not set
> # CONFIG_I2C_STUB is not set
> # CONFIG_SCx200_ACB is not set
>
> #
> # Miscellaneous I2C Chip support
> #
> # CONFIG_DS1682 is not set
> # CONFIG_SENSORS_TSL2550 is not set
> # CONFIG_I2C_DEBUG_CORE is not set
> # CONFIG_I2C_DEBUG_ALGO is not set
> # CONFIG_I2C_DEBUG_BUS is not set
> # CONFIG_I2C_DEBUG_CHIP is not set
> # CONFIG_SPI is not set
>
> #
> # PPS support
> #
> # CONFIG_PPS is not set
> CONFIG_ARCH_WANT_OPTIONAL_GPIOLIB=y
> # CONFIG_GPIOLIB is not set
> # CONFIG_W1 is not set
> CONFIG_POWER_SUPPLY=y
> # CONFIG_POWER_SUPPLY_DEBUG is not set
> # CONFIG_PDA_POWER is not set
> # CONFIG_BATTERY_DS2760 is not set
> # CONFIG_BATTERY_DS2782 is not set
> # CONFIG_BATTERY_BQ27x00 is not set
> # CONFIG_BATTERY_MAX17040 is not set
> CONFIG_HWMON=y
> # CONFIG_HWMON_VID is not set
> # CONFIG_HWMON_DEBUG_CHIP is not set
>
> #
> # Native drivers
> #
> # CONFIG_SENSORS_ABITUGURU is not set
> # CONFIG_SENSORS_ABITUGURU3 is not set
> # CONFIG_SENSORS_AD7414 is not set
> # CONFIG_SENSORS_AD7418 is not set
> # CONFIG_SENSORS_ADM1021 is not set
> # CONFIG_SENSORS_ADM1025 is not set
> # CONFIG_SENSORS_ADM1026 is not set
> # CONFIG_SENSORS_ADM1029 is not set
> # CONFIG_SENSORS_ADM1031 is not set
> # CONFIG_SENSORS_ADM9240 is not set
> # CONFIG_SENSORS_ADT7462 is not set
> # CONFIG_SENSORS_ADT7470 is not set
> # CONFIG_SENSORS_ADT7473 is not set
> # CONFIG_SENSORS_ADT7475 is not set
> # CONFIG_SENSORS_K8TEMP is not set
> # CONFIG_SENSORS_ASB100 is not set
> # CONFIG_SENSORS_ATXP1 is not set
> # CONFIG_SENSORS_DS1621 is not set
> # CONFIG_SENSORS_I5K_AMB is not set
> # CONFIG_SENSORS_F71805F is not set
> # CONFIG_SENSORS_F71882FG is not set
> # CONFIG_SENSORS_F75375S is not set
> # CONFIG_SENSORS_FSCHMD is not set
> # CONFIG_SENSORS_G760A is not set
> # CONFIG_SENSORS_GL518SM is not set
> # CONFIG_SENSORS_GL520SM is not set
> # CONFIG_SENSORS_CORETEMP is not set
> # CONFIG_SENSORS_IT87 is not set
> # CONFIG_SENSORS_LM63 is not set
> # CONFIG_SENSORS_LM75 is not set
> # CONFIG_SENSORS_LM77 is not set
> # CONFIG_SENSORS_LM78 is not set
> # CONFIG_SENSORS_LM80 is not set
> # CONFIG_SENSORS_LM83 is not set
> # CONFIG_SENSORS_LM85 is not set
> # CONFIG_SENSORS_LM87 is not set
> # CONFIG_SENSORS_LM90 is not set
> # CONFIG_SENSORS_LM92 is not set
> # CONFIG_SENSORS_LM93 is not set
> # CONFIG_SENSORS_LTC4215 is not set
> # CONFIG_SENSORS_LTC4245 is not set
> # CONFIG_SENSORS_LM95241 is not set
> # CONFIG_SENSORS_MAX1619 is not set
> # CONFIG_SENSORS_MAX6650 is not set
> # CONFIG_SENSORS_PC87360 is not set
> # CONFIG_SENSORS_PC87427 is not set
> # CONFIG_SENSORS_PCF8591 is not set
> # CONFIG_SENSORS_SIS5595 is not set
> # CONFIG_SENSORS_DME1737 is not set
> # CONFIG_SENSORS_SMSC47M1 is not set
> # CONFIG_SENSORS_SMSC47M192 is not set
> # CONFIG_SENSORS_SMSC47B397 is not set
> # CONFIG_SENSORS_ADS7828 is not set
> # CONFIG_SENSORS_THMC50 is not set
> # CONFIG_SENSORS_TMP401 is not set
> # CONFIG_SENSORS_TMP421 is not set
> # CONFIG_SENSORS_VIA686A is not set
> # CONFIG_SENSORS_VT1211 is not set
> # CONFIG_SENSORS_VT8231 is not set
> # CONFIG_SENSORS_W83781D is not set
> # CONFIG_SENSORS_W83791D is not set
> # CONFIG_SENSORS_W83792D is not set
> # CONFIG_SENSORS_W83793 is not set
> # CONFIG_SENSORS_W83L785TS is not set
> # CONFIG_SENSORS_W83L786NG is not set
> # CONFIG_SENSORS_W83627HF is not set
> # CONFIG_SENSORS_W83627EHF is not set
> # CONFIG_SENSORS_HDAPS is not set
> # CONFIG_SENSORS_APPLESMC is not set
>
> #
> # ACPI drivers
> #
> # CONFIG_SENSORS_ATK0110 is not set
> # CONFIG_SENSORS_LIS3LV02D is not set
> CONFIG_THERMAL=y
> CONFIG_THERMAL_HWMON=y
> # CONFIG_WATCHDOG is not set
> CONFIG_SSB_POSSIBLE=y
>
> #
> # Sonics Silicon Backplane
> #
> CONFIG_SSB=m
> CONFIG_SSB_SPROM=y
> CONFIG_SSB_PCIHOST_POSSIBLE=y
> CONFIG_SSB_PCIHOST=y
> CONFIG_SSB_B43_PCI_BRIDGE=y
> CONFIG_SSB_SDIOHOST_POSSIBLE=y
> # CONFIG_SSB_SDIOHOST is not set
> # CONFIG_SSB_DEBUG is not set
> CONFIG_SSB_DRIVER_PCICORE_POSSIBLE=y
> CONFIG_SSB_DRIVER_PCICORE=y
>
> #
> # Multifunction device drivers
> #
> # CONFIG_MFD_CORE is not set
> # CONFIG_MFD_SM501 is not set
> # CONFIG_HTC_PASIC3 is not set
> # CONFIG_TWL4030_CORE is not set
> # CONFIG_MFD_TMIO is not set
> # CONFIG_PMIC_DA903X is not set
> # CONFIG_MFD_WM8400 is not set
> # CONFIG_MFD_WM831X is not set
> # CONFIG_MFD_WM8350_I2C is not set
> # CONFIG_MFD_PCF50633 is not set
> # CONFIG_AB3100_CORE is not set
> # CONFIG_REGULATOR is not set
> CONFIG_MEDIA_SUPPORT=y
>
> #
> # Multimedia core support
> #
> CONFIG_VIDEO_DEV=y
> CONFIG_VIDEO_V4L2_COMMON=y
> # CONFIG_VIDEO_ALLOW_V4L1 is not set
> CONFIG_VIDEO_V4L1_COMPAT=y
> CONFIG_DVB_CORE=m
> CONFIG_VIDEO_MEDIA=m
>
> #
> # Multimedia drivers
> #
> CONFIG_MEDIA_ATTACH=y
> CONFIG_MEDIA_TUNER=m
> # CONFIG_MEDIA_TUNER_CUSTOMISE is not set
> CONFIG_MEDIA_TUNER_SIMPLE=m
> CONFIG_MEDIA_TUNER_TDA8290=m
> CONFIG_MEDIA_TUNER_TDA9887=m
> CONFIG_MEDIA_TUNER_TEA5761=m
> CONFIG_MEDIA_TUNER_TEA5767=m
> CONFIG_MEDIA_TUNER_MT20XX=m
> CONFIG_MEDIA_TUNER_XC2028=m
> CONFIG_MEDIA_TUNER_XC5000=m
> CONFIG_MEDIA_TUNER_MC44S803=m
> CONFIG_VIDEO_V4L2=y
> CONFIG_VIDEOBUF_GEN=m
> CONFIG_VIDEOBUF_VMALLOC=m
> CONFIG_VIDEO_CAPTURE_DRIVERS=y
> # CONFIG_VIDEO_ADV_DEBUG is not set
> # CONFIG_VIDEO_FIXED_MINOR_RANGES is not set
> CONFIG_VIDEO_HELPER_CHIPS_AUTO=y
> # CONFIG_VIDEO_VIVI is not set
> # CONFIG_VIDEO_BT848 is not set
> # CONFIG_VIDEO_SAA5246A is not set
> # CONFIG_VIDEO_SAA5249 is not set
> # CONFIG_VIDEO_ZORAN is not set
> # CONFIG_VIDEO_SAA7134 is not set
> # CONFIG_VIDEO_HEXIUM_ORION is not set
> # CONFIG_VIDEO_HEXIUM_GEMINI is not set
> # CONFIG_VIDEO_CX88 is not set
> # CONFIG_VIDEO_CX23885 is not set
> # CONFIG_VIDEO_AU0828 is not set
> # CONFIG_VIDEO_IVTV is not set
> # CONFIG_VIDEO_CX18 is not set
> # CONFIG_VIDEO_SAA7164 is not set
> # CONFIG_VIDEO_CAFE_CCIC is not set
> # CONFIG_SOC_CAMERA is not set
> CONFIG_V4L_USB_DRIVERS=y
> CONFIG_USB_VIDEO_CLASS=m
> CONFIG_USB_VIDEO_CLASS_INPUT_EVDEV=y
> CONFIG_USB_GSPCA=m
> # CONFIG_USB_M5602 is not set
> # CONFIG_USB_STV06XX is not set
> # CONFIG_USB_GL860 is not set
> # CONFIG_USB_GSPCA_CONEX is not set
> # CONFIG_USB_GSPCA_ETOMS is not set
> # CONFIG_USB_GSPCA_FINEPIX is not set
> # CONFIG_USB_GSPCA_JEILINJ is not set
> # CONFIG_USB_GSPCA_MARS is not set
> CONFIG_USB_GSPCA_MR97310A=m
> # CONFIG_USB_GSPCA_OV519 is not set
> # CONFIG_USB_GSPCA_OV534 is not set
> # CONFIG_USB_GSPCA_PAC207 is not set
> # CONFIG_USB_GSPCA_PAC7311 is not set
> CONFIG_USB_GSPCA_SN9C20X=m
> CONFIG_USB_GSPCA_SN9C20X_EVDEV=y
> # CONFIG_USB_GSPCA_SONIXB is not set
> # CONFIG_USB_GSPCA_SONIXJ is not set
> # CONFIG_USB_GSPCA_SPCA500 is not set
> # CONFIG_USB_GSPCA_SPCA501 is not set
> # CONFIG_USB_GSPCA_SPCA505 is not set
> # CONFIG_USB_GSPCA_SPCA506 is not set
> # CONFIG_USB_GSPCA_SPCA508 is not set
> # CONFIG_USB_GSPCA_SPCA561 is not set
> CONFIG_USB_GSPCA_SQ905=m
> CONFIG_USB_GSPCA_SQ905C=m
> # CONFIG_USB_GSPCA_STK014 is not set
> # CONFIG_USB_GSPCA_SUNPLUS is not set
> # CONFIG_USB_GSPCA_T613 is not set
> # CONFIG_USB_GSPCA_TV8532 is not set
> # CONFIG_USB_GSPCA_VC032X is not set
> # CONFIG_USB_GSPCA_ZC3XX is not set
> # CONFIG_VIDEO_PVRUSB2 is not set
> # CONFIG_VIDEO_HDPVR is not set
> # CONFIG_VIDEO_EM28XX is not set
> # CONFIG_VIDEO_CX231XX is not set
> # CONFIG_VIDEO_USBVISION is not set
> CONFIG_USB_ET61X251=m
> CONFIG_USB_SN9C102=m
> CONFIG_USB_ZC0301=m
> # CONFIG_USB_PWC_INPUT_EVDEV is not set
> CONFIG_USB_ZR364XX=m
> CONFIG_USB_STKWEBCAM=m
> CONFIG_USB_S2255=m
> # CONFIG_RADIO_ADAPTERS is not set
> CONFIG_DVB_MAX_ADAPTERS=8
> # CONFIG_DVB_DYNAMIC_MINORS is not set
> # CONFIG_DVB_CAPTURE_DRIVERS is not set
> # CONFIG_DAB is not set
>
> #
> # Graphics support
> #
> CONFIG_AGP=y
> # CONFIG_AGP_ALI is not set
> # CONFIG_AGP_ATI is not set
> # CONFIG_AGP_AMD is not set
> # CONFIG_AGP_AMD64 is not set
> CONFIG_AGP_INTEL=y
> # CONFIG_AGP_NVIDIA is not set
> # CONFIG_AGP_SIS is not set
> # CONFIG_AGP_SWORKS is not set
> # CONFIG_AGP_VIA is not set
> # CONFIG_AGP_EFFICEON is not set
> CONFIG_VGA_ARB=y
> CONFIG_DRM=y
> CONFIG_DRM_KMS_HELPER=y
> # CONFIG_DRM_TDFX is not set
> # CONFIG_DRM_R128 is not set
> # CONFIG_DRM_RADEON is not set
> CONFIG_DRM_I810=y
> # CONFIG_DRM_I830 is not set
> CONFIG_DRM_I915=y
> CONFIG_DRM_I915_KMS=y
> # CONFIG_DRM_MGA is not set
> # CONFIG_DRM_SIS is not set
> # CONFIG_DRM_VIA is not set
> # CONFIG_DRM_SAVAGE is not set
> CONFIG_VGASTATE=m
> CONFIG_VIDEO_OUTPUT_CONTROL=y
> CONFIG_FB=y
> # CONFIG_FIRMWARE_EDID is not set
> # CONFIG_FB_DDC is not set
> # CONFIG_FB_BOOT_VESA_SUPPORT is not set
> CONFIG_FB_CFB_FILLRECT=y
> CONFIG_FB_CFB_COPYAREA=y
> CONFIG_FB_CFB_IMAGEBLIT=y
> # CONFIG_FB_CFB_REV_PIXELS_IN_BYTE is not set
> # CONFIG_FB_SYS_FILLRECT is not set
> # CONFIG_FB_SYS_COPYAREA is not set
> # CONFIG_FB_SYS_IMAGEBLIT is not set
> # CONFIG_FB_FOREIGN_ENDIAN is not set
> # CONFIG_FB_SYS_FOPS is not set
> # CONFIG_FB_SVGALIB is not set
> # CONFIG_FB_MACMODES is not set
> # CONFIG_FB_BACKLIGHT is not set
> CONFIG_FB_MODE_HELPERS=y
> # CONFIG_FB_TILEBLITTING is not set
>
> #
> # Frame buffer hardware drivers
> #
> # CONFIG_FB_CIRRUS is not set
> # CONFIG_FB_PM2 is not set
> # CONFIG_FB_CYBER2000 is not set
> # CONFIG_FB_ARC is not set
> # CONFIG_FB_ASILIANT is not set
> # CONFIG_FB_IMSTT is not set
> # CONFIG_FB_VGA16 is not set
> # CONFIG_FB_VESA is not set
> # CONFIG_FB_EFI is not set
> # CONFIG_FB_N411 is not set
> # CONFIG_FB_HGA is not set
> # CONFIG_FB_S1D13XXX is not set
> # CONFIG_FB_NVIDIA is not set
> # CONFIG_FB_RIVA is not set
> CONFIG_FB_I810=m
> # CONFIG_FB_I810_GTF is not set
> # CONFIG_FB_LE80578 is not set
> # CONFIG_FB_MATROX is not set
> # CONFIG_FB_RADEON is not set
> # CONFIG_FB_ATY128 is not set
> # CONFIG_FB_ATY is not set
> # CONFIG_FB_S3 is not set
> # CONFIG_FB_SAVAGE is not set
> # CONFIG_FB_SIS is not set
> # CONFIG_FB_VIA is not set
> # CONFIG_FB_NEOMAGIC is not set
> # CONFIG_FB_KYRO is not set
> # CONFIG_FB_3DFX is not set
> # CONFIG_FB_VOODOO1 is not set
> # CONFIG_FB_VT8623 is not set
> # CONFIG_FB_TRIDENT is not set
> # CONFIG_FB_ARK is not set
> # CONFIG_FB_PM3 is not set
> # CONFIG_FB_CARMINE is not set
> # CONFIG_FB_GEODE is not set
> # CONFIG_FB_VIRTUAL is not set
> # CONFIG_FB_METRONOME is not set
> # CONFIG_FB_MB862XX is not set
> # CONFIG_FB_BROADSHEET is not set
> CONFIG_BACKLIGHT_LCD_SUPPORT=y
> # CONFIG_LCD_CLASS_DEVICE is not set
> CONFIG_BACKLIGHT_CLASS_DEVICE=y
> CONFIG_BACKLIGHT_GENERIC=y
> # CONFIG_BACKLIGHT_PROGEAR is not set
> # CONFIG_BACKLIGHT_MBP_NVIDIA is not set
> # CONFIG_BACKLIGHT_SAHARA is not set
>
> #
> # Display device support
> #
> # CONFIG_DISPLAY_SUPPORT is not set
>
> #
> # Console display driver support
> #
> CONFIG_VGA_CONSOLE=y
> CONFIG_VGACON_SOFT_SCROLLBACK=y
> CONFIG_VGACON_SOFT_SCROLLBACK_SIZE=64
> # CONFIG_MDA_CONSOLE is not set
> CONFIG_DUMMY_CONSOLE=y
> CONFIG_FRAMEBUFFER_CONSOLE=y
> CONFIG_FRAMEBUFFER_CONSOLE_DETECT_PRIMARY=y
> # CONFIG_FRAMEBUFFER_CONSOLE_ROTATION is not set
> CONFIG_FONTS=y
> CONFIG_FONT_8x8=y
> CONFIG_FONT_8x16=y
> CONFIG_FONT_6x11=y
> CONFIG_FONT_7x14=y
> # CONFIG_FONT_PEARL_8x8 is not set
> # CONFIG_FONT_ACORN_8x8 is not set
> # CONFIG_FONT_MINI_4x6 is not set
> # CONFIG_FONT_SUN8x16 is not set
> # CONFIG_FONT_SUN12x22 is not set
> CONFIG_FONT_10x18=y
> # CONFIG_LOGO is not set
> CONFIG_SOUND=y
> # CONFIG_SOUND_OSS_CORE is not set
> CONFIG_SND=y
> CONFIG_SND_TIMER=y
> CONFIG_SND_PCM=y
> CONFIG_SND_HWDEP=y
> CONFIG_SND_RAWMIDI=m
> CONFIG_SND_SEQUENCER=y
> CONFIG_SND_SEQ_DUMMY=y
> # CONFIG_SND_MIXER_OSS is not set
> # CONFIG_SND_PCM_OSS is not set
> # CONFIG_SND_SEQUENCER_OSS is not set
> # CONFIG_SND_HRTIMER is not set
> CONFIG_SND_DYNAMIC_MINORS=y
> # CONFIG_SND_SUPPORT_OLD_API is not set
> CONFIG_SND_VERBOSE_PROCFS=y
> CONFIG_SND_VERBOSE_PRINTK=y
> CONFIG_SND_DEBUG=y
> # CONFIG_SND_DEBUG_VERBOSE is not set
> CONFIG_SND_PCM_XRUN_DEBUG=y
> CONFIG_SND_VMASTER=y
> CONFIG_SND_DMA_SGBUF=y
> CONFIG_SND_RAWMIDI_SEQ=m
> # CONFIG_SND_OPL3_LIB_SEQ is not set
> # CONFIG_SND_OPL4_LIB_SEQ is not set
> # CONFIG_SND_SBAWE_SEQ is not set
> # CONFIG_SND_EMU10K1_SEQ is not set
> CONFIG_SND_AC97_CODEC=y
> CONFIG_SND_DRIVERS=y
> # CONFIG_SND_PCSP is not set
> # CONFIG_SND_DUMMY is not set
> # CONFIG_SND_VIRMIDI is not set
> # CONFIG_SND_MTPAV is not set
> # CONFIG_SND_SERIAL_U16550 is not set
> # CONFIG_SND_MPU401 is not set
> CONFIG_SND_AC97_POWER_SAVE=y
> CONFIG_SND_AC97_POWER_SAVE_DEFAULT=5
> # CONFIG_SND_ISA is not set
> CONFIG_SND_PCI=y
> # CONFIG_SND_AD1889 is not set
> # CONFIG_SND_ALS300 is not set
> # CONFIG_SND_ALS4000 is not set
> # CONFIG_SND_ALI5451 is not set
> # CONFIG_SND_ATIIXP is not set
> # CONFIG_SND_ATIIXP_MODEM is not set
> # CONFIG_SND_AU8810 is not set
> # CONFIG_SND_AU8820 is not set
> # CONFIG_SND_AU8830 is not set
> # CONFIG_SND_AW2 is not set
> # CONFIG_SND_AZT3328 is not set
> # CONFIG_SND_BT87X is not set
> # CONFIG_SND_CA0106 is not set
> # CONFIG_SND_CMIPCI is not set
> # CONFIG_SND_OXYGEN is not set
> # CONFIG_SND_CS4281 is not set
> # CONFIG_SND_CS46XX is not set
> # CONFIG_SND_CS5530 is not set
> # CONFIG_SND_CS5535AUDIO is not set
> # CONFIG_SND_CTXFI is not set
> # CONFIG_SND_DARLA20 is not set
> # CONFIG_SND_GINA20 is not set
> # CONFIG_SND_LAYLA20 is not set
> # CONFIG_SND_DARLA24 is not set
> # CONFIG_SND_GINA24 is not set
> # CONFIG_SND_LAYLA24 is not set
> # CONFIG_SND_MONA is not set
> # CONFIG_SND_MIA is not set
> # CONFIG_SND_ECHO3G is not set
> # CONFIG_SND_INDIGO is not set
> # CONFIG_SND_INDIGOIO is not set
> # CONFIG_SND_INDIGODJ is not set
> # CONFIG_SND_INDIGOIOX is not set
> # CONFIG_SND_INDIGODJX is not set
> # CONFIG_SND_EMU10K1 is not set
> # CONFIG_SND_EMU10K1X is not set
> # CONFIG_SND_ENS1370 is not set
> CONFIG_SND_ENS1371=m
> # CONFIG_SND_ES1938 is not set
> # CONFIG_SND_ES1968 is not set
> # CONFIG_SND_FM801 is not set
> CONFIG_SND_HDA_INTEL=y
> CONFIG_SND_HDA_HWDEP=y
> # CONFIG_SND_HDA_RECONFIG is not set
> # CONFIG_SND_HDA_INPUT_BEEP is not set
> # CONFIG_SND_HDA_INPUT_JACK is not set
> # CONFIG_SND_HDA_PATCH_LOADER is not set
> CONFIG_SND_HDA_CODEC_REALTEK=y
> CONFIG_SND_HDA_CODEC_ANALOG=y
> CONFIG_SND_HDA_CODEC_SIGMATEL=y
> CONFIG_SND_HDA_CODEC_VIA=y
> CONFIG_SND_HDA_CODEC_ATIHDMI=y
> CONFIG_SND_HDA_CODEC_NVHDMI=y
> CONFIG_SND_HDA_CODEC_INTELHDMI=y
> CONFIG_SND_HDA_ELD=y
> CONFIG_SND_HDA_CODEC_CIRRUS=y
> CONFIG_SND_HDA_CODEC_CONEXANT=y
> CONFIG_SND_HDA_CODEC_CA0110=y
> CONFIG_SND_HDA_CODEC_CMEDIA=y
> CONFIG_SND_HDA_CODEC_SI3054=y
> CONFIG_SND_HDA_GENERIC=y
> CONFIG_SND_HDA_POWER_SAVE=y
> CONFIG_SND_HDA_POWER_SAVE_DEFAULT=5
> # CONFIG_SND_HDSP is not set
> # CONFIG_SND_HDSPM is not set
> # CONFIG_SND_HIFIER is not set
> # CONFIG_SND_ICE1712 is not set
> # CONFIG_SND_ICE1724 is not set
> CONFIG_SND_INTEL8X0=y
> # CONFIG_SND_INTEL8X0M is not set
> # CONFIG_SND_KORG1212 is not set
> # CONFIG_SND_LX6464ES is not set
> # CONFIG_SND_MAESTRO3 is not set
> # CONFIG_SND_MIXART is not set
> # CONFIG_SND_NM256 is not set
> # CONFIG_SND_PCXHR is not set
> # CONFIG_SND_RIPTIDE is not set
> # CONFIG_SND_RME32 is not set
> # CONFIG_SND_RME96 is not set
> # CONFIG_SND_RME9652 is not set
> # CONFIG_SND_SIS7019 is not set
> # CONFIG_SND_SONICVIBES is not set
> # CONFIG_SND_TRIDENT is not set
> # CONFIG_SND_VIA82XX is not set
> # CONFIG_SND_VIA82XX_MODEM is not set
> # CONFIG_SND_VIRTUOSO is not set
> # CONFIG_SND_VX222 is not set
> # CONFIG_SND_YMFPCI is not set
> CONFIG_SND_USB=y
> CONFIG_SND_USB_AUDIO=m
> CONFIG_SND_USB_USX2Y=m
> CONFIG_SND_USB_CAIAQ=m
> CONFIG_SND_USB_CAIAQ_INPUT=y
> # CONFIG_SND_USB_US122L is not set
> # CONFIG_SND_SOC is not set
> # CONFIG_SOUND_PRIME is not set
> CONFIG_AC97_BUS=y
> CONFIG_HID_SUPPORT=y
> CONFIG_HID=y
> CONFIG_HIDRAW=y
>
> #
> # USB Input Devices
> #
> CONFIG_USB_HID=y
> CONFIG_HID_PID=y
> CONFIG_USB_HIDDEV=y
>
> #
> # Special HID drivers
> #
> CONFIG_HID_A4TECH=y
> CONFIG_HID_APPLE=y
> CONFIG_HID_BELKIN=y
> CONFIG_HID_CHERRY=y
> CONFIG_HID_CHICONY=y
> CONFIG_HID_CYPRESS=y
> CONFIG_HID_DRAGONRISE=y
> # CONFIG_DRAGONRISE_FF is not set
> CONFIG_HID_EZKEY=y
> CONFIG_HID_KYE=y
> CONFIG_HID_GYRATION=y
> CONFIG_HID_TWINHAN=y
> CONFIG_HID_KENSINGTON=y
> CONFIG_HID_LOGITECH=y
> # CONFIG_LOGITECH_FF is not set
> # CONFIG_LOGIRUMBLEPAD2_FF is not set
> CONFIG_HID_MICROSOFT=y
> CONFIG_HID_MONTEREY=y
> CONFIG_HID_NTRIG=y
> CONFIG_HID_PANTHERLORD=y
> # CONFIG_PANTHERLORD_FF is not set
> CONFIG_HID_PETALYNX=y
> CONFIG_HID_SAMSUNG=y
> CONFIG_HID_SONY=y
> CONFIG_HID_SUNPLUS=y
> CONFIG_HID_GREENASIA=y
> # CONFIG_GREENASIA_FF is not set
> CONFIG_HID_SMARTJOYPLUS=y
> # CONFIG_SMARTJOYPLUS_FF is not set
> CONFIG_HID_TOPSEED=y
> CONFIG_HID_THRUSTMASTER=y
> # CONFIG_THRUSTMASTER_FF is not set
> CONFIG_HID_WACOM=y
> CONFIG_HID_ZEROPLUS=y
> # CONFIG_ZEROPLUS_FF is not set
> CONFIG_USB_SUPPORT=y
> CONFIG_USB_ARCH_HAS_HCD=y
> CONFIG_USB_ARCH_HAS_OHCI=y
> CONFIG_USB_ARCH_HAS_EHCI=y
> CONFIG_USB=y
> # CONFIG_USB_DEBUG is not set
> CONFIG_USB_ANNOUNCE_NEW_DEVICES=y
>
> #
> # Miscellaneous USB options
> #
> CONFIG_USB_DEVICEFS=y
> # CONFIG_USB_DEVICE_CLASS is not set
> # CONFIG_USB_DYNAMIC_MINORS is not set
> CONFIG_USB_SUSPEND=y
> # CONFIG_USB_OTG is not set
> CONFIG_USB_MON=y
> CONFIG_USB_WUSB=m
> # CONFIG_USB_WUSB_CBAF is not set
>
> #
> # USB Host Controller Drivers
> #
> # CONFIG_USB_C67X00_HCD is not set
> # CONFIG_USB_XHCI_HCD is not set
> CONFIG_USB_EHCI_HCD=y
> CONFIG_USB_EHCI_ROOT_HUB_TT=y
> CONFIG_USB_EHCI_TT_NEWSCHED=y
> # CONFIG_USB_OXU210HP_HCD is not set
> CONFIG_USB_ISP116X_HCD=m
> # CONFIG_USB_ISP1760_HCD is not set
> # CONFIG_USB_ISP1362_HCD is not set
> CONFIG_USB_OHCI_HCD=y
> # CONFIG_USB_OHCI_BIG_ENDIAN_DESC is not set
> # CONFIG_USB_OHCI_BIG_ENDIAN_MMIO is not set
> CONFIG_USB_OHCI_LITTLE_ENDIAN=y
> CONFIG_USB_UHCI_HCD=y
> CONFIG_USB_U132_HCD=m
> CONFIG_USB_SL811_HCD=m
> # CONFIG_USB_R8A66597_HCD is not set
> CONFIG_USB_WHCI_HCD=m
> CONFIG_USB_HWA_HCD=m
>
> #
> # USB Device Class drivers
> #
> CONFIG_USB_ACM=m
> CONFIG_USB_PRINTER=m
> CONFIG_USB_WDM=m
> # CONFIG_USB_TMC is not set
>
> #
> # NOTE: USB_STORAGE depends on SCSI but BLK_DEV_SD may
> #
>
> #
> # also be needed; see USB_STORAGE Help for more info
> #
> CONFIG_USB_STORAGE=y
> # CONFIG_USB_STORAGE_DEBUG is not set
> CONFIG_USB_STORAGE_DATAFAB=y
> CONFIG_USB_STORAGE_FREECOM=y
> CONFIG_USB_STORAGE_ISD200=y
> CONFIG_USB_STORAGE_USBAT=y
> CONFIG_USB_STORAGE_SDDR09=y
> CONFIG_USB_STORAGE_SDDR55=y
> CONFIG_USB_STORAGE_JUMPSHOT=y
> CONFIG_USB_STORAGE_ALAUDA=y
> # CONFIG_USB_STORAGE_ONETOUCH is not set
> CONFIG_USB_STORAGE_KARMA=y
> # CONFIG_USB_STORAGE_CYPRESS_ATACB is not set
> CONFIG_USB_LIBUSUAL=y
>
> #
> # USB Imaging devices
> #
> CONFIG_USB_MDC800=m
> CONFIG_USB_MICROTEK=m
>
> #
> # USB port drivers
> #
> CONFIG_USB_SERIAL=m
> CONFIG_USB_EZUSB=y
> CONFIG_USB_SERIAL_GENERIC=y
> CONFIG_USB_SERIAL_AIRCABLE=m
> CONFIG_USB_SERIAL_ARK3116=m
> CONFIG_USB_SERIAL_BELKIN=m
> CONFIG_USB_SERIAL_CH341=m
> CONFIG_USB_SERIAL_WHITEHEAT=m
> CONFIG_USB_SERIAL_DIGI_ACCELEPORT=m
> CONFIG_USB_SERIAL_CP210X=m
> CONFIG_USB_SERIAL_CYPRESS_M8=m
> CONFIG_USB_SERIAL_EMPEG=m
> CONFIG_USB_SERIAL_FTDI_SIO=m
> CONFIG_USB_SERIAL_FUNSOFT=m
> CONFIG_USB_SERIAL_VISOR=m
> CONFIG_USB_SERIAL_IPAQ=m
> CONFIG_USB_SERIAL_IR=m
> CONFIG_USB_SERIAL_EDGEPORT=m
> CONFIG_USB_SERIAL_EDGEPORT_TI=m
> CONFIG_USB_SERIAL_GARMIN=m
> CONFIG_USB_SERIAL_IPW=m
> CONFIG_USB_SERIAL_IUU=m
> CONFIG_USB_SERIAL_KEYSPAN_PDA=m
> CONFIG_USB_SERIAL_KEYSPAN=m
> CONFIG_USB_SERIAL_KEYSPAN_MPR=y
> CONFIG_USB_SERIAL_KEYSPAN_USA28=y
> CONFIG_USB_SERIAL_KEYSPAN_USA28X=y
> CONFIG_USB_SERIAL_KEYSPAN_USA28XA=y
> CONFIG_USB_SERIAL_KEYSPAN_USA28XB=y
> CONFIG_USB_SERIAL_KEYSPAN_USA19=y
> CONFIG_USB_SERIAL_KEYSPAN_USA18X=y
> CONFIG_USB_SERIAL_KEYSPAN_USA19W=y
> CONFIG_USB_SERIAL_KEYSPAN_USA19QW=y
> CONFIG_USB_SERIAL_KEYSPAN_USA19QI=y
> CONFIG_USB_SERIAL_KEYSPAN_USA49W=y
> CONFIG_USB_SERIAL_KEYSPAN_USA49WLC=y
> CONFIG_USB_SERIAL_KLSI=m
> CONFIG_USB_SERIAL_KOBIL_SCT=m
> CONFIG_USB_SERIAL_MCT_U232=m
> CONFIG_USB_SERIAL_MOS7720=m
> CONFIG_USB_SERIAL_MOS7840=m
> # CONFIG_USB_SERIAL_MOTOROLA is not set
> CONFIG_USB_SERIAL_NAVMAN=m
> CONFIG_USB_SERIAL_PL2303=m
> CONFIG_USB_SERIAL_OTI6858=m
> CONFIG_USB_SERIAL_QUALCOMM=m
> # CONFIG_USB_SERIAL_SPCP8X5 is not set
> CONFIG_USB_SERIAL_HP4X=m
> CONFIG_USB_SERIAL_SAFE=m
> CONFIG_USB_SERIAL_SAFE_PADDED=y
> # CONFIG_USB_SERIAL_SIEMENS_MPI is not set
> CONFIG_USB_SERIAL_SIERRAWIRELESS=m
> CONFIG_USB_SERIAL_SYMBOL=m
> CONFIG_USB_SERIAL_TI=m
> CONFIG_USB_SERIAL_CYBERJACK=m
> CONFIG_USB_SERIAL_XIRCOM=m
> CONFIG_USB_SERIAL_OPTION=m
> CONFIG_USB_SERIAL_OMNINET=m
> # CONFIG_USB_SERIAL_OPTICON is not set
> CONFIG_USB_SERIAL_DEBUG=m
>
> #
> # USB Miscellaneous drivers
> #
> CONFIG_USB_EMI62=m
> CONFIG_USB_EMI26=m
> CONFIG_USB_ADUTUX=m
> # CONFIG_USB_SEVSEG is not set
> # CONFIG_USB_RIO500 is not set
> CONFIG_USB_LEGOTOWER=m
> CONFIG_USB_LCD=m
> CONFIG_USB_BERRY_CHARGE=m
> CONFIG_USB_LED=m
> # CONFIG_USB_CYPRESS_CY7C63 is not set
> # CONFIG_USB_CYTHERM is not set
> CONFIG_USB_IDMOUSE=m
> CONFIG_USB_FTDI_ELAN=m
> CONFIG_USB_APPLEDISPLAY=m
> CONFIG_USB_SISUSBVGA=m
> CONFIG_USB_SISUSBVGA_CON=y
> CONFIG_USB_LD=m
> CONFIG_USB_TRANCEVIBRATOR=m
> CONFIG_USB_IOWARRIOR=m
> # CONFIG_USB_TEST is not set
> # CONFIG_USB_ISIGHTFW is not set
> # CONFIG_USB_VST is not set
> # CONFIG_USB_GADGET is not set
>
> #
> # OTG and related infrastructure
> #
> # CONFIG_NOP_USB_XCEIV is not set
> CONFIG_UWB=m
> CONFIG_UWB_HWA=m
> CONFIG_UWB_WHCI=m
> # CONFIG_UWB_WLP is not set
> # CONFIG_UWB_I1480U is not set
> CONFIG_MMC=y
> # CONFIG_MMC_DEBUG is not set
> # CONFIG_MMC_UNSAFE_RESUME is not set
>
> #
> # MMC/SD/SDIO Card Drivers
> #
> CONFIG_MMC_BLOCK=y
> CONFIG_MMC_BLOCK_BOUNCE=y
> CONFIG_SDIO_UART=m
> # CONFIG_MMC_TEST is not set
>
> #
> # MMC/SD/SDIO Host Controller Drivers
> #
> CONFIG_MMC_SDHCI=y
> CONFIG_MMC_SDHCI_PCI=y
> # CONFIG_MMC_RICOH_MMC is not set
> # CONFIG_MMC_SDHCI_PLTFM is not set
> CONFIG_MMC_WBSD=m
> # CONFIG_MMC_AT91 is not set
> # CONFIG_MMC_ATMELMCI is not set
> CONFIG_MMC_TIFM_SD=m
> # CONFIG_MMC_CB710 is not set
> # CONFIG_MMC_VIA_SDMMC is not set
> # CONFIG_MEMSTICK is not set
> CONFIG_NEW_LEDS=y
> CONFIG_LEDS_CLASS=y
>
> #
> # LED drivers
> #
> # CONFIG_LEDS_ALIX2 is not set
> # CONFIG_LEDS_PCA9532 is not set
> # CONFIG_LEDS_LP3944 is not set
> # CONFIG_LEDS_CLEVO_MAIL is not set
> # CONFIG_LEDS_PCA955X is not set
> # CONFIG_LEDS_BD2802 is not set
>
> #
> # LED Triggers
> #
> CONFIG_LEDS_TRIGGERS=y
> # CONFIG_LEDS_TRIGGER_TIMER is not set
> # CONFIG_LEDS_TRIGGER_HEARTBEAT is not set
> # CONFIG_LEDS_TRIGGER_BACKLIGHT is not set
> # CONFIG_LEDS_TRIGGER_DEFAULT_ON is not set
>
> #
> # iptables trigger is under Netfilter config (LED target)
> #
> # CONFIG_ACCESSIBILITY is not set
> # CONFIG_INFINIBAND is not set
> # CONFIG_EDAC is not set
> CONFIG_RTC_LIB=y
> CONFIG_RTC_CLASS=y
> # CONFIG_RTC_HCTOSYS is not set
> # CONFIG_RTC_DEBUG is not set
>
> #
> # RTC interfaces
> #
> CONFIG_RTC_INTF_SYSFS=y
> CONFIG_RTC_INTF_PROC=y
> CONFIG_RTC_INTF_DEV=y
> # CONFIG_RTC_INTF_DEV_UIE_EMUL is not set
> # CONFIG_RTC_DRV_TEST is not set
>
> #
> # I2C RTC drivers
> #
> # CONFIG_RTC_DRV_DS1307 is not set
> # CONFIG_RTC_DRV_DS1374 is not set
> # CONFIG_RTC_DRV_DS1672 is not set
> # CONFIG_RTC_DRV_MAX6900 is not set
> # CONFIG_RTC_DRV_RS5C372 is not set
> # CONFIG_RTC_DRV_ISL1208 is not set
> # CONFIG_RTC_DRV_X1205 is not set
> # CONFIG_RTC_DRV_PCF8563 is not set
> # CONFIG_RTC_DRV_PCF8583 is not set
> # CONFIG_RTC_DRV_M41T80 is not set
> # CONFIG_RTC_DRV_S35390A is not set
> # CONFIG_RTC_DRV_FM3130 is not set
> # CONFIG_RTC_DRV_RX8581 is not set
> # CONFIG_RTC_DRV_RX8025 is not set
>
> #
> # SPI RTC drivers
> #
>
> #
> # Platform RTC drivers
> #
> CONFIG_RTC_DRV_CMOS=y
> # CONFIG_RTC_DRV_DS1286 is not set
> # CONFIG_RTC_DRV_DS1511 is not set
> # CONFIG_RTC_DRV_DS1553 is not set
> # CONFIG_RTC_DRV_DS1742 is not set
> # CONFIG_RTC_DRV_STK17TA8 is not set
> # CONFIG_RTC_DRV_M48T86 is not set
> # CONFIG_RTC_DRV_M48T35 is not set
> # CONFIG_RTC_DRV_M48T59 is not set
> # CONFIG_RTC_DRV_BQ4802 is not set
> # CONFIG_RTC_DRV_V3020 is not set
>
> #
> # on-CPU RTC drivers
> #
> # CONFIG_DMADEVICES is not set
> # CONFIG_AUXDISPLAY is not set
> # CONFIG_UIO is not set
>
> #
> # TI VLYNQ
> #
> CONFIG_STAGING=y
> # CONFIG_STAGING_EXCLUDE_BUILD is not set
> # CONFIG_ET131X is not set
> # CONFIG_SLICOSS is not set
> # CONFIG_VIDEO_GO7007 is not set
> # CONFIG_VIDEO_CX25821 is not set
> CONFIG_USB_IP_COMMON=m
> CONFIG_USB_IP_VHCI_HCD=m
> CONFIG_USB_IP_HOST=m
> # CONFIG_W35UND is not set
> CONFIG_PRISM2_USB=m
> # CONFIG_ECHO is not set
> # CONFIG_AGNX is not set
> # CONFIG_OTUS is not set
> CONFIG_RT2860=m
> CONFIG_RT2870=m
> # CONFIG_RT3090 is not set
> # CONFIG_COMEDI is not set
> # CONFIG_ASUS_OLED is not set
> # CONFIG_ALTERA_PCIE_CHDMA is not set
> CONFIG_RTL8187SE=m
> # CONFIG_RTL8192SU is not set
> # CONFIG_RTL8192E is not set
> # CONFIG_INPUT_MIMIO is not set
> # CONFIG_TRANZPORT is not set
>
> #
> # Android
> #
> # CONFIG_ANDROID is not set
>
> #
> # Qualcomm MSM Camera And Video
> #
>
> #
> # Camera Sensor Selection
> #
> # CONFIG_INPUT_GPIO is not set
> # CONFIG_DST is not set
> # CONFIG_POHMELFS is not set
> # CONFIG_B3DFG is not set
> # CONFIG_IDE_PHISON is not set
> # CONFIG_PLAN9AUTH is not set
> CONFIG_LINE6_USB=m
> # CONFIG_USB_SERIAL_QUATECH2 is not set
> # CONFIG_USB_SERIAL_QUATECH_USB2 is not set
> # CONFIG_VT6655 is not set
> # CONFIG_VT6656 is not set
> # CONFIG_FB_UDL is not set
> # CONFIG_HYPERV is not set
> # CONFIG_VME_BUS is not set
>
> #
> # RAR Register Driver
> #
> # CONFIG_RAR_REGISTER is not set
> # CONFIG_IIO is not set
> # CONFIG_COWLOOP is not set
> CONFIG_X86_PLATFORM_DEVICES=y
> CONFIG_ACER_WMI=y
> # CONFIG_ACERHDF is not set
> CONFIG_ASUS_LAPTOP=m
> CONFIG_DELL_WMI=m
> CONFIG_FUJITSU_LAPTOP=m
> # CONFIG_FUJITSU_LAPTOP_DEBUG is not set
> CONFIG_TC1100_WMI=m
> CONFIG_HP_WMI=m
> CONFIG_MSI_LAPTOP=m
> CONFIG_PANASONIC_LAPTOP=m
> CONFIG_COMPAL_LAPTOP=m
> CONFIG_SONY_LAPTOP=m
> # CONFIG_SONYPI_COMPAT is not set
> CONFIG_THINKPAD_ACPI=m
> # CONFIG_THINKPAD_ACPI_DEBUGFACILITIES is not set
> # CONFIG_THINKPAD_ACPI_DEBUG is not set
> # CONFIG_THINKPAD_ACPI_UNSAFE_LEDS is not set
> CONFIG_THINKPAD_ACPI_VIDEO=y
> CONFIG_THINKPAD_ACPI_HOTKEY_POLL=y
> CONFIG_INTEL_MENLOW=y
> CONFIG_EEEPC_LAPTOP=m
> CONFIG_ACPI_WMI=y
> CONFIG_ACPI_ASUS=m
> # CONFIG_TOPSTAR_LAPTOP is not set
> CONFIG_ACPI_TOSHIBA=m
>
> #
> # Firmware Drivers
> #
> # CONFIG_EDD is not set
> CONFIG_FIRMWARE_MEMMAP=y
> CONFIG_EFI_VARS=m
> # CONFIG_DELL_RBU is not set
> # CONFIG_DCDBAS is not set
> CONFIG_DMIID=y
> # CONFIG_ISCSI_IBFT_FIND is not set
>
> #
> # File systems
> #
> CONFIG_EXT2_FS=y
> # CONFIG_EXT2_FS_XATTR is not set
> # CONFIG_EXT2_FS_XIP is not set
> CONFIG_EXT3_FS=y
> # CONFIG_EXT3_DEFAULTS_TO_ORDERED is not set
> CONFIG_EXT3_FS_XATTR=y
> CONFIG_EXT3_FS_POSIX_ACL=y
> CONFIG_EXT3_FS_SECURITY=y
> # CONFIG_EXT4_FS is not set
> CONFIG_JBD=y
> # CONFIG_JBD_DEBUG is not set
> CONFIG_FS_MBCACHE=y
> # CONFIG_REISERFS_FS is not set
> # CONFIG_JFS_FS is not set
> CONFIG_FS_POSIX_ACL=y
> # CONFIG_XFS_FS is not set
> # CONFIG_GFS2_FS is not set
> # CONFIG_OCFS2_FS is not set
> CONFIG_BTRFS_FS=y
> CONFIG_BTRFS_FS_POSIX_ACL=y
> # CONFIG_NILFS2_FS is not set
> CONFIG_FILE_LOCKING=y
> CONFIG_FSNOTIFY=y
> CONFIG_DNOTIFY=y
> CONFIG_INOTIFY=y
> CONFIG_INOTIFY_USER=y
> # CONFIG_QUOTA is not set
> # CONFIG_AUTOFS_FS is not set
> # CONFIG_AUTOFS4_FS is not set
> CONFIG_FUSE_FS=m
> # CONFIG_CUSE is not set
> CONFIG_GENERIC_ACL=y
>
> #
> # Caches
> #
> # CONFIG_FSCACHE is not set
>
> #
> # CD-ROM/DVD Filesystems
> #
> CONFIG_ISO9660_FS=y
> CONFIG_JOLIET=y
> CONFIG_ZISOFS=y
> CONFIG_UDF_FS=m
> CONFIG_UDF_NLS=y
>
> #
> # DOS/FAT/NT Filesystems
> #
> CONFIG_FAT_FS=y
> CONFIG_MSDOS_FS=y
> CONFIG_VFAT_FS=y
> CONFIG_FAT_DEFAULT_CODEPAGE=437
> CONFIG_FAT_DEFAULT_IOCHARSET="ascii"
> # CONFIG_NTFS_FS is not set
>
> #
> # Pseudo filesystems
> #
> CONFIG_PROC_FS=y
> # CONFIG_PROC_KCORE is not set
> CONFIG_PROC_SYSCTL=y
> CONFIG_PROC_PAGE_MONITOR=y
> CONFIG_SYSFS=y
> CONFIG_TMPFS=y
> CONFIG_TMPFS_POSIX_ACL=y
> # CONFIG_HUGETLBFS is not set
> # CONFIG_HUGETLB_PAGE is not set
> CONFIG_CONFIGFS_FS=m
> CONFIG_MISC_FILESYSTEMS=y
> # CONFIG_ADFS_FS is not set
> # CONFIG_AFFS_FS is not set
> # CONFIG_HFS_FS is not set
> # CONFIG_HFSPLUS_FS is not set
> # CONFIG_BEFS_FS is not set
> # CONFIG_BFS_FS is not set
> # CONFIG_EFS_FS is not set
> # CONFIG_CRAMFS is not set
> CONFIG_SQUASHFS=y
> # CONFIG_SQUASHFS_EMBEDDED is not set
> CONFIG_SQUASHFS_FRAGMENT_CACHE_SIZE=3
> # CONFIG_VXFS_FS is not set
> # CONFIG_MINIX_FS is not set
> # CONFIG_OMFS_FS is not set
> # CONFIG_HPFS_FS is not set
> # CONFIG_QNX4FS_FS is not set
> # CONFIG_ROMFS_FS is not set
> # CONFIG_SYSV_FS is not set
> # CONFIG_UFS_FS is not set
> CONFIG_NETWORK_FILESYSTEMS=y
> # CONFIG_NFS_FS is not set
> # CONFIG_NFSD is not set
> # CONFIG_SMB_FS is not set
> CONFIG_CIFS=m
> # CONFIG_CIFS_STATS is not set
> CONFIG_CIFS_WEAK_PW_HASH=y
> # CONFIG_CIFS_XATTR is not set
> # CONFIG_CIFS_DEBUG2 is not set
> # CONFIG_CIFS_EXPERIMENTAL is not set
> # CONFIG_NCP_FS is not set
> # CONFIG_CODA_FS is not set
> # CONFIG_AFS_FS is not set
>
> #
> # Partition Types
> #
> CONFIG_PARTITION_ADVANCED=y
> # CONFIG_ACORN_PARTITION is not set
> # CONFIG_OSF_PARTITION is not set
> # CONFIG_AMIGA_PARTITION is not set
> # CONFIG_ATARI_PARTITION is not set
> # CONFIG_MAC_PARTITION is not set
> CONFIG_MSDOS_PARTITION=y
> CONFIG_BSD_DISKLABEL=y
> # CONFIG_MINIX_SUBPARTITION is not set
> # CONFIG_SOLARIS_X86_PARTITION is not set
> # CONFIG_UNIXWARE_DISKLABEL is not set
> CONFIG_LDM_PARTITION=y
> # CONFIG_LDM_DEBUG is not set
> # CONFIG_SGI_PARTITION is not set
> # CONFIG_ULTRIX_PARTITION is not set
> # CONFIG_SUN_PARTITION is not set
> # CONFIG_KARMA_PARTITION is not set
> CONFIG_EFI_PARTITION=y
> # CONFIG_SYSV68_PARTITION is not set
> CONFIG_NLS=y
> CONFIG_NLS_DEFAULT="utf8"
> CONFIG_NLS_CODEPAGE_437=y
> CONFIG_NLS_CODEPAGE_737=m
> CONFIG_NLS_CODEPAGE_775=m
> CONFIG_NLS_CODEPAGE_850=m
> CONFIG_NLS_CODEPAGE_852=m
> CONFIG_NLS_CODEPAGE_855=m
> CONFIG_NLS_CODEPAGE_857=m
> CONFIG_NLS_CODEPAGE_860=m
> CONFIG_NLS_CODEPAGE_861=m
> CONFIG_NLS_CODEPAGE_862=m
> CONFIG_NLS_CODEPAGE_863=m
> CONFIG_NLS_CODEPAGE_864=m
> CONFIG_NLS_CODEPAGE_865=m
> CONFIG_NLS_CODEPAGE_866=m
> CONFIG_NLS_CODEPAGE_869=m
> CONFIG_NLS_CODEPAGE_936=m
> CONFIG_NLS_CODEPAGE_950=m
> CONFIG_NLS_CODEPAGE_932=m
> CONFIG_NLS_CODEPAGE_949=m
> CONFIG_NLS_CODEPAGE_874=m
> CONFIG_NLS_ISO8859_8=m
> CONFIG_NLS_CODEPAGE_1250=m
> CONFIG_NLS_CODEPAGE_1251=m
> CONFIG_NLS_ASCII=y
> CONFIG_NLS_ISO8859_1=m
> CONFIG_NLS_ISO8859_2=m
> CONFIG_NLS_ISO8859_3=m
> CONFIG_NLS_ISO8859_4=m
> CONFIG_NLS_ISO8859_5=m
> CONFIG_NLS_ISO8859_6=m
> CONFIG_NLS_ISO8859_7=m
> CONFIG_NLS_ISO8859_9=m
> CONFIG_NLS_ISO8859_13=m
> CONFIG_NLS_ISO8859_14=m
> CONFIG_NLS_ISO8859_15=m
> CONFIG_NLS_KOI8_R=m
> CONFIG_NLS_KOI8_U=m
> CONFIG_NLS_UTF8=m
> # CONFIG_DLM is not set
>
> #
> # Kernel hacking
> #
> CONFIG_TRACE_IRQFLAGS_SUPPORT=y
> CONFIG_PRINTK_TIME=y
> # CONFIG_ENABLE_WARN_DEPRECATED is not set
> CONFIG_ENABLE_MUST_CHECK=y
> CONFIG_FRAME_WARN=1024
> CONFIG_MAGIC_SYSRQ=y
> # CONFIG_STRIP_ASM_SYMS is not set
> # CONFIG_UNUSED_SYMBOLS is not set
> CONFIG_DEBUG_FS=y
> # CONFIG_HEADERS_CHECK is not set
> CONFIG_DEBUG_KERNEL=y
> CONFIG_DEBUG_SHIRQ=y
> CONFIG_DETECT_SOFTLOCKUP=y
> # CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC is not set
> CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC_VALUE=0
> # CONFIG_DETECT_HUNG_TASK is not set
> CONFIG_SCHED_DEBUG=y
> CONFIG_SCHEDSTATS=y
> CONFIG_TIMER_STATS=y
> # CONFIG_DEBUG_OBJECTS is not set
> # CONFIG_DEBUG_SLAB is not set
> # CONFIG_DEBUG_KMEMLEAK is not set
> # CONFIG_DEBUG_PREEMPT is not set
> # CONFIG_DEBUG_RT_MUTEXES is not set
> # CONFIG_RT_MUTEX_TESTER is not set
> CONFIG_DEBUG_SPINLOCK=y
> # CONFIG_DEBUG_MUTEXES is not set
> # CONFIG_DEBUG_LOCK_ALLOC is not set
> # CONFIG_PROVE_LOCKING is not set
> # CONFIG_LOCK_STAT is not set
> CONFIG_DEBUG_SPINLOCK_SLEEP=y
> # CONFIG_DEBUG_LOCKING_API_SELFTESTS is not set
> CONFIG_STACKTRACE=y
> # CONFIG_DEBUG_KOBJECT is not set
> CONFIG_DEBUG_HIGHMEM=y
> CONFIG_DEBUG_BUGVERBOSE=y
> CONFIG_DEBUG_INFO=y
> # CONFIG_DEBUG_VM is not set
> # CONFIG_DEBUG_VIRTUAL is not set
> # CONFIG_DEBUG_WRITECOUNT is not set
> CONFIG_DEBUG_MEMORY_INIT=y
> CONFIG_DEBUG_LIST=y
> # CONFIG_DEBUG_SG is not set
> CONFIG_DEBUG_NOTIFIERS=y
> # CONFIG_DEBUG_CREDENTIALS is not set
> CONFIG_ARCH_WANT_FRAME_POINTERS=y
> CONFIG_FRAME_POINTER=y
> CONFIG_BOOT_PRINTK_DELAY=y
> # CONFIG_RCU_TORTURE_TEST is not set
> # CONFIG_RCU_CPU_STALL_DETECTOR is not set
> # CONFIG_BACKTRACE_SELF_TEST is not set
> # CONFIG_DEBUG_BLOCK_EXT_DEVT is not set
> # CONFIG_DEBUG_FORCE_WEAK_PER_CPU is not set
> # CONFIG_FAULT_INJECTION is not set
> CONFIG_LATENCYTOP=y
> CONFIG_SYSCTL_SYSCALL_CHECK=y
> # CONFIG_DEBUG_PAGEALLOC is not set
> CONFIG_USER_STACKTRACE_SUPPORT=y
> CONFIG_NOP_TRACER=y
> CONFIG_HAVE_FUNCTION_TRACER=y
> CONFIG_HAVE_FUNCTION_GRAPH_TRACER=y
> CONFIG_HAVE_FUNCTION_GRAPH_FP_TEST=y
> CONFIG_HAVE_FUNCTION_TRACE_MCOUNT_TEST=y
> CONFIG_HAVE_DYNAMIC_FTRACE=y
> CONFIG_HAVE_FTRACE_MCOUNT_RECORD=y
> CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
> CONFIG_TRACER_MAX_TRACE=y
> CONFIG_RING_BUFFER=y
> CONFIG_EVENT_TRACING=y
> CONFIG_CONTEXT_SWITCH_TRACER=y
> CONFIG_RING_BUFFER_ALLOW_SWAP=y
> CONFIG_TRACING=y
> CONFIG_GENERIC_TRACER=y
> CONFIG_TRACING_SUPPORT=y
> CONFIG_FTRACE=y
> # CONFIG_FUNCTION_TRACER is not set
> # CONFIG_IRQSOFF_TRACER is not set
> # CONFIG_PREEMPT_TRACER is not set
> CONFIG_SYSPROF_TRACER=y
> CONFIG_SCHED_TRACER=y
> # CONFIG_FTRACE_SYSCALLS is not set
> # CONFIG_BOOT_TRACER is not set
> CONFIG_BRANCH_PROFILE_NONE=y
> # CONFIG_PROFILE_ANNOTATED_BRANCHES is not set
> # CONFIG_PROFILE_ALL_BRANCHES is not set
> CONFIG_POWER_TRACER=y
> # CONFIG_STACK_TRACER is not set
> # CONFIG_KMEMTRACE is not set
> # CONFIG_WORKQUEUE_TRACER is not set
> CONFIG_BLK_DEV_IO_TRACE=y
> # CONFIG_FTRACE_STARTUP_TEST is not set
> # CONFIG_MMIOTRACE is not set
> # CONFIG_RING_BUFFER_BENCHMARK is not set
> # CONFIG_PROVIDE_OHCI1394_DMA_INIT is not set
> # CONFIG_DYNAMIC_DEBUG is not set
> # CONFIG_DMA_API_DEBUG is not set
> # CONFIG_SAMPLES is not set
> CONFIG_HAVE_ARCH_KGDB=y
> # CONFIG_KGDB is not set
> CONFIG_HAVE_ARCH_KMEMCHECK=y
> CONFIG_STRICT_DEVMEM=y
> CONFIG_X86_VERBOSE_BOOTUP=y
> CONFIG_EARLY_PRINTK=y
> # CONFIG_EARLY_PRINTK_DBGP is not set
> # CONFIG_DEBUG_STACKOVERFLOW is not set
> # CONFIG_DEBUG_STACK_USAGE is not set
> # CONFIG_DEBUG_PER_CPU_MAPS is not set
> # CONFIG_X86_PTDUMP is not set
> CONFIG_DEBUG_RODATA=y
> # CONFIG_DEBUG_RODATA_TEST is not set
> # CONFIG_DEBUG_NX_TEST is not set
> # CONFIG_4KSTACKS is not set
> CONFIG_DOUBLEFAULT=y
> # CONFIG_IOMMU_STRESS is not set
> CONFIG_HAVE_MMIOTRACE_SUPPORT=y
> CONFIG_IO_DELAY_TYPE_0X80=0
> CONFIG_IO_DELAY_TYPE_0XED=1
> CONFIG_IO_DELAY_TYPE_UDELAY=2
> CONFIG_IO_DELAY_TYPE_NONE=3
> CONFIG_IO_DELAY_0X80=y
> # CONFIG_IO_DELAY_0XED is not set
> # CONFIG_IO_DELAY_UDELAY is not set
> # CONFIG_IO_DELAY_NONE is not set
> CONFIG_DEFAULT_IO_DELAY_TYPE=0
> CONFIG_DEBUG_BOOT_PARAMS=y
> # CONFIG_CPA_DEBUG is not set
> # CONFIG_OPTIMIZE_INLINING is not set
>
> #
> # Security options
> #
> # CONFIG_KEYS is not set
> # CONFIG_SECURITY is not set
> # CONFIG_SECURITYFS is not set
> # CONFIG_SECURITY_FILE_CAPABILITIES is not set
> # CONFIG_IMA is not set
> CONFIG_CRYPTO=y
>
> #
> # Crypto core or helper
> #
> CONFIG_CRYPTO_ALGAPI=y
> CONFIG_CRYPTO_ALGAPI2=y
> CONFIG_CRYPTO_AEAD=m
> CONFIG_CRYPTO_AEAD2=y
> CONFIG_CRYPTO_BLKCIPHER=y
> CONFIG_CRYPTO_BLKCIPHER2=y
> CONFIG_CRYPTO_HASH=y
> CONFIG_CRYPTO_HASH2=y
> CONFIG_CRYPTO_RNG=m
> CONFIG_CRYPTO_RNG2=y
> CONFIG_CRYPTO_PCOMP=y
> CONFIG_CRYPTO_MANAGER=y
> CONFIG_CRYPTO_MANAGER2=y
> CONFIG_CRYPTO_GF128MUL=m
> CONFIG_CRYPTO_NULL=m
> CONFIG_CRYPTO_WORKQUEUE=y
> # CONFIG_CRYPTO_CRYPTD is not set
> CONFIG_CRYPTO_AUTHENC=m
> CONFIG_CRYPTO_TEST=m
>
> #
> # Authenticated Encryption with Associated Data
> #
> CONFIG_CRYPTO_CCM=m
> CONFIG_CRYPTO_GCM=m
> CONFIG_CRYPTO_SEQIV=m
>
> #
> # Block modes
> #
> CONFIG_CRYPTO_CBC=m
> CONFIG_CRYPTO_CTR=m
> # CONFIG_CRYPTO_CTS is not set
> CONFIG_CRYPTO_ECB=y
> CONFIG_CRYPTO_LRW=m
> CONFIG_CRYPTO_PCBC=m
> CONFIG_CRYPTO_XTS=m
>
> #
> # Hash modes
> #
> CONFIG_CRYPTO_HMAC=y
> CONFIG_CRYPTO_XCBC=m
> # CONFIG_CRYPTO_VMAC is not set
>
> #
> # Digest
> #
> CONFIG_CRYPTO_CRC32C=y
> # CONFIG_CRYPTO_CRC32C_INTEL is not set
> CONFIG_CRYPTO_GHASH=m
> CONFIG_CRYPTO_MD4=m
> CONFIG_CRYPTO_MD5=y
> CONFIG_CRYPTO_MICHAEL_MIC=m
> # CONFIG_CRYPTO_RMD128 is not set
> # CONFIG_CRYPTO_RMD160 is not set
> # CONFIG_CRYPTO_RMD256 is not set
> # CONFIG_CRYPTO_RMD320 is not set
> CONFIG_CRYPTO_SHA1=y
> CONFIG_CRYPTO_SHA256=m
> CONFIG_CRYPTO_SHA512=m
> CONFIG_CRYPTO_TGR192=m
> CONFIG_CRYPTO_WP512=m
>
> #
> # Ciphers
> #
> CONFIG_CRYPTO_AES=y
> CONFIG_CRYPTO_AES_586=m
> CONFIG_CRYPTO_ANUBIS=m
> CONFIG_CRYPTO_ARC4=y
> CONFIG_CRYPTO_BLOWFISH=m
> CONFIG_CRYPTO_CAMELLIA=m
> CONFIG_CRYPTO_CAST5=m
> CONFIG_CRYPTO_CAST6=m
> CONFIG_CRYPTO_DES=m
> CONFIG_CRYPTO_FCRYPT=m
> CONFIG_CRYPTO_KHAZAD=m
> CONFIG_CRYPTO_SALSA20=m
> CONFIG_CRYPTO_SALSA20_586=m
> CONFIG_CRYPTO_SEED=m
> CONFIG_CRYPTO_SERPENT=m
> CONFIG_CRYPTO_TEA=m
> CONFIG_CRYPTO_TWOFISH=m
> CONFIG_CRYPTO_TWOFISH_COMMON=m
> CONFIG_CRYPTO_TWOFISH_586=m
>
> #
> # Compression
> #
> CONFIG_CRYPTO_DEFLATE=m
> CONFIG_CRYPTO_ZLIB=y
> # CONFIG_CRYPTO_LZO is not set
>
> #
> # Random Number Generation
> #
> # CONFIG_CRYPTO_ANSI_CPRNG is not set
> CONFIG_CRYPTO_HW=y
> # CONFIG_CRYPTO_DEV_PADLOCK is not set
> # CONFIG_CRYPTO_DEV_GEODE is not set
> # CONFIG_CRYPTO_DEV_HIFN_795X is not set
> CONFIG_HAVE_KVM=y
> CONFIG_HAVE_KVM_IRQCHIP=y
> CONFIG_HAVE_KVM_EVENTFD=y
> CONFIG_KVM_APIC_ARCHITECTURE=y
> CONFIG_VIRTUALIZATION=y
> CONFIG_KVM=m
> CONFIG_KVM_INTEL=m
> # CONFIG_KVM_AMD is not set
> # CONFIG_LGUEST is not set
> # CONFIG_VIRTIO_PCI is not set
> # CONFIG_VIRTIO_BALLOON is not set
> CONFIG_BINARY_PRINTF=y
>
> #
> # Library routines
> #
> CONFIG_BITREVERSE=y
> CONFIG_GENERIC_FIND_FIRST_BIT=y
> CONFIG_GENERIC_FIND_NEXT_BIT=y
> CONFIG_GENERIC_FIND_LAST_BIT=y
> CONFIG_CRC_CCITT=m
> CONFIG_CRC16=y
> # CONFIG_CRC_T10DIF is not set
> CONFIG_CRC_ITU_T=m
> CONFIG_CRC32=y
> # CONFIG_CRC7 is not set
> CONFIG_LIBCRC32C=y
> CONFIG_ZLIB_INFLATE=y
> CONFIG_ZLIB_DEFLATE=y
> CONFIG_DECOMPRESS_GZIP=y
> CONFIG_DECOMPRESS_BZIP2=y
> CONFIG_DECOMPRESS_LZMA=y
> CONFIG_TEXTSEARCH=y
> CONFIG_TEXTSEARCH_KMP=m
> CONFIG_TEXTSEARCH_BM=m
> CONFIG_TEXTSEARCH_FSM=m
> CONFIG_HAS_IOMEM=y
> CONFIG_HAS_IOPORT=y
> CONFIG_HAS_DMA=y
> CONFIG_CHECK_SIGNATURE=y
> CONFIG_NLATTR=y
>
> Thanks,
>
> Lance Hepler
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From fred99 at carolina.rr.com  Tue Oct  6 14:21:21 2009
From: fred99 at carolina.rr.com (fred99 at carolina.rr.com)
Date: Tue, 6 Oct 2009 8:21:21 -0400
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <69e28c910910050544q2a96939lffe259a211c08ce8@mail.gmail.com>
Message-ID: <20091006122121.VJ888.440143.root@cdptpa-web23-z01>


---- "G?bor Stefanik" <netrolller.3d at gmail.com> wrote: 
> On Fri, Oct 2, 2009 at 11:04 PM,  <fred99 at carolina.rr.com> wrote:
> >
> > Hi Folks --
> >
> > I've read in the archives about DMA errors with the LP-PHY, but there didn't
> > seem to be any conclusion.  Any guidance on what I can test to get it working?
> > It's reproducable on my Lenovo G530 laptop.  (Yes, I know forcing PIO works for
> > others, and it works for me too, but I'd like to help testing if I can).
> >
> > Any guidance on which tests would be most likely to work?  AFAIK, options to
> > test include:
> > * 64bit kernel (and userland?)
> > * Hack b43/dma.c to force fallback to 32bit DMA (as a trial datapoint only)
> 
> Won't work - LP-PHY only supports 64bit DMA.
> 
> > * Boot with Mem=2G.  Currently 4G ram is installed.
> > * Firmware 5xx
> >
> > Or is this a HW design error in the laptop, and I should just live with forcing PIO?
> >
> > My system details:
> > * Compat-wireless-2009-09-30 (and also back to 9-21)
> > * Fedora Rawhide 32-bit, kernel 2.6.31.1-56.fc12.i686
> > * Firmware 478.104
> > * Fatal DMA error soon after heavy traffic starts
> >
> 
> Try installing a proper wireless-testing kernel (not just
> compat-wireless). This issue seems to specifically affect
> 2.6.31+compat-wireless users (probably something needs to be
> backported). 2.6.32-rc1+compat-wireless shoud also work.

Thanks!  I cloned the latest wireless-testing from last night, 2.6.32-rc3 I think.  That seems to work so far, with several hundreds of MB FTP transfers OK.  Previously DMA errors would show up immediately after starting the transfer.  Still get the "NOHZ: local_softirq_pending" stuff.  I will test more transfers and a suspend/resume cycle later tonight, as Lance has reported.  

Any chance of finding out what needs to be fixed for 2.6.31?  Fedora is about to release F12 with a 2.6.31 kernel, and it would be great to be able to backport a fix.  I'm a git noob, but I don't see how to bisect between the wireless-testing tree and compat-wireless.

Lance, you wrote that if you cold boot, then 'sometimes' you can connect.  That means sometimes it *fails* after a cold boot too?  Same DMA errors?

regards, ......... Charlie

> 
> > dmesg extract:
> >
> > ssb: Sonics Silicon Backplane found on PCI device 0000:04:00.0
> > b43-phy0: Broadcom 4312 WLAN found (core revision 15)
> > b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
> > b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
> > phy0: Selected rate control algorithm 'minstrel'
> > Registered led device: b43-phy0::tx
> > Registered led device: b43-phy0::rx
> > Registered led device: b43-phy0::radio
> > Broadcom 43xx driver loaded [ Features: PML, Firmware-ID: FW13 ]
> > b43 ssb0:0: firmware: requesting b43/ucode15.fw
> > cfg80211: Calling CRDA for country: US
> > cfg80211: Regulatory domain changed to country: US
> >        (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
> >        (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
> >        (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
> >        (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> >        (5490000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> >        (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
> > b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
> > b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
> > b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> > b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> > b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
> > b43-phy0 debug: Chip initialized
> > b43-phy0 debug: 64-bit DMA initialized
> > b43-phy0 debug: QoS enabled
> > b43-phy0 debug: Wireless interface started
> > b43-phy0 debug: Adding Interface type 2
> > ADDRCONF(NETDEV_UP): wlan0: link is not ready
> > wlan0: deauthenticating from 00:0c:41:e2:f9:81 by local choice (reason=3)
> > wlan0: direct probe to AP 00:0c:41:e2:f9:81 (try 1)
> > wlan0: direct probe responded
> > wlan0: authenticate with AP 00:0c:41:e2:f9:81 (try 1)
> > wlan0: authenticated
> > wlan0: associate with AP 00:0c:41:e2:f9:81 (try 1)
> > wlan0: RX AssocResp from 00:0c:41:e2:f9:81 (capab=0x411 status=0 aid=2)
> > wlan0: associated
> > ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
> > b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac:
> > ff:ff:ff:ff:ff:ff
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > NOHZ: local_softirq_pending 08
> > wlan0: no IPv6 routers present
> > CE: hpet increasing min_delta_ns to 15000 nsec
> > b43-phy0 ERROR: Fatal DMA error: 0x00000000, 0x00000400, 0x00000000, 0x00000000,
> > 0x00000000, 0x00000000
> > b43-phy0: Controller RESET (DMA error) ...
> > b43-phy0 debug: Wireless interface stopped
> > b43-phy0 debug: DMA-64 rx_ring: Used slots 8/64, Failed frames 0/0 = 0.0%,
> > Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 256/256, Failed frames 0/7742 =
> > 0.0%, Average tries 1.37
> > b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/555 =
> > 0.0%, Average tries 1.01
> > b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> > b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> > b43-phy0 debug: Chip initialized
> > b43-phy0 debug: 64-bit DMA initialized
> > b43-phy0 debug: QoS enabled
> > b43-phy0 debug: Wireless interface started
> > b43-phy0: Controller restarted
> > b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000,
> > 0x00000000, 0x00000000
> > b43-phy0: Controller RESET (DMA error) ...
> > b43-phy0 debug: Wireless interface stopped
> > b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%,
> > Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 1/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> > b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> > b43-phy0 debug: Chip initialized
> > b43-phy0 debug: 64-bit DMA initialized
> > b43-phy0 debug: QoS enabled
> > b43-phy0 debug: Wireless interface started
> > b43-phy0: Controller restarted
> > b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000,
> > 0x00000000, 0x00000000
> > b43-phy0: Controller RESET (DMA error) ...
> > b43-phy0 debug: Wireless interface stopped
> > b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%,
> > Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 =
> > 0.0%, Average tries 0.00
> > b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> > b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> > b43-phy0 debug: Chip initialized
> > b43-phy0 debug: 64-bit DMA initialized
> > b43-phy0 debug: QoS enabled
> >
> > etc etc.
> >
> > regards, .............. Charlie
> >
> > _______________________________________________
> > Bcm43xx-dev mailing list
> > Bcm43xx-dev at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
> >
> 
> 
> 
> -- 
> Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)



From nlhepler at gmail.com  Tue Oct  6 18:05:53 2009
From: nlhepler at gmail.com (Lance Hepler)
Date: Tue, 6 Oct 2009 09:05:53 -0700
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <69e28c910910060348l2351285aqb0577f622bebde10@mail.gmail.com>
References: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com>
	<69e28c910910060348l2351285aqb0577f622bebde10@mail.gmail.com>
Message-ID: <159f5a550910060905l1dd63d30t922b3c3f7cbaf7f7@mail.gmail.com>

2009/10/6 G?bor Stefanik <netrolller.3d at gmail.com>:
> So, this error happens specifically on suspend/resume?

No, it'll happen pretty frequently the first time I try to connect,
but always after I suspend+resume. And once the DMA error pops up, It
just keeps happening.. By far, the rarest occurrence is the device
actually working.

Lance


From netrolller.3d at gmail.com  Tue Oct  6 18:40:12 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Tue, 6 Oct 2009 18:40:12 +0200
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <159f5a550910060905l1dd63d30t922b3c3f7cbaf7f7@mail.gmail.com>
References: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com> 
	<69e28c910910060348l2351285aqb0577f622bebde10@mail.gmail.com> 
	<159f5a550910060905l1dd63d30t922b3c3f7cbaf7f7@mail.gmail.com>
Message-ID: <69e28c910910060940l429f7796j719c4f04931b1960@mail.gmail.com>

2009/10/6 Lance Hepler <nlhepler at gmail.com>:
> 2009/10/6 G?bor Stefanik <netrolller.3d at gmail.com>:
>> So, this error happens specifically on suspend/resume?
>
> No, it'll happen pretty frequently the first time I try to connect,
> but always after I suspend+resume. And once the DMA error pops up, It
> just keeps happening.. By far, the rarest occurrence is the device
> actually working.
>
> Lance
>

One thing I can see from the log is that you have both wl and ssb
(b43's backend) loaded at the same time. Remember to also unload ssb
when you unload b43.

Also, could you try the real wireless-testing?

(BTW, your card is a Dell 1397, which was one of the development cards
I used; so the problem is not a "new variant".)

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Tue Oct  6 22:52:15 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 6 Oct 2009 22:52:15 +0200
Subject: [PATCH] b43: do not stack-allocate pio rx/tx header buffers
In-Reply-To: <1254846043-7121-1-git-send-email-albert_herranz@yahoo.es>
References: <1254846043-7121-1-git-send-email-albert_herranz@yahoo.es>
Message-ID: <200910062252.17565.mb@bu3sch.de>

On Tuesday 06 October 2009 18:20:43 Albert Herranz wrote:
> The DMA-API debugging facility complains about b43 mapping memory from
> stack for SDIO-based cards, as can be seen in the following two
> stack traces.
> 
>   Call Trace:
>   [d2ef7c60] [c01c55f0] check_for_stack+0xf4/0x10c (unreliable)
>   [d2ef7c80] [c01c6d10] debug_dma_map_sg+0xc4/0x134
>   [d2ef7cb0] [c0281e10] sdhci_prepare_data+0x200/0x590
>   [d2ef7ce0] [c0282288] sdhci_send_command+0xe8/0x320
>   [d2ef7d00] [c02825e0] sdhci_request+0x120/0x1b4
>   [d2ef7d20] [c0277ad4] mmc_wait_for_req+0x124/0x140
>   [d2ef7d50] [c027c2f0] mmc_io_rw_extended+0x188/0x214
>   [d2ef7e10] [c027d7c4] sdio_io_rw_ext_helper+0x104/0x224
>   [d2ef7e40] [c0296000] ssb_sdio_block_read+0xac/0x110
>   [d2ef7e60] [c0237f98] pio_rx_frame+0x1d0/0x43c
>   [d2ef7eb0] [c0238244] b43_pio_rx+0x40/0x90
>   [d2ef7ed0] [c0226124] b43_do_interrupt_thread+0x108/0x444
>   [d2ef7f30] [c0226504] b43_sdio_interrupt_handler+0x58/0x74
>   [d2ef7f40] [c0239110] b43_sdio_interrupt_dispatcher+0x4c/0x68
>   [d2ef7f60] [c027e1ac] sdio_irq_thread+0xf8/0x284
>   [d2ef7fb0] [c0054538] kthread+0x78/0x7c
>   [d2ef7ff0] [c00124ec] kernel_thread+0x4c/0x68
> 
>   Call Trace:
>   [d3335c20] [c01c55f0] check_for_stack+0xf4/0x10c (unreliable)
>   [d3335c40] [c01c6d10] debug_dma_map_sg+0xc4/0x134
>   [d3335c70] [c0281e14] sdhci_prepare_data+0x200/0x590
>   [d3335ca0] [c028228c] sdhci_send_command+0xe8/0x320
>   [d3335cc0] [c02825e4] sdhci_request+0x120/0x1b4
>   [d3335ce0] [c0277ad8] mmc_wait_for_req+0x124/0x140
>   [d3335d10] [c027c2f4] mmc_io_rw_extended+0x188/0x214
>   [d3335dd0] [c027d86c] sdio_io_rw_ext_helper+0x1a8/0x224
>   [d3335e00] [c0295ef4] ssb_sdio_block_write+0xac/0x110
>   [d3335e20] [c0237a18] tx_write_4byte_queue+0x6c/0x138
>   [d3335e40] [c0238610] pio_tx_frame+0x1c4/0x224
>   [d3335ee0] [c0238718] b43_pio_tx+0xa8/0x1f4
>   [d3335f00] [c0220380] b43_tx_work+0x4c/0xe0
>   [d3335f20] [c004fa74] run_workqueue+0x120/0x1a4
>   [d3335f70] [c004fb44] worker_thread+0x4c/0xb0
>   [d3335fb0] [c0054538] kthread+0x78/0x7c
>   [d3335ff0] [c00124ec] kernel_thread+0x4c/0x68
> 
> Indeed, b43 currently allocates the PIO RX and TX header buffers
> from stack. The solution here is to use heap-allocated buffers instead.
> 
> Signed-off-by: Albert Herranz <albert_herranz at yahoo.es>
> ---
>  drivers/net/wireless/b43/b43.h |    9 ++++++++
>  drivers/net/wireless/b43/pio.c |   42 +++++++++++++++++++++++++++------------
>  2 files changed, 38 insertions(+), 13 deletions(-)
> 
> diff --git a/drivers/net/wireless/b43/b43.h b/drivers/net/wireless/b43/b43.h
> index fa1549a..b09dda1 100644
> --- a/drivers/net/wireless/b43/b43.h
> +++ b/drivers/net/wireless/b43/b43.h
> @@ -550,6 +550,9 @@ struct b43_dma {
>  struct b43_pio_txqueue;
>  struct b43_pio_rxqueue;
>  
> +struct b43_rxhdr_fw4;
> +struct b43_txhdr;
> +
>  /* Data structures for PIO transmission, per 80211 core. */
>  struct b43_pio {
>  	struct b43_pio_txqueue *tx_queue_AC_BK; /* Background */
> @@ -559,6 +562,12 @@ struct b43_pio {
>  	struct b43_pio_txqueue *tx_queue_mcast; /* Multicast */
>  
>  	struct b43_pio_rxqueue *rx_queue;
> +
> +	/*
> +	 * RX/TX header buffers used by the frame transmit functions.
> +	 */
> +	struct b43_rxhdr_fw4 *rxhdr;
> +	struct b43_txhdr *txhdr;
>  };

Just embed it into struct b43_wl (surround it by #ifdef CONFIG_B43_PIO). No need
to kzalloc then and it saves some memory.
You also need to alloc 4 bytes for the tail buffer (that currently is on the stack, too).

-- 
Greetings, Michael.


From linville at tuxdriver.com  Tue Oct  6 23:13:37 2009
From: linville at tuxdriver.com (John W. Linville)
Date: Tue, 6 Oct 2009 17:13:37 -0400
Subject: [PATCH] b43: do not stack-allocate pio rx/tx header buffers
In-Reply-To: <200910062252.17565.mb@bu3sch.de>
References: <1254846043-7121-1-git-send-email-albert_herranz@yahoo.es>
	<200910062252.17565.mb@bu3sch.de>
Message-ID: <20091006211337.GD2911@tuxdriver.com>

On Tue, Oct 06, 2009 at 10:52:15PM +0200, Michael Buesch wrote:
> On Tuesday 06 October 2009 18:20:43 Albert Herranz wrote:
> > The DMA-API debugging facility complains about b43 mapping memory from
> > stack for SDIO-based cards, as can be seen in the following two
> > stack traces.

<snip>

> > Indeed, b43 currently allocates the PIO RX and TX header buffers
> > from stack. The solution here is to use heap-allocated buffers instead.
> > 
> > Signed-off-by: Albert Herranz <albert_herranz at yahoo.es>

<snip>

> Just embed it into struct b43_wl (surround it by #ifdef CONFIG_B43_PIO). No need
> to kzalloc then and it saves some memory.
> You also need to alloc 4 bytes for the tail buffer (that currently is on the stack, too).

Please make the changes Michael requested and resubmit -- I'll happily
make the adjustments to wireless-testing, etc.

John
-- 
John W. Linville		Someday the world will need a hero, and you
linville at tuxdriver.com			might be all we have.  Be ready.


From mb at bu3sch.de  Tue Oct  6 23:35:09 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 6 Oct 2009 23:35:09 +0200
Subject: b43: fix wldev use after free
In-Reply-To: <20091006142822.55d5120c.akpm@linux-foundation.org>
References: <20091001084924.GA4170@darkstar>
	<20091006142822.55d5120c.akpm@linux-foundation.org>
Message-ID: <200910062335.12069.mb@bu3sch.de>

On Tuesday 06 October 2009 23:28:22 Andrew Morton wrote:
> > fix it by call b43_leds_unregister before b43_one_core_detach
> > if it is the last one in wl->devlist
> > 
> 
> It appears that a different fix was added to linux-next yesterday:

Yes, this one is better, because it doesn't really change the code. It just removes
one unnecessary pointer usage.

-- 
Greetings, Michael.


From fred99 at carolina.rr.com  Wed Oct  7 04:15:21 2009
From: fred99 at carolina.rr.com (Charles Moschel)
Date: Tue, 6 Oct 2009 22:15:21 -0400
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <20091006122121.VJ888.440143.root@cdptpa-web23-z01>
References: <69e28c910910050544q2a96939lffe259a211c08ce8@mail.gmail.com>
	<20091006122121.VJ888.440143.root@cdptpa-web23-z01>
Message-ID: <20091006221521.4b1a47d0@ccm-amd64>

On Tue, 6 Oct 2009 8:21:21 -0400
<fred99 at carolina.rr.com> wrote:
> ---- "G?bor Stefanik" <netrolller.3d at gmail.com> wrote: 
> > On Fri, Oct 2, 2009 at 11:04 PM,  <fred99 at carolina.rr.com> wrote:
> > > My system details:
> > > * Compat-wireless-2009-09-30 (and also back to 9-21)
> > > * Fedora Rawhide 32-bit, kernel 2.6.31.1-56.fc12.i686
> > > * Firmware 478.104
> > > * Fatal DMA error soon after heavy traffic starts
> > >
> > 
> > Try installing a proper wireless-testing kernel (not just
> > compat-wireless). This issue seems to specifically affect
> > 2.6.31+compat-wireless users (probably something needs to be
> > backported). 2.6.32-rc1+compat-wireless shoud also work.
> 
> Thanks!  I cloned the latest wireless-testing from last night, 2.6.32-rc3 I think.  That seems to work so far, with several hundreds of MB FTP transfers OK.  Previously DMA errors would show up immediately after starting the transfer.  Still get the "NOHZ: local_softirq_pending" stuff.  I will test more transfers and a suspend/resume cycle later tonight, as Lance has reported.  

Still stable for me, ~10GB local and ISP transfers, and survives
multiple suspend/resume cycles.

Please let me know if I can help testing any way to get 2.6.31 +
compat-wireless working.

Thanks ! ........ Charlie
 
> Any chance of finding out what needs to be fixed for 2.6.31?  Fedora is about to release F12 with a 2.6.31 kernel, and it would be great to be able to backport a fix.  I'm a git noob, but I don't see how to bisect between the wireless-testing tree and compat-wireless.
> 
> Lance, you wrote that if you cold boot, then 'sometimes' you can connect.  That means sometimes it *fails* after a cold boot too?  Same DMA errors?
> 
> regards, ......... Charlie
> 


From Larry.Finger at lwfinger.net  Wed Oct  7 18:43:02 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 07 Oct 2009 11:43:02 -0500
Subject: [PATCH v2] b43: do not stack-allocate pio rx/tx header and tail
	buffers
In-Reply-To: <1254866864-18265-1-git-send-email-albert_herranz@yahoo.es>
References: <200910062252.17565.mb@bu3sch.de>
	<1254866864-18265-1-git-send-email-albert_herranz@yahoo.es>
Message-ID: <4ACCC516.7050002@lwfinger.net>

Albert Herranz wrote:
> The DMA-API debugging facility complains about b43 mapping memory from
> stack for SDIO-based cards.
> 
> Indeed, b43 currently allocates the PIO RX/TX header and tail buffers
> from stack. The solution here is to use heap-allocated buffers instead.
> 
> Signed-off-by: Albert Herranz <albert_herranz at yahoo.es>
> ---
> v2
> - embed buffers into struct b43_wl, and make them depend on CONFIG_B43_PIO
> - take into account tail buffers for unaligned length transfers
> 
>  drivers/net/wireless/b43/b43.h  |  168 +++++++++++++++++++++------------------
>  drivers/net/wireless/b43/pio.c  |   78 +++++++++---------
>  drivers/net/wireless/b43/xmit.c |    2 +-
>  3 files changed, 132 insertions(+), 116 deletions(-)
> 
> diff --git a/drivers/net/wireless/b43/b43.h b/drivers/net/wireless/b43/b43.h
> index fa1549a..6607162 100644
> --- a/drivers/net/wireless/b43/b43.h
> +++ b/drivers/net/wireless/b43/b43.h
> @@ -607,82 +607,7 @@ struct b43_qos_params {
>  	struct ieee80211_tx_queue_params p;
>  };
>  
> -struct b43_wldev;
> -
> -/* Data structure for the WLAN parts (802.11 cores) of the b43 chip. */
> -struct b43_wl {
> -	/* Pointer to the active wireless device on this chip */
> -	struct b43_wldev *current_dev;
> -	/* Pointer to the ieee80211 hardware data structure */
> -	struct ieee80211_hw *hw;

What is the reason for moving the definition of struct b43_wl?

Larry



From Larry.Finger at lwfinger.net  Wed Oct  7 20:01:09 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 07 Oct 2009 13:01:09 -0500
Subject: [PATCH v2] b43: do not stack-allocate pio rx/tx header and tail
	buffers
In-Reply-To: <4ACCC893.1010402@yahoo.es>
References: <200910062252.17565.mb@bu3sch.de>
	<1254866864-18265-1-git-send-email-albert_herranz@yahoo.es>
	<4ACCC516.7050002@lwfinger.net> <4ACCC893.1010402@yahoo.es>
Message-ID: <4ACCD765.7080604@lwfinger.net>

Albert Herranz wrote:
> Larry Finger wrote:
>> Albert Herranz wrote:
> 
> b43_new_kidx_api() (defined in xmit.h) needs struct b43_wldev defined because it dereferences it.
> With this patch, struct b43_wl (defined in b43.h) needs struct b43_rxhdr_fw4 and struct b43_txhdr (defined in xmit.h).
> 
> So we have b43_wldev -> b43_rxhdr_fw4, b43_txhdr -> b43_wl (at least).
> 
> Moving the definition of struct b43_wl after the definition of struct b43_wldev and placing the inclusion of xmit.h between them gets rid of the generated dependencies.
> 
> The patch hints too to other possible solution.
> 
>> /*
>> * Include goes here to avoid a dependency problem.
>> * A better fix would be to integrate xmit.h into b43.h.
>> */
>> #include "xmit.h"
> 
> Do you have any other solutions in mind?

No. I missed the hint. At first I thought there was a white-space
problem that caused b43_wl to be replaced. When that was not the case,
I posed my question.

All seems OK.

Larry


From nlhepler at gmail.com  Thu Oct  8 05:12:42 2009
From: nlhepler at gmail.com (Lance Hepler)
Date: Wed, 7 Oct 2009 20:12:42 -0700
Subject: 14e4:4315 DMA Errors (still)
In-Reply-To: <69e28c910910060940l429f7796j719c4f04931b1960@mail.gmail.com>
References: <159f5a550910052027n30b173a0mb93745c14a03ffd5@mail.gmail.com>
	<69e28c910910060348l2351285aqb0577f622bebde10@mail.gmail.com>
	<159f5a550910060905l1dd63d30t922b3c3f7cbaf7f7@mail.gmail.com>
	<69e28c910910060940l429f7796j719c4f04931b1960@mail.gmail.com>
Message-ID: <159f5a550910072012x1e595525v35fc60c371699d97@mail.gmail.com>

Hi G?bor, Charlie, All:

I tried wireless-testing commit b4d3a7.. This kernel seems to work
more reliably, but only a little. Sometimes, I still get DMA errors on
cold boot, and I still always get DMA errors after a suspend/resume
cycle. Like Charlie, 'NOHZ: local_softirq_pending 08' shows up when it
does manage to connect.. I certainly wish I could report the other
successes Charlie has. Perhaps I'll update my wireless-testing tonight
and try again.

Lance

2009/10/6 G?bor Stefanik <netrolller.3d at gmail.com>:
> 2009/10/6 Lance Hepler <nlhepler at gmail.com>:
>> 2009/10/6 G?bor Stefanik <netrolller.3d at gmail.com>:
>>> So, this error happens specifically on suspend/resume?
>>
>> No, it'll happen pretty frequently the first time I try to connect,
>> but always after I suspend+resume. And once the DMA error pops up, It
>> just keeps happening.. By far, the rarest occurrence is the device
>> actually working.
>>
>> Lance
>>
>
> One thing I can see from the log is that you have both wl and ssb
> (b43's backend) loaded at the same time. Remember to also unload ssb
> when you unload b43.
>
> Also, could you try the real wireless-testing?
>
> (BTW, your card is a Dell 1397, which was one of the development cards
> I used; so the problem is not a "new variant".)
>
> --
> Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)
>


From celejar at gmail.com  Fri Oct  9 00:58:57 2009
From: celejar at gmail.com (Celejar)
Date: Thu, 8 Oct 2009 18:58:57 -0400
Subject: kernel oops with 2.6.32-rc2
Message-ID: <20091008185857.997d5cdd.celejar@gmail.com>

Card is a 4318:

06:02.0 Network controller: Broadcom Corporation BCM4318 [AirForce One 54g] 802.11g Wireless LAN Controller (rev 02)
	Subsystem: AMBIT Microsystem Corp. TravelMate 2410
	Flags: bus master, fast devsel, latency 64, IRQ 22
	Memory at d0002000 (32-bit, non-prefetchable) [size=8K]
	Kernel driver in use: b43-pci-bridge

This has been working fine, but I've recently been seeing oopses with .32-rc2 from mainline git repo:

~$ uname -a
Linux lizzie 2.6.32-rc2-lizzie-00134-g84d88d5 #2 Thu Oct 1 00:08:23 EDT 2009 i686 GNU/Linux

Here's one, when I tried to unload b43, after
the card had stopped working:

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297331] Oops: 0000 [#1] 

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297334] last sysfs file: /sys/module/b43/refcnt

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297448] Process modprobe (pid: 1421, ti=f2116000 task=f6b18be0 task.ti=f2116000)

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297451] Stack:

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297473] Call Trace:

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297547] Code: f0 0f b6 93 30 02 00 00 5b 5b 5e e9 48 fe ff ff e8 f3 d9 50 c8 8d 76 00 53 83 ec 04 65 8b 15 14 00 00 00 89 14 24 31 d2 8b 58 04 <8b> 83 f4 00 00 00 85 c0 74 13 8d 83 f8 00 00 00 e8 48 db 78 ff 

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297579] EIP: [<f8b1e5a3>] b43_leds_unregister+0x13/0xa0 [b43] SS:ESP 0068:f2117ef4

Message from syslogd at localhost at Oct  8 18:46:17 ...
 kernel:[24031.297588] CR2: 000000002f40666a

Here's syslog:

Oct  8 18:46:17 localhost kernel: [24031.297304] BUG: unable to handle kernel paging request at 2f40666a
Oct  8 18:46:17 localhost kernel: [24031.297312] IP: [<f8b1e5a3>] b43_leds_unregister+0x13/0xa0 [b43]
Oct  8 18:46:17 localhost kernel: [24031.297328] *pde = 00000000 
Oct  8 18:46:17 localhost kernel: [24031.297331] Oops: 0000 [#1] 
Oct  8 18:46:17 localhost kernel: [24031.297334] last sysfs file: /sys/module/b43/refcnt
Oct  8 18:46:17 localhost kernel: [24031.297337] Modules linked in: pl2303 usbserial sd_mod usb_storage scsi_mod usbhid hid i
915 drm_kms_helper drm fb i2c_algo_bit cfbcopyarea i2c_core cfbimgblt cfbfillrect ipv6 iptable_raw ipt_ULOG ipt_REJECT ipt_MA
SQUERADE ipt_ECN ipt_ecn ipt_ah ipt_addrtype xt_multiport ipt_LOG xt_tcpudp xt_state iptable_nat nf_nat nf_conntrack_ipv4 nf_
defrag_ipv4 nf_conntrack iptable_mangle nfnetlink iptable_filter ip_tables x_tables loop arc4 ecb snd_hda_codec_realtek b43(-
) snd_hda_intel pcmcia snd_hda_codec mac80211 snd_pcm snd_seq snd_timer snd_seq_device yenta_socket cfg80211 rsrc_nonstatic r
fkill rtc_cmos pcmcia_core rtc_core rng_core battery ac snd rtc_lib psmouse evdev wmi processor soundcore snd_page_alloc ext3
 jbd sha256_generic aes_i586 aes_generic cbc dm_crypt dm_mod ide_cd_mod ide_gd_mod cdrom ide_pci_generic uhci_hcd sdhci_pci s
dhci b44 piix intel_agp mmc_core video backlight output led_class ide_core button ssb mii ehci_hcd agpgart usbcore thermal fa
n krng chainiv crypto_wq rng c
Oct  8 18:46:17 localhost kernel: ryptomgr crypto_hash aead pcompress crypto_blkcipher crypto_algapi
Oct  8 18:46:17 localhost kernel: [24031.297419] 
Oct  8 18:46:17 localhost kernel: [24031.297423] Pid: 1421, comm: modprobe Not tainted (2.6.32-rc2-lizzie-00134-g84d88d5 #2) 
Aspire 3690     
Oct  8 18:46:17 localhost kernel: [24031.297427] EIP: 0060:[<f8b1e5a3>] EFLAGS: 00010246 CPU: 0
Oct  8 18:46:17 localhost kernel: [24031.297435] EIP is at b43_leds_unregister+0x13/0xa0 [b43]
Oct  8 18:46:17 localhost kernel: [24031.297438] EAX: f6acdc00 EBX: 2f406576 ECX: d911253d EDX: 00000000
Oct  8 18:46:17 localhost kernel: [24031.297441] ESI: f68e2858 EDI: f6acdc00 EBP: f2116000 ESP: f2117ef4
Oct  8 18:46:17 localhost kernel: [24031.297444]  DS: 007b ES: 007b FS: 0000 GS: 00e0 SS: 0068
Oct  8 18:46:17 localhost kernel: [24031.297448] Process modprobe (pid: 1421, ti=f2116000 task=f6b18be0 task.ti=f2116000)
Oct  8 18:46:17 localhost kernel: [24031.297451] Stack:
Oct  8 18:46:17 localhost kernel: [24031.297453]  d911253d f6b64960 f8b06cb5 d911253d f68e2858 f8b236dc f8b236dc f824c3d9
Oct  8 18:46:17 localhost kernel: [24031.297459] <0> d911253d f6a22680 c1173fd4 d911253d f6a22680 f6a226b4 c11740df d911253d
Oct  8 18:46:17 localhost kernel: [24031.297466] <0> fffffff0 f8b236dc f82536e0 c1173005 d911253d fffffff0 00000000 f8b254e0
Oct  8 18:46:17 localhost kernel: [24031.297473] Call Trace:
Oct  8 18:46:17 localhost kernel: [24031.297482]  [<f8b06cb5>] ? b43_remove+0x85/0x110 [b43]
Oct  8 18:46:17 localhost kernel: [24031.297498]  [<f824c3d9>] ? ssb_device_remove+0x29/0x50 [ssb]
Oct  8 18:46:17 localhost kernel: [24031.297506]  [<c1173fd4>] ? __device_release_driver+0x64/0xe0
Oct  8 18:46:17 localhost kernel: [24031.297510]  [<c11740df>] ? driver_detach+0x8f/0xa0
Oct  8 18:46:17 localhost kernel: [24031.297519]  [<c1173005>] ? bus_remove_driver+0x85/0xe0
Oct  8 18:46:17 localhost kernel: [24031.297527]  [<f8b20718>] ? b43_exit+0x18/0x4d [b43]
Oct  8 18:46:17 localhost kernel: [24031.297533]  [<c105a9b4>] ? sys_delete_module+0x154/0x220
Oct  8 18:46:17 localhost kernel: [24031.297539]  [<c101d426>] ? do_page_fault+0x136/0x2f0
Oct  8 18:46:17 localhost kernel: [24031.297544]  [<c10030cf>] ? sysenter_do_call+0x12/0x26
Oct  8 18:46:17 localhost kernel: [24031.297547] Code: f0 0f b6 93 30 02 00 00 5b 5b 5e e9 48 fe ff ff e8 f3 d9 50 c8 8d 76 00 53 83 ec 04 65 8b 15 14 00 00 00 89 14 24 31 d2 8b 58 04 <8b> 83 f4 00 00 00 85 c0 74 13 8d 83 f8 00 00 00 e8 48 db 78 ff 
Oct  8 18:46:17 localhost kernel: [24031.297579] EIP: [<f8b1e5a3>] b43_leds_unregister+0x13/0xa0 [b43] SS:ESP 0068:f2117ef4
Oct  8 18:46:17 localhost kernel: [24031.297588] CR2: 000000002f40666a
Oct  8 18:46:17 localhost kernel: [24031.297592] ---[ end trace 1d5756a54c8bdcd5 ]---

Celejar
-- 
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From zajec5polish at gmail.com  Fri Oct  9 10:44:50 2009
From: zajec5polish at gmail.com (=?UTF-8?B?UmFmYcWCIE1pxYJlY2tp?=)
Date: Fri, 9 Oct 2009 10:44:50 +0200
Subject: kernel oops with 2.6.32-rc2
In-Reply-To: <20091008185857.997d5cdd.celejar@gmail.com>
References: <20091008185857.997d5cdd.celejar@gmail.com>
Message-ID: <14b026160910090144p448ac0bdt8cb017adb985cb30@mail.gmail.com>

2009/10/9 Celejar <celejar at gmail.com>:
> Oct ?8 18:46:17 localhost kernel: [24031.297304] BUG: unable to handle kernel paging request at 2f40666a
> Oct ?8 18:46:17 localhost kernel: [24031.297312] IP: [<f8b1e5a3>] b43_leds_unregister+0x13/0xa0 [b43]

Already noticed and fixed:
https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006129.html

Michael didn't specify in mail for which kernel is that patch, but I
believe it'll hit 2.6.32-rc4

-- 
Rafa?


From mb at bu3sch.de  Fri Oct  9 11:39:33 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 11:39:33 +0200
Subject: Broadcom cards for free
Message-ID: <200910091139.36089.mb@bu3sch.de>

Hi,

I've currently got two Broadcom cards to offer for free.
http://bu3sch.de/misc/bcmcards.JPG

The cardbus one is a WPC300N V1 802.11n card.
It can be used for development of the b43 N-PHY code.

The USB one is BCM4320 which works over RNDIS-WLAN.
This device is disassembled and the EEPROM, which contains
the on-board operating system, is unsoldered and connected through a pinheader.
That means it can be read and/or reprogrammed outside of the device.
The RF-shield on the RF-side of the board was removed.
The device should work properly. It properly registers to the kernel, but I did
not try if it works with the rndis-wlan driver.

-- 
Greetings, Michael.


From netrolller.3d at gmail.com  Fri Oct  9 12:14:24 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Fri, 9 Oct 2009 12:14:24 +0200
Subject: Broadcom cards for free
In-Reply-To: <200910091139.36089.mb@bu3sch.de>
References: <200910091139.36089.mb@bu3sch.de>
Message-ID: <69e28c910910090314j4e9885dfofbc58e901965b4ab@mail.gmail.com>

Sounds interesting... especially now that N-PHY is actually being
reverse-engineered (or is it?).

The modded 4320 is an attempt to replace the built-in OS and use it
with b43 as a softmac device... am I right?

On 10/9/09, Michael Buesch <mb at bu3sch.de> wrote:
> Hi,
>
> I've currently got two Broadcom cards to offer for free.
> http://bu3sch.de/misc/bcmcards.JPG
>
> The cardbus one is a WPC300N V1 802.11n card.
> It can be used for development of the b43 N-PHY code.
>
> The USB one is BCM4320 which works over RNDIS-WLAN.
> This device is disassembled and the EEPROM, which contains
> the on-board operating system, is unsoldered and connected through a
> pinheader.
> That means it can be read and/or reprogrammed outside of the device.
> The RF-shield on the RF-side of the board was removed.
> The device should work properly. It properly registers to the kernel, but I
> did
> not try if it works with the rndis-wlan driver.
>
> --
> Greetings, Michael.
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>


-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Fri Oct  9 12:34:10 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 12:34:10 +0200
Subject: Broadcom cards for free
In-Reply-To: <69e28c910910090314j4e9885dfofbc58e901965b4ab@mail.gmail.com>
References: <200910091139.36089.mb@bu3sch.de>
	<69e28c910910090314j4e9885dfofbc58e901965b4ab@mail.gmail.com>
Message-ID: <200910091234.12484.mb@bu3sch.de>

On Friday 09 October 2009 12:14:24 G?bor Stefanik wrote:
> Sounds interesting... especially now that N-PHY is actually being
> reverse-engineered (or is it?).

I don't know if somebody is working on it, but the card could be useful for
somebody working on it.

> The modded 4320 is an attempt to replace the built-in OS and use it
> with b43 as a softmac device... am I right?

No, it was used to read the EEPROM. There were no attempts to reverse-engineer
and rewrite the EEPROM, however one can do that with this device.
It contains about 300kb data, so it's probably hard to reverse engineer.
However, I think there's no need to start over from zero, because most parts
of the device should be known. They're most likely just running their portable
driver kit on it.

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 16:29:52 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 16:29:52 +0200
Subject: [PATCH] b43: add 'struct b43_wl' missing declaration
In-Reply-To: <200910091613.53960.mboton@gmail.com>
References: <200910091613.53960.mboton@gmail.com>
Message-ID: <200910091629.54616.mb@bu3sch.de>

On Friday 09 October 2009 16:13:53 Miguel Boton wrote:
> 'struct b43_wl' declaration is missing at 'leds.h'.
> It should be declared to avoid getting some GCC warnings at 'b43_leds_unregister'.
> 
> Signed-off-by: Miguel Bot?n <mboton at gmail.com>

ack
(That was fast enough, eh? :D)

> 
> ---
> 
>  drivers/net/wireless/b43/leds.h |    1 +
>  1 files changed, 1 insertions(+), 0 deletions(-)
> 
> diff --git a/drivers/net/wireless/b43/leds.h b/drivers/net/wireless/b43/leds.h
> index 4c56187..32b66d5 100644
> --- a/drivers/net/wireless/b43/leds.h
> +++ b/drivers/net/wireless/b43/leds.h
> @@ -1,6 +1,7 @@
>  #ifndef B43_LEDS_H_
>  #define B43_LEDS_H_
>  
> +struct b43_wl;
>  struct b43_wldev;
>  
>  #ifdef CONFIG_B43_LEDS
> 
> 



-- 
Greetings, Michael.


From Larry.Finger at lwfinger.net  Fri Oct  9 16:34:52 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 09 Oct 2009 09:34:52 -0500
Subject: [PATCH] b43: add 'struct b43_wl' missing declaration
In-Reply-To: <200910091613.53960.mboton@gmail.com>
References: <200910091613.53960.mboton@gmail.com>
Message-ID: <4ACF4A0C.60508@lwfinger.net>

On 10/09/2009 09:13 AM, Miguel Boton wrote:
> 'struct b43_wl' declaration is missing at 'leds.h'.
> It should be declared to avoid getting some GCC warnings at 'b43_leds_unregister'.
> 
> Signed-off-by: Miguel Bot?n <mboton at gmail.com>

What architecture? There must be something strange with your
configuration as I see no such warnings. Please post your .CONFIG.

Larry



From Larry.Finger at lwfinger.net  Fri Oct  9 17:15:42 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 09 Oct 2009 10:15:42 -0500
Subject: Broken patch for b43
Message-ID: <4ACF539E.8070107@lwfinger.net>

Hi,

Unfortunately, my patch entitled "43: Fix PPC crash in rfkill polling
on unload" had more problems than a locking error. When you switch the
RF off, you cannot turn the radio back on without unloading/reloading
the module.

I have an alternative fix for the PPC that is now being tested;
however, it may just restrict the unload/load problem to older models.
To know whether that is a possibility, I need to know if anyone has a
G PHY device with PHY revision <= 2 that also has an RFKILL switch.
Note: LP PHYs (ID of 4315) will have such revisions, but they do not
count.

Thanks,

Larry


From Larry.Finger at lwfinger.net  Fri Oct  9 17:22:27 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 09 Oct 2009 10:22:27 -0500
Subject: Broadcom cards for free
In-Reply-To: <69e28c910910090314j4e9885dfofbc58e901965b4ab@mail.gmail.com>
References: <200910091139.36089.mb@bu3sch.de>
	<69e28c910910090314j4e9885dfofbc58e901965b4ab@mail.gmail.com>
Message-ID: <4ACF5533.70307@lwfinger.net>

On 10/09/2009 05:14 AM, G?bor Stefanik wrote:
> Sounds interesting... especially now that N-PHY is actually being
> reverse-engineered (or is it?).

I'm still working on it, although a lot of my time is taken in testing
openSUSE 11.2 pre-release code. As the release date is Nov. 12, that
will soon be over.

Larry



From Larry.Finger at lwfinger.net  Fri Oct  9 18:17:20 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 09 Oct 2009 11:17:20 -0500
Subject: Broken patch for b43
In-Reply-To: <69e28c910910090841n7557683djfce7fb7880cdd1bf@mail.gmail.com>
References: <4ACF539E.8070107@lwfinger.net>
	<69e28c910910090841n7557683djfce7fb7880cdd1bf@mail.gmail.com>
Message-ID: <4ACF6210.5060801@lwfinger.net>

On 10/09/2009 10:41 AM, G?bor Stefanik wrote:
> G-PHY revision <=2 is handled by b43legacy, not b43, so it shouldn't
> be a problem.

I thought that was the case; however, the traceback on the PPC with
the problem shows:

 NIP [c001bb6c] ioread16+0x8/0x18
 LR [f1078610] ssb_pci_read16+0x30/0x68 [ssb]
 Call Trace:
 [ef87fec0] [f1076b58] ssb_device_enable+0xe0/0x118 [ssb] (unreliable)
 [ef87fed0] [f34c68e0] b43_is_hw_radio_enabled+0x60/0x74 [b43]
 [ef87fee0] [f34c693c] b43_rfkill_poll+0x48/0x134 [b43]

It seems to me that the only way that b43_is_hw_radio_enabled gets to
ssb_pci_read16 is with a call to b43_read16, and that implies phy.rev
<= 2.

I have a request in to the OP on the bug to get the details of his device.

Larry




From mb at bu3sch.de  Fri Oct  9 18:22:01 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 18:22:01 +0200
Subject: Broken patch for b43
In-Reply-To: <4ACF6210.5060801@lwfinger.net>
References: <4ACF539E.8070107@lwfinger.net>
	<69e28c910910090841n7557683djfce7fb7880cdd1bf@mail.gmail.com>
	<4ACF6210.5060801@lwfinger.net>
Message-ID: <200910091822.05329.mb@bu3sch.de>

On Friday 09 October 2009 18:17:20 Larry Finger wrote:
> On 10/09/2009 10:41 AM, G?bor Stefanik wrote:
> > G-PHY revision <=2 is handled by b43legacy, not b43, so it shouldn't
> > be a problem.

That is not true.

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 20:05:58 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:05:58 +0200
Subject: b43: do not stack-allocate pio rx/tx header and tail buffers
	(was: pull request: wireless-2.6 2009-10-08)
In-Reply-To: <4ACF76F7.30406@yahoo.es>
References: <200910062252.17565.mb@bu3sch.de> <4ACCD765.7080604@lwfinger.net>
	<4ACF76F7.30406@yahoo.es>
Message-ID: <200910092005.59916.mb@bu3sch.de>

On Friday 09 October 2009 19:46:31 Albert Herranz wrote:
> I'm not arguing if the patch should have been immediately merged upstream or not without your ack (I'm probably more on your side here, as the patch was still being discussed on the ML).
> The patch [1] may not be up to your quality standards or may not take into account other requirements (that you have not expressed nor on the ML nor on IRC) but I'm sure it's far from being "random", "move crap" or "add stupid comments". That's the unfair part.
> 
> The reason I posted the initial patch for review was because you kind of told me [2].
> 
> [20:06] <mb_> Anyway, I'm not going to fix this. If you need it fixed, please send patches

Yeah, but that doesn't mean that either hack is acceptable. It just means that my time is limited
and I added this non-issue (which I still think it is) to the very bottom of my priority list.

> After ~22 hours if I'm not mistaken (yes, less than 24...) John, who had previously expressed his intentions to merge the patch [5], picked it for wireless-2.6.
> And a day later, more or less again, John did the GIT PULL request.

My impression was, that if the maintainer rejects a patch and asks for a new version,
the upstream maintainer must not take the patch until the maintainer acked the new version.
It seems I was wrong, though.

> My point here is that there's no reason for such strong words concerning the quality of the patch code. It's really not that bad for such wording.
> I'm sure that if the patch was really crap it would have been immediately NAK'ed by you or by any sane maintainer.

It _was_ immediately NAK'ed by me. I did not know that I need to NAK
every single new version of a patch explicitely.
I thought NAK-ing a patch would put it into some special state that only an explicit ACK could
take it out of.

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 20:30:10 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:30:10 +0200
Subject: [PATCH] b43/legacy: Fix usage of host_pci pointer
Message-ID: <200910092030.10963.mb@bu3sch.de>

We must check the bustype before using the host_pci pointer.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

This does not fix a bug, but is required for a future patch which puts
the pointer into a union.

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2009-10-09 18:47:03.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2009-10-09 18:47:52.000000000 +0200
@@ -4671,7 +4671,7 @@ static int b43_wireless_core_attach(stru
 {
 	struct b43_wl *wl = dev->wl;
 	struct ssb_bus *bus = dev->dev->bus;
-	struct pci_dev *pdev = bus->host_pci;
+	struct pci_dev *pdev = (bus->bustype == SSB_BUSTYPE_PCI) ? bus->host_pci : NULL;
 	int err;
 	bool have_2ghz_phy = 0, have_5ghz_phy = 0;
 	u32 tmp;
@@ -4804,7 +4804,7 @@ static int b43_one_core_attach(struct ss
 
 	if (!list_empty(&wl->devlist)) {
 		/* We are not the first core on this chip. */
-		pdev = dev->bus->host_pci;
+		pdev = (dev->bus->bustype == SSB_BUSTYPE_PCI) ? dev->bus->host_pci : NULL;
 		/* Only special chips support more than one wireless
 		 * core, although some of the other chips have more than
 		 * one wireless core as well. Check for this and
Index: wireless-testing/drivers/net/wireless/b43legacy/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/main.c	2009-10-09 18:47:03.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43legacy/main.c	2009-10-09 18:47:52.000000000 +0200
@@ -3592,7 +3592,7 @@ static int b43legacy_wireless_core_attac
 {
 	struct b43legacy_wl *wl = dev->wl;
 	struct ssb_bus *bus = dev->dev->bus;
-	struct pci_dev *pdev = bus->host_pci;
+	struct pci_dev *pdev = (bus->bustype == SSB_BUSTYPE_PCI) ? bus->host_pci : NULL;
 	int err;
 	int have_bphy = 0;
 	int have_gphy = 0;
@@ -3706,7 +3706,7 @@ static int b43legacy_one_core_attach(str
 
 	if (!list_empty(&wl->devlist)) {
 		/* We are not the first core on this chip. */
-		pdev = dev->bus->host_pci;
+		pdev = (dev->bus->bustype == SSB_BUSTYPE_PCI) ? dev->bus->host_pci : NULL;
 		/* Only special chips support more than one wireless
 		 * core, although some of the other chips have more than
 		 * one wireless core as well. Check for this and

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 20:32:10 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:32:10 +0200
Subject: [PATCH] ssb: Put host pointers into a union
Message-ID: <200910092032.10324.mb@bu3sch.de>

This slightly shrinks the structure.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

Index: wireless-testing/drivers/ssb/driver_pcicore.c
===================================================================
--- wireless-testing.orig/drivers/ssb/driver_pcicore.c	2008-07-20 12:09:34.000000000 +0200
+++ wireless-testing/drivers/ssb/driver_pcicore.c	2009-10-09 19:01:59.000000000 +0200
@@ -551,13 +551,13 @@ int ssb_pcicore_dev_irqvecs_enable(struc
 	might_sleep_if(pdev->id.coreid != SSB_DEV_PCI);
 
 	/* Enable interrupts for this device. */
-	if (bus->host_pci &&
-	    ((pdev->id.revision >= 6) || (pdev->id.coreid == SSB_DEV_PCIE))) {
+	if ((pdev->id.revision >= 6) || (pdev->id.coreid == SSB_DEV_PCIE)) {
 		u32 coremask;
 
 		/* Calculate the "coremask" for the device. */
 		coremask = (1 << dev->core_index);
 
+		SSB_WARN_ON(bus->bustype != SSB_BUSTYPE_PCI);
 		err = pci_read_config_dword(bus->host_pci, SSB_PCI_IRQMASK, &tmp);
 		if (err)
 			goto out;
Index: wireless-testing/include/linux/ssb/ssb.h
===================================================================
--- wireless-testing.orig/include/linux/ssb/ssb.h	2009-09-11 21:27:27.000000000 +0200
+++ wireless-testing/include/linux/ssb/ssb.h	2009-10-09 19:10:42.000000000 +0200
@@ -269,7 +269,8 @@ struct ssb_bus {
 
 	const struct ssb_bus_ops *ops;
 
-	/* The core in the basic address register window. (PCI bus only) */
+	/* The core currently mapped into the MMIO window.
+	 * Not valid on all host-buses. So don't use outside of SSB. */
 	struct ssb_device *mapped_device;
 	union {
 		/* Currently mapped PCMCIA segment. (bustype == SSB_BUSTYPE_PCMCIA only) */
@@ -281,14 +282,17 @@ struct ssb_bus {
 	 * On PCMCIA-host busses this is used to protect the whole MMIO access. */
 	spinlock_t bar_lock;
 
-	/* The bus this backplane is running on. */
+	/* The host-bus this backplane is running on. */
 	enum ssb_bustype bustype;
-	/* Pointer to the PCI bus (only valid if bustype == SSB_BUSTYPE_PCI). */
-	struct pci_dev *host_pci;
-	/* Pointer to the PCMCIA device (only if bustype == SSB_BUSTYPE_PCMCIA). */
-	struct pcmcia_device *host_pcmcia;
-	/* Pointer to the SDIO device (only if bustype == SSB_BUSTYPE_SDIO). */
-	struct sdio_func *host_sdio;
+	/* Pointers to the host-bus. Check bustype before using any of these pointers. */
+	union {
+		/* Pointer to the PCI bus (only valid if bustype == SSB_BUSTYPE_PCI). */
+		struct pci_dev *host_pci;
+		/* Pointer to the PCMCIA device (only if bustype == SSB_BUSTYPE_PCMCIA). */
+		struct pcmcia_device *host_pcmcia;
+		/* Pointer to the SDIO device (only if bustype == SSB_BUSTYPE_SDIO). */
+		struct sdio_func *host_sdio;
+	};
 
 	/* See enum ssb_quirks */
 	unsigned int quirks;

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 20:33:32 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:33:32 +0200
Subject: [PATCH] b43: Optimize PIO scratchbuffer usage
Message-ID: <200910092033.32585.mb@bu3sch.de>

This optimizes the PIO scratchbuffer usage.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

Index: wireless-testing/drivers/net/wireless/b43/b43.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/b43.h	2009-10-09 19:50:15.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/b43.h	2009-10-09 20:15:41.000000000 +0200
@@ -749,12 +749,6 @@ struct b43_wldev {
 #endif
 };
 
-/*
- * Include goes here to avoid a dependency problem.
- * A better fix would be to integrate xmit.h into b43.h.
- */
-#include "xmit.h"
-
 /* Data structure for the WLAN parts (802.11 cores) of the b43 chip. */
 struct b43_wl {
 	/* Pointer to the active wireless device on this chip */
@@ -830,13 +824,9 @@ struct b43_wl {
 	struct b43_leds leds;
 
 #ifdef CONFIG_B43_PIO
-	/*
-	 * RX/TX header/tail buffers used by the frame transmit functions.
-	 */
-	struct b43_rxhdr_fw4 rxhdr;
-	struct b43_txhdr txhdr;
-	u8 rx_tail[4];
-	u8 tx_tail[4];
+	/* Kmalloc'ed scratch space for PIO TX/RX. Protected by wl->mutex. */
+	u8 pio_scratchspace[110] __attribute__((__aligned__(8)));
+	u8 pio_tailspace[4] __attribute__((__aligned__(8)));
 #endif /* CONFIG_B43_PIO */
 };
 
Index: wireless-testing/drivers/net/wireless/b43/pio.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/pio.c	2009-10-09 19:50:15.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/pio.c	2009-10-09 20:15:41.000000000 +0200
@@ -341,12 +341,15 @@ static u16 tx_write_2byte_queue(struct b
 			q->mmio_base + B43_PIO_TXDATA,
 			sizeof(u16));
 	if (data_len & 1) {
+		u8 *tail = wl->pio_tailspace;
+		BUILD_BUG_ON(sizeof(wl->pio_tailspace) < 2);
+
 		/* Write the last byte. */
 		ctl &= ~B43_PIO_TXCTL_WRITEHI;
 		b43_piotx_write16(q, B43_PIO_TXCTL, ctl);
-		wl->tx_tail[0] = data[data_len - 1];
-		wl->tx_tail[1] = 0;
-		ssb_block_write(dev->dev, wl->tx_tail, 2,
+		tail[0] = data[data_len - 1];
+		tail[1] = 0;
+		ssb_block_write(dev->dev, tail, 2,
 				q->mmio_base + B43_PIO_TXDATA,
 				sizeof(u16));
 	}
@@ -392,27 +395,27 @@ static u32 tx_write_4byte_queue(struct b
 			q->mmio_base + B43_PIO8_TXDATA,
 			sizeof(u32));
 	if (data_len & 3) {
-		wl->tx_tail[3] = 0;
+		u8 *tail = wl->pio_tailspace;
+		BUILD_BUG_ON(sizeof(wl->pio_tailspace) < 4);
+
+		memset(tail, 0, 4);
 		/* Write the last few bytes. */
 		ctl &= ~(B43_PIO8_TXCTL_8_15 | B43_PIO8_TXCTL_16_23 |
 			 B43_PIO8_TXCTL_24_31);
 		switch (data_len & 3) {
 		case 3:
 			ctl |= B43_PIO8_TXCTL_16_23 | B43_PIO8_TXCTL_8_15;
-			wl->tx_tail[0] = data[data_len - 3];
-			wl->tx_tail[1] = data[data_len - 2];
-			wl->tx_tail[2] = data[data_len - 1];
+			tail[0] = data[data_len - 3];
+			tail[1] = data[data_len - 2];
+			tail[2] = data[data_len - 1];
 			break;
 		case 2:
 			ctl |= B43_PIO8_TXCTL_8_15;
-			wl->tx_tail[0] = data[data_len - 2];
-			wl->tx_tail[1] = data[data_len - 1];
-			wl->tx_tail[2] = 0;
+			tail[0] = data[data_len - 2];
+			tail[1] = data[data_len - 1];
 			break;
 		case 1:
-			wl->tx_tail[0] = data[data_len - 1];
-			wl->tx_tail[1] = 0;
-			wl->tx_tail[2] = 0;
+			tail[0] = data[data_len - 1];
 			break;
 		}
 		b43_piotx_write32(q, B43_PIO8_TXCTL, ctl);
@@ -455,6 +458,7 @@ static int pio_tx_frame(struct b43_pio_t
 	int err;
 	unsigned int hdrlen;
 	struct ieee80211_tx_info *info = IEEE80211_SKB_CB(skb);
+	struct b43_txhdr *txhdr = (struct b43_txhdr *)wl->pio_scratchspace;
 
 	B43_WARN_ON(list_empty(&q->packets_list));
 	pack = list_entry(q->packets_list.next,
@@ -462,7 +466,9 @@ static int pio_tx_frame(struct b43_pio_t
 
 	cookie = generate_cookie(q, pack);
 	hdrlen = b43_txhdr_size(dev);
-	err = b43_generate_txhdr(dev, (u8 *)&wl->txhdr, skb,
+	BUILD_BUG_ON(sizeof(wl->pio_scratchspace) < sizeof(struct b43_txhdr));
+	B43_WARN_ON(sizeof(wl->pio_scratchspace) < hdrlen);
+	err = b43_generate_txhdr(dev, (u8 *)txhdr, skb,
 				 info, cookie);
 	if (err)
 		return err;
@@ -476,9 +482,9 @@ static int pio_tx_frame(struct b43_pio_t
 
 	pack->skb = skb;
 	if (q->rev >= 8)
-		pio_tx_frame_4byte_queue(pack, (const u8 *)&wl->txhdr, hdrlen);
+		pio_tx_frame_4byte_queue(pack, (const u8 *)txhdr, hdrlen);
 	else
-		pio_tx_frame_2byte_queue(pack, (const u8 *)&wl->txhdr, hdrlen);
+		pio_tx_frame_2byte_queue(pack, (const u8 *)txhdr, hdrlen);
 
 	/* Remove it from the list of available packet slots.
 	 * It will be put back when we receive the status report. */
@@ -624,8 +630,10 @@ static bool pio_rx_frame(struct b43_pio_
 	unsigned int i, padding;
 	struct sk_buff *skb;
 	const char *err_msg = NULL;
+	struct b43_rxhdr *rxhdr = (struct b43_rxhdr *)wl->pio_scratchspace;
 
-	memset(&wl->rxhdr, 0, sizeof(wl->rxhdr));
+	BUILD_BUG_ON(sizeof(wl->pio_scratchspace) < sizeof(*rxhdr));
+	memset(rxhdr, 0, sizeof(*rxhdr));
 
 	/* Check if we have data and wait for it to get ready. */
 	if (q->rev >= 8) {
@@ -663,16 +671,16 @@ data_ready:
 
 	/* Get the preamble (RX header) */
 	if (q->rev >= 8) {
-		ssb_block_read(dev->dev, &wl->rxhdr, sizeof(wl->rxhdr),
+		ssb_block_read(dev->dev, rxhdr, sizeof(*rxhdr),
 			       q->mmio_base + B43_PIO8_RXDATA,
 			       sizeof(u32));
 	} else {
-		ssb_block_read(dev->dev, &wl->rxhdr, sizeof(wl->rxhdr),
+		ssb_block_read(dev->dev, rxhdr, sizeof(*rxhdr),
 			       q->mmio_base + B43_PIO_RXDATA,
 			       sizeof(u16));
 	}
 	/* Sanity checks. */
-	len = le16_to_cpu(wl->rxhdr.frame_len);
+	len = le16_to_cpu(rxhdr->frame_len);
 	if (unlikely(len > 0x700)) {
 		err_msg = "len > 0x700";
 		goto rx_error;
@@ -682,7 +690,7 @@ data_ready:
 		goto rx_error;
 	}
 
-	macstat = le32_to_cpu(wl->rxhdr.mac_status);
+	macstat = le32_to_cpu(rxhdr->mac_status);
 	if (macstat & B43_RX_MAC_FCSERR) {
 		if (!(q->dev->wl->filter_flags & FIF_FCSFAIL)) {
 			/* Drop frames with failed FCS. */
@@ -707,22 +715,25 @@ data_ready:
 			       q->mmio_base + B43_PIO8_RXDATA,
 			       sizeof(u32));
 		if (len & 3) {
+			u8 *tail = wl->pio_tailspace;
+			BUILD_BUG_ON(sizeof(wl->pio_tailspace) < 4);
+
 			/* Read the last few bytes. */
-			ssb_block_read(dev->dev, wl->rx_tail, 4,
+			ssb_block_read(dev->dev, tail, 4,
 				       q->mmio_base + B43_PIO8_RXDATA,
 				       sizeof(u32));
 			switch (len & 3) {
 			case 3:
-				skb->data[len + padding - 3] = wl->rx_tail[0];
-				skb->data[len + padding - 2] = wl->rx_tail[1];
-				skb->data[len + padding - 1] = wl->rx_tail[2];
+				skb->data[len + padding - 3] = tail[0];
+				skb->data[len + padding - 2] = tail[1];
+				skb->data[len + padding - 1] = tail[2];
 				break;
 			case 2:
-				skb->data[len + padding - 2] = wl->rx_tail[0];
-				skb->data[len + padding - 1] = wl->rx_tail[1];
+				skb->data[len + padding - 2] = tail[0];
+				skb->data[len + padding - 1] = tail[1];
 				break;
 			case 1:
-				skb->data[len + padding - 1] = wl->rx_tail[0];
+				skb->data[len + padding - 1] = tail[0];
 				break;
 			}
 		}
@@ -731,15 +742,18 @@ data_ready:
 			       q->mmio_base + B43_PIO_RXDATA,
 			       sizeof(u16));
 		if (len & 1) {
+			u8 *tail = wl->pio_tailspace;
+			BUILD_BUG_ON(sizeof(wl->pio_tailspace) < 2);
+
 			/* Read the last byte. */
-			ssb_block_read(dev->dev, wl->rx_tail, 2,
+			ssb_block_read(dev->dev, tail, 2,
 				       q->mmio_base + B43_PIO_RXDATA,
 				       sizeof(u16));
-			skb->data[len + padding - 1] = wl->rx_tail[0];
+			skb->data[len + padding - 1] = tail[0];
 		}
 	}
 
-	b43_rx(q->dev, skb, &wl->rxhdr);
+	b43_rx(q->dev, skb, rxhdr);
 
 	return 1;
 
Index: wireless-testing/drivers/net/wireless/b43/xmit.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/xmit.c	2009-10-09 19:50:15.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/xmit.c	2009-10-09 20:15:41.000000000 +0200
@@ -27,7 +27,7 @@
 
 */
 
-#include "b43.h"
+#include "xmit.h"
 #include "phy_common.h"
 #include "dma.h"
 #include "pio.h"

-- 
Greetings, Michael.


From mb at bu3sch.de  Fri Oct  9 20:48:16 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:48:16 +0200
Subject: [PATCH] b43: Remove me as maintainer
Message-ID: <200910092048.19182.mb@bu3sch.de>

Remove me

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

A properly signed-off patch version...


 MAINTAINERS |    1 -
 1 file changed, 1 deletion(-)

--- wireless-testing.orig/MAINTAINERS
+++ wireless-testing/MAINTAINERS
@@ -1066,7 +1066,6 @@ F:	include/net/ax25.h
 F:	net/ax25/
 
 B43 WIRELESS DRIVER
-M:	Michael Buesch <mb at bu3sch.de>
 M:	Stefano Brivio <stefano.brivio at polimi.it>
 L:	linux-wireless at vger.kernel.org
 W:	http://linuxwireless.org/en/users/Drivers/b43

-- 
Greetings, Michael.


From netrolller.3d at gmail.com  Fri Oct  9 22:46:39 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Fri, 9 Oct 2009 22:46:39 +0200
Subject: Broken patch for b43
In-Reply-To: <200910091822.05329.mb@bu3sch.de>
References: <4ACF539E.8070107@lwfinger.net>
	<69e28c910910090841n7557683djfce7fb7880cdd1bf@mail.gmail.com> 
	<4ACF6210.5060801@lwfinger.net> <200910091822.05329.mb@bu3sch.de>
Message-ID: <69e28c910910091346q11f4793dq3e4189f1227e614a@mail.gmail.com>

On Fri, Oct 9, 2009 at 6:22 PM, Michael Buesch <mb at bu3sch.de> wrote:
> On Friday 09 October 2009 18:17:20 Larry Finger wrote:
>> On 10/09/2009 10:41 AM, G?bor Stefanik wrote:
>> > G-PHY revision <=2 is handled by b43legacy, not b43, so it shouldn't
>> > be a problem.
>
> That is not true.
>
> --
> Greetings, Michael.
>

Oops... yes, I confused the PHY vs. MAC revisions.

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Fri Oct  9 20:05:58 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:05:58 +0200
Subject: b43: do not stack-allocate pio rx/tx header and tail buffers
	(was: pull request: wireless-2.6 2009-10-08)
In-Reply-To: <4ACF76F7.30406@yahoo.es>
References: <200910062252.17565.mb@bu3sch.de> <4ACCD765.7080604@lwfinger.net>
	<4ACF76F7.30406@yahoo.es>
Message-ID: <200910092005.59916.mb@bu3sch.de>

On Friday 09 October 2009 19:46:31 Albert Herranz wrote:
> I'm not arguing if the patch should have been immediately merged upstream or not without your ack (I'm probably more on your side here, as the patch was still being discussed on the ML).
> The patch [1] may not be up to your quality standards or may not take into account other requirements (that you have not expressed nor on the ML nor on IRC) but I'm sure it's far from being "random", "move crap" or "add stupid comments". That's the unfair part.
> 
> The reason I posted the initial patch for review was because you kind of told me [2].
> 
> [20:06] <mb_> Anyway, I'm not going to fix this. If you need it fixed, please send patches

Yeah, but that doesn't mean that either hack is acceptable. It just means that my time is limited
and I added this non-issue (which I still think it is) to the very bottom of my priority list.

> After ~22 hours if I'm not mistaken (yes, less than 24...) John, who had previously expressed his intentions to merge the patch [5], picked it for wireless-2.6.
> And a day later, more or less again, John did the GIT PULL request.

My impression was, that if the maintainer rejects a patch and asks for a new version,
the upstream maintainer must not take the patch until the maintainer acked the new version.
It seems I was wrong, though.

> My point here is that there's no reason for such strong words concerning the quality of the patch code. It's really not that bad for such wording.
> I'm sure that if the patch was really crap it would have been immediately NAK'ed by you or by any sane maintainer.

It _was_ immediately NAK'ed by me. I did not know that I need to NAK
every single new version of a patch explicitely.
I thought NAK-ing a patch would put it into some special state that only an explicit ACK could
take it out of.

-- 
Greetings, Michael.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo at vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/




From mb at bu3sch.de  Fri Oct  9 20:05:58 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 9 Oct 2009 20:05:58 +0200
Subject: b43: do not stack-allocate pio rx/tx header and tail buffers
	(was: pull request: wireless-2.6 2009-10-08)
In-Reply-To: <4ACF76F7.30406@yahoo.es>
References: <200910062252.17565.mb@bu3sch.de> <4ACCD765.7080604@lwfinger.net>
	<4ACF76F7.30406@yahoo.es>
Message-ID: <200910092005.59916.mb@bu3sch.de>

On Friday 09 October 2009 19:46:31 Albert Herranz wrote:
> I'm not arguing if the patch should have been immediately merged upstream or not without your ack (I'm probably more on your side here, as the patch was still being discussed on the ML).
> The patch [1] may not be up to your quality standards or may not take into account other requirements (that you have not expressed nor on the ML nor on IRC) but I'm sure it's far from being "random", "move crap" or "add stupid comments". That's the unfair part.
> 
> The reason I posted the initial patch for review was because you kind of told me [2].
> 
> [20:06] <mb_> Anyway, I'm not going to fix this. If you need it fixed, please send patches

Yeah, but that doesn't mean that either hack is acceptable. It just means that my time is limited
and I added this non-issue (which I still think it is) to the very bottom of my priority list.

> After ~22 hours if I'm not mistaken (yes, less than 24...) John, who had previously expressed his intentions to merge the patch [5], picked it for wireless-2.6.
> And a day later, more or less again, John did the GIT PULL request.

My impression was, that if the maintainer rejects a patch and asks for a new version,
the upstream maintainer must not take the patch until the maintainer acked the new version.
It seems I was wrong, though.

> My point here is that there's no reason for such strong words concerning the quality of the patch code. It's really not that bad for such wording.
> I'm sure that if the patch was really crap it would have been immediately NAK'ed by you or by any sane maintainer.

It _was_ immediately NAK'ed by me. I did not know that I need to NAK
every single new version of a patch explicitely.
I thought NAK-ing a patch would put it into some special state that only an explicit ACK could
take it out of.

-- 
Greetings, Michael.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo at vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/




From hidave.darkstar at gmail.com  Sun Oct 11 11:41:40 2009
From: hidave.darkstar at gmail.com (Dave Young)
Date: Sun, 11 Oct 2009 17:41:40 +0800
Subject: [mmotm 2009-10-09-01-07] b43/wireless possible circular locking
Message-ID: <20091011094139.GA2778@darkstar>

Hi,

I got lockdep warnings about possible circular lock with
b43 interface startup. It looks like a real problem.

[   71.974542] wlan0: deauthenticating from 00:19:e0:db:24:de by local choice (reason=3)
[   72.004352] b43-phy0 debug: Removing Interface type 2
[   72.005431] 
[   72.005435] =======================================================
[   72.006168] [ INFO: possible circular locking dependency detected ]
[   72.006759] 2.6.32-rc3-mm1 #4
[   72.007047] -------------------------------------------------------
[   72.007617] ifconfig/2175 is trying to acquire lock:
[   72.007617]  (&(&rfkill->poll_work)->work){+.+...}, at: [<c0239375>] __cancel_work_timer+0x8c/0x18e
[   72.007617] 
[   72.007617] but task is already holding lock:
[   72.007617]  (&wl->mutex){+.+.+.}, at: [<f8fa5359>] b43_op_stop+0x28/0x6a [b43]
[   72.007617] 
[   72.007617] which lock already depends on the new lock.
[   72.007617] 
[   72.007617] 
[   72.007617] the existing dependency chain (in reverse order) is:
[   72.007617] 
[   72.007617] -> #1 (&wl->mutex){+.+.+.}:
[   72.007617]        [<c024b251>] __lock_acquire+0x9e2/0xb73
[   72.007617]        [<c024b449>] lock_acquire+0x67/0x84
[   72.007617]        [<c055854d>] __mutex_lock_common+0x35/0x2ca
[   72.007617]        [<c0558880>] mutex_lock_nested+0x30/0x38
[   72.007617]        [<f8fb9bcd>] b43_rfkill_poll+0x26/0xc9 [b43]
[   72.007617]        [<f8f8330e>] ieee80211_rfkill_poll+0x1f/0x21 [mac80211]
[   72.007617]        [<f8396011>] cfg80211_rfkill_poll+0x11/0x13 [cfg80211]
[   72.007617]        [<f826b740>] rfkill_poll+0x14/0x2a [rfkill]
[   72.007617]        [<c0239927>] worker_thread+0x13b/0x1ff
[   72.007617]        [<c023be0c>] kthread+0x58/0x5d
[   72.007617]        [<c0203d07>] kernel_thread_helper+0x7/0x10
[   72.007617] 
[   72.007617] -> #0 (&(&rfkill->poll_work)->work){+.+...}:
[   72.007617]        [<c024b15c>] __lock_acquire+0x8ed/0xb73
[   72.007617]        [<c024b449>] lock_acquire+0x67/0x84
[   72.007617]        [<c02393a2>] __cancel_work_timer+0xb9/0x18e
[   72.007617]        [<c0239482>] cancel_delayed_work_sync+0xb/0xd
[   72.007617]        [<f826b71b>] rfkill_pause_polling+0x20/0x22 [rfkill]
[   72.007617]        [<f8396328>] wiphy_rfkill_stop_polling+0x10/0x12 [cfg80211]
[   72.007617]        [<f8fa5361>] b43_op_stop+0x30/0x6a [b43]
[   72.007617]        [<f8f895af>] ieee80211_stop_device+0x20/0x53 [mac80211]
[   72.007617]        [<f8f8141d>] ieee80211_stop+0x3d3/0x452 [mac80211]
[   72.007617]        [<c04e0c47>] dev_close+0x74/0x90
[   72.007617]        [<c04e082c>] dev_change_flags+0x96/0x144
[   72.007617]        [<c05262fd>] devinet_ioctl+0x212/0x468
[   72.007617]        [<c052814d>] inet_ioctl+0x8e/0xa7
[   72.007617]        [<c04d3e16>] sock_ioctl+0x1d3/0x1f7
[   72.007617]        [<c02a6b49>] vfs_ioctl+0x22/0x67
[   72.007617]        [<c02a707d>] do_vfs_ioctl+0x45f/0x493
[   72.007617]        [<c02a70f1>] sys_ioctl+0x40/0x5a
[   72.007617]        [<c020325d>] syscall_call+0x7/0xb
[   72.007617] 
[   72.007617] other info that might help us debug this:
[   72.007617] 
[   72.007617] 2 locks held by ifconfig/2175:
[   72.007617]  #0:  (rtnl_mutex){+.+.+.}, at: [<c04e8b90>] rtnl_lock+0xf/0x11
[   72.007617]  #1:  (&wl->mutex){+.+.+.}, at: [<f8fa5359>] b43_op_stop+0x28/0x6a [b43]
[   72.007617] 
[   72.007617] stack backtrace:
[   72.007617] Pid: 2175, comm: ifconfig Not tainted 2.6.32-rc3-mm1 #4
[   72.007617] Call Trace:
[   72.007617]  [<c024a863>] print_circular_bug+0x8a/0x96
[   72.007617]  [<c024b15c>] __lock_acquire+0x8ed/0xb73
[   72.007617]  [<c024b449>] lock_acquire+0x67/0x84
[   72.007617]  [<c0239375>] ? __cancel_work_timer+0x8c/0x18e
[   72.007617]  [<c02393a2>] __cancel_work_timer+0xb9/0x18e
[   72.007617]  [<c0239375>] ? __cancel_work_timer+0x8c/0x18e
[   72.007617]  [<c05587c8>] ? __mutex_lock_common+0x2b0/0x2ca
[   72.007617]  [<c0248233>] ? debug_mutex_free_waiter+0x45/0x48
[   72.007617]  [<c05587d8>] ? __mutex_lock_common+0x2c0/0x2ca
[   72.007617]  [<c0239482>] cancel_delayed_work_sync+0xb/0xd
[   72.007617]  [<f826b71b>] rfkill_pause_polling+0x20/0x22 [rfkill]
[   72.007617]  [<f8396328>] wiphy_rfkill_stop_polling+0x10/0x12 [cfg80211]
[   72.007617]  [<f8fa5361>] b43_op_stop+0x30/0x6a [b43]
[   72.007617]  [<f8f895af>] ieee80211_stop_device+0x20/0x53 [mac80211]
[   72.007617]  [<f8f8141d>] ieee80211_stop+0x3d3/0x452 [mac80211]
[   72.007617]  [<c0249d42>] ? trace_hardirqs_on+0xb/0xd
[   72.007617]  [<c022fd77>] ? _local_bh_enable_ip+0x9d/0xa6
[   72.007617]  [<c022fd88>] ? local_bh_enable_ip+0x8/0xa
[   72.007617]  [<c05592a8>] ? _spin_unlock_bh+0x25/0x28
[   72.007617]  [<c04e0c47>] dev_close+0x74/0x90
[   72.007617]  [<c04e082c>] dev_change_flags+0x96/0x144
[   72.007617]  [<c05262fd>] devinet_ioctl+0x212/0x468
[   72.007617]  [<c052814d>] inet_ioctl+0x8e/0xa7
[   72.007617]  [<c04d3e16>] sock_ioctl+0x1d3/0x1f7
[   72.007617]  [<c04d3c43>] ? sock_ioctl+0x0/0x1f7
[   72.007617]  [<c02a6b49>] vfs_ioctl+0x22/0x67
[   72.007617]  [<c02a707d>] do_vfs_ioctl+0x45f/0x493
[   72.007617]  [<c0221652>] ? need_resched+0x14/0x1e
[   72.007617]  [<c0557e29>] ? schedule+0x6ed/0x6fd
[   72.007617]  [<c055b24e>] ? do_page_fault+0x29d/0x2a5
[   72.007617]  [<c02a70f1>] sys_ioctl+0x40/0x5a
[   72.007617]  [<c020325d>] syscall_call+0x7/0xb
[   73.122930] b43-phy0 debug: Wireless interface stopped
[   73.131557] ifconfig used greatest stack depth: 5660 bytes left
[   73.310494] b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
[   73.329042] b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
[   77.923855] b43-phy0 debug: Chip initialized
[   77.924695] b43-phy0 debug: PIO initialized
[   77.925410] b43-phy0 debug: QoS enabled
[   77.941415] b43-phy0 debug: Wireless interface started
[   77.942164] b43-phy0 debug: Adding Interface type 2
[   77.961969] wlan0: direct probe to AP 00:19:e0:db:24:de (try 1)
[   78.160198] wlan0: direct probe to AP 00:19:e0:db:24:de (try 2)
[   78.164241] wlan0: direct probe responded
[   78.164649] wlan0: authenticate with AP 00:19:e0:db:24:de (try 1)
[   78.167341] wlan0: authenticated
[   78.167791] wlan0: associate with AP 00:19:e0:db:24:de (try 1)
[   78.170935] wlan0: RX ReassocResp from 00:19:e0:db:24:de (capab=0x421 status=0 aid=4)
[   78.171690] wlan0: associated

--
Regards
dave


From johannes at sipsolutions.net  Sun Oct 11 11:51:27 2009
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sun, 11 Oct 2009 11:51:27 +0200
Subject: [mmotm 2009-10-09-01-07] b43/wireless possible circular locking
In-Reply-To: <20091011094139.GA2778@darkstar>
References: <20091011094139.GA2778@darkstar>
Message-ID: <1255254687.4095.46.camel@johannes.local>

On Sun, 2009-10-11 at 17:41 +0800, Dave Young wrote:
> Hi,
> 
> I got lockdep warnings about possible circular lock with
> b43 interface startup. It looks like a real problem.
> 
> [   71.974542] wlan0: deauthenticating from 00:19:e0:db:24:de by local choice (reason=3)
> [   72.004352] b43-phy0 debug: Removing Interface type 2
> [   72.005431] 
> [   72.005435] =======================================================
> [   72.006168] [ INFO: possible circular locking dependency detected ]
> [   72.006759] 2.6.32-rc3-mm1 #4
> [   72.007047] -------------------------------------------------------
> [   72.007617] ifconfig/2175 is trying to acquire lock:
> [   72.007617]  (&(&rfkill->poll_work)->work){+.+...}, at: [<c0239375>] __cancel_work_timer+0x8c/0x18e
> [   72.007617] 
> [   72.007617] but task is already holding lock:
> [   72.007617]  (&wl->mutex){+.+.+.}, at: [<f8fa5359>] b43_op_stop+0x28/0x6a [b43]

I believe this is already taken care of by Larry.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091011/9f9d5e5b/attachment.pgp>

From Larry.Finger at lwfinger.net  Sun Oct 11 16:23:33 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 11 Oct 2009 09:23:33 -0500
Subject: [mmotm 2009-10-09-01-07] b43/wireless possible circular locking
In-Reply-To: <1255254687.4095.46.camel@johannes.local>
References: <20091011094139.GA2778@darkstar>
	<1255254687.4095.46.camel@johannes.local>
Message-ID: <4AD1EA65.3070805@lwfinger.net>

On 10/11/2009 04:51 AM, Johannes Berg wrote:
> On Sun, 2009-10-11 at 17:41 +0800, Dave Young wrote:
>> Hi,
>>
>> I got lockdep warnings about possible circular lock with
>> b43 interface startup. It looks like a real problem.
>>
>> [   71.974542] wlan0: deauthenticating from 00:19:e0:db:24:de by local choice (reason=3)
>> [   72.004352] b43-phy0 debug: Removing Interface type 2
>> [   72.005431] 
>> [   72.005435] =======================================================
>> [   72.006168] [ INFO: possible circular locking dependency detected ]
>> [   72.006759] 2.6.32-rc3-mm1 #4
>> [   72.007047] -------------------------------------------------------
>> [   72.007617] ifconfig/2175 is trying to acquire lock:
>> [   72.007617]  (&(&rfkill->poll_work)->work){+.+...}, at: [<c0239375>] __cancel_work_timer+0x8c/0x18e
>> [   72.007617] 
>> [   72.007617] but task is already holding lock:
>> [   72.007617]  (&wl->mutex){+.+.+.}, at: [<f8fa5359>] b43_op_stop+0x28/0x6a [b43]
> 
> I believe this is already taken care of by Larry.

Yes, I introduced this bug and fixed it. The latest wireless-testing
should have the fix. In addition, it is on its way to Linus through
DameM. Unfortunately, that fix has another bug that will not show up
in the logs. With it, it is impossible to turn the radio back on after
it is killed via the rfkill switch. A "final" (And I hope that is
true!) fix is out for testing; however, the OP for the bug that
started this whole chain only has limited access to the machine in
question.

Larry


From celejar at gmail.com  Tue Oct 13 16:17:24 2009
From: celejar at gmail.com (Celejar)
Date: Tue, 13 Oct 2009 10:17:24 -0400
Subject: kernel oops with 2.6.32-rc2
In-Reply-To: <14b026160910090144p448ac0bdt8cb017adb985cb30@mail.gmail.com>
References: <20091008185857.997d5cdd.celejar@gmail.com>
	<14b026160910090144p448ac0bdt8cb017adb985cb30@mail.gmail.com>
Message-ID: <20091013101724.28629142.celejar@gmail.com>

On Fri, 9 Oct 2009 10:44:50 +0200
Rafa? Mi?ecki <zajec5polish at gmail.com> wrote:

> 2009/10/9 Celejar <celejar at gmail.com>:
> > Oct ?8 18:46:17 localhost kernel: [24031.297304] BUG: unable to
> > handle kernel paging request at 2f40666a Oct ?8 18:46:17 localhost
> > kernel: [24031.297312] IP: [<f8b1e5a3>] b43_leds_unregister
> > +0x13/0xa0 [b43]
> 
> Already noticed and fixed:
> https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006129.html
> 
> Michael didn't specify in mail for which kernel is that patch, but I
> believe it'll hit 2.6.32-rc4

I'm still seeing the oops in -rc4, so I assume that it hasn't hit yet?

Celejar
-- 
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Tue Oct 13 16:49:25 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 13 Oct 2009 09:49:25 -0500
Subject: kernel oops with 2.6.32-rc2
In-Reply-To: <20091013101724.28629142.celejar@gmail.com>
References: <20091008185857.997d5cdd.celejar@gmail.com>	<14b026160910090144p448ac0bdt8cb017adb985cb30@mail.gmail.com>
	<20091013101724.28629142.celejar@gmail.com>
Message-ID: <4AD49375.6090002@lwfinger.net>

On 10/13/2009 09:17 AM, Celejar wrote:
> On Fri, 9 Oct 2009 10:44:50 +0200
> Rafa? Mi?ecki <zajec5polish at gmail.com> wrote:
>> Already noticed and fixed:
>> https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006129.html
>>
>> Michael didn't specify in mail for which kernel is that patch, but I
>> believe it'll hit 2.6.32-rc4
> 
> I'm still seeing the oops in -rc4, so I assume that it hasn't hit yet?

It has not yet gotten to Linus's tree.

Larry


From Larry.Finger at lwfinger.net  Wed Oct 14 03:25:30 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 13 Oct 2009 20:25:30 -0500
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new
 problem 
Message-ID: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>

Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
however, it introduced a new bug. Whenever the radio switch was turned off,
it was necessary to unload and reload the driver for it to recognize the
switch again.

I believe this patch fixes the original problem without introducing any new
problems.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

This is 2.6.32 material to fix the mess I made earlier.

Larry
---

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4501,7 +4501,6 @@ static void b43_op_stop(struct ieee80211
 
 	cancel_work_sync(&(wl->beacon_update_trigger));
 
-	wiphy_rfkill_stop_polling(hw->wiphy);
 	mutex_lock(&wl->mutex);
 	if (b43_status(dev) >= B43_STAT_STARTED) {
 		dev = b43_wireless_core_stop(dev);
Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -33,7 +33,8 @@ bool b43_is_hw_radio_enabled(struct b43_
 		      & B43_MMIO_RADIO_HWENABLED_HI_MASK))
 			return 1;
 	} else {
-		if (b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
+		if (b43_status(dev) >= B43_STAT_STARTED &&
+		    b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
 		    & B43_MMIO_RADIO_HWENABLED_LO_MASK)
 			return 1;
 	}


From mb at bu3sch.de  Wed Oct 14 10:06:19 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 14 Oct 2009 10:06:19 +0200
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
Message-ID: <200910141006.21854.mb@bu3sch.de>

On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
> however, it introduced a new bug. Whenever the radio switch was turned off,
> it was necessary to unload and reload the driver for it to recognize the
> switch again.
> 
> I believe this patch fixes the original problem without introducing any new
> problems.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---
> 
> John,
> 
> This is 2.6.32 material to fix the mess I made earlier.
> 
> Larry
> ---
> 
> Index: wireless-testing/drivers/net/wireless/b43/main.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/main.c
> +++ wireless-testing/drivers/net/wireless/b43/main.c
> @@ -4501,7 +4501,6 @@ static void b43_op_stop(struct ieee80211
>  
>  	cancel_work_sync(&(wl->beacon_update_trigger));
>  
> -	wiphy_rfkill_stop_polling(hw->wiphy);
>  	mutex_lock(&wl->mutex);
>  	if (b43_status(dev) >= B43_STAT_STARTED) {
>  		dev = b43_wireless_core_stop(dev);
> Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
> +++ wireless-testing/drivers/net/wireless/b43/rfkill.c
> @@ -33,7 +33,8 @@ bool b43_is_hw_radio_enabled(struct b43_
>  		      & B43_MMIO_RADIO_HWENABLED_HI_MASK))
>  			return 1;
>  	} else {
> -		if (b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
> +		if (b43_status(dev) >= B43_STAT_STARTED &&
> +		    b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
>  		    & B43_MMIO_RADIO_HWENABLED_LO_MASK)
>  			return 1;
>  	}

I'm still wondering, however, why you only need that check in the else branch.
I guess the newer devices which use the other branch just fail silently.

I don't think this fix is correct at all.
The only way we can have status<STARTED here is through the rfkill_poll
function being called before the device is initialized. So it will enable
the ssb device and try to fetch the rfkill register. _However_, with this check
added it will _always_ return False. So why do we do the polling anyway, if it's
always guaranteed to be false? I think that's buggy.
To get the same effect, we could just do that:

 44 void b43_rfkill_poll(struct ieee80211_hw *hw)
 45 {
 46         struct b43_wl *wl = hw_to_b43_wl(hw);
 47         struct b43_wldev *dev = wl->current_dev;
 48         struct ssb_bus *bus = dev->dev->bus;
 49         bool enabled;
 50         bool brought_up = false;
 51 
 52         mutex_lock(&wl->mutex);
 53         if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {

wiphy_rfkill_set_hw_state(false);
unlock;
return;
// Remove the powerup logic...

 54                 if (ssb_bus_powerup(bus, 0)) {
 55                         mutex_unlock(&wl->mutex);
 56                         return;
 57                 }
 58                 ssb_device_enable(dev->dev, 0);
 59                 brought_up = true;
 60         }


And no, it's not correct to force device state to STARTED or something else here, because
that won't fix the issue and introduce other bugs.

-- 
Greetings, Michael.


From Larry.Finger at lwfinger.net  Wed Oct 14 17:04:15 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 14 Oct 2009 10:04:15 -0500
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <200910141006.21854.mb@bu3sch.de>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<200910141006.21854.mb@bu3sch.de>
Message-ID: <4AD5E86F.1080702@lwfinger.net>

On 10/14/2009 03:06 AM, Michael Buesch wrote:
> On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
>> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
>> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
>> however, it introduced a new bug. Whenever the radio switch was turned off,
>> it was necessary to unload and reload the driver for it to recognize the
>> switch again.
>>
>> I believe this patch fixes the original problem without introducing any new
>> problems.
>>
>> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
>> ---
>>
>> John,
>>
>> This is 2.6.32 material to fix the mess I made earlier.
>>
>> Larry
>> ---
>>
>> Index: wireless-testing/drivers/net/wireless/b43/main.c
>> ===================================================================
>> --- wireless-testing.orig/drivers/net/wireless/b43/main.c
>> +++ wireless-testing/drivers/net/wireless/b43/main.c
>> @@ -4501,7 +4501,6 @@ static void b43_op_stop(struct ieee80211
>>  
>>  	cancel_work_sync(&(wl->beacon_update_trigger));
>>  
>> -	wiphy_rfkill_stop_polling(hw->wiphy);
>>  	mutex_lock(&wl->mutex);
>>  	if (b43_status(dev) >= B43_STAT_STARTED) {
>>  		dev = b43_wireless_core_stop(dev);
>> Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
>> ===================================================================
>> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
>> +++ wireless-testing/drivers/net/wireless/b43/rfkill.c
>> @@ -33,7 +33,8 @@ bool b43_is_hw_radio_enabled(struct b43_
>>  		      & B43_MMIO_RADIO_HWENABLED_HI_MASK))
>>  			return 1;
>>  	} else {
>> -		if (b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
>> +		if (b43_status(dev) >= B43_STAT_STARTED &&
>> +		    b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)
>>  		    & B43_MMIO_RADIO_HWENABLED_LO_MASK)
>>  			return 1;
>>  	}
> 
> I'm still wondering, however, why you only need that check in the else branch.
> I guess the newer devices which use the other branch just fail silently.

No, the logic in b43_rfkill_poll gets the device into a state that it
works for newer hardware. There is something about the PPC G4 (at
least) that is not in a state where the B43_MMIO_RADIO_HWENABLED_LO
register can be read and the processor faults. I do not have access to
PPC hardware, thus I proposed the above fix as one that would avoid
the fault on PPC, yet not hurt my hardware.

> I don't think this fix is correct at all.
> The only way we can have status<STARTED here is through the rfkill_poll
> function being called before the device is initialized. So it will enable
> the ssb device and try to fetch the rfkill register. _However_, with this check
> added it will _always_ return False. So why do we do the polling anyway, if it's
> always guaranteed to be false? I think that's buggy.
> To get the same effect, we could just do that:
> 
>  44 void b43_rfkill_poll(struct ieee80211_hw *hw)
>  45 {
>  46         struct b43_wl *wl = hw_to_b43_wl(hw);
>  47         struct b43_wldev *dev = wl->current_dev;
>  48         struct ssb_bus *bus = dev->dev->bus;
>  49         bool enabled;
>  50         bool brought_up = false;
>  51 
>  52         mutex_lock(&wl->mutex);
>  53         if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {
> 
> wiphy_rfkill_set_hw_state(false);
> unlock;
> return;
> // Remove the powerup logic...
> 
>  54                 if (ssb_bus_powerup(bus, 0)) {
>  55                         mutex_unlock(&wl->mutex);
>  56                         return;
>  57                 }
>  58                 ssb_device_enable(dev->dev, 0);
>  59                 brought_up = true;
>  60         }
> 
> 
> And no, it's not correct to force device state to STARTED or something else here, because
> that won't fix the issue and introduce other bugs.

This code would probably fix the PPC fault, but it would fail for
everything else. Once b43 reports that the RF switch is off, then
mac80211 calls to b43_op_stop, which in turn calls b43_wireless_stop,
and it sets the state to B43_STAT_INITIALIZED. Your proposed code
would have the same failure as my previous patch to stop polling in
b43_op_stop - there would be no way to detect that the switch was back on.

If there is a way to detect that an MMIO read will fail on PPC
architecture, then that is what we need. I do not have a clue on what
that might be.

I'm not sure that any devices that use b43 and have a PHY revision < 3
actually have a radio kill switch. The case in bug 14181 does not.
Would you prefer a patch that assumes that none do, and doesn't start
polling unless phy.rev >= 3? Then we could kill the test in
b43_is_hw_radio_enabled. The routine could even be inlined.

Larry


From mb at bu3sch.de  Wed Oct 14 22:46:17 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 14 Oct 2009 22:46:17 +0200
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <4AD5E86F.1080702@lwfinger.net>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<200910141006.21854.mb@bu3sch.de> <4AD5E86F.1080702@lwfinger.net>
Message-ID: <200910142246.19352.mb@bu3sch.de>

On Wednesday 14 October 2009 17:04:15 Larry Finger wrote:
> No, the logic in b43_rfkill_poll gets the device into a state that it
> works for newer hardware. There is something about the PPC G4 (at
> least) that is not in a state where the B43_MMIO_RADIO_HWENABLED_LO
> register can be read and the processor faults. I do not have access to
> PPC hardware, thus I proposed the above fix as one that would avoid
> the fault on PPC, yet not hurt my hardware.
> 
> > I don't think this fix is correct at all.
> > The only way we can have status<STARTED here is through the rfkill_poll
> > function being called before the device is initialized. So it will enable
> > the ssb device and try to fetch the rfkill register. _However_, with this check
> > added it will _always_ return False. So why do we do the polling anyway, if it's
> > always guaranteed to be false? I think that's buggy.
> > To get the same effect, we could just do that:
> > 
> >  44 void b43_rfkill_poll(struct ieee80211_hw *hw)
> >  45 {
> >  46         struct b43_wl *wl = hw_to_b43_wl(hw);
> >  47         struct b43_wldev *dev = wl->current_dev;
> >  48         struct ssb_bus *bus = dev->dev->bus;
> >  49         bool enabled;
> >  50         bool brought_up = false;
> >  51 
> >  52         mutex_lock(&wl->mutex);
> >  53         if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {
> > 
> > wiphy_rfkill_set_hw_state(false);
> > unlock;
> > return;
> > // Remove the powerup logic...
> > 
> >  54                 if (ssb_bus_powerup(bus, 0)) {
> >  55                         mutex_unlock(&wl->mutex);
> >  56                         return;
> >  57                 }
> >  58                 ssb_device_enable(dev->dev, 0);
> >  59                 brought_up = true;
> >  60         }
> > 
> > 
> > And no, it's not correct to force device state to STARTED or something else here, because
> > that won't fix the issue and introduce other bugs.
> 
> This code would probably fix the PPC fault, but it would fail for
> everything else. Once b43 reports that the RF switch is off, then
> mac80211 calls to b43_op_stop, which in turn calls b43_wireless_stop,
> and it sets the state to B43_STAT_INITIALIZED. Your proposed code
> would have the same failure as my previous patch to stop polling in
> b43_op_stop - there would be no way to detect that the switch was back on.

Well, so your patch trades one bug for another.

> If there is a way to detect that an MMIO read will fail on PPC
> architecture, then that is what we need. I do not have a clue on what
> that might be.

Ehm, no. You need to find out which part of initialization is missing to
get the MMIO access _not_ fault at all.
It does not fault, if the device is fully initialized, so you simply miss some
initialization. I don't know what's missing, however. I guess it probably
needs the PHY/Radio 4-wire bus initialized.

> I'm not sure that any devices that use b43 and have a PHY revision < 3
> actually have a radio kill switch. The case in bug 14181 does not.
> Would you prefer a patch that assumes that none do, and doesn't start
> polling unless phy.rev >= 3? Then we could kill the test in
> b43_is_hw_radio_enabled. The routine could even be inlined.

I don't have any preference, as I'm not the maintainer.
I just want to point out that the patch trades one bug for another. That
may be acceptable. I don't know. I have a PPC with a phyrev 2 card in it,
but I don't compile in RFKILL, as there's no switch. So I can't really test it
without an actual switch.

-- 
Greetings, Michael.


From chris at cvine.freeserve.co.uk  Fri Oct 16 14:03:29 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Fri, 16 Oct 2009 13:03:29 +0100
Subject: b43/BCM4312 fails with DMA errors
Message-ID: <20091016130329.3dd0b1a9@boulder.homenet>

Hi,

I have a Levono S-12 Netbook, which has the Atom N270 processor and a
Broadcom 14e4:4315 wireless chip with low power PHY.  lspci -vnn | grep
14e4 gives:

  02:00.0 Ethernet controller [0200]: Broadcom Corporation NetLink BCM5906M Fast Ethernet PCI Express [14e4:1713] (rev 02)
  03:00.0 Network controller [0280]: Broadcom Corporation BCM4312 802.11b/g [14e4:4315] (rev 01)
          Subsystem: Broadcom Corporation Unknown device [14e4:04b5]

As suggested for this chip on the linux wireless b43 howto web page, I
am using firmware extracted from broadcom-wl-4.178.10.4.tar.bz2 using
the current b43-fwcutter in git.

Although wireless works with the broadcom wl driver provided by
Broadcom in their hybrid-portsrc-x86_32-v5.10.91.9.3.tar.gz package up
to and including kernel 2.6.28 (but not afterwards, presumably because
of the replacement of ieee80211 by lib80211), the b43 driver in both
2.6.32-rc4 and current compat-wireless fails on a cold boot with dma
errors (I use "cold boot" advisedly - see the working case 1 for b43
mentioned at the end).

Prior to failure, modprobe b43 && dmesg | egrep "ssb|b43" gives:

  b43-pci-bridge 0000:03:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
  b43-pci-bridge 0000:03:00.0: setting latency timer to 64
  ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
  b43-phy0: Broadcom 4312 WLAN found (core revision 15)
  b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
  b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
  Registered led device: b43-phy0::tx
  Registered led device: b43-phy0::rx
  Registered led device: b43-phy0::radio

So far it looks normal.  However, bringing up the wlan0 interface and
attempting to associate will shortly afterwards trigger DMA errors, and
any further use of the interface thereafter will fail.  Sometimes
failure happens immediately the interface is brought up, usually I can
get as far as successfully scanning for APs with 'iwlist scan wlan0',
and sometimes it gets as far as negotiating association with the AP,
but it always ends at some point with logging output such as this
in /var/log/messages (with b43 debugging switched on):

  b43-phy0: Broadcom 4312 WLAN found (core revision 15)
  b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
  b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
  phy0: Selected rate control algorithm 'minstrel'
  Registered led device: b43-phy0::tx
  Registered led device: b43-phy0::rx
  Registered led device: b43-phy0::radio
  Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
  b43 ssb0:0: firmware: requesting b43/ucode15.fw
  b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
  b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
  b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
  b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
  b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
  b43-phy0 debug: Chip initialized
  b43-phy0 debug: 64-bit DMA initialized
  b43-phy0 debug: QoS enabled
  b43-phy0 debug: Wireless interface started
  b43-phy0 debug: Adding Interface type 2
  ADDRCONF(NETDEV_UP): wlan0: link is not ready
  b43-phy0 ERROR: Fatal DMA error: 0x00000800, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
  b43-phy0: Controller RESET (DMA error) ...
  b43-phy0 debug: Wireless interface stopped
  b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
  b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
  b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
  b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
  b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/11 = 0.0%, Average tries 1.00
  b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
  b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
  b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
  b43-phy0 debug: Chip initialized
  [ ... and so on ... ]

The DMA error message repeats at approximately 5 second intervals (so
filling up /var/log/messages quite nicely after a while).

Two other points which may help locate the problem, when b43 WILL work:

1.  If I boot up ubuntu kernel-2.6.27 with the proprietary wl driver,
and then do a warm reboot to kernel 2.6.32-rc4, b43 works normally.
No DMA errors are reported.  This may point to a firmware loading issue,
but see 2 below.

2.  If I choose the "force PIO" debugging option b43 works OK (albeit no
doubt not very efficiently).

Chris




From fred99 at carolina.rr.com  Fri Oct 16 15:45:40 2009
From: fred99 at carolina.rr.com (fred99 at carolina.rr.com)
Date: Fri, 16 Oct 2009 9:45:40 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091016130329.3dd0b1a9@boulder.homenet>
Message-ID: <20091016134540.FL4F5.573954.root@cdptpa-web23-z01>


Hi Chris --

---- Chris Vine <chris at cvine.freeserve.co.uk> wrote: 
> Hi,
> 
> I have a Levono S-12 Netbook, which has the Atom N270 processor and a
> Broadcom 14e4:4315 wireless chip with low power PHY.  lspci -vnn | grep
> 14e4 gives:
> 
>   02:00.0 Ethernet controller [0200]: Broadcom Corporation NetLink BCM5906M Fast Ethernet PCI Express [14e4:1713] (rev 02)
>   03:00.0 Network controller [0280]: Broadcom Corporation BCM4312 802.11b/g [14e4:4315] (rev 01)
>           Subsystem: Broadcom Corporation Unknown device [14e4:04b5]
> 
> As suggested for this chip on the linux wireless b43 howto web page, I
> am using firmware extracted from broadcom-wl-4.178.10.4.tar.bz2 using
> the current b43-fwcutter in git.
> 
> Although wireless works with the broadcom wl driver provided by
> Broadcom in their hybrid-portsrc-x86_32-v5.10.91.9.3.tar.gz package up
> to and including kernel 2.6.28 (but not afterwards, presumably because
> of the replacement of ieee80211 by lib80211), the b43 driver in both
> 2.6.32-rc4 and current compat-wireless fails on a cold boot with dma
> errors (I use "cold boot" advisedly - see the working case 1 for b43
> mentioned at the end).
> 
> Prior to failure, modprobe b43 && dmesg | egrep "ssb|b43" gives:
> 
>   b43-pci-bridge 0000:03:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
>   b43-pci-bridge 0000:03:00.0: setting latency timer to 64
>   ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
>   b43-phy0: Broadcom 4312 WLAN found (core revision 15)
>   b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
>   b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
>   Registered led device: b43-phy0::tx
>   Registered led device: b43-phy0::rx
>   Registered led device: b43-phy0::radio
> 
> So far it looks normal.  However, bringing up the wlan0 interface and
> attempting to associate will shortly afterwards trigger DMA errors, and
> any further use of the interface thereafter will fail.  Sometimes
> failure happens immediately the interface is brought up, usually I can
> get as far as successfully scanning for APs with 'iwlist scan wlan0',
> and sometimes it gets as far as negotiating association with the AP,
> but it always ends at some point with logging output such as this
> in /var/log/messages (with b43 debugging switched on):
> 
>   b43-phy0: Broadcom 4312 WLAN found (core revision 15)
>   b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
>   b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
>   phy0: Selected rate control algorithm 'minstrel'
>   Registered led device: b43-phy0::tx
>   Registered led device: b43-phy0::rx
>   Registered led device: b43-phy0::radio
>   Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
>   b43 ssb0:0: firmware: requesting b43/ucode15.fw
>   b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
>   b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
>   b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
>   b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
>   b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
>   b43-phy0 debug: Chip initialized
>   b43-phy0 debug: 64-bit DMA initialized
>   b43-phy0 debug: QoS enabled
>   b43-phy0 debug: Wireless interface started
>   b43-phy0 debug: Adding Interface type 2
>   ADDRCONF(NETDEV_UP): wlan0: link is not ready
>   b43-phy0 ERROR: Fatal DMA error: 0x00000800, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

I had 0x00000400, rather than 0x00000800

>   b43-phy0: Controller RESET (DMA error) ...
>   b43-phy0 debug: Wireless interface stopped
>   b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
>   b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
>   b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
>   b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
>   b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/11 = 0.0%, Average tries 1.00
>   b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
>   b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
>   b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
>   b43-phy0 debug: Chip initialized
>   [ ... and so on ... ]
> 
> The DMA error message repeats at approximately 5 second intervals (so
> filling up /var/log/messages quite nicely after a while).
> 
> Two other points which may help locate the problem, when b43 WILL work:
> 
> 1.  If I boot up ubuntu kernel-2.6.27 with the proprietary wl driver,
> and then do a warm reboot to kernel 2.6.32-rc4, b43 works normally.
> No DMA errors are reported.  This may point to a firmware loading issue,
> but see 2 below.

I had similar problems, and was advised to try the full wireless-testing kernel,
which worked OK for me (compat-wireless with Fedora 2.6.31 kernel did *not* work).

2.6.32-rc? and wireless-compat was thought to work as well as wireless-testing ... hmmm

See threads "14e4:4315 DMA Errors (still)" at:
https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/thread.html

> 
> 2.  If I choose the "force PIO" debugging option b43 works OK (albeit no
> doubt not very efficiently).

Me too.  I never tried proprietary module.

regards, ......... Charlie

> 
> Chris
> 
> 
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev



From Larry.Finger at lwfinger.net  Fri Oct 16 15:42:08 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 16 Oct 2009 08:42:08 -0500
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <200910141006.21854.mb@bu3sch.de>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<200910141006.21854.mb@bu3sch.de>
Message-ID: <4AD87830.9010200@lwfinger.net>

On 10/14/2009 03:06 AM, Michael Buesch wrote:
> On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
>> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
>> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
>> however, it introduced a new bug. Whenever the radio switch was turned off,
>> it was necessary to unload and reload the driver for it to recognize the
>> switch again.
>>
>> I believe this patch fixes the original problem without introducing any new
>> problems.
>>
>> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
>> ---
>>

John,

As Michael correctly points out, this patch substitutes one bug for
another. The current bug affects every bcm43xx device with an rfkill
switch except BCM4306/3, and the new bug only affects BCM4306/3 users
with a kill switch. As the latter group may be the empty set, I think
the trade-off is worth it.

An additional complication is that I do not have the hardware to test
the PPC faults. The OP of Bugzilla #14181 has been helpful; however,
if it takes several tries to get a fix, we might miss the 2.6.32
release, which would introduce a significant regression.

For the above reasons, I am suggesting that this patch be accepted and
pushed to mainline even though it has faults.

Thanks,

Larry


From linville at tuxdriver.com  Fri Oct 16 16:44:14 2009
From: linville at tuxdriver.com (John W. Linville)
Date: Fri, 16 Oct 2009 10:44:14 -0400
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <4AD87830.9010200@lwfinger.net>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<200910141006.21854.mb@bu3sch.de> <4AD87830.9010200@lwfinger.net>
Message-ID: <20091016144414.GE4849@tuxdriver.com>

On Fri, Oct 16, 2009 at 08:42:08AM -0500, Larry Finger wrote:
> On 10/14/2009 03:06 AM, Michael Buesch wrote:
> > On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
> >> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
> >> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
> >> however, it introduced a new bug. Whenever the radio switch was turned off,
> >> it was necessary to unload and reload the driver for it to recognize the
> >> switch again.
> >>
> >> I believe this patch fixes the original problem without introducing any new
> >> problems.
> >>
> >> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> >> ---
> >>

> As Michael correctly points out, this patch substitutes one bug for
> another. The current bug affects every bcm43xx device with an rfkill
> switch except BCM4306/3, and the new bug only affects BCM4306/3 users
> with a kill switch. As the latter group may be the empty set, I think
> the trade-off is worth it.
> 
> An additional complication is that I do not have the hardware to test
> the PPC faults. The OP of Bugzilla #14181 has been helpful; however,
> if it takes several tries to get a fix, we might miss the 2.6.32
> release, which would introduce a significant regression.
> 
> For the above reasons, I am suggesting that this patch be accepted and
> pushed to mainline even though it has faults.

Well, hmmm...ok, we have two or three problems here... :-)

One is whether or not to take this patch.  Normally it is against
policy or whatnot to trade one bug for another.  In this case,
it seems we would fix a real bug in exchange for a theorhetical
bug that we believe no one actually has.  Is that the case?  If so,
that might be acceptable.

The other problem is a work/patch flow issue.  I have occasionally
(some would say too often) snagged a patch directly from this list.
But in general I have waited for Michael to repost the patches to
linux-wireless before merging them.  As such, I'm unaccustomed to
collecting patches from here.  In any event, most patches should be
posted to linux-wireless for wider review before merging.  That would
normally be the maintainer's job, but we are effectively without one
for b43 now.  I don't suppose anyone wants to stand-up?

The third problem (related to the second) is that I missed the
original post, so if you don't mind I'd like you to resend it (to
linux-wireless)! :-)

Thanks,

John
-- 
John W. Linville		Someday the world will need a hero, and you
linville at tuxdriver.com			might be all we have.  Be ready.


From mb at bu3sch.de  Fri Oct 16 17:00:23 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 16 Oct 2009 17:00:23 +0200
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new problem
In-Reply-To: <20091016144414.GE4849@tuxdriver.com>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<4AD87830.9010200@lwfinger.net>
	<20091016144414.GE4849@tuxdriver.com>
Message-ID: <200910161700.25071.mb@bu3sch.de>

On Friday 16 October 2009 16:44:14 John W. Linville wrote:
> On Fri, Oct 16, 2009 at 08:42:08AM -0500, Larry Finger wrote:
> > On 10/14/2009 03:06 AM, Michael Buesch wrote:
> > > On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
> > >> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
> > >> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
> > >> however, it introduced a new bug. Whenever the radio switch was turned off,
> > >> it was necessary to unload and reload the driver for it to recognize the
> > >> switch again.
> > >>
> > >> I believe this patch fixes the original problem without introducing any new
> > >> problems.
> > >>
> > >> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> > >> ---
> > >>
> 
> > As Michael correctly points out, this patch substitutes one bug for
> > another. The current bug affects every bcm43xx device with an rfkill
> > switch except BCM4306/3, and the new bug only affects BCM4306/3 users
> > with a kill switch. As the latter group may be the empty set, I think
> > the trade-off is worth it.
> > 
> > An additional complication is that I do not have the hardware to test
> > the PPC faults. The OP of Bugzilla #14181 has been helpful; however,
> > if it takes several tries to get a fix, we might miss the 2.6.32
> > release, which would introduce a significant regression.
> > 
> > For the above reasons, I am suggesting that this patch be accepted and
> > pushed to mainline even though it has faults.
> 
> Well, hmmm...ok, we have two or three problems here... :-)
> 
> One is whether or not to take this patch.  Normally it is against
> policy or whatnot to trade one bug for another.  In this case,
> it seems we would fix a real bug in exchange for a theorhetical
> bug that we believe no one actually has.  Is that the case?  If so,
> that might be acceptable.

The patch reduces the number of affected users, so it's probably OK.
I can't say if this reduces it to zero, though.
The real fix for all this crapola is to rewrite the b43 init to never
shutdown the device (or fix rfkill to never shutdown the device completely
and instead add a rfkill hook. But that's not going to happen, because
people don't like it. Although keeping the wireless device up just for
monitoring a stupid pushbutton is not acceptable behavior to me.)

> The other problem is a work/patch flow issue.  I have occasionally
> (some would say too often) snagged a patch directly from this list.

I suggest we move as much stuff as possible _off_ this list. It's
horribly unreliable, it mangles messages and it's slow.
So it's a good idea to add CC linux-wireless list on the very first reply.

I think, however, it's always a good idea to resend a patch after the
discussion has calmed down. It's way easier for the upstream maintainer.

-- 
Greetings, Michael.


From Larry.Finger at lwfinger.net  Fri Oct 16 17:01:38 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 16 Oct 2009 10:01:38 -0500
Subject: [PATCH] b43: Fix Bugzilla #14181 without introducing a new	problem
In-Reply-To: <20091016144414.GE4849@tuxdriver.com>
References: <4ad5288a.T5OOlPF0pmC3jjEL%Larry.Finger@lwfinger.net>
	<200910141006.21854.mb@bu3sch.de> <4AD87830.9010200@lwfinger.net>
	<20091016144414.GE4849@tuxdriver.com>
Message-ID: <4AD88AD2.20807@lwfinger.net>

On 10/16/2009 09:44 AM, John W. Linville wrote:
> On Fri, Oct 16, 2009 at 08:42:08AM -0500, Larry Finger wrote:
>> On 10/14/2009 03:06 AM, Michael Buesch wrote:
>>> On Wednesday 14 October 2009 03:25:30 Larry Finger wrote:
>>>> Commit 93bad2b757586fb153ef73b028953a8dcaccde77 entitled "b43: Fix PPC crash
>>>> in rfkill polling on unload" fixed the bug reported in Bugzilla No. 14181;
>>>> however, it introduced a new bug. Whenever the radio switch was turned off,
>>>> it was necessary to unload and reload the driver for it to recognize the
>>>> switch again.
>>>>
>>>> I believe this patch fixes the original problem without introducing any new
>>>> problems.
>>>>
>>>> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
>>>> ---
>>>>
> 
>> As Michael correctly points out, this patch substitutes one bug for
>> another. The current bug affects every bcm43xx device with an rfkill
>> switch except BCM4306/3, and the new bug only affects BCM4306/3 users
>> with a kill switch. As the latter group may be the empty set, I think
>> the trade-off is worth it.
>>
>> An additional complication is that I do not have the hardware to test
>> the PPC faults. The OP of Bugzilla #14181 has been helpful; however,
>> if it takes several tries to get a fix, we might miss the 2.6.32
>> release, which would introduce a significant regression.
>>
>> For the above reasons, I am suggesting that this patch be accepted and
>> pushed to mainline even though it has faults.
> 
> Well, hmmm...ok, we have two or three problems here... :-)
> 
> One is whether or not to take this patch.  Normally it is against
> policy or whatnot to trade one bug for another.  In this case,
> it seems we would fix a real bug in exchange for a theorhetical
> bug that we believe no one actually has.  Is that the case?  If so,
> that might be acceptable.

Yes, I believe that to be the case.

> The other problem is a work/patch flow issue.  I have occasionally
> (some would say too often) snagged a patch directly from this list.
> But in general I have waited for Michael to repost the patches to
> linux-wireless before merging them.  As such, I'm unaccustomed to
> collecting patches from here.  In any event, most patches should be
> posted to linux-wireless for wider review before merging.  That would
> normally be the maintainer's job, but we are effectively without one
> for b43 now.  I don't suppose anyone wants to stand-up?

I would, but my RE work precludes that.

> The third problem (related to the second) is that I missed the
> original post, so if you don't mind I'd like you to resend it (to
> linux-wireless)! :-)

Will do.

Larry


From chris at cvine.freeserve.co.uk  Fri Oct 16 18:01:52 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Fri, 16 Oct 2009 17:01:52 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
Message-ID: <20091016170152.4f0fa69f@boulder.homenet>

On Fri, 16 Oct 2009 9:45:40 -0400
<fred99 at carolina.rr.com> wrote:

> 2.6.32-rc? and wireless-compat was thought to work as well as
> wireless-testing ... hmmm

Ah right.  I had been trying 2.6.32-rc4 by itself and compat-wireless
with 2.6.31.  If I build compat-wireless on top of 2.6.32-rc.4 the dma
errors appear to go away but the encryption modules won't load so it
is not usable.

I think I will try again in a few months time when things have settled
down a bit.  (Or possibly pull wireless-testing from git once 2.6.32
comes out.)

Chris




From netrolller.3d at gmail.com  Fri Oct 16 21:35:54 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Fri, 16 Oct 2009 21:35:54 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091016170152.4f0fa69f@boulder.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01> 
	<20091016170152.4f0fa69f@boulder.homenet>
Message-ID: <69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>

On Fri, Oct 16, 2009 at 6:01 PM, Chris Vine <chris at cvine.freeserve.co.uk> wrote:
> On Fri, 16 Oct 2009 9:45:40 -0400
> <fred99 at carolina.rr.com> wrote:
>
>> 2.6.32-rc? and wireless-compat was thought to work as well as
>> wireless-testing ... hmmm
>
> Ah right. ?I had been trying 2.6.32-rc4 by itself and compat-wireless
> with 2.6.31. ?If I build compat-wireless on top of 2.6.32-rc.4 the dma
> errors appear to go away but the encryption modules won't load so it
> is not usable.
>
> I think I will try again in a few months time when things have settled
> down a bit. ?(Or possibly pull wireless-testing from git once 2.6.32
> comes out.)
>
> Chris
>
>
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>

Could you please try the real wireless-testing tree (as opposed to
compat-wireless)?

Also, what I noticed is that everyone with this problem appears to
have an Intel Atom CPU... weird. Maybe something weird is going on
with the Atom chipset's DMA handling.

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From chris at cvine.freeserve.co.uk  Sat Oct 17 10:45:32 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sat, 17 Oct 2009 09:45:32 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
Message-ID: <20091017094532.59998d1d@laptop.homenet>

On Fri, 16 Oct 2009 21:35:54 +0200
G?bor Stefanik <netrolller.3d at gmail.com> wrote:

> Could you please try the real wireless-testing tree (as opposed to
> compat-wireless)?
> 
> Also, what I noticed is that everyone with this problem appears to
> have an Intel Atom CPU... weird. Maybe something weird is going on
> with the Atom chipset's DMA handling.

OK, I'll compile wireless-testing it over the weekend.

I am struggling to stop my spam filter removing bcm43xx-devel posts.
Is there anything in the lists.berlioz.de headers that I can key on?

Chris


From gene.heskett at verizon.net  Sat Oct 17 14:24:59 2009
From: gene.heskett at verizon.net (Gene Heskett)
Date: Sat, 17 Oct 2009 08:24:59 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091017094532.59998d1d@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091017094532.59998d1d@laptop.homenet>
Message-ID: <200910170824.59082.gene.heskett@verizon.net>

On Saturday 17 October 2009, Chris Vine wrote:
>On Fri, 16 Oct 2009 21:35:54 +0200
>
>G?bor Stefanik <netrolller.3d at gmail.com> wrote:
>> Could you please try the real wireless-testing tree (as opposed to
>> compat-wireless)?
>>
>> Also, what I noticed is that everyone with this problem appears to
>> have an Intel Atom CPU... weird. Maybe something weird is going on
>> with the Atom chipset's DMA handling.
>
>OK, I'll compile wireless-testing it over the weekend.
>
>I am struggling to stop my spam filter removing bcm43xx-devel posts.
>Is there anything in the lists.berlioz.de headers that I can key on?
>
>Chris

NDI what 'filter' you are using, but I just checked back over a 30 day corpus 
of this list, and no message in that 30 days even rated above a 0 for 
spaminess, all were in the -2.3 to -2.5 range according to spamassassin.

Is your bayes database poisoned perhaps, or inadequately trained on ham?

>_______________________________________________
>Bcm43xx-dev mailing list
>Bcm43xx-dev at lists.berlios.de
>https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>


-- 
Cheers, Gene
"There are four boxes to be used in defense of liberty:
 soap, ballot, jury, and ammo. Please use in that order."
-Ed Howdershelt (Author)
The NRA is offering FREE Associate memberships to anyone who wants them.
<https://www.nrahq.org/nrabonus/accept-membership.asp>

A successful [software] tool is one that was used to do something
undreamed of by its author.
		-- S. C. Johnson


From fred99 at carolina.rr.com  Sat Oct 17 20:12:48 2009
From: fred99 at carolina.rr.com (Charles Moschel)
Date: Sat, 17 Oct 2009 14:12:48 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
Message-ID: <20091017141248.796a1249@ccm-amd64>

On Fri, 16 Oct 2009 21:35:54 +0200
G?bor Stefanik <netrolller.3d at gmail.com> wrote:

> On Fri, Oct 16, 2009 at 6:01 PM, Chris Vine <chris at cvine.freeserve.co.uk> wrote:
> > On Fri, 16 Oct 2009 9:45:40 -0400
> > <fred99 at carolina.rr.com> wrote:
> >
> >> 2.6.32-rc? and wireless-compat was thought to work as well as
> >> wireless-testing ... hmmm
> >
> > Ah right. ?I had been trying 2.6.32-rc4 by itself and compat-wireless
> > with 2.6.31. ?If I build compat-wireless on top of 2.6.32-rc.4 the dma
> > errors appear to go away but the encryption modules won't load so it
> > is not usable.
> >
> > I think I will try again in a few months time when things have settled
> > down a bit. ?(Or possibly pull wireless-testing from git once 2.6.32
> > comes out.)
> >
> > Chris
> >
> >
> > _______________________________________________
> > Bcm43xx-dev mailing list
> > Bcm43xx-dev at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
> >
> 
> Could you please try the real wireless-testing tree (as opposed to
> compat-wireless)?
> 
> Also, what I noticed is that everyone with this problem appears to
> have an Intel Atom CPU... weird. Maybe something weird is going on
> with the Atom chipset's DMA handling.
> 

No, it's not only Atom.  I see it on Intel T4200 (dual core
Pentium, 45nm, 800MHz FSB, GL40/GM45 chipset).  Lenovo G530 laptop.

regards, ........ Charlie


From Larry.Finger at lwfinger.net  Sat Oct 17 21:10:19 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 17 Oct 2009 14:10:19 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091017141248.796a1249@ccm-amd64>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>	<20091016170152.4f0fa69f@boulder.homenet>	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091017141248.796a1249@ccm-amd64>
Message-ID: <4ADA169B.1090508@lwfinger.net>

On 10/17/2009 01:12 PM, Charles Moschel wrote:
>> Also, what I noticed is that everyone with this problem appears to
>> have an Intel Atom CPU... weird. Maybe something weird is going on
>> with the Atom chipset's DMA handling.
>>
> 
> No, it's not only Atom.  I see it on Intel T4200 (dual core
> Pentium, 45nm, 800MHz FSB, GL40/GM45 chipset).  Lenovo G530 laptop.

Is this with the same wireless card moved from computer to computer?


From chris at cvine.freeserve.co.uk  Sat Oct 17 21:36:03 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sat, 17 Oct 2009 20:36:03 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910170824.59082.gene.heskett@verizon.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091017094532.59998d1d@laptop.homenet>
	<200910170824.59082.gene.heskett@verizon.net>
Message-ID: <20091017203603.361aab46@laptop.homenet>

On Sat, 17 Oct 2009 08:24:59 -0400
Gene Heskett <gene.heskett at verizon.net> wrote:
> NDI what 'filter' you are using, but I just checked back over a
> 30 day corpus of this list, and no message in that 30 days even
> rated above a 0 for spaminess, all were in the -2.3 to -2.5 range
> according to spamassassin.
> 
> Is your bayes database poisoned perhaps, or inadequately trained on
> ham?

I just use my ISP's spam filter, which probably uses spamassassin, as a
first sift, but delete it here rather than at the ISP as I put various
savings in for things it sometimes interprets as spam.  Because I get
fed up with complaints about my penis size which still get through (and
my wife says it isn't true), I add additional simple filters of my own:
in particular I delete anything which is not addressed to a known user
on the system. As mailing list often don't do that, I put in a further
saving rule for my mailing lists.  You are usually safe with a From
header from the mailing list - that doesn't work with berlios.

Chris


From fred99 at carolina.rr.com  Sun Oct 18 01:44:02 2009
From: fred99 at carolina.rr.com (Charles Moschel)
Date: Sat, 17 Oct 2009 19:44:02 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADA169B.1090508@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091017141248.796a1249@ccm-amd64> <4ADA169B.1090508@lwfinger.net>
Message-ID: <20091017194402.0635def3@ccm-amd64>

On Sat, 17 Oct 2009 14:10:19 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> On 10/17/2009 01:12 PM, Charles Moschel wrote:
> >> Also, what I noticed is that everyone with this problem appears to
> >> have an Intel Atom CPU... weird. Maybe something weird is going on
> >> with the Atom chipset's DMA handling.
> >>
> > 
> > No, it's not only Atom.  I see it on Intel T4200 (dual core
> > Pentium, 45nm, 800MHz FSB, GL40/GM45 chipset).  Lenovo G530 laptop.
> 
> Is this with the same wireless card moved from computer to computer?

No, it came with the laptop and has never been removed.  I reported
earlier that it fails with 2.6.31 (Fedora rawhide kernel) +
compat-wireless, but works with 2.6.32-rc[12] wireless-testing pulled
from git:
[https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006132.html]


From netrolller.3d at gmail.com  Sun Oct 18 01:57:19 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 18 Oct 2009 01:57:19 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091017194402.0635def3@ccm-amd64>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01> 
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com> 
	<20091017141248.796a1249@ccm-amd64> <4ADA169B.1090508@lwfinger.net> 
	<20091017194402.0635def3@ccm-amd64>
Message-ID: <69e28c910910171657j73a1c1eeh2fc5643946bd0bca@mail.gmail.com>

On Sun, Oct 18, 2009 at 1:44 AM, Charles Moschel <fred99 at carolina.rr.com> wrote:
> On Sat, 17 Oct 2009 14:10:19 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>
>> On 10/17/2009 01:12 PM, Charles Moschel wrote:
>> >> Also, what I noticed is that everyone with this problem appears to
>> >> have an Intel Atom CPU... weird. Maybe something weird is going on
>> >> with the Atom chipset's DMA handling.
>> >>
>> >
>> > No, it's not only Atom. ?I see it on Intel T4200 (dual core
>> > Pentium, 45nm, 800MHz FSB, GL40/GM45 chipset). ?Lenovo G530 laptop.
>>
>> Is this with the same wireless card moved from computer to computer?
>
> No, it came with the laptop and has never been removed. ?I reported
> earlier that it fails with 2.6.31 (Fedora rawhide kernel) +
> compat-wireless, but works with 2.6.32-rc[12] wireless-testing pulled
> from git:
> [https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006132.html]
>

What happens with 2.6.31-rc[12] + compat-wireless? And with just
2.6.32-rc[12] (without compat-wireless)? (My guess is that it will
fail, but I need to know this before we move on.)

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From nlhepler at gmail.com  Sun Oct 18 13:25:14 2009
From: nlhepler at gmail.com (Lance Hepler)
Date: Sun, 18 Oct 2009 04:25:14 -0700
Subject: b43/BCM4312 fails with DMA errors
Message-ID: <159f5a550910180425y78e8907dh94982eabb160ecf@mail.gmail.com>

I have tried the latest wireless-testing and 2.6.32-rc5 and they both
still give DMA errors exactly like those I reported earlier. Perhaps
it's because the machine only has 1GB of RAM, and is an Atom compiled
with "-march=core2 -mtune=generic -mfpmath=sse" CFLAGS? (At least,
that's what I pass to make. I don't know how the kernel build system
filters these flags..).

Lance

PS:  And I apologize if this message breaks the thread again. I can't
for the life of me figure out how to get gmail to use the extra
parameters...


From mb at bu3sch.de  Sun Oct 18 13:51:20 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 18 Oct 2009 13:51:20 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <159f5a550910180425y78e8907dh94982eabb160ecf@mail.gmail.com>
References: <159f5a550910180425y78e8907dh94982eabb160ecf@mail.gmail.com>
Message-ID: <200910181351.22478.mb@bu3sch.de>

On Sunday 18 October 2009 13:25:14 Lance Hepler wrote:
> I have tried the latest wireless-testing and 2.6.32-rc5 and they both
> still give DMA errors exactly like those I reported earlier. Perhaps
> it's because the machine only has 1GB of RAM, and is an Atom compiled
> with "-march=core2 -mtune=generic -mfpmath=sse" CFLAGS? (At least,
> that's what I pass to make. I don't know how the kernel build system
> filters these flags..).


A simple rule for modifying CFLAGS in the kernel is: Don't!

The kernel developers _already_ tuned the CFLAGS to the best possible gain,
so by further modifying the flags you just introduce bugs and miscompilations.
And besides that, the kernel doesn't use floating point, so the -mfpmath=sse
will do no good and has potential for miscompilations.

It's unlikely that this causes your issues, but it's a general rule.
It's also a good idea to obey the "Don't!" rule for userspace programs.
It's just placebo.

-- 
Greetings, Michael.


From celejar at gmail.com  Sun Oct 18 16:17:07 2009
From: celejar at gmail.com (Celejar)
Date: Sun, 18 Oct 2009 10:17:07 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091017203603.361aab46@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091017094532.59998d1d@laptop.homenet>
	<200910170824.59082.gene.heskett@verizon.net>
	<20091017203603.361aab46@laptop.homenet>
Message-ID: <20091018101707.0576d8ba.celejar@gmail.com>

On Sat, 17 Oct 2009 20:36:03 +0100
Chris Vine <chris at cvine.freeserve.co.uk> wrote:

...

> get through (and my wife says it isn't true), I add additional simple
> filters of my own: in particular I delete anything which is not
> addressed to a known user on the system. As mailing list often don't
> do that, I put in a further saving rule for my mailing lists.  You
> are usually safe with a From header from the mailing list - that
> doesn't work with berlios.

Why not use the List-Id header?

Celejar
-- 
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From chris at cvine.freeserve.co.uk  Sun Oct 18 18:35:10 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 18 Oct 2009 17:35:10 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
Message-ID: <20091018173510.7901fe6d@laptop.homenet>

On Fri, 16 Oct 2009 21:35:54 +0200
G?bor Stefanik <netrolller.3d at gmail.com> wrote:
> Could you please try the real wireless-testing tree (as opposed to
> compat-wireless)?
> 
> Also, what I noticed is that everyone with this problem appears to
> have an Intel Atom CPU... weird. Maybe something weird is going on
> with the Atom chipset's DMA handling.

I get the DMA errors with both the master and linville branches of
wireless-testing.

Since b43 works correctly after a warm boot from a loaded wl module, I
suspect it is more likely to be something amiss with the loading
of the firmware or with device initialisation.

Chris


From Larry.Finger at lwfinger.net  Sun Oct 18 22:41:17 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 18 Oct 2009 15:41:17 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091018173510.7901fe6d@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>	<20091016170152.4f0fa69f@boulder.homenet>	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091018173510.7901fe6d@laptop.homenet>
Message-ID: <4ADB7D6D.6040607@lwfinger.net>

On 10/18/2009 11:35 AM, Chris Vine wrote:
> On Fri, 16 Oct 2009 21:35:54 +0200
> G?bor Stefanik <netrolller.3d at gmail.com> wrote:
>> Could you please try the real wireless-testing tree (as opposed to
>> compat-wireless)?
>>
>> Also, what I noticed is that everyone with this problem appears to
>> have an Intel Atom CPU... weird. Maybe something weird is going on
>> with the Atom chipset's DMA handling.
> 
> I get the DMA errors with both the master and linville branches of
> wireless-testing.
> 
> Since b43 works correctly after a warm boot from a loaded wl module, I
> suspect it is more likely to be something amiss with the loading
> of the firmware or with device initialisation.

Remember that most of us do not get this error. I think that something
is amiss with your motherboard, the PCIe bridge, or the interface
between the chip and the PCIe buss. Without the error on my machine,
it is very difficult to debug.

Please post the output of the command 'sudo lspci -nnvvv' for the
BCM43XX device in the case of a cold boot (when it fails) and the case
of a warm boot from a loaded wl.

In addition, please post the particulars of your computer.

Larry


From chris at cvine.freeserve.co.uk  Sun Oct 18 23:47:49 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 18 Oct 2009 22:47:49 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADB7D6D.6040607@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091018173510.7901fe6d@laptop.homenet>
	<4ADB7D6D.6040607@lwfinger.net>
Message-ID: <20091018224749.658869d0@laptop.homenet>

On Sun, 18 Oct 2009 15:41:17 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Please post the output of the command 'sudo lspci -nnvvv' for the
> BCM43XX device in the case of a cold boot (when it fails) and the case
> of a warm boot from a loaded wl.
> 
> In addition, please post the particulars of your computer.

Sure.  Attached is the output of lspci -nnvvv with the wl driver loaded
under kernel 2.6.27 (2.6.27.txt), for a working loaded b43 driver on a
subsequent warm boot to kernel 2.6.32-rc5 (2.6.32-rc5.warm.txt)
(wireless-testing, linville branch) and a failed loaded b43 driver on a
further cold boot to kernel 2.6.32-rc5 (2.6.32-rc5.cold.txt)
(wireless-testing, linville branch).  Also attached is a list of loaded
modules in the last two cases (2.6.32-rc5.modules).

The computer is a Levono S-12 netbook.  What further particulars would
you like that is not revealed by lspci?

Chris

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 2.6.27.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091018/86b63dda/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 2.6.32-rc5.warm.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091018/86b63dda/attachment-0001.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 2.6.32-rc5.cold.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091018/86b63dda/attachment-0002.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2.6.32-rc5.modules
Type: application/octet-stream
Size: 3456 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091018/86b63dda/attachment.obj>

From celejar at gmail.com  Mon Oct 19 02:53:54 2009
From: celejar at gmail.com (Celejar)
Date: Sun, 18 Oct 2009 20:53:54 -0400
Subject: 4318 not working with bleeding edge kernels
Message-ID: <20091018205354.d22b8ec8.celejar@gmail.com>

I'm not sure that this is a b43 thing, but hopefully, even if it isn't,
someone here will be able to point me in the right direction.

My 4318 (details below) has been working fine for quite some time with
b43.  As recently as 2.6.31, it was still working:

Oct 18 20:30:06 localhost wpa_supplicant[2892]: CTRL-EVENT-SCAN-RESULTS 
Oct 18 20:30:06 localhost wpa_supplicant[2892]: Trying to associate with 00:14:d1:3e:ff:30 (SSID='cranford' freq=2437 MHz)
Oct 18 20:30:06 localhost wpa_supplicant[2892]: Association request to the driver failed
Oct 18 20:30:07 localhost kernel: [   78.196304] wlan0: authenticate with AP 00:14:d1:3e:ff:30
Oct 18 20:30:07 localhost kernel: [   78.197716] wlan0: authenticated
Oct 18 20:30:07 localhost kernel: [   78.197719] wlan0: associate with AP 00:14:d1:3e:ff:30
Oct 18 20:30:07 localhost kernel: [   78.200084] wlan0: RX AssocResp from 00:14:d1:3e:ff:30 (capab=0x431 status=43 aid=0)
Oct 18 20:30:07 localhost kernel: [   78.200088] wlan0: AP denied association (code=43)
Oct 18 20:30:07 localhost kernel: [   78.397059] wlan0: associate with AP 00:14:d1:3e:ff:30
Oct 18 20:30:07 localhost wpa_supplicant[2892]: Associated with 00:14:d1:3e:ff:30
Oct 18 20:30:07 localhost kernel: [   78.399232] wlan0: RX AssocResp from 00:14:d1:3e:ff:30 (capab=0x431 status=0 aid=2)
Oct 18 20:30:07 localhost kernel: [   78.399237] wlan0: associated
Oct 18 20:30:07 localhost kernel: [   78.400055] ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Oct 18 20:30:08 localhost dnsmasq[1968]: reading /var/run/dnsmasq/resolv.conf
Oct 18 20:30:08 localhost dnsmasq[1968]: using nameserver 192.168.0.1#53
Oct 18 20:30:09 localhost wpa_supplicant[2892]: WPA: Key negotiation completed with 00:14:d1:3e:ff:30 [PTK=CCMP GTK=CCMP]
Oct 18 20:30:09 localhost wpa_supplicant[2892]: CTRL-EVENT-CONNECTED - Connection to 00:14:d1:3e:ff:30 completed (auth) [id=0 id_str=]
Oct 18 20:30:09 localhost kernel: [   80.263676] b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 00:14:d1:3e:ff:30
Oct 18 20:30:09 localhost kernel: [   80.263699] b43-phy0 debug: Using hardware based encryption for keyidx: 1, mac: ff:ff:ff:ff:ff:ff

The early 2.6.32 rc kernels were giving oopses, apparently because of
this:

https://lists.berlios.de/pipermail/bcm43xx-dev/2009-October/006129.html

The patch is apparently in -rc5, but that kernel, while it doesn't
oops, fails to authenticate:

Oct 17 19:44:05 localhost wpa_supplicant[3477]: CTRL-EVENT-SCAN-RESULTS 
Oct 17 19:44:07 localhost wpa_supplicant[3477]: CTRL-EVENT-SCAN-RESULTS 
Oct 17 19:44:07 localhost wpa_supplicant[3477]: Trying to associate with 00:14:d1:3e:ff:30 (SSID='cranford' freq=2437 MHz)
Oct 17 19:44:07 localhost kernel: [  198.914180] wlan0: deauthenticating from 00:14:d1:3e:ff:30 by local choice (reason=3)
Oct 17 19:44:07 localhost kernel: [  198.914320] wlan0: direct probe to AP 00:14:d1:3e:ff:30 (try 1)
Oct 17 19:44:07 localhost kernel: [  198.917136] wlan0: direct probe responded
Oct 17 19:44:07 localhost kernel: [  198.917141] wlan0: authenticate with AP 00:14:d1:3e:ff:30 (try 1)
Oct 17 19:44:07 localhost kernel: [  198.918857] wlan0: authenticated
Oct 17 19:44:07 localhost kernel: [  198.918873] wlan0: associate with AP 00:14:d1:3e:ff:30 (try 1)
Oct 17 19:44:07 localhost kernel: [  198.921192] wlan0: RX AssocResp from 00:14:d1:3e:ff:30 (capab=0x431 status=43 aid=0)
Oct 17 19:44:07 localhost kernel: [  198.921196] wlan0: AP denied association (code=43)
Oct 17 19:44:17 localhost wpa_supplicant[3477]: Authentication with 00:14:d1:3e:ff:30 timed out.
Oct 17 19:44:19 localhost wpa_supplicant[3477]: CTRL-EVENT-SCAN-RESULTS 
Oct 17 19:44:19 localhost wpa_supplicant[3477]: Trying to associate with 00:14:d1:3e:ff:30 (SSID='cranford' freq=2437 MHz)
Oct 17 19:44:19 localhost wpa_supplicant[3477]: Association request to the driver failed
Oct 17 19:44:24 localhost wpa_supplicant[3477]: Authentication with 00:14:d1:3e:ff:30 timed out.
Oct 17 19:44:25 localhost wpa_supplicant[3477]: CTRL-EVENT-SCAN-RESULTS 
Oct 17 19:44:25 localhost wpa_supplicant[3477]: Trying to associate with 00:14:d1:3e:ff:30 (SSID='cranford' freq=2437 MHz)
Oct 17 19:44:25 localhost wpa_supplicant[3477]: Association request to the driver failed
Oct 17 19:44:30 localhost wpa_supplicant[3477]: Authentication with 00:14:d1:3e:ff:30 timed out.
Oct 17 19:44:31 localhost wpa_supplicant[3477]: CTRL-EVENT-SCAN-RESULTS 
Oct 17 19:44:31 localhost wpa_supplicant[3477]: Trying to associate with 00:14:d1:3e:ff:30 (SSID='cranford' freq=2437 MHz)
Oct 17 19:44:31 localhost wpa_supplicant[3477]: Association request to the driver failed

Any idea what's going on here?


From Larry.Finger at lwfinger.net  Mon Oct 19 05:14:31 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 18 Oct 2009 22:14:31 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091018224749.658869d0@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>	<20091016170152.4f0fa69f@boulder.homenet>	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>	<20091018173510.7901fe6d@laptop.homenet>	<4ADB7D6D.6040607@lwfinger.net>
	<20091018224749.658869d0@laptop.homenet>
Message-ID: <4ADBD997.9070107@lwfinger.net>

On 10/18/2009 04:47 PM, Chris Vine wrote:
> On Sun, 18 Oct 2009 15:41:17 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> 
>> Please post the output of the command 'sudo lspci -nnvvv' for the
>> BCM43XX device in the case of a cold boot (when it fails) and the case
>> of a warm boot from a loaded wl.
>>
>> In addition, please post the particulars of your computer.
> 
> Sure.  Attached is the output of lspci -nnvvv with the wl driver loaded
> under kernel 2.6.27 (2.6.27.txt), for a working loaded b43 driver on a
> subsequent warm boot to kernel 2.6.32-rc5 (2.6.32-rc5.warm.txt)
> (wireless-testing, linville branch) and a failed loaded b43 driver on a
> further cold boot to kernel 2.6.32-rc5 (2.6.32-rc5.cold.txt)
> (wireless-testing, linville branch).  Also attached is a list of loaded
> modules in the last two cases (2.6.32-rc5.modules).
> 
> The computer is a Levono S-12 netbook.  What further particulars would
> you like that is not revealed by lspci?

I see no difference in the output for the BCM4312 device; however,
there was a difference in the memory layout for the BCM5906 wired
network device. Please post the dmesg output for the warm and cold reboot.

Larry



From chris at cvine.freeserve.co.uk  Mon Oct 19 11:37:56 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 10:37:56 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADBD997.9070107@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091016134540.FL4F5.573954.root@cdptpa-web23-z01>
	<20091016170152.4f0fa69f@boulder.homenet>
	<69e28c910910161235l6705187cl8ffb1a7f438d63e8@mail.gmail.com>
	<20091018173510.7901fe6d@laptop.homenet>
	<4ADB7D6D.6040607@lwfinger.net>
	<20091018224749.658869d0@laptop.homenet>
	<4ADBD997.9070107@lwfinger.net>
Message-ID: <20091019103756.0d2741a4@laptop.homenet>

On Sun, 18 Oct 2009 22:14:31 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> I see no difference in the output for the BCM4312 device; however,
> there was a difference in the memory layout for the BCM5906 wired
> network device. Please post the dmesg output for the warm and cold
> reboot.

Attached.  The dmesg ring buffer truncates at slightly different places
because of the reports of DMA errors at the end of the cold boot and
there seems to be some re-ordering of the loading of different things,
but they appear basically the same.

Chris
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg-2.6.32-rc5.warm.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091019/23803c5b/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg-2.6.32-rc5.cold.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091019/23803c5b/attachment-0001.txt>

From mb at bu3sch.de  Mon Oct 19 11:46:00 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 19 Oct 2009 11:46:00 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019103756.0d2741a4@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<4ADBD997.9070107@lwfinger.net>
	<20091019103756.0d2741a4@laptop.homenet>
Message-ID: <200910191146.02347.mb@bu3sch.de>

On Monday 19 October 2009 11:37:56 Chris Vine wrote:
> On Sun, 18 Oct 2009 22:14:31 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > I see no difference in the output for the BCM4312 device; however,
> > there was a difference in the memory layout for the BCM5906 wired
> > network device. Please post the dmesg output for the warm and cold
> > reboot.
> 
> Attached.  The dmesg ring buffer truncates at slightly different places
> because of the reports of DMA errors at the end of the cold boot and
> there seems to be some re-ordering of the loading of different things,
> but they appear basically the same.

I guess you guys already played with acpi=off and apic=off ?

-- 
Greetings, Michael.


From mb at bu3sch.de  Mon Oct 19 11:55:01 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 19 Oct 2009 11:55:01 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910191146.02347.mb@bu3sch.de>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091019103756.0d2741a4@laptop.homenet>
	<200910191146.02347.mb@bu3sch.de>
Message-ID: <200910191155.03872.mb@bu3sch.de>

On Monday 19 October 2009 11:46:00 Michael Buesch wrote:
> On Monday 19 October 2009 11:37:56 Chris Vine wrote:
> > On Sun, 18 Oct 2009 22:14:31 -0500
> > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > > I see no difference in the output for the BCM4312 device; however,
> > > there was a difference in the memory layout for the BCM5906 wired
> > > network device. Please post the dmesg output for the warm and cold
> > > reboot.
> > 
> > Attached.  The dmesg ring buffer truncates at slightly different places
> > because of the reports of DMA errors at the end of the cold boot and
> > there seems to be some re-ordering of the loading of different things,
> > but they appear basically the same.
> 
> I guess you guys already played with acpi=off and apic=off ?
> 

If you look at the diff of those logs, you also see that this is not just
reordering of stuff. At the very beginning you see some fairly huge ACPI mapping
that's not done for the failure case. So my guess is that the ACPI simply fails
to map some important I/O memory. There also are other interesting things in the log,
which are probably not the cause of the b43 issue, but related to the root issue.
For example the failed TSC calibration smells fishy to me.


--- dmesg-2.6.32-rc5.cold.txt	2009-10-19 11:47:53.000000000 +0200
+++ dmesg-2.6.32-rc5.warm.txt	2009-10-19 11:47:50.000000000 +0200
@@ -1,4 +1,35 @@
- 00000001)
+anges enabled:
+  00000-9FFFF write-back
+  A0000-BFFFF uncachable
+  C0000-CFFFF write-protect
+  D0000-DFFFF uncachable
+  E0000-FFFFF write-protect
+MTRR variable ranges enabled:
+  0 base 000000000 mask 0C0000000 write-back
+  1 base 03F700000 mask 0FFF00000 uncachable
+  2 base 03F800000 mask 0FF800000 uncachable
+  3 disabled
+  4 disabled
+  5 disabled
+  6 disabled
+  7 disabled
+x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
+initial memory mapped : 0 - 01800000
+init_memory_mapping: 0000000000000000-00000000377fe000
+ 0000000000 - 0000400000 page 4k
+ 0000400000 - 0037400000 page 2M
+ 0037400000 - 00377fe000 page 4k
+kernel direct mapping tables up to 377fe000 @ 7000-c000
+ACPI: RSDP 000f7c70 00024 (v02 LENOVO)
+ACPI: XSDT 3f6d9fed 0007C (v01 LENOVO CB-01    06040000  LTP 00000000)
+ACPI: FACP 3f6e1c3a 000F4 (v03 INTEL  CALISTGA 06040000 ALAN 00000001)
+ACPI: DSDT 3f6dbbf9 05FCD (v01 LENOVO CB-01    06040000 MSFT 03000000)
+ACPI: FACS 3f6e2fc0 00040
+ACPI: HPET 3f6e1d2e 00038 (v01 INTEL  CALISTGA 06040000 LOHR 0000005A)
+ACPI: MCFG 3f6e1d66 0003C (v01 INTEL  CALISTGA 06040000 LOHR 0000005A)
+ACPI: TCPA 3f6e1da2 00032 (v01 PTLTD  CALISTGA 06040000  PTL 00000001)
+ACPI: TMOR 3f6e1dd4 00026 (v01 PTLTD           06040000 PTL  00000003)
+ACPI: SLIC 3f6e1dfa 00176 (v01 LENOVO CB-01    06040000 LNVO 00000001)
 ACPI: APIC 3f6e1f70 00068 (v01 PTLTD  ? APIC   06040000  LTP 00000000)
 ACPI: BOOT 3f6e1fd8 00028 (v01 PTLTD  $SBFTBL$ 06040000  LTP 00000001)
 ACPI: SSDT 3f6db5aa 0064F (v01 SataRe  SataPri 00001000 INTL 20050624)
@@ -93,10 +124,9 @@
 Console: colour dummy device 80x25
 console [tty0] enabled
 hpet clockevent registered
-Fast TSC calibration failed
-TSC: PIT calibration matches HPET. 1 loops
-Detected 1596.048 MHz processor.
-Calibrating delay loop (skipped), value calculated using timer frequency.. 3192.09 BogoMIPS (lpj=6384192)
+Fast TSC calibration using PIT
+Detected 1595.947 MHz processor.
+Calibrating delay loop (skipped), value calculated using timer frequency.. 3191.89 BogoMIPS (lpj=6383788)
 Security Framework initialized
 Mount-cache hash table entries: 512
 CPU: L1 I cache: 32K, L1 D cache: 24K
@@ -120,7 +150,7 @@
 CPU0: Intel(R) Atom(TM) CPU N270   @ 1.60GHz stepping 02
 Booting processor 1 APIC 0x1 ip 0x6000
 Initializing CPU#1
-Calibrating delay using timer specific routine.. 3191.70 BogoMIPS (lpj=6383401)
+Calibrating delay using timer specific routine.. 3191.93 BogoMIPS (lpj=6383871)
 CPU: L1 I cache: 32K, L1 D cache: 24K
 CPU: L2 cache: 512K
 CPU: Physical Processor ID: 0
@@ -130,7 +160,7 @@
 CPU1: Intel(R) Atom(TM) CPU N270   @ 1.60GHz stepping 02
 checking TSC synchronization [CPU#0 -> CPU#1]: passed.
 Brought up 2 CPUs
-Total of 2 processors activated (6383.79 BogoMIPS).
+Total of 2 processors activated (6383.82 BogoMIPS).
 regulator: core version 0.5
 NET: Registered protocol family 16
 ACPI: bus type pci registered
@@ -141,6 +171,7 @@
 bio: create slab <bio-0> at 0
 ACPI: EC: Look up EC in DSDT
 ACPI: BIOS _OSI(Linux) query ignored
+ACPI: EC: GPE storm detected, transactions will use polling mode
 ACPI: Interpreter enabled
 ACPI: (supports S0 S3 S4 S5)
 ACPI: Using IOAPIC for interrupt routing
@@ -366,6 +397,14 @@
 usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
 usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
 usb usb1: Product: EHCI Host Controller
+ata1.00: ATA-8: Hitachi HTS543216L9A300, FB2OC4DC, max UDMA/133
+ata1.00: 312581808 sectors, multi 16: LBA48 NCQ (depth 0/32)
+ata1.00: configured for UDMA/133
+scsi 0:0:0:0: Direct-Access     ATA      Hitachi HTS54321 FB2O PQ: 0 ANSI: 5
+sd 0:0:0:0: [sda] 312581808 512-byte logical blocks: (160 GB/149 GiB)
+sd 0:0:0:0: [sda] Write Protect is off
+sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
+sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
 usb usb1: Manufacturer: Linux 2.6.32-rc5-wl-wt ehci_hcd
 usb usb1: SerialNumber: 0000:00:1d.7
 usb usb1: configuration #1 chosen from 1 choice
@@ -383,7 +422,7 @@
 usb usb2: Manufacturer: Linux 2.6.32-rc5-wl-wt uhci_hcd
 usb usb2: SerialNumber: 0000:00:1d.0
 usb usb2: configuration #1 chosen from 1 choice
-ata1.00: ATA-8: Hitachi HTS543216L9A300, FB2OC4DC, max UDMA/133
+ sda:
 hub 2-0:1.0: USB hub found
 hub 2-0:1.0: 2 ports detected
 uhci_hcd 0000:00:1d.1: PCI INT B -> GSI 19 (level, low) -> IRQ 19
@@ -396,8 +435,10 @@
 usb usb3: Product: UHCI Host Controller
 usb usb3: Manufacturer: Linux 2.6.32-rc5-wl-wt uhci_hcd
 usb usb3: SerialNumber: 0000:00:1d.1
+ sda1 sda2 sda3 sda4
 usb usb3: configuration #1 chosen from 1 choice
 hub 3-0:1.0: USB hub found
+sd 0:0:0:0: [sda] Attached SCSI disk
 hub 3-0:1.0: 2 ports detected
 uhci_hcd 0000:00:1d.2: PCI INT C -> GSI 18 (level, low) -> IRQ 18
 uhci_hcd 0000:00:1d.2: setting latency timer to 64
@@ -438,17 +479,8 @@
 TCP cubic registered
 Initializing XFRM netlink socket
 NET: Registered protocol family 17
-Using IPI No-Shortcut mode
 input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input0
-ata1.00: 312581808 sectors, multi 16: LBA48 NCQ (depth 0/32)
-ata1.00: configured for UDMA/133
-scsi 0:0:0:0: Direct-Access     ATA      Hitachi HTS54321 FB2O PQ: 0 ANSI: 5
-sd 0:0:0:0: [sda] 312581808 512-byte logical blocks: (160 GB/149 GiB)
-sd 0:0:0:0: [sda] Write Protect is off
-sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
-sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
- sda: sda1 sda2 sda3 sda4
-sd 0:0:0:0: [sda] Attached SCSI disk
+Using IPI No-Shortcut mode
 usb 1-7: new high speed USB device using ehci_hcd and address 4
 kjournald starting.  Commit interval 5 seconds
 EXT3-fs: mounted filesystem with writeback data mode.
@@ -471,80 +503,79 @@
 usb 3-2: Manufacturer: Broadcom Corp
 usb 3-2: SerialNumber: 002556EC4067
 usb 3-2: configuration #1 chosen from 1 choice
-sd 0:0:0:0: Attached scsi generic sg0 type 0
+intel_rng: FWH not detected
+Linux agpgart interface v0.103
 i801_smbus 0000:00:1f.3: PCI INT B -> GSI 19 (level, low) -> IRQ 19
 ACPI: I/O resource 0000:00:1f.3 [0x18e0-0x18ff] conflicts with ACPI region SMBI [0x18e0-0x18ef]
 ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver
-intel_rng: FWH not detected
 input: Sleep Button as /devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0E:00/input/input1
-Linux agpgart interface v0.103
 ACPI: Sleep Button [SLPB]
 ACPI: WMI: Mapper loaded
-input: Lid Switch as /devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0D:00/input/input2
 ACPI: AC Adapter [ADP1] (on-line)
-usbcore: registered new interface driver hiddev
+input: Lid Switch as /devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0D:00/input/input2
+sd 0:0:0:0: Attached scsi generic sg0 type 0
 ACPI: Lid Switch [LID0]
 input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input3
-input: USB Optical Mouse as /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1:1.0/input/input4
+usbcore: registered new interface driver hiddev
+agpgart-intel 0000:00:00.0: Intel 945GME Chipset
 ACPI: Power Button [PWRF]
+input: USB Optical Mouse as /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1:1.0/input/input4
+agpgart-intel 0000:00:00.0: detected 7932K stolen memory
 generic-usb 0003:0461:4D22.0001: input,hidraw0: USB HID v1.11 Mouse [USB Optical Mouse] on usb-0000:00:1d.0-1/input0
 usbcore: registered new interface driver usbhid
 usbhid: v2.6:USB HID core driver
-ACPI: EC: GPE storm detected, transactions will use polling mode
 tg3.c:v3.102 (September 1, 2009)
 tg3 0000:02:00.0: PCI INT A -> GSI 16 (level, low) -> IRQ 16
-Driver 'rtc_cmos' needs updating - please use bus_type methods
 tg3 0000:02:00.0: setting latency timer to 64
-agpgart-intel 0000:00:00.0: Intel 945GME Chipset
-rtc_cmos 00:07: RTC can wake from S4
-agpgart-intel 0000:00:00.0: detected 7932K stolen memory
-rtc_cmos 00:07: rtc core: registered rtc_cmos as rtc0
-agpgart-intel 0000:00:00.0: AGP aperture is 256M @ 0xd0000000
-rtc0: alarms up to one month, y3k, 242 bytes nvram, hpet irqs
-ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 9 (20090903/nsrepair-132)
-Linux video capture interface: v2.00
-input: PS/2 Generic Mouse as /devices/platform/i8042/serio2/input/input5
-ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 10 (20090903/nsrepair-132)
-ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 11 (20090903/nsrepair-132)
-ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 12 (20090903/nsrepair-132)
+Bluetooth: Core ver 2.15
+NET: Registered protocol family 31
+Bluetooth: HCI device and connection manager initialized
+Bluetooth: HCI socket layer initialized
 ACPI: SSDT 3f6dabff 00245 (v02  PmRef  Cpu0Ist 00003000 INTL 20050624)
+Bluetooth: Generic Bluetooth USB driver ver 0.6
+usbcore: registered new interface driver btusb
+agpgart-intel 0000:00:00.0: AGP aperture is 256M @ 0xd0000000
 ACPI: SSDT 3f6da55f 0061B (v02  PmRef  Cpu0Cst 00003001 INTL 20050624)
-eth0: Tigon3 [partno(BCM95906) rev c002] (PCI Express) MAC address 00:1f:16:1f:85:a4
-eth0: attached PHY is 5906 (10/100Base-TX Ethernet) (WireSpeed[0])
-eth0: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] TSOcap[1]
-eth0: dma_rwctrl[76180000] dma_mask[64-bit]
 Monitor-Mwait will be used to enter C-1 state
 Monitor-Mwait will be used to enter C-2 state
 Monitor-Mwait will be used to enter C-3 state
 Marking TSC unstable due to TSC halts in idle
 Switching to clocksource hpet
 processor LNXCPU:00: registered as cooling_device0
-Bluetooth: Core ver 2.15
 ACPI: SSDT 3f6dae44 000D4 (v02  PmRef  Cpu1Ist 00003000 INTL 20050624)
+eth0: Tigon3 [partno(BCM95906) rev c002] (PCI Express) MAC address 00:1f:16:1f:85:a4
 ACPI: SSDT 3f6dab7a 00085 (v02  PmRef  Cpu1Cst 00003000 INTL 20050624)
-acpi device:03: registered as cooling_device1
-NET: Registered protocol family 31
-Bluetooth: HCI device and connection manager initialized
-Bluetooth: HCI socket layer initialized
-Bluetooth: Generic Bluetooth USB driver ver 0.6
-usbcore: registered new interface driver btusb
+eth0: attached PHY is 5906 (10/100Base-TX Ethernet) (WireSpeed[0])
+eth0: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] TSOcap[1]
+eth0: dma_rwctrl[76180000] dma_mask[64-bit]
+input: PS/2 Generic Mouse as /devices/platform/i8042/serio2/input/input5
 thermal LNXTHERM:01: registered as thermal_zone0
+processor LNXCPU:01: registered as cooling_device1
+ACPI: Thermal Zone [TZS0] (50 C)
+ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 9 (20090903/nsrepair-132)
+ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 10 (20090903/nsrepair-132)
+ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 11 (20090903/nsrepair-132)
+ACPI Warning for \_SB_.PCI0.LPCB.EC0_.BAT0._BIF: Converted Buffer to expected String at index 12 (20090903/nsrepair-132)
+thermal LNXTHERM:02: registered as thermal_zone1
+ACPI: Thermal Zone [TZS1] (50 C)
+ACPI: Battery Slot [BAT0] (battery present)
+Driver 'rtc_cmos' needs updating - please use bus_type methods
+rtc_cmos 00:07: RTC can wake from S4
+rtc_cmos 00:07: rtc core: registered rtc_cmos as rtc0
+rtc0: alarms up to one month, y3k, 242 bytes nvram, hpet irqs
+Linux video capture interface: v2.00
+acpi device:03: registered as cooling_device2
 input: Video Bus as /devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A08:00/LNXVIDEO:00/input/input6
 ACPI: Video Device [GFX0] (multi-head: yes  rom: no  post: no)
-processor LNXCPU:01: registered as cooling_device2
-ACPI: Battery Slot [BAT0] (battery present)
-ACPI: Thermal Zone [TZS0] (49 C)
+b43-pci-bridge 0000:03:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
 uvcvideo: Found UVC 1.00 device Lenovo EasyCamera (04f2:b090)
 input: Lenovo EasyCamera as /devices/pci0000:00/0000:00:1d.7/usb1/1-7/1-7:1.0/input/input7
-thermal LNXTHERM:02: registered as thermal_zone1
 usbcore: registered new interface driver uvcvideo
-ACPI: Thermal Zone [TZS1] (49 C)
 USB Video Class driver (v0.1.0)
-b43-pci-bridge 0000:03:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
 b43-pci-bridge 0000:03:00.0: setting latency timer to 64
+ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
 HDA Intel 0000:00:1b.0: PCI INT A -> GSI 22 (level, low) -> IRQ 22
 HDA Intel 0000:00:1b.0: setting latency timer to 64
-ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
 hda_codec: ALC269: BIOS auto-probing.
 input: HDA Digital PCBeep as /devices/pci0000:00/0000:00:1b.0/input/input8
 Adding 3903784k swap on /dev/sda3.  Priority:-1 extents:1 across:3903784k 
@@ -593,30 +624,11 @@
 b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
 b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
 b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0 ERROR: Fatal DMA error: 0x00000800, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
-b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
-b43-phy0: Controller restarted
-b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
-b43-phy0: Controller RESET (DMA error) ...
 b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
+wlan0: direct probe to AP 00:08:5c:ca:dc:c3 (try 1)
+wlan0: direct probe responded
+wlan0: authenticate with AP 00:08:5c:ca:dc:c3 (try 1)
+wlan0: authenticated
+wlan0: associate with AP 00:08:5c:ca:dc:c3 (try 1)
+wlan0: RX AssocResp from 00:08:5c:ca:dc:c3 (capab=0x411 status=0 aid=1)
+wlan0: associated


-- 
Greetings, Michael.


From mb at bu3sch.de  Mon Oct 19 11:56:38 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 19 Oct 2009 11:56:38 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910191155.03872.mb@bu3sch.de>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191146.02347.mb@bu3sch.de> <200910191155.03872.mb@bu3sch.de>
Message-ID: <200910191156.40681.mb@bu3sch.de>

On Monday 19 October 2009 11:55:01 Michael Buesch wrote:
> On Monday 19 October 2009 11:46:00 Michael Buesch wrote:
> > On Monday 19 October 2009 11:37:56 Chris Vine wrote:
> > > On Sun, 18 Oct 2009 22:14:31 -0500
> > > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > > > I see no difference in the output for the BCM4312 device; however,
> > > > there was a difference in the memory layout for the BCM5906 wired
> > > > network device. Please post the dmesg output for the warm and cold
> > > > reboot.
> > > 
> > > Attached.  The dmesg ring buffer truncates at slightly different places
> > > because of the reports of DMA errors at the end of the cold boot and
> > > there seems to be some re-ordering of the loading of different things,
> > > but they appear basically the same.
> > 
> > I guess you guys already played with acpi=off and apic=off ?
> > 
> 
> If you look at the diff of those logs, you also see that this is not just
> reordering of stuff. At the very beginning you see some fairly huge ACPI mapping
> that's not done for the failure case. So my guess is that the ACPI simply fails
> to map some important I/O memory. There also are other interesting things in the log,
> which are probably not the cause of the b43 issue, but related to the root issue.
> For example the failed TSC calibration smells fishy to me.

Though, I currently realize that those kernel logs are truncated, so they aren't really
of any use...

-- 
Greetings, Michael.


From chris at cvine.freeserve.co.uk  Mon Oct 19 12:03:40 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 11:03:40 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910191155.03872.mb@bu3sch.de>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091019103756.0d2741a4@laptop.homenet>
	<200910191146.02347.mb@bu3sch.de> <200910191155.03872.mb@bu3sch.de>
Message-ID: <20091019110340.2c6991a8@laptop.homenet>

On Mon, 19 Oct 2009 11:55:01 +0200
Michael Buesch <mb at bu3sch.de> wrote:
> On Monday 19 October 2009 11:46:00 Michael Buesch wrote:
> > On Monday 19 October 2009 11:37:56 Chris Vine wrote:
> > > On Sun, 18 Oct 2009 22:14:31 -0500
> > > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > > > I see no difference in the output for the BCM4312 device;
> > > > however, there was a difference in the memory layout for the
> > > > BCM5906 wired network device. Please post the dmesg output for
> > > > the warm and cold reboot.
> > > 
> > > Attached.  The dmesg ring buffer truncates at slightly different
> > > places because of the reports of DMA errors at the end of the
> > > cold boot and there seems to be some re-ordering of the loading
> > > of different things, but they appear basically the same.
> > 
> > I guess you guys already played with acpi=off and apic=off ?
> > 
> 
> If you look at the diff of those logs, you also see that this is not
> just reordering of stuff. At the very beginning you see some fairly
> huge ACPI mapping that's not done for the failure case. So my guess
> is that the ACPI simply fails to map some important I/O memory. There
> also are other interesting things in the log, which are probably not
> the cause of the b43 issue, but related to the root issue. For
> example the failed TSC calibration smells fishy to me.

On the first point (ACPI mapping), that's just dmesg ring buffer
truncation, and irrelevant.

Chris


From mb at bu3sch.de  Mon Oct 19 12:12:59 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 19 Oct 2009 12:12:59 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019110340.2c6991a8@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191155.03872.mb@bu3sch.de>
	<20091019110340.2c6991a8@laptop.homenet>
Message-ID: <200910191213.01444.mb@bu3sch.de>

On Monday 19 October 2009 12:03:40 Chris Vine wrote:
> > If you look at the diff of those logs, you also see that this is not
> > just reordering of stuff. At the very beginning you see some fairly
> > huge ACPI mapping that's not done for the failure case. So my guess
> > is that the ACPI simply fails to map some important I/O memory. There
> > also are other interesting things in the log, which are probably not
> > the cause of the b43 issue, but related to the root issue. For
> > example the failed TSC calibration smells fishy to me.
> 
> On the first point (ACPI mapping), that's just dmesg ring buffer
> truncation, and irrelevant.

Post the full log, please, so we can _verify_ that it's irrelevant.
Everything else is just bad guesswork.

-- 
Greetings, Michael.


From chris at cvine.freeserve.co.uk  Mon Oct 19 12:30:44 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 11:30:44 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910191155.03872.mb@bu3sch.de>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091019103756.0d2741a4@laptop.homenet>
	<200910191146.02347.mb@bu3sch.de> <200910191155.03872.mb@bu3sch.de>
Message-ID: <20091019113044.505264e3@laptop.homenet>

On Mon, 19 Oct 2009 11:55:01 +0200
Michael Buesch <mb at bu3sch.de> wrote:

> 
> On Monday 19 October 2009 11:46:00 Michael Buesch wrote:
> > On Monday 19 October 2009 11:37:56 Chris Vine wrote:
> > > On Sun, 18 Oct 2009 22:14:31 -0500
> > > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > > > I see no difference in the output for the BCM4312 device;
> > > > however, there was a difference in the memory layout for the
> > > > BCM5906 wired network device. Please post the dmesg output for
> > > > the warm and cold reboot.
> > > 
> > > Attached.  The dmesg ring buffer truncates at slightly different
> > > places because of the reports of DMA errors at the end of the
> > > cold boot and there seems to be some re-ordering of the loading
> > > of different things, but they appear basically the same.
> > 
> > I guess you guys already played with acpi=off and apic=off ?
> > 
> 
> If you look at the diff of those logs, you also see that this is not
> just reordering of stuff. At the very beginning you see some fairly
> huge ACPI mapping that's not done for the failure case. So my guess
> is that the ACPI simply fails to map some important I/O memory. There
> also are other interesting things in the log, which are probably not
> the cause of the b43 issue, but related to the root issue. For
> example the failed TSC calibration smells fishy to me.

On TSC calibration, as I read it, it is only the fast calibration which
fails, not slow (regular) calibration.  Both have "Marking TSC unstable
due to TSC halts in idle" logged later, and I have no idea whether that
is significant, although I suspect not.  (Amongst other things, it would
not explain why b43 works on a warm boot.)

Chris


From chris at cvine.freeserve.co.uk  Mon Oct 19 12:58:50 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 11:58:50 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910191213.01444.mb@bu3sch.de>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191155.03872.mb@bu3sch.de>
	<20091019110340.2c6991a8@laptop.homenet>
	<200910191213.01444.mb@bu3sch.de>
Message-ID: <20091019115850.6b9d249b@laptop.homenet>

On Mon, 19 Oct 2009 12:12:59 +0200
Michael Buesch <mb at bu3sch.de> wrote:
> Post the full log, please, so we can _verify_ that it's irrelevant.
> Everything else is just bad guesswork.

Full marks for attitude.  What do you take, for this purpose, as
being "the full log"?  All of /var/log/messages, /var/log/syslog
and /var/log/debug?

(If you are proposing that I should rebuild dmesg with a larger ring
buffer, then no.)

Chris



From mb at bu3sch.de  Mon Oct 19 13:18:36 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 19 Oct 2009 13:18:36 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019115850.6b9d249b@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
Message-ID: <200910191318.38925.mb@bu3sch.de>

On Monday 19 October 2009 12:58:50 Chris Vine wrote:
> (If you are proposing that I should rebuild dmesg with a larger ring
> buffer, then no.)

Why not? You want some help, right? So we need your help.

-- 
Greetings, Michael.


From gene.heskett at verizon.net  Mon Oct 19 14:12:37 2009
From: gene.heskett at verizon.net (Gene Heskett)
Date: Mon, 19 Oct 2009 08:12:37 -0400
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019115850.6b9d249b@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
Message-ID: <200910190812.38017.gene.heskett@verizon.net>

On Monday 19 October 2009, Chris Vine wrote:
>On Mon, 19 Oct 2009 12:12:59 +0200
>
>Michael Buesch <mb at bu3sch.de> wrote:
>> Post the full log, please, so we can _verify_ that it's irrelevant.
>> Everything else is just bad guesswork.
>
>Full marks for attitude.  What do you take, for this purpose, as
>being "the full log"?  All of /var/log/messages, /var/log/syslog
>and /var/log/debug?
>
>(If you are proposing that I should rebuild dmesg with a larger ring
>buffer, then no.)
>
>Chris
>
Chris, if its needed, then yes.  Its a single entry in a 'make xconfig' and 
rebuild & reboot.

-- 
Cheers, Gene
"There are four boxes to be used in defense of liberty:
 soap, ballot, jury, and ammo. Please use in that order."
-Ed Howdershelt (Author)
The NRA is offering FREE Associate memberships to anyone who wants them.
<https://www.nrahq.org/nrabonus/accept-membership.asp>

The cost of feathers has risen, even down is up!


From Larry.Finger at lwfinger.net  Mon Oct 19 16:30:28 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 19 Oct 2009 09:30:28 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <200910190812.38017.gene.heskett@verizon.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
Message-ID: <4ADC7804.80301@lwfinger.net>

On 10/19/2009 07:12 AM, Gene Heskett wrote:
> On Monday 19 October 2009, Chris Vine wrote:
>> (If you are proposing that I should rebuild dmesg with a larger ring
>> buffer, then no.)
>>
>> Chris
>>
> Chris, if its needed, then yes.  Its a single entry in a 'make xconfig' and 
> rebuild & reboot.

Chris, from the lengths of the logs you posted, it looks as if your
kernel is built with CONFIG_LOG_BUF_SHIFT=9. That is way too small for
any meaningful debugging. Your computer has 1 GB RAM - it won't hurt
to devote a bit more to the ring buffer. On my system with 3 GB RAM, I
use 19. I got tired of wrap-arounds when I was trying to see the first
oops message.

In the short-tern, you can boot your existing kernel with a bigger log
buffer by adding 'log_buf_len=131072' to the boot parameter line in GRUB.

Larry




From chris at cvine.freeserve.co.uk  Mon Oct 19 20:00:29 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 19:00:29 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADC7804.80301@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
Message-ID: <20091019190029.47d6b329@laptop.homenet>

On Mon, 19 Oct 2009 09:30:28 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> Chris, from the lengths of the logs you posted, it looks as if your
> kernel is built with CONFIG_LOG_BUF_SHIFT=9. That is way too small for
> any meaningful debugging. Your computer has 1 GB RAM - it won't hurt
> to devote a bit more to the ring buffer. On my system with 3 GB RAM, I
> use 19. I got tired of wrap-arounds when I was trying to see the first
> oops message.
> 
> In the short-tern, you can boot your existing kernel with a bigger log
> buffer by adding 'log_buf_len=131072' to the boot parameter line in
> GRUB.

OK.  Attached is the dmesg output with that boot parameter.

To avoid any false trails, I ought to say that a warm boot of itself
achieves nothing.  What is required to make b43 succeed is a warm boot
from a kernel which has initialised the wireless device by means of the
wl kernel module.

Chris
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg-2.6.32-rc5.warm.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091019/847ed2a2/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg-2.6.32-rc5.cold.txt
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091019/847ed2a2/attachment-0001.txt>

From Larry.Finger at lwfinger.net  Mon Oct 19 23:53:24 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 19 Oct 2009 16:53:24 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019190029.47d6b329@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
Message-ID: <4ADCDFD4.1000705@lwfinger.net>

On 10/19/2009 01:00 PM, Chris Vine wrote:
> On Mon, 19 Oct 2009 09:30:28 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>> Chris, from the lengths of the logs you posted, it looks as if your
>> kernel is built with CONFIG_LOG_BUF_SHIFT=9. That is way too small for
>> any meaningful debugging. Your computer has 1 GB RAM - it won't hurt
>> to devote a bit more to the ring buffer. On my system with 3 GB RAM, I
>> use 19. I got tired of wrap-arounds when I was trying to see the first
>> oops message.
>>
>> In the short-tern, you can boot your existing kernel with a bigger log
>> buffer by adding 'log_buf_len=131072' to the boot parameter line in
>> GRUB.
> 
> OK.  Attached is the dmesg output with that boot parameter.
> 
> To avoid any false trails, I ought to say that a warm boot of itself
> achieves nothing.  What is required to make b43 succeed is a warm boot
> from a kernel which has initialised the wireless device by means of the
> wl kernel module.

This set of dmesg outputs was better; however, please set
CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
Please post the full dmesg for warm and cold reboot.

Larry


From chris at cvine.freeserve.co.uk  Tue Oct 20 00:48:07 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Mon, 19 Oct 2009 23:48:07 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADCDFD4.1000705@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
Message-ID: <20091019234807.049338d0@laptop.homenet>

On Mon, 19 Oct 2009 16:53:24 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> This set of dmesg outputs was better; however, please set
> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
> Please post the full dmesg for warm and cold reboot.

My original posting (16 October) gave the output for a b43 failure
with debugging on.  Was this an oversight, or do you really need to
compare it with the case of a successful load?  If so I can provide you
with the output for a successful load, but it won't be until late
tomorrow.

Chris


From Larry.Finger at lwfinger.net  Tue Oct 20 00:52:14 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 19 Oct 2009 17:52:14 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091019234807.049338d0@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>
	<20091019234807.049338d0@laptop.homenet>
Message-ID: <4ADCED9E.4050408@lwfinger.net>

On 10/19/2009 05:48 PM, Chris Vine wrote:
> On Mon, 19 Oct 2009 16:53:24 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>> This set of dmesg outputs was better; however, please set
>> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
>> Please post the full dmesg for warm and cold reboot.
> 
> My original posting (16 October) gave the output for a b43 failure
> with debugging on.  Was this an oversight, or do you really need to
> compare it with the case of a successful load?  If so I can provide you
> with the output for a successful load, but it won't be until late
> tomorrow.

I want the comparison.

Larry



From _vi at list.ru  Tue Oct 20 15:23:54 2009
From: _vi at list.ru (_vi at list.ru)
Date: Tue, 20 Oct 2009 16:23:54 +0300
Subject: Poor hostapd work with newer driver
Message-ID: <4ADDB9EA.1010207@list.ru>

2.6.30-zen2-31270-gc7099db-dirty - works well.
2.6.31-zen3-07782-g320a4ec - hostapd works bad, especially with multiple 
clients.
earlier 2.6.31 also works bad.

Client mode works OK with newer kernels.

Should I prepare and send additional information or try to bisect the 
problem?
    (It is not easy because of when my hostapd is used to provide 
connection for multiple clients, experiments are discouraged).


From daniel at schmitt-united.de  Tue Oct 20 18:59:44 2009
From: daniel at schmitt-united.de (Daniel Schmitt)
Date: Tue, 20 Oct 2009 18:59:44 +0200
Subject: ssb problem on ar71xx ubiquiti routerstation
Message-ID: <4ADDEC80.8050001@schmitt-united.de>

Hello Group,

I don't know why it is so hard for hardware vendors to implement pci bus ...
A few weeks ago I tried IXP425 platform, now Atheros with ar7161 on Ubiquiti
Routerstation, pci bus isn't working, too.

I'm trying current OpenWrt trunk version for this platform.
Already tried kernel versions 2.6.28, 2.6.30 and 2.6.31.
on every platform the same error if i "insmod ssb":

PCI: Enabling device 0000:00:11.0 (0000 -> 0002)
PCI: Setting latency timer of device 0000:00:11.0 to 64
PCI error 1 at PCI addr 0x10001000
Data bus error, epc == 80164df4, ra == 830026a0
Oops[#1]:
Cpu 0
$ 0   : 00000000 00000073 0000c0de 00000000
$ 4   : b0001002 830eff80 00000000 839cb038
$ 8   : 00000000 800643f0 802d0000 802e0000
$12   : 802d0000 00100100 802d3868 765f6972
$16   : 830eff82 00000001 839cb000 839cb000
$20   : 839d3b90 00408dbc 004953c4 00000002
$24   : 00000018 00000000
$28   : 839d2000 839d3b38 7f8bcb80 830026a0
Hi    : 00000000
Lo    : 00000000
epc   : 80164df4 ioread16+0x8/0x10
     Tainted: P
ra    : 830026a0 ssb_attr_sprom_show+0x44c/0x480 [ssb]
Status: 1000fc03    KERNEL EXL IE
Cause : 9080001c
PrId  : 00019374 (MIPS 24Kc)
Modules linked in: ssb(+) ohci_hcd ath_pci ath_hal(P) nf_nat_tftp
nf_conntrack_tftp nf_nat_irc nf_conntrack_irc nf_nat_ftp nf_conntrack_ftp
ipt_MASQUERADE iptable_nat nf_nat xt_NOTRACK iptable_raw xt_state
nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack ehci_hcd pppoe pppox ipt_REJECT
xt_TCPMSS ipt_LOG xt_multiport xt_mac xt_limit iptable_mangle iptable_filter
ip_tables xt_tcpudp x_tables ppp_async ppp_generic slhc usbcore crc_ccitt
michael_mic arc4 aes_generic deflate ecb cbc cryptomgr crypto_hash
crypto_blkcipher aead crypto_algapi button_hotplug gpio_buttons input_polldev
input_core leds_gpio
Process insmod (pid: 662, threadinfo=839d2000, task=839f8d68, tls=00000000)
Stack : 839d3b58 83007d90 00000000 839cb000 fffffff4 839cb000 830eff80 83002b9c
         839cb2dc 83003cac 00000000 00000001 00000000 839cb000 839cb2dc 839d3b90
         83002b4c 83000f6c 00000000 0000000d 00000001 83007de4 00000000 00000000
         00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
         00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
         ...
Call Trace:
[<80164df4>] ioread16+0x8/0x10
[<830026a0>] ssb_attr_sprom_show+0x44c/0x480 [ssb]


Code: 304200ff  38840002  94820000 <03e00008> 3042ffff  38840002  94820000
03e00008  3042ffff

I already tried to insert printk before and after ioread16 to have a delay. But
it already crashes at the first ioread16 in sprom_do_read.
I then tried ioread8 and ioread32 instead of ioread16 (which did not work in
IXP425).
But I cannot resolve it.

Gabor says that the pci controller of Atheros SoC has a hardware bug and nobody
knows exactly about it:
"The PCI Host Controller in the AR71xx SoCs has a hardware bug. At least everyone
says this, but (apart from the Atheros' engineers) nobody knows what is this bug
exactly."

Is it right, that the only way to get 4 minipci cards working is a x86 PC with a
big huge ATX power supply and a big case? I know of ALIX but I want something
small and cheap for driving bcm4306 cards ... :(

Thanks for any help,
Daniel




From chris at cvine.freeserve.co.uk  Tue Oct 20 23:56:14 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Tue, 20 Oct 2009 22:56:14 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADCDFD4.1000705@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
Message-ID: <20091020225614.51f07b43@laptop.homenet>

On Mon, 19 Oct 2009 16:53:24 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> This set of dmesg outputs was better; however, please set
> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
> Please post the full dmesg for warm and cold reboot.

For a warm boot it is:

cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
	(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
	(2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
	(5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
b43-phy0: Broadcom 4312 WLAN found (core revision 15)
b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
phy0: Selected rate control algorithm 'minstrel'
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
b43 ssb0:0: firmware: requesting b43/ucode15.fw
b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/33 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
wlan0: direct probe to AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: direct probe responded
wlan0: authenticate with AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: authenticated
wlan0: associate with AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: RX AssocResp from 00:08:5c:ca:dc:c3 (capab=0x411 status=0 aid=1)
wlan0: associated

For a cold boot it is:

cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
	(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
	(2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
	(5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
b43-phy0: Broadcom 4312 WLAN found (core revision 15)
b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
phy0: Selected rate control algorithm 'minstrel'
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
b43 ssb0:0: firmware: requesting b43/ucode15.fw
b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
b43-phy0 ERROR: Fatal DMA error: 0x00000800, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/22 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.


From peter at stuge.se  Wed Oct 21 01:03:33 2009
From: peter at stuge.se (Peter Stuge)
Date: Wed, 21 Oct 2009 01:03:33 +0200
Subject: ssb problem on ar71xx ubiquiti routerstation
In-Reply-To: <4ADDEC80.8050001@schmitt-united.de>
References: <4ADDEC80.8050001@schmitt-united.de>
Message-ID: <20091020230333.4646.qmail@stuge.se>

Daniel Schmitt wrote:
> Is it right, that the only way to get 4 minipci cards working is a
> x86 PC with a big huge ATX power supply and a big case? I know of
> ALIX but I want something small and cheap for driving bcm4306 cards
> ... :(

The ALIX is a pretty nice deal, some models run under 70 EUR.

It doesn't support 4 cards however..


//Peter


From _vi at list.ru  Wed Oct 21 02:50:52 2009
From: _vi at list.ru (_vi at list.ru)
Date: Wed, 21 Oct 2009 03:50:52 +0300
Subject: Poor hostapd work with newer driver
In-Reply-To: <4ADDB9EA.1010207@list.ru>
References: <4ADDB9EA.1010207@list.ru>
Message-ID: <4ADE5AEC.1070507@list.ru>

Additional information:

04:00.0 0280: 14e4:4311 (rev 01)
        Subsystem: 1468:0422
        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- 
ParErr- Stepping- SERR+ FastB2B- DisINTx-
        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- 
<TAbort- <MAbort- >SERR- <PERR- INTx-
        Latency: 0, Cache Line Size: 64 bytes
        Interrupt: pin A routed to IRQ 17
        Region 0: Memory at f8000000 (32-bit, non-prefetchable) [size=16K]
        Capabilities: [40] Power Management version 2
                Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=375mA 
PME(D0-,D1-,D2-,D3hot-,D3cold-)
                Status: D0 PME-Enable- DSel=0 DScale=2 PME-
        Capabilities: [58] Message Signalled Interrupts: Mask- 64bit- 
Queue=0/0 Enable-
                Address: 00000000  Data: 0000
        Capabilities: [d0] Express (v1) Legacy Endpoint, MSI 00
                DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s 
<4us, L1 unlimited
                        ExtTag+ AttnBtn- AttnInd- PwrInd- RBE- FLReset-
                DevCtl: Report errors: Correctable- Non-Fatal- Fatal- 
Unsupported-
                        RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop-
                        MaxPayload 128 bytes, MaxReadReq 128 bytes
                DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr+ 
TransPend-
                LnkCap: Port #0, Speed 2.5GT/s, Width x1, ASPM L0s, 
Latency L0 <4us, L1 <64us
                        ClockPM- Suprise- LLActRep- BwNot-
                LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- 
CommClk+
                        ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-
                LnkSta: Speed 2.5GT/s, Width x1, TrErr- Train- SlotClk+ 
DLActive- BWMgmt- ABWMgmt-
        Capabilities: [100] Advanced Error Reporting <?>
        Capabilities: [13c] Virtual Channel <?>
        Kernel driver in use: b43-pci-bridge
        Kernel modules: ssb

No encryption.

$ git log --pretty=oneline 320a4ec -- drivers/net/wireless/b43 | head -n 
20 # New, don't work well
12952a35b99c10fb2c1b9aa2777d5deafc6b3f8a Revert "Merge branch 'gc-linux' 
of git://zen-sources.org/zen/zen into master-testing"
6eb27b42cea3efe5c553c347c67a9ebc862a6c9f Revert "Merge branch 'gc-linux' 
into master-2.6.31"
cbc7796b1dca47192b95b667c208627440b4c44f b43: use PIO instead of DMA for 
SDIO devices
fe066228b79f6a888b4ffe7391611e7290952ede b43: fix compilation error when 
CONFIG_B43_SDIO is disabled
e8b1516fbb6988a49889710b683fd8e369a10f44 b43: B43_SDIO should select 
SB_SDIOHOST and depend on SSB_SDIOHOST_POSSIBLE
2f74cccda1098bd2f74c1a6ff02158c2f5fb2696 b43: fix merge errors
39237140cbe0c77607b0e1dd83bba95edc145cc1 b43: add support for sdio based 
cards
b8f2f491c0bfc6edb134247e6f7934529c167b36 b43: remove wrong 
probe_resp_plcp write
0e5b77bfb27aa749bb14d143ecb275a397571494 b43: Fix unaligned 32bit 
SHM-shared access
cff782cd94df7adea84af6aa9516c8088f7ea950 b43: Add support for 4318E
fd4973c56f8d9baac8d269791a90e5119ce30a0e b43/b43legacy: fix radio LED 
initialization
403a3a136122457165321e90b7569a321cc9ac12 b43: Add fw capabilities
f41f3f373dd72344c65d801d6381fe83ef3a2c54 b43/legacy: port to cfg80211 rfkill
b52a033c2c501a8015df3727a4bd73389ccb1641 b43: Fix possible unaligned u32 
access
19d337dff95cbf76edd3ad95c0cee2732c3e1ec5 rfkill: rewrite
e31a16d6f64ef0e324c6f54d5112703c3f13a9c4 wireless: move some utility 
functions from mac80211 to cfg80211
3f0d843b5c94be824c2027f01348f360958e5542 b43/legacy: fix beacon change 
processing
2d0ddec5b2b859f06116f631fc0ffe94fbceb556 mac80211: unify 
config_interface and bss_info_changed
57c4d7b4c4986037be51476b8e3025d5ba18d8b8 mac80211: clean up beacon 
interval settings
137907287789607f2a2586ad625e7b8c646b3425 b43: Remove unnecessary MMIO in 
interrupt hotpath

$ git log --pretty=oneline c7099db -- drivers/net/wireless/b43 | head -n 
20 # Old, works well
3850d27fcd35906bdc25139388593c8587657dc9 Revert "Merge branch 'master' 
of git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-testing"
ebfea807f9dacff6e67f46f662a630ee6c6ecca8 b43: Add fw capabilities
9227bc5114139cc0b2269407f7c87bd48408f0fd b43/legacy: port to cfg80211 rfkill
d40c73599578b42a7c2a8aff96b853204a4a0633 b43: Fix possible unaligned u32 
access
83fd92f9bc04fbfc3cd6fd307f57b787b0dc089c rfkill: rewrite
d037736a02b68e3bad31db0af26b4b5178f20e57 wireless: move some utility 
functions from mac80211 to cfg80211
826d42c88aec8cd2193a4de88a67dda6de4deb77 b43/legacy: fix beacon change 
processing
f8b34c4c5947edf5ac1e22b6fb46b580f226f83c mac80211: unify 
config_interface and bss_info_changed
655c9528afe597ef7a885d4d9b809e5c1e26222e mac80211: clean up beacon 
interval settings
e352b93739f7532bb9cea7e720d468723b9521c0 b43: Remove unnecessary MMIO in 
interrupt hotpath
c5fd13165771d179377cbb4abfc662c6db3cf399 b43: Do not "select" HW_RANDOM
4b386e7b098bbf70c2c2d343c54e2a3f87620311 rfkill: remove user_claim stuff
b25cce469689730ca750947e2c91283bc8468343 Revert "rfkill: remove 
user_claim stuff"
7ed6bfade6dc9a458bd06a3ae6a04f4e80b4576d Revert "b43: Do not "select" 
HW_RANDOM"
cbb21139a2d431f36206e4105c3ccb452185e72d Revert "b43: Remove unnecessary 
MMIO in interrupt hotpath"
7ebc1056704c23d0d8b22d1cc27ac26e9626d3e0 Revert "mac80211: clean up 
beacon interval settings"
b06e49b4bdac9394ffeb5764f6cd7e79e70cab71 Revert "mac80211: unify 
config_interface and bss_info_changed"
d7385e27d2f65bf921eaa3fc4182b01497533779 Revert "b43/legacy: fix beacon 
change processing"
e62b401e9d4935dfd3324e310ef8938f7b0cefc5 Revert "wireless: move some 
utility functions from mac80211 to cfg80211"
5f7a4cc97a975e48e5f30d47cb62dcf9d82ad067 Revert "rfkill: rewrite"


_vi at list.ru wrote:
> 2.6.30-zen2-31270-gc7099db-dirty - works well.
> 2.6.31-zen3-07782-g320a4ec - hostapd works bad, especially with 
> multiple clients.
> earlier 2.6.31 also works bad.
>
> Client mode works OK with newer kernels.
>
> Should I prepare and send additional information or try to bisect the 
> problem?
>    (It is not easy because of when my hostapd is used to provide 
> connection for multiple clients, experiments are discouraged).
>



From Larry.Finger at lwfinger.net  Wed Oct 21 21:30:49 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 21 Oct 2009 14:30:49 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091020225614.51f07b43@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
Message-ID: <4ADF6169.70608@lwfinger.net>

On 10/20/2009 04:56 PM, Chris Vine wrote:
> On Mon, 19 Oct 2009 16:53:24 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>> This set of dmesg outputs was better; however, please set
>> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
>> Please post the full dmesg for warm and cold reboot.

Thanks for the output. Unfortunately, it all looks normal.

On auditing the  DMA code for b43, I re-discovered a work-around that
was necessary for the first card that had 64-bit DMA, namely a 4311/2.
The fix for that is not needed for the 4315 card. Please apply the
attached patch (b43_change_dma_flags) to see if it fixes the problem.

If this patch does not fix the problem, I am working on a second to
try to do further debugging.

Larry
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: b43_change_dma_flags
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091021/84b319ed/attachment.ksh>

From chris at cvine.freeserve.co.uk  Wed Oct 21 23:16:12 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Wed, 21 Oct 2009 22:16:12 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADF6169.70608@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
Message-ID: <20091021221612.5133db1b@laptop.homenet>

On Wed, 21 Oct 2009 14:30:49 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> On 10/20/2009 04:56 PM, Chris Vine wrote:
> > On Mon, 19 Oct 2009 16:53:24 -0500
> > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> >> This set of dmesg outputs was better; however, please set
> >> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
> >> Please post the full dmesg for warm and cold reboot.
> 
> Thanks for the output. Unfortunately, it all looks normal.
> 
> On auditing the  DMA code for b43, I re-discovered a work-around that
> was necessary for the first card that had 64-bit DMA, namely a 4311/2.
> The fix for that is not needed for the 4315 card. Please apply the
> attached patch (b43_change_dma_flags) to see if it fixes the problem.
> 
> If this patch does not fix the problem, I am working on a second to
> try to do further debugging.

Hi,

It doesn't fix it, I'm afraid.

Chris


From Larry.Finger at lwfinger.net  Thu Oct 22 01:05:31 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 21 Oct 2009 18:05:31 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091021221612.5133db1b@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>	<20091020225614.51f07b43@laptop.homenet>	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
Message-ID: <4ADF93BB.5050200@lwfinger.net>

On 10/21/2009 04:16 PM, Chris Vine wrote:
> On Wed, 21 Oct 2009 14:30:49 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>> On 10/20/2009 04:56 PM, Chris Vine wrote:
>>> On Mon, 19 Oct 2009 16:53:24 -0500
>>> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>>>> This set of dmesg outputs was better; however, please set
>>>> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
>>>> Please post the full dmesg for warm and cold reboot.
>>
>> Thanks for the output. Unfortunately, it all looks normal.
>>
>> On auditing the  DMA code for b43, I re-discovered a work-around that
>> was necessary for the first card that had 64-bit DMA, namely a 4311/2.
>> The fix for that is not needed for the 4315 card. Please apply the
>> attached patch (b43_change_dma_flags) to see if it fixes the problem.
>>
>> If this patch does not fix the problem, I am working on a second to
>> try to do further debugging.
> 
> Hi,
> 
> It doesn't fix it, I'm afraid.

Then try this patch without the previous one. It will generate some
warnings but they are harmless.

Larry
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: b43_debug_dma
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091021/8237a649/attachment.ksh>

From chris at cvine.freeserve.co.uk  Thu Oct 22 02:12:37 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Thu, 22 Oct 2009 01:12:37 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADF93BB.5050200@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
Message-ID: <20091022011237.4e38680e@laptop.homenet>

On Wed, 21 Oct 2009 18:05:31 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> Then try this patch without the previous one. It will generate some
> warnings but they are harmless.

Working warm boot:

----------------------------------------------------

cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
	(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
	(2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
	(5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
b43-phy0: Broadcom 4312 WLAN found (core revision 15)
b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
phy0: Selected rate control algorithm 'minstrel'
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
b43 ssb0:0: firmware: requesting b43/ucode15.fw
b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
b43-phy0 debug: Chip initialized
b43-phy0 debug: DMA ringmemory location: 0x309CD000
b43-phy0 debug: DMA ringmemory location: 0x30AC3000
b43-phy0 debug: DMA ringmemory location: 0x30A42000
b43-phy0 debug: DMA ringmemory location: 0x30AB7000
b43-phy0 debug: DMA ringmemory location: 0x30AB3000
b43-phy0 debug: DMA ringmemory location: 0x309DE000
b43-phy0 debug: DMA Address in map_descbuffer: 0x30ACD020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30ACE020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30ACF020
b43-phy0 debug: DMA Address in map_descbuffer: 0x36503020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A80020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A81020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A82020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A83020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A84020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30A85020
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/44 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: DMA ringmemory location: 0x2E81A000
b43-phy0 debug: DMA ringmemory location: 0x30A3A000
b43-phy0 debug: DMA ringmemory location: 0x309F8000
b43-phy0 debug: DMA ringmemory location: 0x309BC000
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
wlan0: direct probe to AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: direct probe responded
wlan0: authenticate with AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: authenticated
wlan0: associate with AP 00:08:5c:ca:dc:c3 (try 1)
wlan0: RX AssocResp from 00:08:5c:ca:dc:c3 (capab=0x411 status=0 aid=1)
wlan0: associated

----------------------------------------------------

Cold boot:

----------------------------------------------------

cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
	(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
	(2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
	(5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
	(5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
b43-phy0: Broadcom 4312 WLAN found (core revision 15)
b43-phy0 debug: Found PHY: Analog 6, Type 5, Revision 1
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
phy0: Selected rate control algorithm 'minstrel'
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
Broadcom 43xx driver loaded [ Features: PMLS, Firmware-ID: FW13 ]
b43 ssb0:0: firmware: requesting b43/ucode15.fw
b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
b43-phy0 debug: Chip initialized
b43-phy0 debug: DMA ringmemory location: 0x30AA2000
b43-phy0 debug: DMA ringmemory location: 0x30AD9000
b43-phy0 debug: DMA ringmemory location: 0x309BE000
b43-phy0 debug: DMA ringmemory location: 0x30A06000
b43-phy0 debug: DMA ringmemory location: 0x30A27000
b43-phy0 debug: DMA ringmemory location: 0x30A29000
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE2020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE3020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE4020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE5020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE6020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AE7020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AF0020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AF1020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AF2020
b43-phy0 debug: DMA Address in map_descbuffer: 0x30AF3020
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
b43-phy0 ERROR: Fatal DMA error: 0x00000800, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/6 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: DMA ringmemory location: 0x30A0E000
b43-phy0 debug: DMA ringmemory location: 0x30AB7000
b43-phy0 debug: DMA ringmemory location: 0x30AB6000
b43-phy0 debug: DMA ringmemory location: 0x30A05000
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 2/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
b43-phy0 debug: Chip initialized
b43-phy0 debug: 64-bit DMA initialized
b43-phy0 debug: QoS enabled
b43-phy0 debug: Wireless interface started
b43-phy0: Controller restarted
b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
b43-phy0: Controller RESET (DMA error) ...
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.

----------------------------------------------------


From mb at bu3sch.de  Thu Oct 22 16:10:37 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 22 Oct 2009 16:10:37 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4ADF93BB.5050200@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
Message-ID: <200910221610.40388.mb@bu3sch.de>

On Thursday 22 October 2009 01:05:31 Larry Finger wrote:
> On 10/21/2009 04:16 PM, Chris Vine wrote:
> > On Wed, 21 Oct 2009 14:30:49 -0500
> > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> >> On 10/20/2009 04:56 PM, Chris Vine wrote:
> >>> On Mon, 19 Oct 2009 16:53:24 -0500
> >>> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> >>>> This set of dmesg outputs was better; however, please set
> >>>> CONFIG_B43_DEBUG=y in your configuration and rebuild the kernel.
> >>>> Please post the full dmesg for warm and cold reboot.
> >>
> >> Thanks for the output. Unfortunately, it all looks normal.
> >>
> >> On auditing the  DMA code for b43, I re-discovered a work-around that
> >> was necessary for the first card that had 64-bit DMA, namely a 4311/2.
> >> The fix for that is not needed for the 4315 card. Please apply the
> >> attached patch (b43_change_dma_flags) to see if it fixes the problem.
> >>
> >> If this patch does not fix the problem, I am working on a second to
> >> try to do further debugging.
> > 
> > Hi,
> > 
> > It doesn't fix it, I'm afraid.
> 
> Then try this patch without the previous one. It will generate some
> warnings but they are harmless.
> 
> Larry
> 

This only prints the lower 32bits of the DMA mapping, so I think it's not that useful
for debugging without doing bad assumptions.

-- 
Greetings, Michael.


From Larry.Finger at lwfinger.net  Fri Oct 23 00:06:53 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 22 Oct 2009 17:06:53 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091022011237.4e38680e@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>	<20091020225614.51f07b43@laptop.homenet>	<4ADF6169.70608@lwfinger.net>	<20091021221612.5133db1b@laptop.homenet>	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
Message-ID: <4AE0D77D.5060209@lwfinger.net>

Chris,

Michael was right in that my previous debug messages were badly setup.
Please try the attached patch as a replacement for the previous one.
It will look at the data that is pushed into the DMA descriptors.

I also reviewed the thread. Have you tried acpi=off and apic=off?

Thanks,

Larry

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: b43_debug_dma
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091022/e1591182/attachment.ksh>

From chris at cvine.freeserve.co.uk  Fri Oct 23 00:46:38 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Thu, 22 Oct 2009 23:46:38 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4AE0D77D.5060209@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
Message-ID: <20091022234638.7f6025e0@laptop.homenet>

On Thu, 22 Oct 2009 17:06:53 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Chris,
> 
> Michael was right in that my previous debug messages were badly setup.
> Please try the attached patch as a replacement for the previous one.
> It will look at the data that is pushed into the DMA descriptors.
> 
> I also reviewed the thread. Have you tried acpi=off and apic=off?

No, I hadn't.  But on doing so, booting with acpi=off makes b43 work
correctly.

In the light of this, do you want me to continue with this debugging? I
have to say though that I would be very reluctant to run my netbook
without ACPI: amongst other things, the power, lid and thermal events
won't work.  If this is not resolvable with b43, I think I would
probably have to go with the wl driver.

Chris



From illth at gmx.de  Fri Oct 23 00:49:31 2009
From: illth at gmx.de (Thomas Ilnseher)
Date: Fri, 23 Oct 2009 00:49:31 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4AE0D77D.5060209@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
Message-ID: <1256251771.4438.6.camel@luzifer.localnet>

On Do, 2009-10-22 at 17:06 -0500, Larry Finger wrote:
> +       static int count;
count is declared, and incremented, but never set to 0. I guess this
will work anyway, because it might be magically cleared to 0 by defining
it (it is static, and will probably be allocated to some place that is
zeroed before), but I'd find it much cleaner if this was declared like
static int count = 0;

>  
>         slot = (int)(&(desc->dma64) - descbase);
>         B43_WARN_ON(!(slot >= 0 && slot < ring->nr_slots));
> @@ -190,6 +191,10 @@ static void op64_fill_descriptor(struct
>         desc->dma64.control1 = cpu_to_le32(ctl1);
>         desc->dma64.address_low = cpu_to_le32(addrlo);
>         desc->dma64.address_high = cpu_to_le32(addrhi);
> +       if (count++ < 10)
> +               b43dbg(ring->dev->wl, "cntrl0, cntrl1, addrlo, addrhi: 0x%X 0x%X"
> +                      " 0x%X 0x%X\n", desc->dma64.control0, desc->dma64.control1,
> +                      desc->dma64.address_low, desc->dma64.address_high);
>  }



From Larry.Finger at lwfinger.net  Fri Oct 23 00:55:55 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 22 Oct 2009 17:55:55 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091022234638.7f6025e0@laptop.homenet>
References: <20091016130329.3dd0b1a9@boulder.homenet>	<200910191213.01444.mb@bu3sch.de>	<20091019115850.6b9d249b@laptop.homenet>	<200910190812.38017.gene.heskett@verizon.net>	<4ADC7804.80301@lwfinger.net>	<20091019190029.47d6b329@laptop.homenet>	<4ADCDFD4.1000705@lwfinger.net>	<20091020225614.51f07b43@laptop.homenet>	<4ADF6169.70608@lwfinger.net>	<20091021221612.5133db1b@laptop.homenet>	<4ADF93BB.5050200@lwfinger.net>	<20091022011237.4e38680e@laptop.homenet>	<4AE0D77D.5060209@lwfinger.net>
	<20091022234638.7f6025e0@laptop.homenet>
Message-ID: <4AE0E2FB.4040506@lwfinger.net>

On 10/22/2009 05:46 PM, Chris Vine wrote:
> 
> No, I hadn't.  But on doing so, booting with acpi=off makes b43 work
> correctly.
> 
> In the light of this, do you want me to continue with this debugging? I
> have to say though that I would be very reluctant to run my netbook
> without ACPI: amongst other things, the power, lid and thermal events
> won't work.  If this is not resolvable with b43, I think I would
> probably have to go with the wl driver.

No, do not bother with the most-recent patch. The problem is not with
b43, but with ACPI. The debugging will need to be done by that set of
devs. If you want to forgo that debug step and switch to wl, then do
so. Of course, you will never know when the ACPI bug will hit you
again, and what the problem will be.

Larry


From chris at cvine.freeserve.co.uk  Fri Oct 23 01:03:00 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Fri, 23 Oct 2009 00:03:00 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4AE0E2FB.4040506@lwfinger.net>
References: <20091016130329.3dd0b1a9@boulder.homenet>
	<200910191213.01444.mb@bu3sch.de>
	<20091019115850.6b9d249b@laptop.homenet>
	<200910190812.38017.gene.heskett@verizon.net>
	<4ADC7804.80301@lwfinger.net>
	<20091019190029.47d6b329@laptop.homenet>
	<4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
	<20091022234638.7f6025e0@laptop.homenet>
	<4AE0E2FB.4040506@lwfinger.net>
Message-ID: <20091023000300.753a3eba@laptop.homenet>

On Thu, 22 Oct 2009 17:55:55 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> On 10/22/2009 05:46 PM, Chris Vine wrote:
> > 
> > No, I hadn't.  But on doing so, booting with acpi=off makes b43 work
> > correctly.
> > 
> > In the light of this, do you want me to continue with this
> > debugging? I have to say though that I would be very reluctant to
> > run my netbook without ACPI: amongst other things, the power, lid
> > and thermal events won't work.  If this is not resolvable with b43,
> > I think I would probably have to go with the wl driver.
> 
> No, do not bother with the most-recent patch. The problem is not with
> b43, but with ACPI. The debugging will need to be done by that set of
> devs. If you want to forgo that debug step and switch to wl, then do
> so. Of course, you will never know when the ACPI bug will hit you
> again, and what the problem will be.

OK.  I may try blacklisting different ACPI modules and see if I can
identify which one is causing the problem.  If I find out I will report
back because a number of other people seem to be suffering the same
problem.

Thanks for your help.

Chris


From peter at stuge.se  Fri Oct 23 06:25:33 2009
From: peter at stuge.se (Peter Stuge)
Date: Fri, 23 Oct 2009 06:25:33 +0200
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091023000300.753a3eba@laptop.homenet>
References: <4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
	<20091022234638.7f6025e0@laptop.homenet>
	<4AE0E2FB.4040506@lwfinger.net>
	<20091023000300.753a3eba@laptop.homenet>
Message-ID: <20091023042533.28589.qmail@stuge.se>

Chris Vine wrote:
> > The problem is not with b43, but with ACPI. The debugging will
> > need to be done by that set of devs.
> 
> OK.  I may try blacklisting different ACPI modules and see if I can
> identify which one is causing the problem.

I'd suggest to go directly to the ACPI mailing list, do not pass go.
:) They will want you to do more, and other, testing in order to
track down the problem.


//Peter


From chris at cvine.freeserve.co.uk  Fri Oct 23 12:46:18 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Fri, 23 Oct 2009 11:46:18 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091023042533.28589.qmail@stuge.se>
References: <4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
	<20091022234638.7f6025e0@laptop.homenet>
	<4AE0E2FB.4040506@lwfinger.net>
	<20091023000300.753a3eba@laptop.homenet>
	<20091023042533.28589.qmail@stuge.se>
Message-ID: <20091023114618.47e0d19d@laptop.homenet>

On Fri, 23 Oct 2009 06:25:33 +0200
Peter Stuge <peter at stuge.se> wrote:
> 
> Chris Vine wrote:
> > > The problem is not with b43, but with ACPI. The debugging will
> > > need to be done by that set of devs.
> > 
> > OK.  I may try blacklisting different ACPI modules and see if I can
> > identify which one is causing the problem.
> 
> I'd suggest to go directly to the ACPI mailing list, do not pass go.
> :) They will want you to do more, and other, testing in order to
> track down the problem.

I will probably do that (maybe), but nonetheless I have identified the
offending ACPI module.  If I blacklist the 'processor' module then b43
works.  I strongly suspect that kernel ACPI does not at present deal
correctly with Atom N270 idle states.

As a side note, with kernel 2.6.32 the 'thermal' module is not dependent
(so far as loading is concerned) on the 'processor' module and is not
troublesome, although I am not certain it actually does anything (cpu
temperatures and operation of the fan seems to be controlled by the
BIOS on my machine): nonetheless I install 'thermal' out of
superstition.

Anyway, that appears to be a temporary fix until any ACPI bugs are
sorted out.

Chris


From Larry.Finger at lwfinger.net  Fri Oct 23 15:48:38 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 23 Oct 2009 08:48:38 -0500
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <20091023114618.47e0d19d@laptop.homenet>
References: <4ADCDFD4.1000705@lwfinger.net>	<20091020225614.51f07b43@laptop.homenet>	<4ADF6169.70608@lwfinger.net>	<20091021221612.5133db1b@laptop.homenet>	<4ADF93BB.5050200@lwfinger.net>	<20091022011237.4e38680e@laptop.homenet>	<4AE0D77D.5060209@lwfinger.net>	<20091022234638.7f6025e0@laptop.homenet>	<4AE0E2FB.4040506@lwfinger.net>	<20091023000300.753a3eba@laptop.homenet>	<20091023042533.28589.qmail@stuge.se>
	<20091023114618.47e0d19d@laptop.homenet>
Message-ID: <4AE1B436.5000502@lwfinger.net>

On 10/23/2009 05:46 AM, Chris Vine wrote:

> I will probably do that (maybe), but nonetheless I have identified the
> offending ACPI module.  If I blacklist the 'processor' module then b43
> works.  I strongly suspect that kernel ACPI does not at present deal
> correctly with Atom N270 idle states.

Good find. Please file a bugzilla for this problem.

Larry


From chris at cvine.freeserve.co.uk  Sat Oct 24 12:34:18 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sat, 24 Oct 2009 11:34:18 +0100
Subject: b43/BCM4312 fails with DMA errors
In-Reply-To: <4AE1B436.5000502@lwfinger.net>
References: <4ADCDFD4.1000705@lwfinger.net>
	<20091020225614.51f07b43@laptop.homenet>
	<4ADF6169.70608@lwfinger.net>
	<20091021221612.5133db1b@laptop.homenet>
	<4ADF93BB.5050200@lwfinger.net>
	<20091022011237.4e38680e@laptop.homenet>
	<4AE0D77D.5060209@lwfinger.net>
	<20091022234638.7f6025e0@laptop.homenet>
	<4AE0E2FB.4040506@lwfinger.net>
	<20091023000300.753a3eba@laptop.homenet>
	<20091023042533.28589.qmail@stuge.se>
	<20091023114618.47e0d19d@laptop.homenet>
	<4AE1B436.5000502@lwfinger.net>
Message-ID: <20091024113418.173bb834@laptop.homenet>

On Fri, 23 Oct 2009 08:48:38 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:
> On 10/23/2009 05:46 AM, Chris Vine wrote:
> 
> > I will probably do that (maybe), but nonetheless I have identified
> > the offending ACPI module.  If I blacklist the 'processor' module
> > then b43 works.  I strongly suspect that kernel ACPI does not at
> > present deal correctly with Atom N270 idle states.
> 
> Good find. Please file a bugzilla for this problem.

I'll send an e-mail to the linux-apci mailing list (probably tomorrow
or Monday), and following that if still needed I'll file a
kernel bugzilla item.

Chris


From netrolller.3d at gmail.com  Sun Oct 25 16:22:53 2009
From: netrolller.3d at gmail.com (=?UTF-8?q?G=C3=A1bor=20Stefanik?=)
Date: Sun, 25 Oct 2009 16:22:53 +0100
Subject: [PATCH] b43: LP-PHY: Begin implementing calibration & software RFKILL
	support
Message-ID: <1256484173-30378-1-git-send-email-netrolller.3d@gmail.com>

This implements the following calibration functions:
-Set TX IQCC
-Set TX Power by Index
-PR41573 workaround (incomplete, needs PHY reset)
-Calc RX IQ Comp
-PHY Cordic
-Run Samples
-Start/Stop TX Tone
-part of PAPD Cal TX Power
-RX I/Q Calibration
-The basic structure of the periodic calibration wrapper

Software RFKILL (required by calibration) is also implemented in
this round.

Signed-off-by: G?bor Stefanik <netrolller.3d at gmail.com>
---
Michael, could you please do the PHY reset part? I can't seem to
understand its relationship to wireless_core_reset... also, it's
heavily ssb-speak, which I am not good at.

 drivers/net/wireless/b43/phy_lp.c |  783 ++++++++++++++++++++++++++++++-------
 drivers/net/wireless/b43/phy_lp.h |   11 +-
 2 files changed, 658 insertions(+), 136 deletions(-)

diff --git a/drivers/net/wireless/b43/phy_lp.c b/drivers/net/wireless/b43/phy_lp.c
index 07d9d03..9dcb39c 100644
--- a/drivers/net/wireless/b43/phy_lp.c
+++ b/drivers/net/wireless/b43/phy_lp.c
@@ -67,6 +67,7 @@ static void b43_lpphy_op_prepare_structs(struct b43_wldev *dev)
 	struct b43_phy_lp *lpphy = phy->lp;
 
 	memset(lpphy, 0, sizeof(*lpphy));
+	lpphy->antenna = B43_ANTENNA_DEFAULT;
 
 	//TODO
 }
@@ -379,8 +380,6 @@ static void lpphy_save_dig_flt_state(struct b43_wldev *dev)
 	}
 }
 
-/* lpphy_restore_dig_flt_state is unused but kept as a reference */
-#if 0
 static void lpphy_restore_dig_flt_state(struct b43_wldev *dev)
 {
 	static const u16 addr[] = {
@@ -401,7 +400,6 @@ static void lpphy_restore_dig_flt_state(struct b43_wldev *dev)
 	for (i = 0; i < ARRAY_SIZE(addr); i++)
 		b43_phy_write(dev, addr[i], lpphy->dig_flt_state[i]);
 }
-#endif
 
 static void lpphy_baseband_rev2plus_init(struct b43_wldev *dev)
 {
@@ -754,11 +752,17 @@ static void lpphy_clear_deaf(struct b43_wldev *dev, bool user)
 	}
 }
 
+static void lpphy_set_trsw_over(struct b43_wldev *dev, bool tx, bool rx)
+{
+	u16 trsw = (tx << 1) | rx;
+	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, trsw);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+}
+
 static void lpphy_disable_crs(struct b43_wldev *dev, bool user)
 {
 	lpphy_set_deaf(dev, user);
-	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, 0x1);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+	lpphy_set_trsw_over(dev, false, true);
 	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFB);
 	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x4);
 	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFF7);
@@ -793,6 +797,60 @@ static void lpphy_restore_crs(struct b43_wldev *dev, bool user)
 
 struct lpphy_tx_gains { u16 gm, pga, pad, dac; };
 
+static void lpphy_disable_rx_gain_override(struct b43_wldev *dev)
+{
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFEF);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFBF);
+	if (dev->phy.rev >= 2) {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
+		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFBFF);
+			b43_phy_mask(dev, B43_PHY_OFDM(0xE5), 0xFFF7);
+		}
+	} else {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFDFF);
+	}
+}
+
+static void lpphy_enable_rx_gain_override(struct b43_wldev *dev)
+{
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x10);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x40);
+	if (dev->phy.rev >= 2) {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
+		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x400);
+			b43_phy_set(dev, B43_PHY_OFDM(0xE5), 0x8);
+		}
+	} else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x200);
+	}
+}
+
+static void lpphy_disable_tx_gain_override(struct b43_wldev *dev)
+{
+	if (dev->phy.rev < 2)
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
+	else {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFF7F);
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xBFFF);
+	}
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFBF);
+}
+
+static void lpphy_enable_tx_gain_override(struct b43_wldev *dev)
+{
+	if (dev->phy.rev < 2)
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
+	else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x80);
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x4000);
+	}
+	b43_phy_set(dev, B43_LPPHY_AFE_CTL_OVR, 0x40);
+}
+
 static struct lpphy_tx_gains lpphy_get_tx_gains(struct b43_wldev *dev)
 {
 	struct lpphy_tx_gains gains;
@@ -822,6 +880,17 @@ static void lpphy_set_dac_gain(struct b43_wldev *dev, u16 dac)
 	b43_phy_maskset(dev, B43_LPPHY_AFE_DAC_CTL, 0xF000, ctl);
 }
 
+static u16 lpphy_get_pa_gain(struct b43_wldev *dev)
+{
+	return b43_phy_read(dev, B43_PHY_OFDM(0xFB)) & 0x7F;
+}
+
+static void lpphy_set_pa_gain(struct b43_wldev *dev, u16 gain)
+{
+	b43_phy_maskset(dev, B43_PHY_OFDM(0xFB), 0xE03F, gain << 6);
+	b43_phy_maskset(dev, B43_PHY_OFDM(0xFD), 0x80FF, gain << 8);
+}
+
 static void lpphy_set_tx_gains(struct b43_wldev *dev,
 			       struct lpphy_tx_gains gains)
 {
@@ -832,25 +901,22 @@ static void lpphy_set_tx_gains(struct b43_wldev *dev,
 		b43_phy_maskset(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
 				0xF800, rf_gain);
 	} else {
-		pa_gain = b43_phy_read(dev, B43_PHY_OFDM(0xFB)) & 0x1FC0;
-		pa_gain <<= 2;
+		pa_gain = lpphy_get_pa_gain(dev);
 		b43_phy_write(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
 			      (gains.pga << 8) | gains.gm);
+		/*
+		 * SPEC FIXME The spec calls for (pa_gain << 8) here, but that
+		 * conflicts with the spec for set_pa_gain! Vendor driver bug?
+		 */
 		b43_phy_maskset(dev, B43_PHY_OFDM(0xFB),
-				0x8000, gains.pad | pa_gain);
+				0x8000, gains.pad | (pa_gain << 6));
 		b43_phy_write(dev, B43_PHY_OFDM(0xFC),
 			      (gains.pga << 8) | gains.gm);
 		b43_phy_maskset(dev, B43_PHY_OFDM(0xFD),
-				0x8000, gains.pad | pa_gain);
+				0x8000, gains.pad | (pa_gain << 8));
 	}
 	lpphy_set_dac_gain(dev, gains.dac);
-	if (dev->phy.rev < 2) {
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF, 1 << 8);
-	} else {
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFF7F, 1 << 7);
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xBFFF, 1 << 14);
-	}
-	b43_phy_maskset(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFBF, 1 << 6);
+	lpphy_enable_tx_gain_override(dev);
 }
 
 static void lpphy_rev0_1_set_rx_gain(struct b43_wldev *dev, u32 gain)
@@ -890,41 +956,6 @@ static void lpphy_rev2plus_set_rx_gain(struct b43_wldev *dev, u32 gain)
 	}
 }
 
-/* lpphy_disable_rx_gain_override is unused but kept as a reference */
-#if 0
-static void lpphy_disable_rx_gain_override(struct b43_wldev *dev)
-{
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFE);
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFEF);
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFBF);
-	if (dev->phy.rev >= 2) {
-		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
-		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
-			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFBFF);
-			b43_phy_mask(dev, B43_PHY_OFDM(0xE5), 0xFFF7);
-		}
-	} else {
-		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFDFF);
-	}
-}
-#endif
-
-static void lpphy_enable_rx_gain_override(struct b43_wldev *dev)
-{
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x10);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x40);
-	if (dev->phy.rev >= 2) {
-		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
-		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
-			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x400);
-			b43_phy_set(dev, B43_PHY_OFDM(0xE5), 0x8);
-		}
-	} else {
-		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x200);
-	}
-}
-
 static void lpphy_set_rx_gain(struct b43_wldev *dev, u32 gain)
 {
 	if (dev->phy.rev < 2)
@@ -1009,8 +1040,7 @@ static int lpphy_loopback(struct b43_wldev *dev)
 
 	memset(&iq_est, 0, sizeof(iq_est));
 
-	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, 0x3);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+	lpphy_set_trsw_over(dev, true, true);
 	b43_phy_set(dev, B43_LPPHY_AFE_CTL_OVR, 1);
 	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xFFFE);
 	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x800);
@@ -1132,7 +1162,7 @@ static void lpphy_set_tx_power_control(struct b43_wldev *dev,
 			b43_phy_maskset(dev, B43_LPPHY_TX_PWR_CTL_NNUM,
 					0x8FFF, ((u16)lpphy->tssi_npt << 16));
 			//TODO Set "TSSI Transmit Count" variable to total transmitted frame count
-			//TODO Disable TX gain override
+			lpphy_disable_tx_gain_override(dev);
 			lpphy->tx_pwr_idx_over = -1;
 		}
 	}
@@ -1318,15 +1348,73 @@ static void lpphy_calibrate_rc(struct b43_wldev *dev)
 	}
 }
 
+static void b43_lpphy_op_set_rx_antenna(struct b43_wldev *dev, int antenna)
+{
+	if (dev->phy.rev >= 2)
+		return; // rev2+ doesn't support antenna diversity
+
+	if (B43_WARN_ON(antenna > B43_ANTENNA_AUTO1))
+		return;
+
+	b43_hf_write(dev, b43_hf_read(dev) & ~B43_HF_ANTDIVHELP);
+
+	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFD, antenna & 0x2);
+	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFE, antenna & 0x1);
+
+	b43_hf_write(dev, b43_hf_read(dev) | B43_HF_ANTDIVHELP);
+
+	dev->phy.lp->antenna = antenna;
+}
+
+static void lpphy_set_tx_iqcc(struct b43_wldev *dev, u16 a, u16 b)
+{
+	u16 tmp[2];
+
+	tmp[0] = a;
+	tmp[1] = b;
+	b43_lptab_write_bulk(dev, B43_LPTAB16(0, 80), 2, tmp);
+}
+
 static void lpphy_set_tx_power_by_index(struct b43_wldev *dev, u8 index)
 {
 	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct lpphy_tx_gains gains;
+	u32 iq_comp, tx_gain, coeff, rf_power;
 
 	lpphy->tx_pwr_idx_over = index;
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
 	if (lpphy->txpctl_mode != B43_LPPHY_TXPCTL_OFF)
 		lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_SW);
-
-	//TODO
+	if (dev->phy.rev >= 2) {
+		iq_comp = b43_lptab_read(dev, B43_LPTAB32(7, index + 320));
+		tx_gain = b43_lptab_read(dev, B43_LPTAB32(7, index + 192));
+		gains.pad = (tx_gain >> 16) & 0xFF;
+		gains.gm = tx_gain & 0xFF;
+		gains.pga = (tx_gain >> 8) & 0xFF;
+		gains.dac = (iq_comp >> 28) & 0xFF;
+		lpphy_set_tx_gains(dev, gains);
+	} else {
+		iq_comp = b43_lptab_read(dev, B43_LPTAB32(10, index + 320));
+		tx_gain = b43_lptab_read(dev, B43_LPTAB32(10, index + 192));
+		b43_phy_maskset(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
+				0xF800, (tx_gain >> 4) & 0x7FFF);
+		lpphy_set_dac_gain(dev, tx_gain & 0x7);
+		lpphy_set_pa_gain(dev, (tx_gain >> 24) & 0x7F);
+	}
+	lpphy_set_bb_mult(dev, (iq_comp >> 20) & 0xFF);
+	lpphy_set_tx_iqcc(dev, (iq_comp >> 10) & 0x3FF, iq_comp & 0x3FF);
+	if (dev->phy.rev >= 2) {
+		coeff = b43_lptab_read(dev, B43_LPTAB32(7, index + 448));
+	} else {
+		coeff = b43_lptab_read(dev, B43_LPTAB32(10, index + 448));
+	}
+	b43_lptab_write(dev, B43_LPTAB16(0, 85), coeff & 0xFFFF);
+	if (dev->phy.rev >= 2) {
+		rf_power = b43_lptab_read(dev, B43_LPTAB32(7, index + 576));
+		b43_phy_maskset(dev, B43_LPPHY_RF_PWR_OVERRIDE, 0xFF00,
+				rf_power & 0xFFFF);//SPEC FIXME mask & set != 0
+	}
+	lpphy_enable_tx_gain_override(dev);
 }
 
 static void lpphy_btcoex_override(struct b43_wldev *dev)
@@ -1335,58 +1423,45 @@ static void lpphy_btcoex_override(struct b43_wldev *dev)
 	b43_write16(dev, B43_MMIO_BTCOEX_TXCTL, 0xFF);
 }
 
-static void lpphy_pr41573_workaround(struct b43_wldev *dev)
+static void b43_lpphy_op_software_rfkill(struct b43_wldev *dev,
+					 bool blocked)
 {
-	struct b43_phy_lp *lpphy = dev->phy.lp;
-	u32 *saved_tab;
-	const unsigned int saved_tab_size = 256;
-	enum b43_lpphy_txpctl_mode txpctl_mode;
-	s8 tx_pwr_idx_over;
-	u16 tssi_npt, tssi_idx;
-
-	saved_tab = kcalloc(saved_tab_size, sizeof(saved_tab[0]), GFP_KERNEL);
-	if (!saved_tab) {
-		b43err(dev->wl, "PR41573 failed. Out of memory!\n");
-		return;
-	}
-
-	lpphy_read_tx_pctl_mode_from_hardware(dev);
-	txpctl_mode = lpphy->txpctl_mode;
-	tx_pwr_idx_over = lpphy->tx_pwr_idx_over;
-	tssi_npt = lpphy->tssi_npt;
-	tssi_idx = lpphy->tssi_idx;
-
-	if (dev->phy.rev < 2) {
-		b43_lptab_read_bulk(dev, B43_LPTAB32(10, 0x140),
-				    saved_tab_size, saved_tab);
+	//TODO check MAC control register
+	if (blocked) {
+		if (dev->phy.rev >= 2) {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0x83FF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1F00);
+			b43_phy_mask(dev, B43_LPPHY_AFE_DDFS, 0x80FF);
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2_VAL, 0xDFFF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x0808);
+		} else {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xE0FF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1F00);
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2_VAL, 0xFCFF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x0018);
+		}
 	} else {
-		b43_lptab_read_bulk(dev, B43_LPTAB32(7, 0x140),
-				    saved_tab_size, saved_tab);
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xE0FF);
+		if (dev->phy.rev >= 2)
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xF7F7);
+		else
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFFE7);
 	}
-	//TODO
-
-	kfree(saved_tab);
 }
 
-static void lpphy_calibration(struct b43_wldev *dev)
+/* This was previously called lpphy_japan_filter */
+static void lpphy_set_analog_filter(struct b43_wldev *dev, int channel)
 {
 	struct b43_phy_lp *lpphy = dev->phy.lp;
-	enum b43_lpphy_txpctl_mode saved_pctl_mode;
-
-	b43_mac_suspend(dev);
-
-	lpphy_btcoex_override(dev);
-	lpphy_read_tx_pctl_mode_from_hardware(dev);
-	saved_pctl_mode = lpphy->txpctl_mode;
-	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
-	//TODO Perform transmit power table I/Q LO calibration
-	if ((dev->phy.rev == 0) && (saved_pctl_mode != B43_LPPHY_TXPCTL_OFF))
-		lpphy_pr41573_workaround(dev);
-	//TODO If a full calibration has not been performed on this channel yet, perform PAPD TX-power calibration
-	lpphy_set_tx_power_control(dev, saved_pctl_mode);
-	//TODO Perform I/Q calibration with a single control value set
+	u16 tmp = (channel == 14); //SPEC FIXME check japanwidefilter!
 
-	b43_mac_enable(dev);
+	if (dev->phy.rev < 2) { //SPEC FIXME Isn't this rev0/1-specific?
+		b43_phy_maskset(dev, B43_LPPHY_LP_PHY_CTL, 0xFCFF, tmp << 9);
+		if ((dev->phy.rev == 1) && (lpphy->rc_cap))
+			lpphy_set_rc_cap(dev);
+	} else {
+		b43_radio_write(dev, B2063_TX_BB_SP3, 0x3F);
+	}
 }
 
 static void lpphy_set_tssi_mux(struct b43_wldev *dev, enum tssi_mux_mode mode)
@@ -1495,6 +1570,473 @@ static void lpphy_tx_pctl_init(struct b43_wldev *dev)
 	}
 }
 
+static void lpphy_pr41573_workaround(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	u32 *saved_tab;
+	const unsigned int saved_tab_size = 256;
+	enum b43_lpphy_txpctl_mode txpctl_mode;
+	s8 tx_pwr_idx_over;
+	u16 tssi_npt, tssi_idx;
+
+	saved_tab = kcalloc(saved_tab_size, sizeof(saved_tab[0]), GFP_KERNEL);
+	if (!saved_tab) {
+		b43err(dev->wl, "PR41573 failed. Out of memory!\n");
+		return;
+	}
+
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	txpctl_mode = lpphy->txpctl_mode;
+	tx_pwr_idx_over = lpphy->tx_pwr_idx_over;
+	tssi_npt = lpphy->tssi_npt;
+	tssi_idx = lpphy->tssi_idx;
+
+	if (dev->phy.rev < 2) {
+		b43_lptab_read_bulk(dev, B43_LPTAB32(10, 0x140),
+				    saved_tab_size, saved_tab);
+	} else {
+		b43_lptab_read_bulk(dev, B43_LPTAB32(7, 0x140),
+				    saved_tab_size, saved_tab);
+	}
+	//FIXME PHY reset
+	lpphy_table_init(dev); //FIXME is table init needed?
+	lpphy_baseband_init(dev);
+	lpphy_tx_pctl_init(dev);
+	b43_lpphy_op_software_rfkill(dev, false);
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+	if (dev->phy.rev < 2) {
+		b43_lptab_write_bulk(dev, B43_LPTAB32(10, 0x140),
+				     saved_tab_size, saved_tab);
+	} else {
+		b43_lptab_write_bulk(dev, B43_LPTAB32(7, 0x140),
+				     saved_tab_size, saved_tab);
+	}
+	b43_write16(dev, B43_MMIO_CHANNEL, lpphy->channel);
+	lpphy->tssi_npt = tssi_npt;
+	lpphy->tssi_idx = tssi_idx;
+	lpphy_set_analog_filter(dev, lpphy->channel);
+	if (tx_pwr_idx_over != -1)
+		lpphy_set_tx_power_by_index(dev, tx_pwr_idx_over);
+	if (lpphy->rc_cap)
+		lpphy_set_rc_cap(dev);
+	b43_lpphy_op_set_rx_antenna(dev, lpphy->antenna);
+	lpphy_set_tx_power_control(dev, txpctl_mode);
+	kfree(saved_tab);
+}
+
+struct lpphy_rx_iq_comp { u8 chan; s8 c1, c0; };
+
+static const struct lpphy_rx_iq_comp lpphy_5354_iq_table[] = {
+	{ .chan = 1, .c1 = -66, .c0 = 15, },
+	{ .chan = 2, .c1 = -66, .c0 = 15, },
+	{ .chan = 3, .c1 = -66, .c0 = 15, },
+	{ .chan = 4, .c1 = -66, .c0 = 15, },
+	{ .chan = 5, .c1 = -66, .c0 = 15, },
+	{ .chan = 6, .c1 = -66, .c0 = 15, },
+	{ .chan = 7, .c1 = -66, .c0 = 14, },
+	{ .chan = 8, .c1 = -66, .c0 = 14, },
+	{ .chan = 9, .c1 = -66, .c0 = 14, },
+	{ .chan = 10, .c1 = -66, .c0 = 14, },
+	{ .chan = 11, .c1 = -66, .c0 = 14, },
+	{ .chan = 12, .c1 = -66, .c0 = 13, },
+	{ .chan = 13, .c1 = -66, .c0 = 13, },
+	{ .chan = 14, .c1 = -66, .c0 = 13, },
+};
+
+static const struct lpphy_rx_iq_comp lpphy_rev0_1_iq_table[] = {
+	{ .chan = 1, .c1 = -64, .c0 = 13, },
+	{ .chan = 2, .c1 = -64, .c0 = 13, },
+	{ .chan = 3, .c1 = -64, .c0 = 13, },
+	{ .chan = 4, .c1 = -64, .c0 = 13, },
+	{ .chan = 5, .c1 = -64, .c0 = 12, },
+	{ .chan = 6, .c1 = -64, .c0 = 12, },
+	{ .chan = 7, .c1 = -64, .c0 = 12, },
+	{ .chan = 8, .c1 = -64, .c0 = 12, },
+	{ .chan = 9, .c1 = -64, .c0 = 12, },
+	{ .chan = 10, .c1 = -64, .c0 = 11, },
+	{ .chan = 11, .c1 = -64, .c0 = 11, },
+	{ .chan = 12, .c1 = -64, .c0 = 11, },
+	{ .chan = 13, .c1 = -64, .c0 = 11, },
+	{ .chan = 14, .c1 = -64, .c0 = 10, },
+	{ .chan = 34, .c1 = -62, .c0 = 24, },
+	{ .chan = 38, .c1 = -62, .c0 = 24, },
+	{ .chan = 42, .c1 = -62, .c0 = 24, },
+	{ .chan = 46, .c1 = -62, .c0 = 23, },
+	{ .chan = 36, .c1 = -62, .c0 = 24, },
+	{ .chan = 40, .c1 = -62, .c0 = 24, },
+	{ .chan = 44, .c1 = -62, .c0 = 23, },
+	{ .chan = 48, .c1 = -62, .c0 = 23, },
+	{ .chan = 52, .c1 = -62, .c0 = 23, },
+	{ .chan = 56, .c1 = -62, .c0 = 22, },
+	{ .chan = 60, .c1 = -62, .c0 = 22, },
+	{ .chan = 64, .c1 = -62, .c0 = 22, },
+	{ .chan = 100, .c1 = -62, .c0 = 16, },
+	{ .chan = 104, .c1 = -62, .c0 = 16, },
+	{ .chan = 108, .c1 = -62, .c0 = 15, },
+	{ .chan = 112, .c1 = -62, .c0 = 14, },
+	{ .chan = 116, .c1 = -62, .c0 = 14, },
+	{ .chan = 120, .c1 = -62, .c0 = 13, },
+	{ .chan = 124, .c1 = -62, .c0 = 12, },
+	{ .chan = 128, .c1 = -62, .c0 = 12, },
+	{ .chan = 132, .c1 = -62, .c0 = 12, },
+	{ .chan = 136, .c1 = -62, .c0 = 11, },
+	{ .chan = 140, .c1 = -62, .c0 = 10, },
+	{ .chan = 149, .c1 = -61, .c0 = 9, },
+	{ .chan = 153, .c1 = -61, .c0 = 9, },
+	{ .chan = 157, .c1 = -61, .c0 = 9, },
+	{ .chan = 161, .c1 = -61, .c0 = 8, },
+	{ .chan = 165, .c1 = -61, .c0 = 8, },
+	{ .chan = 184, .c1 = -62, .c0 = 25, },
+	{ .chan = 188, .c1 = -62, .c0 = 25, },
+	{ .chan = 192, .c1 = -62, .c0 = 25, },
+	{ .chan = 196, .c1 = -62, .c0 = 25, },
+	{ .chan = 200, .c1 = -62, .c0 = 25, },
+	{ .chan = 204, .c1 = -62, .c0 = 25, },
+	{ .chan = 208, .c1 = -62, .c0 = 25, },
+	{ .chan = 212, .c1 = -62, .c0 = 25, },
+	{ .chan = 216, .c1 = -62, .c0 = 26, },
+};
+
+static const struct lpphy_rx_iq_comp lpphy_rev2plus_iq_comp = {
+	.chan = 0,
+	.c1 = -64,
+	.c0 = 0,
+};
+
+static u8 lpphy_nbits(s32 val)
+{
+	u32 tmp = abs(val);
+	u8 nbits = 0;
+
+	while (tmp != 0) {
+		nbits++;
+		tmp >>= 1;
+	}
+
+	return nbits;
+}
+
+static int lpphy_calc_rx_iq_comp(struct b43_wldev *dev, u16 samples)
+{
+	struct lpphy_iq_est iq_est;
+	u16 c0, c1;
+	int prod, ipwr, qpwr, prod_msb, q_msb, tmp1, tmp2, tmp3, tmp4, ret;
+
+	c1 = b43_phy_read(dev, B43_LPPHY_RX_COMP_COEFF_S);
+	c0 = c1 >> 8;
+	c1 |= 0xFF;
+
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, 0x00C0);
+	b43_phy_mask(dev, B43_LPPHY_RX_COMP_COEFF_S, 0x00FF);
+
+	ret = lpphy_rx_iq_est(dev, samples, 32, &iq_est);
+	if (!ret)
+		goto out;
+
+	prod = iq_est.iq_prod;
+	ipwr = iq_est.i_pwr;
+	qpwr = iq_est.q_pwr;
+
+	if (ipwr + qpwr < 2) {
+		ret = 0;
+		goto out;
+	}
+
+	prod_msb = lpphy_nbits(prod);
+	q_msb = lpphy_nbits(qpwr);
+	tmp1 = prod_msb - 20;
+
+	if (tmp1 >= 0) {
+		tmp3 = ((prod << (30 - prod_msb)) + (ipwr >> (1 + tmp1))) /
+			(ipwr >> tmp1);
+	} else {
+		tmp3 = ((prod << (30 - prod_msb)) + (ipwr << (-1 - tmp1))) /
+			(ipwr << -tmp1);
+	}
+
+	tmp2 = q_msb - 11;
+
+	if (tmp2 >= 0)
+		tmp4 = (qpwr << (31 - q_msb)) / (ipwr >> tmp2);
+	else
+		tmp4 = (qpwr << (31 - q_msb)) / (ipwr << -tmp2);
+
+	tmp4 -= tmp3 * tmp3;
+	tmp4 = -int_sqrt(tmp4);
+
+	c0 = tmp3 >> 3;
+	c1 = tmp4 >> 4;
+
+out:
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, c1);
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0x00FF, c0 << 8);
+	return ret;
+}
+
+/* Complex number using 2 32-bit signed integers */
+typedef struct {s32 i, q;} lpphy_c32;
+
+static lpphy_c32 lpphy_cordic(int theta)
+{
+	u32 arctg[] = { 2949120, 1740967, 919879, 466945, 234379, 117304,
+		      58666, 29335, 14668, 7334, 3667, 1833, 917, 458,
+		      229, 115, 57, 29, };
+	int i, tmp, signx = 1, angle = 0;
+	lpphy_c32 ret = { .i = 39797, .q = 0, };
+
+	theta = clamp_t(int, theta, -180, 180);
+
+	if (theta > 90) {
+		theta -= 180;
+		signx = -1;
+	} else if (theta < -90) {
+		theta += 180;
+		signx = -1;
+	}
+
+	for (i = 0; i <= 17; i++) {
+		if (theta > angle) {
+			tmp = ret.i - (ret.q >> i);
+			ret.q += ret.i >> i;
+			ret.i = tmp;
+			angle += arctg[i];
+		} else {
+			tmp = ret.i + (ret.q >> i);
+			ret.q -= ret.i >> i;
+			ret.i = tmp;
+			angle -= arctg[i];
+		}
+	}
+
+	ret.i *= signx;
+	ret.q *= signx;
+
+	return ret;
+}
+
+static void lpphy_run_samples(struct b43_wldev *dev, u16 samples, u16 loops,
+			      u16 wait)
+{
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_BUFFER_CTL,
+			0xFFC0, samples - 1);
+	if (loops != 0xFFFF)
+		loops--;
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_COUNT, 0xF000, loops);
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_BUFFER_CTL, 0x3F, wait << 6);
+	b43_phy_set(dev, B43_LPPHY_A_PHY_CTL_ADDR, 0x1);
+}
+
+//SPEC FIXME what does a negative freq mean?
+static void lpphy_start_tx_tone(struct b43_wldev *dev, s32 freq, u16 max)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	u16 buf[64];
+	int i, samples = 0, angle = 0, rotation = (9 * freq) / 500;
+	lpphy_c32 sample;
+
+	lpphy->tx_tone_freq = freq;
+
+	if (freq) {
+		/* Find i for which abs(freq) integrally divides 20000 * i */
+		for (i = 1; samples * abs(freq) != 20000 * i; i++) {
+			samples = (20000 * i) / abs(freq);
+			if(B43_WARN_ON(samples > 63))
+				return;
+		}
+	} else {
+		samples = 2;
+	}
+
+	for (i = 0; i < samples; i++) {
+		sample = lpphy_cordic(angle);
+		angle += rotation;
+		buf[i] = ((sample.i * max) & 0xFF) << 8;
+		buf[i] |= (sample.q * max) & 0xFF;
+	}
+
+	b43_lptab_write_bulk(dev, B43_LPTAB16(5, 0), samples, buf);
+
+	lpphy_run_samples(dev, samples, 0xFFFF, 0);
+}
+
+static void lpphy_stop_tx_tone(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	int i;
+
+	lpphy->tx_tone_freq = 0;
+
+	b43_phy_mask(dev, B43_LPPHY_SMPL_PLAY_COUNT, 0xF000);
+	for (i = 0; i < 31; i++) {
+		if (!(b43_phy_read(dev, B43_LPPHY_A_PHY_CTL_ADDR) & 0x1))
+			break;
+		udelay(100);
+	}
+}
+
+
+static void lpphy_papd_cal(struct b43_wldev *dev, struct lpphy_tx_gains gains,
+			   int mode, bool useindex, u8 index)
+{
+	//TODO
+}
+
+static void lpphy_papd_cal_txpwr(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct ssb_bus *bus = dev->dev->bus;
+	struct lpphy_tx_gains gains, oldgains;
+	int old_txpctl, old_afe_ovr, old_rf, old_bbmult;
+
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	old_txpctl = lpphy->txpctl_mode;
+	old_afe_ovr = b43_phy_read(dev, B43_LPPHY_AFE_CTL_OVR) & 0x40;
+	if (old_afe_ovr)
+		oldgains = lpphy_get_tx_gains(dev);
+	old_rf = b43_phy_read(dev, B43_LPPHY_RF_PWR_OVERRIDE) & 0xFF;
+	old_bbmult = lpphy_get_bb_mult(dev);
+
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+
+	if (bus->chip_id == 0x4325 && bus->chip_rev == 0)
+		lpphy_papd_cal(dev, gains, 0, 1, 30);
+	else
+		lpphy_papd_cal(dev, gains, 0, 1, 65);
+
+	if (old_afe_ovr)
+		lpphy_set_tx_gains(dev, oldgains);
+	lpphy_set_bb_mult(dev, old_bbmult);
+	lpphy_set_tx_power_control(dev, old_txpctl);
+	b43_phy_maskset(dev, B43_LPPHY_RF_PWR_OVERRIDE, 0xFF00, old_rf);
+}
+
+static int lpphy_rx_iq_cal(struct b43_wldev *dev, bool noise, bool tx,
+			    bool rx, bool pa, struct lpphy_tx_gains *gains)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct ssb_bus *bus = dev->dev->bus;
+	const struct lpphy_rx_iq_comp *iqcomp = NULL;
+	struct lpphy_tx_gains nogains, oldgains;
+	u16 tmp;
+	int i, ret;
+
+	memset(&nogains, 0, sizeof(nogains));
+	memset(&oldgains, 0, sizeof(oldgains));
+
+	if (bus->chip_id == 0x5354) {
+		for (i = 0; i < ARRAY_SIZE(lpphy_5354_iq_table); i++) {
+			if (lpphy_5354_iq_table[i].chan == lpphy->channel) {
+				iqcomp = &lpphy_5354_iq_table[i];
+			}
+		}
+	} else if (dev->phy.rev >= 2) {
+		iqcomp = &lpphy_rev2plus_iq_comp;
+	} else {
+		for (i = 0; i < ARRAY_SIZE(lpphy_rev0_1_iq_table); i++) {
+			if (lpphy_rev0_1_iq_table[i].chan == lpphy->channel) {
+				iqcomp = &lpphy_rev0_1_iq_table[i];
+			}
+		}
+	}
+
+	if (B43_WARN_ON(!iqcomp))
+		return 0;
+
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, iqcomp->c1);
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S,
+			0x00FF, iqcomp->c0 << 8);
+
+	if (noise) {
+		tx = true;
+		rx = false;
+		pa = false;
+	}
+
+	lpphy_set_trsw_over(dev, tx, rx);
+
+	if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x8);
+		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0,
+				0xFFF7, pa << 3);
+	} else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x20);
+		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0,
+				0xFFDF, pa << 5);
+	}
+
+	tmp = b43_phy_read(dev, B43_LPPHY_AFE_CTL_OVR) & 0x40;
+
+	if (noise)
+		lpphy_set_rx_gain(dev, 0x2D5D);
+	else {
+		if (tmp)
+			oldgains = lpphy_get_tx_gains(dev);
+		if (!gains)
+			gains = &nogains;
+		lpphy_set_tx_gains(dev, *gains);
+	}
+
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xFFFE);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x800);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0x800);
+	lpphy_set_deaf(dev, false);
+	if (noise)
+		ret = lpphy_calc_rx_iq_comp(dev, 0xFFF0);
+	else {
+		lpphy_start_tx_tone(dev, 4000, 100);
+		ret = lpphy_calc_rx_iq_comp(dev, 0x4000);
+		lpphy_stop_tx_tone(dev);
+	}
+	lpphy_clear_deaf(dev, false);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFC);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFF7);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFDF);
+	if (!noise) {
+		if (tmp)
+			lpphy_set_tx_gains(dev, oldgains);
+		else
+			lpphy_disable_tx_gain_override(dev);
+	}
+	lpphy_disable_rx_gain_override(dev);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xF7FF);
+	return ret;
+}
+
+static void lpphy_calibration(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	enum b43_lpphy_txpctl_mode saved_pctl_mode;
+	bool full_cal = false;
+
+	if (lpphy->full_calib_chan != lpphy->channel) {
+		full_cal = true;
+		lpphy->full_calib_chan = lpphy->channel;
+	}
+
+	b43_mac_suspend(dev);
+
+	lpphy_btcoex_override(dev);
+	if (dev->phy.rev >= 2)
+		lpphy_save_dig_flt_state(dev);
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	saved_pctl_mode = lpphy->txpctl_mode;
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+	//TODO Perform transmit power table I/Q LO calibration
+	if ((dev->phy.rev == 0) && (saved_pctl_mode != B43_LPPHY_TXPCTL_OFF))
+		lpphy_pr41573_workaround(dev);
+	if ((dev->phy.rev >= 2) && full_cal) {
+		lpphy_papd_cal_txpwr(dev);
+	}
+	lpphy_set_tx_power_control(dev, saved_pctl_mode);
+	if (dev->phy.rev >= 2)
+		lpphy_restore_dig_flt_state(dev);
+	lpphy_rx_iq_cal(dev, true, true, false, false, NULL);
+
+	b43_mac_enable(dev);
+}
+
 static u16 b43_lpphy_op_read(struct b43_wldev *dev, u16 reg)
 {
 	b43_write16(dev, B43_MMIO_PHY_CONTROL, reg);
@@ -1539,12 +2081,6 @@ static void b43_lpphy_op_radio_write(struct b43_wldev *dev, u16 reg, u16 value)
 	b43_write16(dev, B43_MMIO_RADIO_DATA_LOW, value);
 }
 
-static void b43_lpphy_op_software_rfkill(struct b43_wldev *dev,
-					 bool blocked)
-{
-	//TODO
-}
-
 struct b206x_channel {
 	u8 channel;
 	u16 freq;
@@ -2010,22 +2546,6 @@ static int lpphy_b2062_tune(struct b43_wldev *dev,
 	return err;
 }
 
-
-/* This was previously called lpphy_japan_filter */
-static void lpphy_set_analog_filter(struct b43_wldev *dev, int channel)
-{
-	struct b43_phy_lp *lpphy = dev->phy.lp;
-	u16 tmp = (channel == 14); //SPEC FIXME check japanwidefilter!
-
-	if (dev->phy.rev < 2) { //SPEC FIXME Isn't this rev0/1-specific?
-		b43_phy_maskset(dev, B43_LPPHY_LP_PHY_CTL, 0xFCFF, tmp << 9);
-		if ((dev->phy.rev == 1) && (lpphy->rc_cap))
-			lpphy_set_rc_cap(dev);
-	} else {
-		b43_radio_write(dev, B2063_TX_BB_SP3, 0x3F);
-	}
-}
-
 static void lpphy_b2063_vco_calib(struct b43_wldev *dev)
 {
 	u16 tmp;
@@ -2210,18 +2730,6 @@ static int b43_lpphy_op_init(struct b43_wldev *dev)
 	return 0;
 }
 
-static void b43_lpphy_op_set_rx_antenna(struct b43_wldev *dev, int antenna)
-{
-	if (dev->phy.rev >= 2)
-		return; // rev2+ doesn't support antenna diversity
-
-	if (B43_WARN_ON(antenna > B43_ANTENNA_AUTO1))
-		return;
-
-	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFD, antenna & 0x2);
-	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFE, antenna & 0x1);
-}
-
 static void b43_lpphy_op_adjust_txpower(struct b43_wldev *dev)
 {
 	//TODO
@@ -2244,6 +2752,11 @@ void b43_lpphy_op_switch_analog(struct b43_wldev *dev, bool on)
        }
 }
 
+static void b43_lpphy_op_pwork_15sec(struct b43_wldev *dev)
+{
+	//TODO
+}
+
 const struct b43_phy_operations b43_phyops_lp = {
 	.allocate		= b43_lpphy_op_allocate,
 	.free			= b43_lpphy_op_free,
@@ -2261,4 +2774,6 @@ const struct b43_phy_operations b43_phyops_lp = {
 	.set_rx_antenna		= b43_lpphy_op_set_rx_antenna,
 	.recalc_txpower		= b43_lpphy_op_recalc_txpower,
 	.adjust_txpower		= b43_lpphy_op_adjust_txpower,
+	.pwork_15sec		= b43_lpphy_op_pwork_15sec,
+	.pwork_60sec		= lpphy_calibration,
 };
diff --git a/drivers/net/wireless/b43/phy_lp.h b/drivers/net/wireless/b43/phy_lp.h
index c3232c1..62737f7 100644
--- a/drivers/net/wireless/b43/phy_lp.h
+++ b/drivers/net/wireless/b43/phy_lp.h
@@ -286,6 +286,7 @@
 #define B43_LPPHY_TR_LOOKUP_6			B43_PHY_OFDM(0xC8) /* TR Lookup 6 */
 #define B43_LPPHY_TR_LOOKUP_7			B43_PHY_OFDM(0xC9) /* TR Lookup 7 */
 #define B43_LPPHY_TR_LOOKUP_8			B43_PHY_OFDM(0xCA) /* TR Lookup 8 */
+#define B43_LPPHY_RF_PWR_OVERRIDE		B43_PHY_OFDM(0xD3) /* RF power override */
 
 
 
@@ -871,12 +872,12 @@ struct b43_phy_lp {
 	u8 rssi_gs;
 
 	/* RC cap */
-	u8 rc_cap; /* FIXME initial value? */
+	u8 rc_cap;
 	/* BX arch */
 	u8 bx_arch;
 
 	/* Full calibration channel */
-	u8 full_calib_chan; /* FIXME initial value? */
+	u8 full_calib_chan;
 
 	/* Transmit iqlocal best coeffs */
 	bool tx_iqloc_best_coeffs_valid;
@@ -891,6 +892,12 @@ struct b43_phy_lp {
 
 	/* The channel we are tuned to */
 	u8 channel;
+
+	/* The active antenna diversity mode */
+	int antenna;
+
+	/* Frequency of the active TX tone */
+	int tx_tone_freq;
 };
 
 enum tssi_mux_mode {
-- 
1.6.4.2



From netrolller.3d at gmail.com  Sun Oct 25 16:26:36 2009
From: netrolller.3d at gmail.com (=?UTF-8?q?G=C3=A1bor=20Stefanik?=)
Date: Sun, 25 Oct 2009 16:26:36 +0100
Subject: [PATCH] b43: LP-PHY: Begin implementing calibration & software RFKILL
	support
Message-ID: <1256484396-31063-1-git-send-email-netrolller.3d@gmail.com>

This implements the following calibration functions:
-Set TX IQCC
-Set TX Power by Index
-PR41573 workaround (incomplete, needs PHY reset)
-Calc RX IQ Comp
-PHY Cordic
-Run Samples
-Start/Stop TX Tone
-part of PAPD Cal TX Power
-RX I/Q Calibration
-The basic structure of the periodic calibration wrapper

Software RFKILL (required by calibration) is also implemented in
this round.

Signed-off-by: G?bor Stefanik <netrolller.3d at gmail.com>
---
(Mail re-sent as my mailer seems to have dropped it; apologies if
you receive it twice.)

Michael, could you please do the PHY reset part? I can't seem to
understand its relationship to wireless_core_reset... also, it's
heavily ssb-speak, which I am not good at.

 drivers/net/wireless/b43/phy_lp.c |  783 ++++++++++++++++++++++++++++++-------
 drivers/net/wireless/b43/phy_lp.h |   11 +-
 2 files changed, 658 insertions(+), 136 deletions(-)

diff --git a/drivers/net/wireless/b43/phy_lp.c b/drivers/net/wireless/b43/phy_lp.c
index 07d9d03..9dcb39c 100644
--- a/drivers/net/wireless/b43/phy_lp.c
+++ b/drivers/net/wireless/b43/phy_lp.c
@@ -67,6 +67,7 @@ static void b43_lpphy_op_prepare_structs(struct b43_wldev *dev)
 	struct b43_phy_lp *lpphy = phy->lp;
 
 	memset(lpphy, 0, sizeof(*lpphy));
+	lpphy->antenna = B43_ANTENNA_DEFAULT;
 
 	//TODO
 }
@@ -379,8 +380,6 @@ static void lpphy_save_dig_flt_state(struct b43_wldev *dev)
 	}
 }
 
-/* lpphy_restore_dig_flt_state is unused but kept as a reference */
-#if 0
 static void lpphy_restore_dig_flt_state(struct b43_wldev *dev)
 {
 	static const u16 addr[] = {
@@ -401,7 +400,6 @@ static void lpphy_restore_dig_flt_state(struct b43_wldev *dev)
 	for (i = 0; i < ARRAY_SIZE(addr); i++)
 		b43_phy_write(dev, addr[i], lpphy->dig_flt_state[i]);
 }
-#endif
 
 static void lpphy_baseband_rev2plus_init(struct b43_wldev *dev)
 {
@@ -754,11 +752,17 @@ static void lpphy_clear_deaf(struct b43_wldev *dev, bool user)
 	}
 }
 
+static void lpphy_set_trsw_over(struct b43_wldev *dev, bool tx, bool rx)
+{
+	u16 trsw = (tx << 1) | rx;
+	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, trsw);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+}
+
 static void lpphy_disable_crs(struct b43_wldev *dev, bool user)
 {
 	lpphy_set_deaf(dev, user);
-	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, 0x1);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+	lpphy_set_trsw_over(dev, false, true);
 	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFB);
 	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x4);
 	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFF7);
@@ -793,6 +797,60 @@ static void lpphy_restore_crs(struct b43_wldev *dev, bool user)
 
 struct lpphy_tx_gains { u16 gm, pga, pad, dac; };
 
+static void lpphy_disable_rx_gain_override(struct b43_wldev *dev)
+{
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFEF);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFBF);
+	if (dev->phy.rev >= 2) {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
+		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFBFF);
+			b43_phy_mask(dev, B43_PHY_OFDM(0xE5), 0xFFF7);
+		}
+	} else {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFDFF);
+	}
+}
+
+static void lpphy_enable_rx_gain_override(struct b43_wldev *dev)
+{
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x10);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x40);
+	if (dev->phy.rev >= 2) {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
+		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x400);
+			b43_phy_set(dev, B43_PHY_OFDM(0xE5), 0x8);
+		}
+	} else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x200);
+	}
+}
+
+static void lpphy_disable_tx_gain_override(struct b43_wldev *dev)
+{
+	if (dev->phy.rev < 2)
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
+	else {
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFF7F);
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xBFFF);
+	}
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFBF);
+}
+
+static void lpphy_enable_tx_gain_override(struct b43_wldev *dev)
+{
+	if (dev->phy.rev < 2)
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
+	else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x80);
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x4000);
+	}
+	b43_phy_set(dev, B43_LPPHY_AFE_CTL_OVR, 0x40);
+}
+
 static struct lpphy_tx_gains lpphy_get_tx_gains(struct b43_wldev *dev)
 {
 	struct lpphy_tx_gains gains;
@@ -822,6 +880,17 @@ static void lpphy_set_dac_gain(struct b43_wldev *dev, u16 dac)
 	b43_phy_maskset(dev, B43_LPPHY_AFE_DAC_CTL, 0xF000, ctl);
 }
 
+static u16 lpphy_get_pa_gain(struct b43_wldev *dev)
+{
+	return b43_phy_read(dev, B43_PHY_OFDM(0xFB)) & 0x7F;
+}
+
+static void lpphy_set_pa_gain(struct b43_wldev *dev, u16 gain)
+{
+	b43_phy_maskset(dev, B43_PHY_OFDM(0xFB), 0xE03F, gain << 6);
+	b43_phy_maskset(dev, B43_PHY_OFDM(0xFD), 0x80FF, gain << 8);
+}
+
 static void lpphy_set_tx_gains(struct b43_wldev *dev,
 			       struct lpphy_tx_gains gains)
 {
@@ -832,25 +901,22 @@ static void lpphy_set_tx_gains(struct b43_wldev *dev,
 		b43_phy_maskset(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
 				0xF800, rf_gain);
 	} else {
-		pa_gain = b43_phy_read(dev, B43_PHY_OFDM(0xFB)) & 0x1FC0;
-		pa_gain <<= 2;
+		pa_gain = lpphy_get_pa_gain(dev);
 		b43_phy_write(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
 			      (gains.pga << 8) | gains.gm);
+		/*
+		 * SPEC FIXME The spec calls for (pa_gain << 8) here, but that
+		 * conflicts with the spec for set_pa_gain! Vendor driver bug?
+		 */
 		b43_phy_maskset(dev, B43_PHY_OFDM(0xFB),
-				0x8000, gains.pad | pa_gain);
+				0x8000, gains.pad | (pa_gain << 6));
 		b43_phy_write(dev, B43_PHY_OFDM(0xFC),
 			      (gains.pga << 8) | gains.gm);
 		b43_phy_maskset(dev, B43_PHY_OFDM(0xFD),
-				0x8000, gains.pad | pa_gain);
+				0x8000, gains.pad | (pa_gain << 8));
 	}
 	lpphy_set_dac_gain(dev, gains.dac);
-	if (dev->phy.rev < 2) {
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF, 1 << 8);
-	} else {
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFF7F, 1 << 7);
-		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_2, 0xBFFF, 1 << 14);
-	}
-	b43_phy_maskset(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFBF, 1 << 6);
+	lpphy_enable_tx_gain_override(dev);
 }
 
 static void lpphy_rev0_1_set_rx_gain(struct b43_wldev *dev, u32 gain)
@@ -890,41 +956,6 @@ static void lpphy_rev2plus_set_rx_gain(struct b43_wldev *dev, u32 gain)
 	}
 }
 
-/* lpphy_disable_rx_gain_override is unused but kept as a reference */
-#if 0
-static void lpphy_disable_rx_gain_override(struct b43_wldev *dev)
-{
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFE);
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFEF);
-	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFBF);
-	if (dev->phy.rev >= 2) {
-		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFEFF);
-		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
-			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFBFF);
-			b43_phy_mask(dev, B43_PHY_OFDM(0xE5), 0xFFF7);
-		}
-	} else {
-		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFDFF);
-	}
-}
-#endif
-
-static void lpphy_enable_rx_gain_override(struct b43_wldev *dev)
-{
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x10);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x40);
-	if (dev->phy.rev >= 2) {
-		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x100);
-		if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
-			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x400);
-			b43_phy_set(dev, B43_PHY_OFDM(0xE5), 0x8);
-		}
-	} else {
-		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x200);
-	}
-}
-
 static void lpphy_set_rx_gain(struct b43_wldev *dev, u32 gain)
 {
 	if (dev->phy.rev < 2)
@@ -1009,8 +1040,7 @@ static int lpphy_loopback(struct b43_wldev *dev)
 
 	memset(&iq_est, 0, sizeof(iq_est));
 
-	b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xFFFC, 0x3);
-	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x3);
+	lpphy_set_trsw_over(dev, true, true);
 	b43_phy_set(dev, B43_LPPHY_AFE_CTL_OVR, 1);
 	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xFFFE);
 	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x800);
@@ -1132,7 +1162,7 @@ static void lpphy_set_tx_power_control(struct b43_wldev *dev,
 			b43_phy_maskset(dev, B43_LPPHY_TX_PWR_CTL_NNUM,
 					0x8FFF, ((u16)lpphy->tssi_npt << 16));
 			//TODO Set "TSSI Transmit Count" variable to total transmitted frame count
-			//TODO Disable TX gain override
+			lpphy_disable_tx_gain_override(dev);
 			lpphy->tx_pwr_idx_over = -1;
 		}
 	}
@@ -1318,15 +1348,73 @@ static void lpphy_calibrate_rc(struct b43_wldev *dev)
 	}
 }
 
+static void b43_lpphy_op_set_rx_antenna(struct b43_wldev *dev, int antenna)
+{
+	if (dev->phy.rev >= 2)
+		return; // rev2+ doesn't support antenna diversity
+
+	if (B43_WARN_ON(antenna > B43_ANTENNA_AUTO1))
+		return;
+
+	b43_hf_write(dev, b43_hf_read(dev) & ~B43_HF_ANTDIVHELP);
+
+	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFD, antenna & 0x2);
+	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFE, antenna & 0x1);
+
+	b43_hf_write(dev, b43_hf_read(dev) | B43_HF_ANTDIVHELP);
+
+	dev->phy.lp->antenna = antenna;
+}
+
+static void lpphy_set_tx_iqcc(struct b43_wldev *dev, u16 a, u16 b)
+{
+	u16 tmp[2];
+
+	tmp[0] = a;
+	tmp[1] = b;
+	b43_lptab_write_bulk(dev, B43_LPTAB16(0, 80), 2, tmp);
+}
+
 static void lpphy_set_tx_power_by_index(struct b43_wldev *dev, u8 index)
 {
 	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct lpphy_tx_gains gains;
+	u32 iq_comp, tx_gain, coeff, rf_power;
 
 	lpphy->tx_pwr_idx_over = index;
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
 	if (lpphy->txpctl_mode != B43_LPPHY_TXPCTL_OFF)
 		lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_SW);
-
-	//TODO
+	if (dev->phy.rev >= 2) {
+		iq_comp = b43_lptab_read(dev, B43_LPTAB32(7, index + 320));
+		tx_gain = b43_lptab_read(dev, B43_LPTAB32(7, index + 192));
+		gains.pad = (tx_gain >> 16) & 0xFF;
+		gains.gm = tx_gain & 0xFF;
+		gains.pga = (tx_gain >> 8) & 0xFF;
+		gains.dac = (iq_comp >> 28) & 0xFF;
+		lpphy_set_tx_gains(dev, gains);
+	} else {
+		iq_comp = b43_lptab_read(dev, B43_LPTAB32(10, index + 320));
+		tx_gain = b43_lptab_read(dev, B43_LPTAB32(10, index + 192));
+		b43_phy_maskset(dev, B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL,
+				0xF800, (tx_gain >> 4) & 0x7FFF);
+		lpphy_set_dac_gain(dev, tx_gain & 0x7);
+		lpphy_set_pa_gain(dev, (tx_gain >> 24) & 0x7F);
+	}
+	lpphy_set_bb_mult(dev, (iq_comp >> 20) & 0xFF);
+	lpphy_set_tx_iqcc(dev, (iq_comp >> 10) & 0x3FF, iq_comp & 0x3FF);
+	if (dev->phy.rev >= 2) {
+		coeff = b43_lptab_read(dev, B43_LPTAB32(7, index + 448));
+	} else {
+		coeff = b43_lptab_read(dev, B43_LPTAB32(10, index + 448));
+	}
+	b43_lptab_write(dev, B43_LPTAB16(0, 85), coeff & 0xFFFF);
+	if (dev->phy.rev >= 2) {
+		rf_power = b43_lptab_read(dev, B43_LPTAB32(7, index + 576));
+		b43_phy_maskset(dev, B43_LPPHY_RF_PWR_OVERRIDE, 0xFF00,
+				rf_power & 0xFFFF);//SPEC FIXME mask & set != 0
+	}
+	lpphy_enable_tx_gain_override(dev);
 }
 
 static void lpphy_btcoex_override(struct b43_wldev *dev)
@@ -1335,58 +1423,45 @@ static void lpphy_btcoex_override(struct b43_wldev *dev)
 	b43_write16(dev, B43_MMIO_BTCOEX_TXCTL, 0xFF);
 }
 
-static void lpphy_pr41573_workaround(struct b43_wldev *dev)
+static void b43_lpphy_op_software_rfkill(struct b43_wldev *dev,
+					 bool blocked)
 {
-	struct b43_phy_lp *lpphy = dev->phy.lp;
-	u32 *saved_tab;
-	const unsigned int saved_tab_size = 256;
-	enum b43_lpphy_txpctl_mode txpctl_mode;
-	s8 tx_pwr_idx_over;
-	u16 tssi_npt, tssi_idx;
-
-	saved_tab = kcalloc(saved_tab_size, sizeof(saved_tab[0]), GFP_KERNEL);
-	if (!saved_tab) {
-		b43err(dev->wl, "PR41573 failed. Out of memory!\n");
-		return;
-	}
-
-	lpphy_read_tx_pctl_mode_from_hardware(dev);
-	txpctl_mode = lpphy->txpctl_mode;
-	tx_pwr_idx_over = lpphy->tx_pwr_idx_over;
-	tssi_npt = lpphy->tssi_npt;
-	tssi_idx = lpphy->tssi_idx;
-
-	if (dev->phy.rev < 2) {
-		b43_lptab_read_bulk(dev, B43_LPTAB32(10, 0x140),
-				    saved_tab_size, saved_tab);
+	//TODO check MAC control register
+	if (blocked) {
+		if (dev->phy.rev >= 2) {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0x83FF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1F00);
+			b43_phy_mask(dev, B43_LPPHY_AFE_DDFS, 0x80FF);
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2_VAL, 0xDFFF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x0808);
+		} else {
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0xE0FF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x1F00);
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2_VAL, 0xFCFF);
+			b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_2, 0x0018);
+		}
 	} else {
-		b43_lptab_read_bulk(dev, B43_LPTAB32(7, 0x140),
-				    saved_tab_size, saved_tab);
+		b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xE0FF);
+		if (dev->phy.rev >= 2)
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xF7F7);
+		else
+			b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_2, 0xFFE7);
 	}
-	//TODO
-
-	kfree(saved_tab);
 }
 
-static void lpphy_calibration(struct b43_wldev *dev)
+/* This was previously called lpphy_japan_filter */
+static void lpphy_set_analog_filter(struct b43_wldev *dev, int channel)
 {
 	struct b43_phy_lp *lpphy = dev->phy.lp;
-	enum b43_lpphy_txpctl_mode saved_pctl_mode;
-
-	b43_mac_suspend(dev);
-
-	lpphy_btcoex_override(dev);
-	lpphy_read_tx_pctl_mode_from_hardware(dev);
-	saved_pctl_mode = lpphy->txpctl_mode;
-	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
-	//TODO Perform transmit power table I/Q LO calibration
-	if ((dev->phy.rev == 0) && (saved_pctl_mode != B43_LPPHY_TXPCTL_OFF))
-		lpphy_pr41573_workaround(dev);
-	//TODO If a full calibration has not been performed on this channel yet, perform PAPD TX-power calibration
-	lpphy_set_tx_power_control(dev, saved_pctl_mode);
-	//TODO Perform I/Q calibration with a single control value set
+	u16 tmp = (channel == 14); //SPEC FIXME check japanwidefilter!
 
-	b43_mac_enable(dev);
+	if (dev->phy.rev < 2) { //SPEC FIXME Isn't this rev0/1-specific?
+		b43_phy_maskset(dev, B43_LPPHY_LP_PHY_CTL, 0xFCFF, tmp << 9);
+		if ((dev->phy.rev == 1) && (lpphy->rc_cap))
+			lpphy_set_rc_cap(dev);
+	} else {
+		b43_radio_write(dev, B2063_TX_BB_SP3, 0x3F);
+	}
 }
 
 static void lpphy_set_tssi_mux(struct b43_wldev *dev, enum tssi_mux_mode mode)
@@ -1495,6 +1570,473 @@ static void lpphy_tx_pctl_init(struct b43_wldev *dev)
 	}
 }
 
+static void lpphy_pr41573_workaround(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	u32 *saved_tab;
+	const unsigned int saved_tab_size = 256;
+	enum b43_lpphy_txpctl_mode txpctl_mode;
+	s8 tx_pwr_idx_over;
+	u16 tssi_npt, tssi_idx;
+
+	saved_tab = kcalloc(saved_tab_size, sizeof(saved_tab[0]), GFP_KERNEL);
+	if (!saved_tab) {
+		b43err(dev->wl, "PR41573 failed. Out of memory!\n");
+		return;
+	}
+
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	txpctl_mode = lpphy->txpctl_mode;
+	tx_pwr_idx_over = lpphy->tx_pwr_idx_over;
+	tssi_npt = lpphy->tssi_npt;
+	tssi_idx = lpphy->tssi_idx;
+
+	if (dev->phy.rev < 2) {
+		b43_lptab_read_bulk(dev, B43_LPTAB32(10, 0x140),
+				    saved_tab_size, saved_tab);
+	} else {
+		b43_lptab_read_bulk(dev, B43_LPTAB32(7, 0x140),
+				    saved_tab_size, saved_tab);
+	}
+	//FIXME PHY reset
+	lpphy_table_init(dev); //FIXME is table init needed?
+	lpphy_baseband_init(dev);
+	lpphy_tx_pctl_init(dev);
+	b43_lpphy_op_software_rfkill(dev, false);
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+	if (dev->phy.rev < 2) {
+		b43_lptab_write_bulk(dev, B43_LPTAB32(10, 0x140),
+				     saved_tab_size, saved_tab);
+	} else {
+		b43_lptab_write_bulk(dev, B43_LPTAB32(7, 0x140),
+				     saved_tab_size, saved_tab);
+	}
+	b43_write16(dev, B43_MMIO_CHANNEL, lpphy->channel);
+	lpphy->tssi_npt = tssi_npt;
+	lpphy->tssi_idx = tssi_idx;
+	lpphy_set_analog_filter(dev, lpphy->channel);
+	if (tx_pwr_idx_over != -1)
+		lpphy_set_tx_power_by_index(dev, tx_pwr_idx_over);
+	if (lpphy->rc_cap)
+		lpphy_set_rc_cap(dev);
+	b43_lpphy_op_set_rx_antenna(dev, lpphy->antenna);
+	lpphy_set_tx_power_control(dev, txpctl_mode);
+	kfree(saved_tab);
+}
+
+struct lpphy_rx_iq_comp { u8 chan; s8 c1, c0; };
+
+static const struct lpphy_rx_iq_comp lpphy_5354_iq_table[] = {
+	{ .chan = 1, .c1 = -66, .c0 = 15, },
+	{ .chan = 2, .c1 = -66, .c0 = 15, },
+	{ .chan = 3, .c1 = -66, .c0 = 15, },
+	{ .chan = 4, .c1 = -66, .c0 = 15, },
+	{ .chan = 5, .c1 = -66, .c0 = 15, },
+	{ .chan = 6, .c1 = -66, .c0 = 15, },
+	{ .chan = 7, .c1 = -66, .c0 = 14, },
+	{ .chan = 8, .c1 = -66, .c0 = 14, },
+	{ .chan = 9, .c1 = -66, .c0 = 14, },
+	{ .chan = 10, .c1 = -66, .c0 = 14, },
+	{ .chan = 11, .c1 = -66, .c0 = 14, },
+	{ .chan = 12, .c1 = -66, .c0 = 13, },
+	{ .chan = 13, .c1 = -66, .c0 = 13, },
+	{ .chan = 14, .c1 = -66, .c0 = 13, },
+};
+
+static const struct lpphy_rx_iq_comp lpphy_rev0_1_iq_table[] = {
+	{ .chan = 1, .c1 = -64, .c0 = 13, },
+	{ .chan = 2, .c1 = -64, .c0 = 13, },
+	{ .chan = 3, .c1 = -64, .c0 = 13, },
+	{ .chan = 4, .c1 = -64, .c0 = 13, },
+	{ .chan = 5, .c1 = -64, .c0 = 12, },
+	{ .chan = 6, .c1 = -64, .c0 = 12, },
+	{ .chan = 7, .c1 = -64, .c0 = 12, },
+	{ .chan = 8, .c1 = -64, .c0 = 12, },
+	{ .chan = 9, .c1 = -64, .c0 = 12, },
+	{ .chan = 10, .c1 = -64, .c0 = 11, },
+	{ .chan = 11, .c1 = -64, .c0 = 11, },
+	{ .chan = 12, .c1 = -64, .c0 = 11, },
+	{ .chan = 13, .c1 = -64, .c0 = 11, },
+	{ .chan = 14, .c1 = -64, .c0 = 10, },
+	{ .chan = 34, .c1 = -62, .c0 = 24, },
+	{ .chan = 38, .c1 = -62, .c0 = 24, },
+	{ .chan = 42, .c1 = -62, .c0 = 24, },
+	{ .chan = 46, .c1 = -62, .c0 = 23, },
+	{ .chan = 36, .c1 = -62, .c0 = 24, },
+	{ .chan = 40, .c1 = -62, .c0 = 24, },
+	{ .chan = 44, .c1 = -62, .c0 = 23, },
+	{ .chan = 48, .c1 = -62, .c0 = 23, },
+	{ .chan = 52, .c1 = -62, .c0 = 23, },
+	{ .chan = 56, .c1 = -62, .c0 = 22, },
+	{ .chan = 60, .c1 = -62, .c0 = 22, },
+	{ .chan = 64, .c1 = -62, .c0 = 22, },
+	{ .chan = 100, .c1 = -62, .c0 = 16, },
+	{ .chan = 104, .c1 = -62, .c0 = 16, },
+	{ .chan = 108, .c1 = -62, .c0 = 15, },
+	{ .chan = 112, .c1 = -62, .c0 = 14, },
+	{ .chan = 116, .c1 = -62, .c0 = 14, },
+	{ .chan = 120, .c1 = -62, .c0 = 13, },
+	{ .chan = 124, .c1 = -62, .c0 = 12, },
+	{ .chan = 128, .c1 = -62, .c0 = 12, },
+	{ .chan = 132, .c1 = -62, .c0 = 12, },
+	{ .chan = 136, .c1 = -62, .c0 = 11, },
+	{ .chan = 140, .c1 = -62, .c0 = 10, },
+	{ .chan = 149, .c1 = -61, .c0 = 9, },
+	{ .chan = 153, .c1 = -61, .c0 = 9, },
+	{ .chan = 157, .c1 = -61, .c0 = 9, },
+	{ .chan = 161, .c1 = -61, .c0 = 8, },
+	{ .chan = 165, .c1 = -61, .c0 = 8, },
+	{ .chan = 184, .c1 = -62, .c0 = 25, },
+	{ .chan = 188, .c1 = -62, .c0 = 25, },
+	{ .chan = 192, .c1 = -62, .c0 = 25, },
+	{ .chan = 196, .c1 = -62, .c0 = 25, },
+	{ .chan = 200, .c1 = -62, .c0 = 25, },
+	{ .chan = 204, .c1 = -62, .c0 = 25, },
+	{ .chan = 208, .c1 = -62, .c0 = 25, },
+	{ .chan = 212, .c1 = -62, .c0 = 25, },
+	{ .chan = 216, .c1 = -62, .c0 = 26, },
+};
+
+static const struct lpphy_rx_iq_comp lpphy_rev2plus_iq_comp = {
+	.chan = 0,
+	.c1 = -64,
+	.c0 = 0,
+};
+
+static u8 lpphy_nbits(s32 val)
+{
+	u32 tmp = abs(val);
+	u8 nbits = 0;
+
+	while (tmp != 0) {
+		nbits++;
+		tmp >>= 1;
+	}
+
+	return nbits;
+}
+
+static int lpphy_calc_rx_iq_comp(struct b43_wldev *dev, u16 samples)
+{
+	struct lpphy_iq_est iq_est;
+	u16 c0, c1;
+	int prod, ipwr, qpwr, prod_msb, q_msb, tmp1, tmp2, tmp3, tmp4, ret;
+
+	c1 = b43_phy_read(dev, B43_LPPHY_RX_COMP_COEFF_S);
+	c0 = c1 >> 8;
+	c1 |= 0xFF;
+
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, 0x00C0);
+	b43_phy_mask(dev, B43_LPPHY_RX_COMP_COEFF_S, 0x00FF);
+
+	ret = lpphy_rx_iq_est(dev, samples, 32, &iq_est);
+	if (!ret)
+		goto out;
+
+	prod = iq_est.iq_prod;
+	ipwr = iq_est.i_pwr;
+	qpwr = iq_est.q_pwr;
+
+	if (ipwr + qpwr < 2) {
+		ret = 0;
+		goto out;
+	}
+
+	prod_msb = lpphy_nbits(prod);
+	q_msb = lpphy_nbits(qpwr);
+	tmp1 = prod_msb - 20;
+
+	if (tmp1 >= 0) {
+		tmp3 = ((prod << (30 - prod_msb)) + (ipwr >> (1 + tmp1))) /
+			(ipwr >> tmp1);
+	} else {
+		tmp3 = ((prod << (30 - prod_msb)) + (ipwr << (-1 - tmp1))) /
+			(ipwr << -tmp1);
+	}
+
+	tmp2 = q_msb - 11;
+
+	if (tmp2 >= 0)
+		tmp4 = (qpwr << (31 - q_msb)) / (ipwr >> tmp2);
+	else
+		tmp4 = (qpwr << (31 - q_msb)) / (ipwr << -tmp2);
+
+	tmp4 -= tmp3 * tmp3;
+	tmp4 = -int_sqrt(tmp4);
+
+	c0 = tmp3 >> 3;
+	c1 = tmp4 >> 4;
+
+out:
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, c1);
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0x00FF, c0 << 8);
+	return ret;
+}
+
+/* Complex number using 2 32-bit signed integers */
+typedef struct {s32 i, q;} lpphy_c32;
+
+static lpphy_c32 lpphy_cordic(int theta)
+{
+	u32 arctg[] = { 2949120, 1740967, 919879, 466945, 234379, 117304,
+		      58666, 29335, 14668, 7334, 3667, 1833, 917, 458,
+		      229, 115, 57, 29, };
+	int i, tmp, signx = 1, angle = 0;
+	lpphy_c32 ret = { .i = 39797, .q = 0, };
+
+	theta = clamp_t(int, theta, -180, 180);
+
+	if (theta > 90) {
+		theta -= 180;
+		signx = -1;
+	} else if (theta < -90) {
+		theta += 180;
+		signx = -1;
+	}
+
+	for (i = 0; i <= 17; i++) {
+		if (theta > angle) {
+			tmp = ret.i - (ret.q >> i);
+			ret.q += ret.i >> i;
+			ret.i = tmp;
+			angle += arctg[i];
+		} else {
+			tmp = ret.i + (ret.q >> i);
+			ret.q -= ret.i >> i;
+			ret.i = tmp;
+			angle -= arctg[i];
+		}
+	}
+
+	ret.i *= signx;
+	ret.q *= signx;
+
+	return ret;
+}
+
+static void lpphy_run_samples(struct b43_wldev *dev, u16 samples, u16 loops,
+			      u16 wait)
+{
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_BUFFER_CTL,
+			0xFFC0, samples - 1);
+	if (loops != 0xFFFF)
+		loops--;
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_COUNT, 0xF000, loops);
+	b43_phy_maskset(dev, B43_LPPHY_SMPL_PLAY_BUFFER_CTL, 0x3F, wait << 6);
+	b43_phy_set(dev, B43_LPPHY_A_PHY_CTL_ADDR, 0x1);
+}
+
+//SPEC FIXME what does a negative freq mean?
+static void lpphy_start_tx_tone(struct b43_wldev *dev, s32 freq, u16 max)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	u16 buf[64];
+	int i, samples = 0, angle = 0, rotation = (9 * freq) / 500;
+	lpphy_c32 sample;
+
+	lpphy->tx_tone_freq = freq;
+
+	if (freq) {
+		/* Find i for which abs(freq) integrally divides 20000 * i */
+		for (i = 1; samples * abs(freq) != 20000 * i; i++) {
+			samples = (20000 * i) / abs(freq);
+			if(B43_WARN_ON(samples > 63))
+				return;
+		}
+	} else {
+		samples = 2;
+	}
+
+	for (i = 0; i < samples; i++) {
+		sample = lpphy_cordic(angle);
+		angle += rotation;
+		buf[i] = ((sample.i * max) & 0xFF) << 8;
+		buf[i] |= (sample.q * max) & 0xFF;
+	}
+
+	b43_lptab_write_bulk(dev, B43_LPTAB16(5, 0), samples, buf);
+
+	lpphy_run_samples(dev, samples, 0xFFFF, 0);
+}
+
+static void lpphy_stop_tx_tone(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	int i;
+
+	lpphy->tx_tone_freq = 0;
+
+	b43_phy_mask(dev, B43_LPPHY_SMPL_PLAY_COUNT, 0xF000);
+	for (i = 0; i < 31; i++) {
+		if (!(b43_phy_read(dev, B43_LPPHY_A_PHY_CTL_ADDR) & 0x1))
+			break;
+		udelay(100);
+	}
+}
+
+
+static void lpphy_papd_cal(struct b43_wldev *dev, struct lpphy_tx_gains gains,
+			   int mode, bool useindex, u8 index)
+{
+	//TODO
+}
+
+static void lpphy_papd_cal_txpwr(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct ssb_bus *bus = dev->dev->bus;
+	struct lpphy_tx_gains gains, oldgains;
+	int old_txpctl, old_afe_ovr, old_rf, old_bbmult;
+
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	old_txpctl = lpphy->txpctl_mode;
+	old_afe_ovr = b43_phy_read(dev, B43_LPPHY_AFE_CTL_OVR) & 0x40;
+	if (old_afe_ovr)
+		oldgains = lpphy_get_tx_gains(dev);
+	old_rf = b43_phy_read(dev, B43_LPPHY_RF_PWR_OVERRIDE) & 0xFF;
+	old_bbmult = lpphy_get_bb_mult(dev);
+
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+
+	if (bus->chip_id == 0x4325 && bus->chip_rev == 0)
+		lpphy_papd_cal(dev, gains, 0, 1, 30);
+	else
+		lpphy_papd_cal(dev, gains, 0, 1, 65);
+
+	if (old_afe_ovr)
+		lpphy_set_tx_gains(dev, oldgains);
+	lpphy_set_bb_mult(dev, old_bbmult);
+	lpphy_set_tx_power_control(dev, old_txpctl);
+	b43_phy_maskset(dev, B43_LPPHY_RF_PWR_OVERRIDE, 0xFF00, old_rf);
+}
+
+static int lpphy_rx_iq_cal(struct b43_wldev *dev, bool noise, bool tx,
+			    bool rx, bool pa, struct lpphy_tx_gains *gains)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct ssb_bus *bus = dev->dev->bus;
+	const struct lpphy_rx_iq_comp *iqcomp = NULL;
+	struct lpphy_tx_gains nogains, oldgains;
+	u16 tmp;
+	int i, ret;
+
+	memset(&nogains, 0, sizeof(nogains));
+	memset(&oldgains, 0, sizeof(oldgains));
+
+	if (bus->chip_id == 0x5354) {
+		for (i = 0; i < ARRAY_SIZE(lpphy_5354_iq_table); i++) {
+			if (lpphy_5354_iq_table[i].chan == lpphy->channel) {
+				iqcomp = &lpphy_5354_iq_table[i];
+			}
+		}
+	} else if (dev->phy.rev >= 2) {
+		iqcomp = &lpphy_rev2plus_iq_comp;
+	} else {
+		for (i = 0; i < ARRAY_SIZE(lpphy_rev0_1_iq_table); i++) {
+			if (lpphy_rev0_1_iq_table[i].chan == lpphy->channel) {
+				iqcomp = &lpphy_rev0_1_iq_table[i];
+			}
+		}
+	}
+
+	if (B43_WARN_ON(!iqcomp))
+		return 0;
+
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S, 0xFF00, iqcomp->c1);
+	b43_phy_maskset(dev, B43_LPPHY_RX_COMP_COEFF_S,
+			0x00FF, iqcomp->c0 << 8);
+
+	if (noise) {
+		tx = true;
+		rx = false;
+		pa = false;
+	}
+
+	lpphy_set_trsw_over(dev, tx, rx);
+
+	if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x8);
+		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0,
+				0xFFF7, pa << 3);
+	} else {
+		b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x20);
+		b43_phy_maskset(dev, B43_LPPHY_RF_OVERRIDE_VAL_0,
+				0xFFDF, pa << 5);
+	}
+
+	tmp = b43_phy_read(dev, B43_LPPHY_AFE_CTL_OVR) & 0x40;
+
+	if (noise)
+		lpphy_set_rx_gain(dev, 0x2D5D);
+	else {
+		if (tmp)
+			oldgains = lpphy_get_tx_gains(dev);
+		if (!gains)
+			gains = &nogains;
+		lpphy_set_tx_gains(dev, *gains);
+	}
+
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xFFFE);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_0, 0x800);
+	b43_phy_set(dev, B43_LPPHY_RF_OVERRIDE_VAL_0, 0x800);
+	lpphy_set_deaf(dev, false);
+	if (noise)
+		ret = lpphy_calc_rx_iq_comp(dev, 0xFFF0);
+	else {
+		lpphy_start_tx_tone(dev, 4000, 100);
+		ret = lpphy_calc_rx_iq_comp(dev, 0x4000);
+		lpphy_stop_tx_tone(dev);
+	}
+	lpphy_clear_deaf(dev, false);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFFC);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFF7);
+	b43_phy_mask(dev, B43_LPPHY_RF_OVERRIDE_0, 0xFFDF);
+	if (!noise) {
+		if (tmp)
+			lpphy_set_tx_gains(dev, oldgains);
+		else
+			lpphy_disable_tx_gain_override(dev);
+	}
+	lpphy_disable_rx_gain_override(dev);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVR, 0xFFFE);
+	b43_phy_mask(dev, B43_LPPHY_AFE_CTL_OVRVAL, 0xF7FF);
+	return ret;
+}
+
+static void lpphy_calibration(struct b43_wldev *dev)
+{
+	struct b43_phy_lp *lpphy = dev->phy.lp;
+	enum b43_lpphy_txpctl_mode saved_pctl_mode;
+	bool full_cal = false;
+
+	if (lpphy->full_calib_chan != lpphy->channel) {
+		full_cal = true;
+		lpphy->full_calib_chan = lpphy->channel;
+	}
+
+	b43_mac_suspend(dev);
+
+	lpphy_btcoex_override(dev);
+	if (dev->phy.rev >= 2)
+		lpphy_save_dig_flt_state(dev);
+	lpphy_read_tx_pctl_mode_from_hardware(dev);
+	saved_pctl_mode = lpphy->txpctl_mode;
+	lpphy_set_tx_power_control(dev, B43_LPPHY_TXPCTL_OFF);
+	//TODO Perform transmit power table I/Q LO calibration
+	if ((dev->phy.rev == 0) && (saved_pctl_mode != B43_LPPHY_TXPCTL_OFF))
+		lpphy_pr41573_workaround(dev);
+	if ((dev->phy.rev >= 2) && full_cal) {
+		lpphy_papd_cal_txpwr(dev);
+	}
+	lpphy_set_tx_power_control(dev, saved_pctl_mode);
+	if (dev->phy.rev >= 2)
+		lpphy_restore_dig_flt_state(dev);
+	lpphy_rx_iq_cal(dev, true, true, false, false, NULL);
+
+	b43_mac_enable(dev);
+}
+
 static u16 b43_lpphy_op_read(struct b43_wldev *dev, u16 reg)
 {
 	b43_write16(dev, B43_MMIO_PHY_CONTROL, reg);
@@ -1539,12 +2081,6 @@ static void b43_lpphy_op_radio_write(struct b43_wldev *dev, u16 reg, u16 value)
 	b43_write16(dev, B43_MMIO_RADIO_DATA_LOW, value);
 }
 
-static void b43_lpphy_op_software_rfkill(struct b43_wldev *dev,
-					 bool blocked)
-{
-	//TODO
-}
-
 struct b206x_channel {
 	u8 channel;
 	u16 freq;
@@ -2010,22 +2546,6 @@ static int lpphy_b2062_tune(struct b43_wldev *dev,
 	return err;
 }
 
-
-/* This was previously called lpphy_japan_filter */
-static void lpphy_set_analog_filter(struct b43_wldev *dev, int channel)
-{
-	struct b43_phy_lp *lpphy = dev->phy.lp;
-	u16 tmp = (channel == 14); //SPEC FIXME check japanwidefilter!
-
-	if (dev->phy.rev < 2) { //SPEC FIXME Isn't this rev0/1-specific?
-		b43_phy_maskset(dev, B43_LPPHY_LP_PHY_CTL, 0xFCFF, tmp << 9);
-		if ((dev->phy.rev == 1) && (lpphy->rc_cap))
-			lpphy_set_rc_cap(dev);
-	} else {
-		b43_radio_write(dev, B2063_TX_BB_SP3, 0x3F);
-	}
-}
-
 static void lpphy_b2063_vco_calib(struct b43_wldev *dev)
 {
 	u16 tmp;
@@ -2210,18 +2730,6 @@ static int b43_lpphy_op_init(struct b43_wldev *dev)
 	return 0;
 }
 
-static void b43_lpphy_op_set_rx_antenna(struct b43_wldev *dev, int antenna)
-{
-	if (dev->phy.rev >= 2)
-		return; // rev2+ doesn't support antenna diversity
-
-	if (B43_WARN_ON(antenna > B43_ANTENNA_AUTO1))
-		return;
-
-	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFD, antenna & 0x2);
-	b43_phy_maskset(dev, B43_LPPHY_CRSGAIN_CTL, 0xFFFE, antenna & 0x1);
-}
-
 static void b43_lpphy_op_adjust_txpower(struct b43_wldev *dev)
 {
 	//TODO
@@ -2244,6 +2752,11 @@ void b43_lpphy_op_switch_analog(struct b43_wldev *dev, bool on)
        }
 }
 
+static void b43_lpphy_op_pwork_15sec(struct b43_wldev *dev)
+{
+	//TODO
+}
+
 const struct b43_phy_operations b43_phyops_lp = {
 	.allocate		= b43_lpphy_op_allocate,
 	.free			= b43_lpphy_op_free,
@@ -2261,4 +2774,6 @@ const struct b43_phy_operations b43_phyops_lp = {
 	.set_rx_antenna		= b43_lpphy_op_set_rx_antenna,
 	.recalc_txpower		= b43_lpphy_op_recalc_txpower,
 	.adjust_txpower		= b43_lpphy_op_adjust_txpower,
+	.pwork_15sec		= b43_lpphy_op_pwork_15sec,
+	.pwork_60sec		= lpphy_calibration,
 };
diff --git a/drivers/net/wireless/b43/phy_lp.h b/drivers/net/wireless/b43/phy_lp.h
index c3232c1..62737f7 100644
--- a/drivers/net/wireless/b43/phy_lp.h
+++ b/drivers/net/wireless/b43/phy_lp.h
@@ -286,6 +286,7 @@
 #define B43_LPPHY_TR_LOOKUP_6			B43_PHY_OFDM(0xC8) /* TR Lookup 6 */
 #define B43_LPPHY_TR_LOOKUP_7			B43_PHY_OFDM(0xC9) /* TR Lookup 7 */
 #define B43_LPPHY_TR_LOOKUP_8			B43_PHY_OFDM(0xCA) /* TR Lookup 8 */
+#define B43_LPPHY_RF_PWR_OVERRIDE		B43_PHY_OFDM(0xD3) /* RF power override */
 
 
 
@@ -871,12 +872,12 @@ struct b43_phy_lp {
 	u8 rssi_gs;
 
 	/* RC cap */
-	u8 rc_cap; /* FIXME initial value? */
+	u8 rc_cap;
 	/* BX arch */
 	u8 bx_arch;
 
 	/* Full calibration channel */
-	u8 full_calib_chan; /* FIXME initial value? */
+	u8 full_calib_chan;
 
 	/* Transmit iqlocal best coeffs */
 	bool tx_iqloc_best_coeffs_valid;
@@ -891,6 +892,12 @@ struct b43_phy_lp {
 
 	/* The channel we are tuned to */
 	u8 channel;
+
+	/* The active antenna diversity mode */
+	int antenna;
+
+	/* Frequency of the active TX tone */
+	int tx_tone_freq;
 };
 
 enum tssi_mux_mode {
-- 
1.6.4.2



From mb at bu3sch.de  Sun Oct 25 16:54:14 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 25 Oct 2009 16:54:14 +0100
Subject: [PATCH] b43: LP-PHY: Begin implementing calibration & software
	RFKILL support
In-Reply-To: <1256484396-31063-1-git-send-email-netrolller.3d@gmail.com>
References: <1256484396-31063-1-git-send-email-netrolller.3d@gmail.com>
Message-ID: <200910251654.17050.mb@bu3sch.de>

On Sunday 25 October 2009 16:26:36 G?bor Stefanik wrote:
> Michael, could you please do the PHY reset part? I can't seem to
> understand its relationship to wireless_core_reset... also, it's
> heavily ssb-speak, which I am not good at.

Where are the specifications?

-- 
Greetings, Michael.


From netrolller.3d at gmail.com  Sun Oct 25 16:57:44 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 16:57:44 +0100
Subject: [PATCH] b43: LP-PHY: Begin implementing calibration & software 
	RFKILL support
In-Reply-To: <200910251654.17050.mb@bu3sch.de>
References: <1256484396-31063-1-git-send-email-netrolller.3d@gmail.com> 
	<200910251654.17050.mb@bu3sch.de>
Message-ID: <69e28c910910250857l341cc114w46224b94cda36f3e@mail.gmail.com>

2009/10/25 Michael Buesch <mb at bu3sch.de>:
> On Sunday 25 October 2009 16:26:36 G?bor Stefanik wrote:
>> Michael, could you please do the PHY reset part? I can't seem to
>> understand its relationship to wireless_core_reset... also, it's
>> heavily ssb-speak, which I am not good at.
>
> Where are the specifications?
>
> --
> Greetings, Michael.
>

They are @ http://bcm-v4.sipsolutions.net/802.11/PHY/Reset - it shows
some similarity to wireless_core_reset, but it is not an exact match.

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Sun Oct 25 17:00:05 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 25 Oct 2009 17:00:05 +0100
Subject: [PATCH] b43: LP-PHY: Begin implementing calibration & software
	RFKILL support
In-Reply-To: <69e28c910910250857l341cc114w46224b94cda36f3e@mail.gmail.com>
References: <1256484396-31063-1-git-send-email-netrolller.3d@gmail.com>
	<200910251654.17050.mb@bu3sch.de>
	<69e28c910910250857l341cc114w46224b94cda36f3e@mail.gmail.com>
Message-ID: <200910251700.06859.mb@bu3sch.de>

On Sunday 25 October 2009 16:57:44 G?bor Stefanik wrote:
> 2009/10/25 Michael Buesch <mb at bu3sch.de>:
> > On Sunday 25 October 2009 16:26:36 G?bor Stefanik wrote:
> >> Michael, could you please do the PHY reset part? I can't seem to
> >> understand its relationship to wireless_core_reset... also, it's
> >> heavily ssb-speak, which I am not good at.
> >
> > Where are the specifications?
> >
> > --
> > Greetings, Michael.
> >
> 
> They are @ http://bcm-v4.sipsolutions.net/802.11/PHY/Reset - it shows
> some similarity to wireless_core_reset, but it is not an exact match.

Well, I don't know. Just implement it in another function.
I don't have the time to dig into this.

-- 
Greetings, Michael.


From simon at schampijer.de  Sun Oct 25 19:07:18 2009
From: simon at schampijer.de (Simon Schampijer)
Date: Sun, 25 Oct 2009 19:07:18 +0100
Subject: b43 driver disconects after a few minutes with airport extreme
Message-ID: <4AE493D6.60407@schampijer.de>

Hi,

I am using the b43 driver for my Apple Airport Extrem card (Powerbook 
G4), firmware ucode5.fw. When I start some networking action (fe 
minutes) the driver disconnects and tries to authenticate again. This 
does not work. It is only able after rebooting. The issue is 
reproducable all the time.

I have attached the info requested at: 
http://linuxwireless.org/en/users/Drivers/b43#bug_reporting

Let me know if you need something else.

Regards,
    Simon


uname -a: Linux kassiopeia 2.6.30-2-powerpc #1 Sat Oct 3 22:43:22 UTC 
2009 ppc GNU/Linux

lspci -vvn|grep 43 -A7:
0001:10:12.0 0280: 14e4:4320 (rev 03)
	Subsystem: 106b:004e
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- 
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- <TAbort- 
<MAbort- >SERR- <PERR- INTx-
	Latency: 16
	Interrupt: pin A routed to IRQ 52
	Region 0: Memory at 80084000 (32-bit, non-prefetchable) [size=8K]
	Capabilities: [40] Power Management version 2
--
	Kernel driver in use: b43-pci-bridge

0001:10:17.0 ff00: 106b:003e
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- 
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap- 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- 
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 16, Cache Line Size: 32 bytes
	Region 0: Memory at 80000000 (32-bit, non-prefetchable) [size=512K]
	Kernel driver in use: macio
--
0001:10:1b.0 0c03: 1033:0035 (rev 43) (prog-if 10 [OHCI])
	Subsystem: 1033:0035
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- 
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- 
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 16 (250ns min, 10500ns max), Cache Line Size: 32 bytes
	Interrupt: pin A routed to IRQ 63
	Region 0: Memory at 80082000 (32-bit, non-prefetchable) [size=4K]
	Capabilities: [40] Power Management version 2
--
0001:10:1b.1 0c03: 1033:0035 (rev 43) (prog-if 10 [OHCI])
	Subsystem: 1033:0035
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- 
Stepping- SERR- FastB2B- DisINTx-
	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- 
<TAbort- <MAbort- >SERR- <PERR- INTx-
	Latency: 16 (250ns min, 10500ns max), Cache Line Size: 32 bytes
	Interrupt: pin B routed to IRQ 63
	Region 0: Memory at 80081000 (32-bit, non-prefetchable) [size=4K]
	Capabilities: [40] Power Management version 2


dmesg: attached
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmesg.log
Type: text/x-log
Size: 28846 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20091025/6b0c5187/attachment.bin>

From netrolller.3d at gmail.com  Sun Oct 25 19:30:56 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 19:30:56 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
Message-ID: <69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>

On Sun, Oct 25, 2009 at 7:17 PM, Linus Torvalds
<torvalds at linux-foundation.org> wrote:
>
> Ok, so I got myself (or rather, Patricia) a new Dell 11 inspiron laptop,
> and everything seems to work, except for the wireless. It's a Broadcom
> BCM4312b/g LP-PHY.
>
> In fact, even the wireless works at least to _some_ degree, because I saw
> the wireless networks listed once (but I can't seem to recreate that now),
> but:
>
> ?- I get a _lot_ of noise in dmesg:
>
> ? ? ? ?b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> ? ? ? ?b43-phy0: Controller RESET (DMA error) ...
> ? ? ? ?b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> ? ? ? ?b43-phy0: Controller restarted
>
> ?- the 'phy0' kernel thread seems to spend all its time presumably doing
> ? that firmware reloading (looks like 20% CPU time in top)
>
> ?- the wireless doesn't seem to actually ever succeed in connecting even
> ? the one time it saw something, and 'rmmod b43' just hangs.
>
> The network I'm trying to connect to is just a random 128-bit WEP thing.
> But while I once got far enough to see it (I think that was with the
> 4.150.10.5 firmware - I started out using the wrong one by mistake), now I
> can't even see the networks, so I doubt that matters.
>
> Maybe it's all as simple as me just having the wrong firmware version or
> something. But it's the version documented at
>
> ? ? ? ?http://linuxwireless.org/en/users/Drivers/b43
>
> for the LP-PHY case.
>
> This is with current -git (v2.6.32-rc5-81-g964fe08), and lspci reports
>
> ? ? ? ?08:00.0 0280: 14e4:4315 (rev 01)
> ? ? ? ? ? ? ? ?Subsystem: 1028:000c
> ? ? ? ? ? ? ? ?Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-
> ? ? ? ? ? ? ? ?Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- <TAbort- <MAbort- >SERR- <PERR- INTx-
> ? ? ? ? ? ? ? ?Latency: 0, Cache Line Size: 64 bytes
> ? ? ? ? ? ? ? ?Interrupt: pin A routed to IRQ 17
> ? ? ? ? ? ? ? ?Region 0: Memory at f0600000 (64-bit, non-prefetchable) [size=16K]
> ? ? ? ? ? ? ? ?Capabilities: <access denied>
> ? ? ? ? ? ? ? ?Kernel driver in use: b43-pci-bridge
> ? ? ? ? ? ? ? ?Kernel modules: ssb
> ? ? ? ?00: e4 14 15 43 06 00 10 00 01 00 80 02 10 00 00 00
> ? ? ? ?10: 04 00 60 f0 00 00 00 00 00 00 00 00 00 00 00 00
> ? ? ? ?20: 00 00 00 00 00 00 00 00 00 00 00 00 28 10 0c 00
> ? ? ? ?30: 00 00 00 00 40 00 00 00 00 00 00 00 0a 01 00 00
>
> with dmesg saying
>
> ? ? ? ?b43-pci-bridge 0000:08:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
> ? ? ? ?b43-pci-bridge 0000:08:00.0: setting latency timer to 64
> ? ? ? ?...
> ? ? ? ?cfg80211: Calling CRDA to update world regulatory domain
> ? ? ? ?...
> ? ? ? ?cfg80211: World regulatory domain updated:
> ? ? ? ? ? ? ? ?(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
> ? ? ? ? ? ? ? ?(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ?b43-phy0: Broadcom 4312 WLAN found (core revision 15)
> ? ? ? ?...
> ? ? ? ?phy0: Selected rate control algorithm 'minstrel'
> ? ? ? ?Registered led device: b43-phy0::tx
> ? ? ? ?Registered led device: b43-phy0::rx
> ? ? ? ?Registered led device: b43-phy0::radio
> ? ? ? ?Broadcom 43xx driver loaded [ Features: PML, Firmware-ID: FW13 ]
> ? ? ? ?...
> ? ? ? ?cfg80211: Calling CRDA for country: US
> ? ? ? ?cfg80211: Regulatory domain changed to country: US
> ? ? ? ? ? ? ? ?(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
> ? ? ? ? ? ? ? ?(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
> ? ? ? ? ? ? ? ?(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
> ? ? ? ? ? ? ? ?(5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(5490000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
> ? ? ? ? ? ? ? ?(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
> ? ? ? ?...
> ? ? ? ?b43 ssb0:0: firmware: requesting b43/ucode15.fw
> ? ? ? ?b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
> ? ? ? ?b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
> ? ? ? ?b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> ? ? ? ?...
> ? ? ? ?b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> ? ? ? ?b43-phy0: Controller RESET (DMA error) ...
> ? ? ? ?b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> ? ? ? ?b43-phy0 ERROR:
> ? ? ? ?b43-phy0: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> ? ? ? ?b43-phy0: Controller RESET (DMA error) ...
> ? ? ? ?Controller restarted
> ? ? ? ?b43-phy0 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> ? ? ? ?b43-phy0: Controller RESET (DMA error) ...
>
> with that "b43-phy0" mess then going on forever (happily at least
> ratelimited).
>
> I can obviously test patches etc.
>
> ? ? ? ? ? ? ? ? ? ? ? ?Linus
>

Hello,

Could you please test the tag "master-2009-08-26" from
wireless-testing? That one was the first version that worked, and in
that specific build, my card (exactly the same as yours) worked
perfectly, leading me to suspect a regression (probably not in the b43
driver, but in something else interfering with b43). Also try apic=off
& acpi=off (IIRC another DMA error victim, but with error code
0x00000800 had ACPI clobbering his DMA).

Also, is there any reference to a failed channel switch in the log?

Thanks,
G?bor

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From netrolller.3d at gmail.com  Sun Oct 25 21:46:29 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 21:46:29 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910251322560.3618@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain> 
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com> 
	<alpine.LFD.2.01.0910251322560.3618@localhost.localdomain>
Message-ID: <69e28c910910251346o614be99fqa0ea58fd2b5a6db6@mail.gmail.com>

2009/10/25 Linus Torvalds <torvalds at linux-foundation.org>:
>
>
> On Sun, 25 Oct 2009, G?bor Stefanik wrote:
>>
>> Could you please test the tag "master-2009-08-26" from
>> wireless-testing? That one was the first version that worked, and in
>> that specific build, my card (exactly the same as yours) worked
>> perfectly, leading me to suspect a regression (probably not in the b43
>> driver, but in something else interfering with b43).
>
> Will try. Are you using that same firmware version?

Yes, I have v478 also. However, I tried to build the latest
wireless-testing tree, but I can't reproduce the error here.

One thing I have noticed is that everyone so far with this error
appears to have a HP or Dell laptop - I have tested with a
custom-built desktop with an Asus motherboard. I will test my other
4312 in my Acer laptop later (I don't own a Dell or a HP).

Could you describe the exact HW configuration of your system
(including the BIOS type - my Acer has InsydeH2O, while my desktop is
AMI-based)?

Does the wl_hybrid driver work for you? (If it does work, please try
building the latest compat-wireless for the kernel on which wl_hybrid
worked, and post the results. Try the compat-wireless driver both on a
cold boot and after wl_hybrid has been unloaded.)

>
>> Also try apic=off & acpi=off (IIRC another DMA error victim, but with
>> error code 0x00000800 had ACPI clobbering his DMA).
>
> Ok, will try that separately.
>
>> Also, is there any reference to a failed channel switch in the log?
>
> Nope.

Then it's a different bug than the 0x00000800 one, which also caused
channel switching to fail.

>
> ? ? ? ? ? ? ? ? ? ? ? ?Linus
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From chris at cvine.freeserve.co.uk  Sun Oct 25 22:02:49 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 25 Oct 2009 21:02:49 +0000
Subject: b43 fatal DMA errors
In-Reply-To: <69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
Message-ID: <20091025210249.7deecd71@boulder.homenet>

On Sun, 25 Oct 2009 19:30:56 +0100
G?bor Stefanik <netrolller.3d at gmail.com> wrote:
> Also try apic=off
> & acpi=off (IIRC another DMA error victim, but with error code
> 0x00000800 had ACPI clobbering his DMA).

Specifically me, and I resolved it, until it is fixed, by blacklisting
the 'processor' ACPI module.  (However in my case I am using an Atom
N270 processor and that may make a difference.)

Chris




From netrolller.3d at gmail.com  Sun Oct 25 22:40:50 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 22:40:50 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain> 
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com> 
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain> 
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
Message-ID: <69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>

On Sun, Oct 25, 2009 at 10:39 PM, Linus Torvalds
<torvalds at linux-foundation.org> wrote:
>
>
> On Sun, 25 Oct 2009, Linus Torvalds wrote:
>>
>> Ok, this machine is a 1.3GHz Core 2 Duo, so no Atom crap.
>
> Oh, and I compile for x86-64, in case anybody cares. But I assume all sane
> developers have long since abandoned 32-bit mode, so I can't imagine that
> there is some 32-vs-64-bit issue.
>
> Btw, here's the dmesg from a few seconds after loading that driver with
> CONFIG_B43_DEBUG enabled.
>
> Just for fun, I'll also try what FORCE_PIO results in..
>
> ? ? ? ? ? ? ? ?Linus

0x00000400 is "DMA PCI Descriptor Error" - not sure what it actually means.

BTW your dmidecode reveals that this is a modified PhoenixBIOS
(non-Award) - I wonder if others with this error are also PhoenixBios
users...

Another thing to test: boot into Windows (or any other OS where the
card works), initialize the card, reboot (not cold-boot) into Linux,
try to load b43. If this succeeds, then we are missing something in
the init routine.

>
> ---
> b43-phy1: Broadcom 4312 WLAN found (core revision 15)
> b43-phy1 debug: Found PHY: Analog 6, Type 5, Revision 1
> b43-phy1 debug: Found Radio: Manuf 0x17F, Version 0x2062, Revision 2
> phy1: Selected rate control algorithm 'minstrel'
> Registered led device: b43-phy1::tx
> Registered led device: b43-phy1::rx
> Registered led device: b43-phy1::radio
> Broadcom 43xx driver loaded [ Features: PML, Firmware-ID: FW13 ]
> b43 ssb0:0: firmware: requesting b43/ucode15.fw
> b43 ssb0:0: firmware: requesting b43/lp0initvals15.fw
> b43 ssb0:0: firmware: requesting b43/lp0bsinitvals15.fw
> b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy1 debug: Chip initialized
> b43-phy1 debug: 64-bit DMA initialized
> b43-phy1 debug: QoS enabled
> b43-phy1 debug: Wireless interface started
> b43-phy1 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> b43-phy1: Controller RESET (DMA error) ...
> b43-phy1 debug: Adding Interface type 2
> b43-phy1 debug: Wireless interface stopped
> b43-phy1 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy1 debug: Chip initialized
> b43-phy1 debug: 64-bit DMA initialized
> b43-phy1 debug: QoS enabled
> b43-phy1 debug: Wireless interface started
> b43-phy1: Controller restarted
> b43-phy1 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> b43-phy1: Controller RESET (DMA error) ...
> b43-phy1 ERROR: Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> b43-phy1: Controller RESET (DMA error) ...
> b43-phy1 debug: Wireless interface stopped
> b43-phy1 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1: Loading firmware version 478.104 (2008-07-01 00:50:23)
> b43-phy1 debug: b2062: Using crystal tab entry 19200 kHz.
> b43-phy1 debug: Chip initialized
> b43-phy1 debug: 64-bit DMA initialized
> b43-phy1 debug: QoS enabled
> b43-phy1 debug: Wireless interface started
> b43-phy1 ERROR:
> b43-phy1: Controller restarted
> Fatal DMA error: 0x00000400, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
> b43-phy1: Controller RESET (DMA error) ...
> b43-phy1 debug: Wireless interface stopped
> b43-phy1 debug: DMA-64 rx_ring: Used slots 0/64, Failed frames 0/0 = 0.0%, Average tries 0.00
> ADDRCONF(NETDEV_UP): wlan0: link is not ready
> b43-phy1 debug: DMA-64 tx_ring_AC_BK: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_BE: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VI: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_AC_VO: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
> b43-phy1 debug: DMA-64 tx_ring_mcast: Used slots 0/256, Failed frames 0/0 = 0.0%, Average tries 0.00
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From Larry.Finger at lwfinger.net  Sun Oct 25 22:12:10 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 25 Oct 2009 16:12:10 -0500
Subject: b43 fatal DMA errors
In-Reply-To: <69e28c910910251346o614be99fqa0ea58fd2b5a6db6@mail.gmail.com>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<alpine.LFD.2.01.0910251322560.3618@localhost.localdomain>
	<69e28c910910251346o614be99fqa0ea58fd2b5a6db6@mail.gmail.com>
Message-ID: <4AE4BF2A.5030907@lwfinger.net>

On 10/25/2009 03:46 PM, G?bor Stefanik wrote:
> 2009/10/25 Linus Torvalds <torvalds at linux-foundation.org>:
>>
>>
>> On Sun, 25 Oct 2009, G?bor Stefanik wrote:
>>>
>>> Could you please test the tag "master-2009-08-26" from
>>> wireless-testing? That one was the first version that worked, and in
>>> that specific build, my card (exactly the same as yours) worked
>>> perfectly, leading me to suspect a regression (probably not in the b43
>>> driver, but in something else interfering with b43).
>>
>> Will try. Are you using that same firmware version?
> 
> Yes, I have v478 also. However, I tried to build the latest
> wireless-testing tree, but I can't reproduce the error here.
> 
> One thing I have noticed is that everyone so far with this error
> appears to have a HP or Dell laptop - I have tested with a
> custom-built desktop with an Asus motherboard. I will test my other
> 4312 in my Acer laptop later (I don't own a Dell or a HP).
> 
> Could you describe the exact HW configuration of your system
> (including the BIOS type - my Acer has InsydeH2O, while my desktop is
> AMI-based)?
> 
> Does the wl_hybrid driver work for you? (If it does work, please try
> building the latest compat-wireless for the kernel on which wl_hybrid
> worked, and post the results. Try the compat-wireless driver both on a
> cold boot and after wl_hybrid has been unloaded.)
> 
>>
>>> Also try apic=off & acpi=off (IIRC another DMA error victim, but with
>>> error code 0x00000800 had ACPI clobbering his DMA).
>>
>> Ok, will try that separately.
>>
>>> Also, is there any reference to a failed channel switch in the log?
>>
>> Nope.
> 
> Then it's a different bug than the 0x00000800 one, which also caused
> channel switching to fail.

I do not see the DMA problem on an HP dv2815, no matter whether I run
kernels from wireless-testing, mainline 2.6.32-rcX, or 2.6.31.5 from
openSUSE 11.2 RC1 with compat-wireless later than 1-OCT-2009.

For completeness, the specification page at
http://bcm-v4.sipsolutions.net/802.11/Registers shows the error
0x00000800 to be a PCI data error and 0x00000400 to be a DMA
descriptor error. For netbooks with Atom CPUs, the PCI data error
seems to be due to ACPI errors. It is not clear what causes the DMA
descriptor error. Too bad one of the devs doesn't see this error.

Larry


From chris at cvine.freeserve.co.uk  Sun Oct 25 22:57:08 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 25 Oct 2009 21:57:08 +0000
Subject: b43 fatal DMA errors
In-Reply-To: <69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain>
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
Message-ID: <20091025215708.6f2f432b@boulder.homenet>

On Sun, 25 Oct 2009 22:40:50 +0100
G?bor Stefanik <netrolller.3d at gmail.com> wrote:
> Another thing to test: boot into Windows (or any other OS where the
> card works), initialize the card, reboot (not cold-boot) into Linux,
> try to load b43. If this succeeds, then we are missing something in
> the init routine.

You already know that this eliminates the DMA errors.  I have reported
twice that if I boot up with the 2.6.27 kernel and install the broadcom
b43 driver to intialise the wireless device, and then do a warm reboot
to 2.6.32-rc5, then b43 works correctly.

I was informed that this was irrelevant and that since acpi=off works
then it must be an ACPI problem.

By the way, my machine does use Phoenix BIOS.

Chris




From chris at cvine.freeserve.co.uk  Sun Oct 25 23:00:14 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 25 Oct 2009 22:00:14 +0000
Subject: b43 fatal DMA errors
In-Reply-To: <20091025215708.6f2f432b@boulder.homenet>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain>
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
	<20091025215708.6f2f432b@boulder.homenet>
Message-ID: <20091025220014.6a3c9ec9@boulder.homenet>

On Sun, 25 Oct 2009 21:57:08 +0000
Chris Vine <chris at cvine.freeserve.co.uk> wrote:

> On Sun, 25 Oct 2009 22:40:50 +0100
> G?bor Stefanik <netrolller.3d at gmail.com> wrote:
> > Another thing to test: boot into Windows (or any other OS where the
> > card works), initialize the card, reboot (not cold-boot) into Linux,
> > try to load b43. If this succeeds, then we are missing something in
> > the init routine.
> 
> You already know that this eliminates the DMA errors.  I have reported
> twice that if I boot up with the 2.6.27 kernel and install the
> broadcom b43 driver to intialise the wireless device, and then do a
> warm reboot to 2.6.32-rc5, then b43 works correctly.
>

Sorry, I meant "if I boot up with the 2.6.27 kernel and install the
broadcom wl driver to intialise the wireless device" (ie if I do a
first (cold) boot with the proprietary driver).

Chris




From chris at cvine.freeserve.co.uk  Sun Oct 25 23:13:46 2009
From: chris at cvine.freeserve.co.uk (Chris Vine)
Date: Sun, 25 Oct 2009 22:13:46 +0000
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain>
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
	<20091025215708.6f2f432b@boulder.homenet>
	<alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
Message-ID: <20091025221346.00c0c65e@boulder.homenet>

On Sun, 25 Oct 2009 15:08:11 -0700 (PDT)
Linus Torvalds <torvalds at linux-foundation.org> wrote:
> On Sun, 25 Oct 2009, Chris Vine wrote:
> >
> > On Sun, 25 Oct 2009 22:40:50 +0100 G?bor Stefanik
> > <netrolller.3d at gmail.com> suggested:
> > > Another thing to test: boot into Windows (or any other OS where
> > > the [..]
> > 
> > You already know that this eliminates the DMA errors.  I have
> > reported twice that if I boot up with the 2.6.27 kernel and install
> > the broadcom b43 driver to intialise the wireless device, and then
> > do a warm reboot to 2.6.32-rc5, then b43 works correctly.
> 
> Is there some way to dump all the device registers behind the SSB
> bridge? If so, dumping them for the warm-boot and cold-boot cases,
> and seeing where they are different might be an obvious clue, and
> point to something that isn't initialized correctly.
> 
> And Chris, just out of interest - does FORCE_PIO work for you too?

Yes.

Chris




From netrolller.3d at gmail.com  Sun Oct 25 23:28:25 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 23:28:25 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain> 
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com> 
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain> 
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain> 
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com> 
	<20091025215708.6f2f432b@boulder.homenet>
	<alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
Message-ID: <69e28c910910251528g60fe154ct85a29a97c7aa3660@mail.gmail.com>

On Sun, Oct 25, 2009 at 11:08 PM, Linus Torvalds
<torvalds at linux-foundation.org> wrote:
>
>
> On Sun, 25 Oct 2009, Chris Vine wrote:
>>
>> On Sun, 25 Oct 2009 22:40:50 +0100 G?bor Stefanik ?<netrolller.3d at gmail.com> suggested:
>> > Another thing to test: boot into Windows (or any other OS where the [..]
>>
>> You already know that this eliminates the DMA errors. ?I have reported
>> twice that if I boot up with the 2.6.27 kernel and install the broadcom
>> b43 driver to intialise the wireless device, and then do a warm reboot
>> to 2.6.32-rc5, then b43 works correctly.
>
> Is there some way to dump all the device registers behind the SSB bridge?
> If so, dumping them for the warm-boot and cold-boot cases, and seeing
> where they are different might be an obvious clue, and point to something
> that isn't initialized correctly.
>

I don't know of such a method; however I have previously succeeded in
using mmiotrace to find differences between wl and b43, so it might be
of help in this case. However, this might be completely irrelevant, as
I suspect that PhoenixBIOS is interfering with the DMA mappings of the
card, which wl (and the Windows driver) works around somehow. (Is this
"PR41573"? In that case, it's possible that the calibration patch -
maybe in conjunction with a proper PHY reset - will fix it.)

Larry: what BIOS are you testing on?

> And Chris, just out of interest - does FORCE_PIO work for you too?
>
> ? ? ? ? ? ? ? ?Linus
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From Larry.Finger at lwfinger.net  Sun Oct 25 23:50:28 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 25 Oct 2009 17:50:28 -0500
Subject: b43 fatal DMA errors
In-Reply-To: <69e28c910910251528g60fe154ct85a29a97c7aa3660@mail.gmail.com>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<20091025210249.7deecd71@boulder.homenet>	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain>
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
	<20091025215708.6f2f432b@boulder.homenet>	<alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
	<69e28c910910251528g60fe154ct85a29a97c7aa3660@mail.gmail.com>
Message-ID: <4AE4D634.7060107@lwfinger.net>

On 10/25/2009 05:28 PM, G?bor Stefanik wrote:
> On Sun, Oct 25, 2009 at 11:08 PM, Linus Torvalds
> <torvalds at linux-foundation.org> wrote:
>>
>>
>> On Sun, 25 Oct 2009, Chris Vine wrote:
>>>
>>> On Sun, 25 Oct 2009 22:40:50 +0100 G?bor Stefanik  <netrolller.3d at gmail.com> suggested:
>>>> Another thing to test: boot into Windows (or any other OS where the [..]
>>>
>>> You already know that this eliminates the DMA errors.  I have reported
>>> twice that if I boot up with the 2.6.27 kernel and install the broadcom
>>> b43 driver to intialise the wireless device, and then do a warm reboot
>>> to 2.6.32-rc5, then b43 works correctly.
>>
>> Is there some way to dump all the device registers behind the SSB bridge?
>> If so, dumping them for the warm-boot and cold-boot cases, and seeing
>> where they are different might be an obvious clue, and point to something
>> that isn't initialized correctly.
>>
> 
> I don't know of such a method; however I have previously succeeded in
> using mmiotrace to find differences between wl and b43, so it might be
> of help in this case. However, this might be completely irrelevant, as
> I suspect that PhoenixBIOS is interfering with the DMA mappings of the
> card, which wl (and the Windows driver) works around somehow. (Is this
> "PR41573"? In that case, it's possible that the calibration patch -
> maybe in conjunction with a proper PHY reset - will fix it.)
> 
> Larry: what BIOS are you testing on?

The splash screen shows it to be a Phoenix BIOS. With dmidecode I see
the following:

BIOS Information
        Vendor: Hewlett-Packard
        Version: F.21
        Release Date: 02/28/2008
        Address: 0xE7060
        Runtime Size: 102304 bytes
        ROM Size: 1024 kB
        Characteristics:
                ISA is supported
                PCI is supported
                PC Card (PCMCIA) is supported
                PNP is supported
                APM is supported
                BIOS is upgradeable
                BIOS shadowing is allowed
                ESCD support is available
                Boot from CD is supported
                ACPI is supported
                USB legacy is supported
                AGP is supported
                BIOS boot specification is supported
                Targeted content distribution is supported
        BIOS Revision: 15.33
        Firmware Revision: 81.81

Larry


From netrolller.3d at gmail.com  Sun Oct 25 23:58:08 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Sun, 25 Oct 2009 23:58:08 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <4AE4D634.7060107@lwfinger.net>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain> 
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com> 
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain> 
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain> 
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com> 
	<20091025215708.6f2f432b@boulder.homenet>
	<alpine.LFD.2.01.0910251504520.3618@localhost.localdomain> 
	<69e28c910910251528g60fe154ct85a29a97c7aa3660@mail.gmail.com> 
	<4AE4D634.7060107@lwfinger.net>
Message-ID: <69e28c910910251558p62f60e5cxa16b276d2b4233f5@mail.gmail.com>

2009/10/25 Larry Finger <Larry.Finger at lwfinger.net>:
> On 10/25/2009 05:28 PM, G?bor Stefanik wrote:
>> On Sun, Oct 25, 2009 at 11:08 PM, Linus Torvalds
>> <torvalds at linux-foundation.org> wrote:
>>>
>>>
>>> On Sun, 25 Oct 2009, Chris Vine wrote:
>>>>
>>>> On Sun, 25 Oct 2009 22:40:50 +0100 G?bor Stefanik ?<netrolller.3d at gmail.com> suggested:
>>>>> Another thing to test: boot into Windows (or any other OS where the [..]
>>>>
>>>> You already know that this eliminates the DMA errors. ?I have reported
>>>> twice that if I boot up with the 2.6.27 kernel and install the broadcom
>>>> b43 driver to intialise the wireless device, and then do a warm reboot
>>>> to 2.6.32-rc5, then b43 works correctly.
>>>
>>> Is there some way to dump all the device registers behind the SSB bridge?
>>> If so, dumping them for the warm-boot and cold-boot cases, and seeing
>>> where they are different might be an obvious clue, and point to something
>>> that isn't initialized correctly.
>>>
>>
>> I don't know of such a method; however I have previously succeeded in
>> using mmiotrace to find differences between wl and b43, so it might be
>> of help in this case. However, this might be completely irrelevant, as
>> I suspect that PhoenixBIOS is interfering with the DMA mappings of the
>> card, which wl (and the Windows driver) works around somehow. (Is this
>> "PR41573"? In that case, it's possible that the calibration patch -
>> maybe in conjunction with a proper PHY reset - will fix it.)
>>
>> Larry: what BIOS are you testing on?
>
> The splash screen shows it to be a Phoenix BIOS.

Kinda odd - apparently not all Phoenix BIOS versions are affected. (Or
is this Phoenix AwardBIOS, Award Modular BIOS's successor? That would
explain why it doesn't reproduce the error.)

> With dmidecode I see
> the following:
>
> BIOS Information
> ? ? ? ?Vendor: Hewlett-Packard
> ? ? ? ?Version: F.21
> ? ? ? ?Release Date: 02/28/2008
> ? ? ? ?Address: 0xE7060
> ? ? ? ?Runtime Size: 102304 bytes
> ? ? ? ?ROM Size: 1024 kB
> ? ? ? ?Characteristics:
> ? ? ? ? ? ? ? ?ISA is supported
> ? ? ? ? ? ? ? ?PCI is supported
> ? ? ? ? ? ? ? ?PC Card (PCMCIA) is supported
> ? ? ? ? ? ? ? ?PNP is supported
> ? ? ? ? ? ? ? ?APM is supported
> ? ? ? ? ? ? ? ?BIOS is upgradeable
> ? ? ? ? ? ? ? ?BIOS shadowing is allowed
> ? ? ? ? ? ? ? ?ESCD support is available
> ? ? ? ? ? ? ? ?Boot from CD is supported
> ? ? ? ? ? ? ? ?ACPI is supported
> ? ? ? ? ? ? ? ?USB legacy is supported
> ? ? ? ? ? ? ? ?AGP is supported
> ? ? ? ? ? ? ? ?BIOS boot specification is supported
> ? ? ? ? ? ? ? ?Targeted content distribution is supported
> ? ? ? ?BIOS Revision: 15.33
> ? ? ? ?Firmware Revision: 81.81

Is this all that dmidecode outputs? There is an important element
towards the end of the dump that identifies a PhoenixBIOS, even if it
is "cloaked".

>
> Larry
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From Larry.Finger at lwfinger.net  Mon Oct 26 00:50:14 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 25 Oct 2009 18:50:14 -0500
Subject: b43 fatal DMA errors
In-Reply-To: <69e28c910910251558p62f60e5cxa16b276d2b4233f5@mail.gmail.com>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain>
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com>
	<20091025210249.7deecd71@boulder.homenet>
	<alpine.LFD.2.01.0910251414090.3618@localhost.localdomain>
	<alpine.LFD.2.01.0910251430450.3618@localhost.localdomain>
	<69e28c910910251440l483a3d7bq9751e5c8182eeb18@mail.gmail.com>
	<20091025215708.6f2f432b@boulder.homenet>
	<alpine.LFD.2.01.0910251504520.3618@localhost.localdomain>
	<69e28c910910251528g60fe154ct85a29a97c7aa3660@mail.gmail.com>
	<4AE4D634.7060107@lwfinger.net>
	<69e28c910910251558p62f60e5cxa16b276d2b4233f5@mail.gmail.com>
Message-ID: <4AE4E436.2050002@lwfinger.net>

On 10/25/2009 05:58 PM, G?bor Stefanik wrote:
> 2009/10/25 Larry Finger <Larry.Finger at lwfinger.net>:
>> On 10/25/2009 05:28 PM, G?bor Stefanik wrote:
>>> On Sun, Oct 25, 2009 at 11:08 PM, Linus Torvalds
>>> <torvalds at linux-foundation.org> wrote:
>>>>
>>>>
>>>> On Sun, 25 Oct 2009, Chris Vine wrote:
>>>>>
>>>>> On Sun, 25 Oct 2009 22:40:50 +0100 G?bor Stefanik  <netrolller.3d at gmail.com> suggested:
>>>>>> Another thing to test: boot into Windows (or any other OS where the [..]
>>>>>
>>>>> You already know that this eliminates the DMA errors.  I have reported
>>>>> twice that if I boot up with the 2.6.27 kernel and install the broadcom
>>>>> b43 driver to intialise the wireless device, and then do a warm reboot
>>>>> to 2.6.32-rc5, then b43 works correctly.
>>>>
>>>> Is there some way to dump all the device registers behind the SSB bridge?
>>>> If so, dumping them for the warm-boot and cold-boot cases, and seeing
>>>> where they are different might be an obvious clue, and point to something
>>>> that isn't initialized correctly.
>>>>
>>>
>>> I don't know of such a method; however I have previously succeeded in
>>> using mmiotrace to find differences between wl and b43, so it might be
>>> of help in this case. However, this might be completely irrelevant, as
>>> I suspect that PhoenixBIOS is interfering with the DMA mappings of the
>>> card, which wl (and the Windows driver) works around somehow. (Is this
>>> "PR41573"? In that case, it's possible that the calibration patch -
>>> maybe in conjunction with a proper PHY reset - will fix it.)
>>>
>>> Larry: what BIOS are you testing on?
>>
>> The splash screen shows it to be a Phoenix BIOS.
> 
> Kinda odd - apparently not all Phoenix BIOS versions are affected. (Or
> is this Phoenix AwardBIOS, Award Modular BIOS's successor? That would
> explain why it doesn't reproduce the error.)
> 
>> With dmidecode I see
>> the following:
>>
>> BIOS Information
>>        Vendor: Hewlett-Packard
>>        Version: F.21
>>        Release Date: 02/28/2008
>>        Address: 0xE7060
>>        Runtime Size: 102304 bytes
>>        ROM Size: 1024 kB
>>        Characteristics:
>>                ISA is supported
>>                PCI is supported
>>                PC Card (PCMCIA) is supported
>>                PNP is supported
>>                APM is supported
>>                BIOS is upgradeable
>>                BIOS shadowing is allowed
>>                ESCD support is available
>>                Boot from CD is supported
>>                ACPI is supported
>>                USB legacy is supported
>>                AGP is supported
>>                BIOS boot specification is supported
>>                Targeted content distribution is supported
>>        BIOS Revision: 15.33
>>        Firmware Revision: 81.81
> 
> Is this all that dmidecode outputs? There is an important element
> towards the end of the dump that identifies a PhoenixBIOS, even if it
> is "cloaked".

I think the part you want is

Handle 0x0019, DMI type 150, 14 bytes
OEM-specific Type
        Header and Data:
                96 0E 19 00 01 01 00 00 00 00 00 00 00 00
        Strings:
                ABSOLUTE(PHOENIX) CLM

Handle 0x001A, DMI type 127, 4 bytes
End Of Table

There is a lot more, but the other stuff refers to memory, CPU, etc.

Larry


From barx at email.it  Thu Oct 22 17:37:17 2009
From: barx at email.it (Alessandro Barisone)
Date: Thu, 22 Oct 2009 17:37:17 +0200
Subject: PHY transmission error on broadcom 4318
Message-ID: <hbpu7b$6rk$1@ger.gmane.org>

Hi all

I have a broadcom 4318 on my laptop , acer ferrari 4005WLMI
The distro is
Slackware 13.0 with kernel 2.6.29.6
I'm using driver b43

linuxwireless.org says to use the latest firmware, 4.150.10.5
but using this version the wireless card doesn't work good
it connect, but in the syslog I get lots of errors 'b43-phy0 ERROR: PHY 
transmission error', and the card loose lots of packets.

This happens immediately, after few seconds of use.

Then i tried using a previous version of the firmware, version 4.80.53.0
This version works perfectly. I used it for 10 hours, trasferring some Gb of 
files.
But in the syslog I get the message "You are using an old firmware image. 
Support for old firmware will be removed in July 2008."
Now I still continue to use the old (deprecated, but working) firmware
But .. how to fix these errors with the newer firmware?

I read in the mailing list that some patch exists.. so, which is the best 
choice?

- continue to use the older firmware (what I'm doing now)
- upgrade the kernel (to which version?)
- use of some patch to kernel or module or firmware (as I have read 
somewhere in the mailing list)


--
To unsubscribe from this list: send the line "unsubscribe linux-wireless" in
the body of a message to majordomo at vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html



From netrolller.3d at gmail.com  Wed Oct 28 13:46:38 2009
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?G=E1bor_Stefanik?=)
Date: Wed, 28 Oct 2009 13:46:38 +0100
Subject: b43 fatal DMA errors
In-Reply-To: <alpine.LFD.2.01.0910271802160.31845@localhost.localdomain>
References: <alpine.LFD.2.01.0910251057270.3618@localhost.localdomain> 
	<69e28c910910251130v45acce96sd86dc4fd2052a707@mail.gmail.com> 
	<alpine.LFD.2.01.0910271802160.31845@localhost.localdomain>
Message-ID: <69e28c910910280546k3f466cb4j68a80bd69a24f378@mail.gmail.com>

2009/10/28 Linus Torvalds <torvalds at linux-foundation.org>:
>
>
> On Sun, 25 Oct 2009, G?bor Stefanik wrote:
>>
>> Also, is there any reference to a failed channel switch in the log?
>
> I've been debugging this some more, and it looks like there are more
> issues at play than just the DMA problem.
>
> With the b43 driver enabled, I seem to be unable to reliably suspend and
> resume. Sometimes the machine just locks up hard, but sometimes I get
> something like this on the resume path:
>
> ? ? ? ?b43-phy0 debug: Resuming...
> ? ? ? ?b43-phy0 debug: Device resumed.
> ? ? ? ?...
> ? ? ? ?b43-phy0: Loading firmware version 478.104 (2008-07-01 00:50:23)
> ? ? ? ?b43-phy0 debug: b2062: Using crystal tab entry 19200 kHz.
> ? ? ? ?b43-phy0 debug: RC calib: Failed to switch to channel 7, error = -5
> ? ? ? ?b43-phy0 debug: Chip initialized
> ? ? ? ?b43-phy0 debug: PIO initialized
> ? ? ? ?b43-phy0 debug: QoS disabled
> ? ? ? ?b43-phy0 debug: Wireless interface started
> ? ? ? ?b43-phy0 debug: Adding Interface type 2
>
> and when that happens, it appears that then the _next_ suspend/resume
> cycle will fail with a hard lockup. And sometimes the hard lockup happens
> on the very first resume.
>
> But maybe that "Failed to switch to channel 7" error is entirely unrelated
> to the "Locks up hard on resume" problem. But the lock-up seems to be tied
> to the b43 driver too - the machine seems stable if I don't load that
> module at all.
>
> What seems a bit odd is how the b43_lpphy_op_init() seems to try to switch
> to channel 7 _twice_. It does:
>
> ? ? ? ?...
> ? ? ? ?lpphy_radio_init(dev);
> ? ? ? ?lpphy_calibrate_rc(dev);
> ? ? ? ?err = b43_lpphy_op_switch_channel(dev, 7);
> ? ? ? ?...
>
> and that lpphy_calibrate_rc() call will already have done the channel
> switch for the lpphy_rev0_1_rc_calib() case. Maybe it should just switch
> to channel 7 unconditionally before doing the lpphy_calibrate_rc()?

What we do is exactly what the spec calls for - specifically, rev.2+
cards don't switch to channel 7 during RC calibration, while rev.0/1
SoCs can have an NVRAM variable specifying a predetermined RC-Cap
value, in which case the actual RC calibration doesn't even run
(though the latter is not yet implemented). However, just switching to
channel 7 at the beginning looks saner - Larry, what do you think
about it?

>
> I dunno. I don't know the code, I don't know the hardware, the above is
> just a random musing based on looking at the code around that warning
> case.
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Linus
>



-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Wed Oct 28 22:08:13 2009
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 28 Oct 2009 22:08:13 +0100
Subject: [PATCH] b43: Fix DMA TX bounce buffer copying
Message-ID: <200910282208.15792.mb@bu3sch.de>

b43 allocates a bouncebuffer, if the supplied TX skb is in an invalid
memory range for DMA.
However, this is broken in that it fails to copy over some metadata to the
new skb.

This patch fixes three problems:
* Failure to adjust the ieee80211_tx_info pointer to the new buffer.
  This results in a kmemcheck warning.
* Failure to copy the skb cb, which contains ieee80211_tx_info, to the new skb.
  This results in breakage of various TX-status postprocessing (Rate control).
* Failure to transfer the queue mapping.
  This results in the wrong queue being stopped on saturation and can result in queue overflow.

Signed-off-by: Michael Buesch <mb at bu3sch.de>
Tested-by: Christian Casteyde <casteyde.christian at free.fr>

---

Thanks to Johannes for tracking down this hard to find bug and
thanks to Christian for testing.

Larry, I think I remember you reported a strange rate control failure on
one of your cards. Does this patch fix it?

b43legacy:
Note that b43legacy has the same bug and also needs fixing.
Is there a maintainer for b43legacy?

stable:
I'm not sure if it's necessary to send this patch to stable.
The problem is there since the very beginning and it doesn't affect many people.
I'll leave this decision to somebody else, if somebody cares.




---
 drivers/net/wireless/b43/dma.c |   15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

--- wireless-testing.orig/drivers/net/wireless/b43/dma.c
+++ wireless-testing/drivers/net/wireless/b43/dma.c
@@ -1157,8 +1157,9 @@ struct b43_dmaring *parse_cookie(struct 
 }
 
 static int dma_tx_fragment(struct b43_dmaring *ring,
-			   struct sk_buff *skb)
+			   struct sk_buff **in_skb)
 {
+	struct sk_buff *skb = *in_skb;
 	const struct b43_dma_ops *ops = ring->ops;
 	struct ieee80211_tx_info *info = IEEE80211_SKB_CB(skb);
 	u8 *header;
@@ -1224,8 +1225,14 @@ static int dma_tx_fragment(struct b43_dm
 		}
 
 		memcpy(skb_put(bounce_skb, skb->len), skb->data, skb->len);
+		memcpy(bounce_skb->cb, skb->cb, sizeof(skb->cb));
+		bounce_skb->dev = skb->dev;
+		skb_set_queue_mapping(bounce_skb, skb_get_queue_mapping(skb));
+		info = IEEE80211_SKB_CB(bounce_skb);
+
 		dev_kfree_skb_any(skb);
 		skb = bounce_skb;
+		*in_skb = bounce_skb;
 		meta->skb = skb;
 		meta->dmaaddr = map_descbuffer(ring, skb->data, skb->len, 1);
 		if (b43_dma_mapping_error(ring, meta->dmaaddr, skb->len, 1)) {
@@ -1355,7 +1362,11 @@ int b43_dma_tx(struct b43_wldev *dev, st
 	 * static, so we don't need to store it per frame. */
 	ring->queue_prio = skb_get_queue_mapping(skb);
 
-	err = dma_tx_fragment(ring, skb);
+	/* dma_tx_fragment might reallocate the skb, so invalidate pointers pointing
+	 * into the skb data or cb now. */
+	hdr = NULL;
+	info = NULL;
+	err = dma_tx_fragment(ring, &skb);
 	if (unlikely(err == -ENOKEY)) {
 		/* Drop this packet, as we don't have the encryption key
 		 * anymore and must not transmit it unencrypted. */

-- 
Greetings, Michael.


From Larry.Finger at lwfinger.net  Wed Oct 28 22:48:01 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 28 Oct 2009 16:48:01 -0500
Subject: [PATCH] b43: Fix DMA TX bounce buffer copying
In-Reply-To: <200910282208.15792.mb@bu3sch.de>
References: <200910282208.15792.mb@bu3sch.de>
Message-ID: <4AE8BC11.7040301@lwfinger.net>

Michael Buesch wrote:
> b43 allocates a bouncebuffer, if the supplied TX skb is in an invalid
> memory range for DMA.
> However, this is broken in that it fails to copy over some metadata to the
> new skb.
> 
> This patch fixes three problems:
> * Failure to adjust the ieee80211_tx_info pointer to the new buffer.
>   This results in a kmemcheck warning.
> * Failure to copy the skb cb, which contains ieee80211_tx_info, to the new skb.
>   This results in breakage of various TX-status postprocessing (Rate control).
> * Failure to transfer the queue mapping.
>   This results in the wrong queue being stopped on saturation and can result in queue overflow.
> 
> Signed-off-by: Michael Buesch <mb at bu3sch.de>
> Tested-by: Christian Casteyde <casteyde.christian at free.fr>
> 
> ---
> 
> Thanks to Johannes for tracking down this hard to find bug and
> thanks to Christian for testing.
> 
> Larry, I think I remember you reported a strange rate control failure on
> one of your cards. Does this patch fix it?
> 
> b43legacy:
> Note that b43legacy has the same bug and also needs fixing.
> Is there a maintainer for b43legacy?

Michael,

There was not really a rate-control problem - just a difficulty with
the operator. I was making a transmit test, then interrogating the
rate from the same console. By that time, the rate was back to 1 Mb/s
for control messages. When I looped the transmit tests, and looked at
the rate in a separate console, the code was doing mostly what it
should. Mostly because the success rate for the LP PHY does not
satisfy the assumptions that mistrel makes. One gets a higher
throughput with a fixed rate, but that will improve as power control
is implemented.

There is no maintainer for b43legacy. I have ported your patch for b43
to legacy and I will be testing and submitting it.

Larry



From Larry.Finger at lwfinger.net  Fri Oct 30 17:58:21 2009
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 30 Oct 2009 11:58:21 -0500
Subject: [PATCH] b43legacy: Fix DMA TX bounce buffer copying
Message-ID: <4aeb1b2d.68WA7BjDMaGvZ8qT%Larry.Finger@lwfinger.net>

This patch is adapted from the submission by Michael Buesch <mb at bu3sch.de>
for a bounce-buffer copying problem with b43.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

Full testing of this patch is a problem as the bounce buffer can come into
play only when the test machine has more than 1 GB RAM. When I coded the
original bounce-buffer code for bcm43xx, I had such a machine, but it
died. I tested the patch on a machine with 256 MB and it works. As it
is a line-by-line copy of Michael's patch, it should be OK. In any case, this
is 2.6.33 material.

Larry
---

Index: wireless-testing/drivers/net/wireless/b43legacy/dma.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/dma.c
+++ wireless-testing/drivers/net/wireless/b43legacy/dma.c
@@ -1240,8 +1240,9 @@ struct b43legacy_dmaring *parse_cookie(s
 }
 
 static int dma_tx_fragment(struct b43legacy_dmaring *ring,
-			    struct sk_buff *skb)
+			    struct sk_buff **in_skb)
 {
+	struct sk_buff *skb = *in_skb;
 	const struct b43legacy_dma_ops *ops = ring->ops;
 	struct ieee80211_tx_info *info = IEEE80211_SKB_CB(skb);
 	u8 *header;
@@ -1305,8 +1306,14 @@ static int dma_tx_fragment(struct b43leg
 		}
 
 		memcpy(skb_put(bounce_skb, skb->len), skb->data, skb->len);
+		memcpy(bounce_skb->cb, skb->cb, sizeof(skb->cb));
+		bounce_skb->dev = skb->dev;
+		skb_set_queue_mapping(bounce_skb, skb_get_queue_mapping(skb));
+		info = IEEE80211_SKB_CB(bounce_skb);
+
 		dev_kfree_skb_any(skb);
 		skb = bounce_skb;
+		*in_skb = bounce_skb;
 		meta->skb = skb;
 		meta->dmaaddr = map_descbuffer(ring, skb->data, skb->len, 1);
 		if (b43legacy_dma_mapping_error(ring, meta->dmaaddr, skb->len, 1)) {
@@ -1360,8 +1367,10 @@ int b43legacy_dma_tx(struct b43legacy_wl
 		     struct sk_buff *skb)
 {
 	struct b43legacy_dmaring *ring;
+	struct ieee80211_hdr *hdr;
 	int err = 0;
 	unsigned long flags;
+	struct ieee80211_tx_info *info = IEEE80211_SKB_CB(skb);
 
 	ring = priority_to_txring(dev, skb_get_queue_mapping(skb));
 	spin_lock_irqsave(&ring->lock, flags);
@@ -1386,7 +1395,11 @@ int b43legacy_dma_tx(struct b43legacy_wl
 		goto out_unlock;
 	}
 
-	err = dma_tx_fragment(ring, skb);
+	/* dma_tx_fragment might reallocate the skb, so invalidate pointers pointing
+	 * into the skb data or cb now. */
+	hdr = NULL;
+	info = NULL;
+	err = dma_tx_fragment(ring, &skb);
 	if (unlikely(err == -ENOKEY)) {
 		/* Drop this packet, as we don't have the encryption key
 		 * anymore and must not transmit it unencrypted. */



