From cisco.inc at gmail.com  Mon Sep  1 00:53:49 2008
From: cisco.inc at gmail.com (Cisco)
Date: Sun, 31 Aug 2008 18:23:49 -0430
Subject: bcm-43xx for bcm-4328
In-Reply-To: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
Message-ID: <48BB20FD.9020308@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Javier Santos Romero wrote:
> Hi! It's my first post to bcm-43xx list. I searching about bcm4328
> device without ndiswrapper, but i didn't found anything. Can you
> tell me about this? thanks
>
> ----------------------------------------------------------------------
>
>
> _______________________________________________ Bcm43xx-dev mailing
> list Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
"No bcm4328 support so far, we are working on that. Don't ask. There
is NO support!", I'm not a developer, but this is the message that I
get when  i join to #bcm-users on IRC, however wanna know something
about that, I know nobody i paid to answer, but there are some users
that wanna know something about this driver and what can we do to help
in the process. indeed I would like to make a donation(humble), but i
guess that can help.
Jos? Pagola.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.8 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAki7IP0ACgkQ/B14jtaLFwoDPwCggpLxeBTUN6crFn8vklKxVBfH
7NMAoIs/CNwXDVCKa4mDVNl58Q8yevu8
=ivMz
-----END PGP SIGNATURE-----



From zajec5polish at gmail.com  Mon Sep  1 09:37:30 2008
From: zajec5polish at gmail.com (=?UTF-8?Q?Rafa=C5=82_Mi=C5=82ecki?=)
Date: Mon, 1 Sep 2008 09:37:30 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48BB20FD.9020308@gmail.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
Message-ID: <14b026160809010037x4817e189vb3d4de95f1441141@mail.gmail.com>

2008/9/1 Cisco <cisco.inc at gmail.com>:
> "No bcm4328 support so far, we are working on that. Don't ask. There
> is NO support!", I'm not a developer, but this is the message that I
> get when  i join to #bcm-users on IRC, however wanna know something
> about that, I know nobody i paid to answer, but there are some users
> that wanna know something about this driver and what can we do to help
> in the process. indeed I would like to make a donation(humble), but i
> guess that can help.
> Jos? Pagola.

This message with status info is quite "fresh":
http://lists.berlios.de/pipermail/bcm43xx-dev/2008-August/007932.html

-- 
Rafa? Mi?ecki

From illth at gmx.de  Mon Sep  1 09:40:36 2008
From: illth at gmx.de (Thomas Ilnseher)
Date: Mon, 01 Sep 2008 09:40:36 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48BB20FD.9020308@gmail.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
Message-ID: <1220254836.17106.11.camel@pcmik05.zmk.uni-kl.de>


> > Hi! It's my first post to bcm-43xx list. I searching about bcm4328
> > device without ndiswrapper, but i didn't found anything. Can you
> > tell me about this? thanks
> >
> "No bcm4328 support so far, we are working on that. Don't ask. There
> is NO support!", I'm not a developer, but this is the message that I
> get when  i join to #bcm-users on IRC, however wanna know something
> about that, I know nobody i paid to answer, but there are some users
> that wanna know something about this driver and what can we do to help
> in the process. indeed I would like to make a donation(humble), but i
> guess that can help.

out of curiosity: what kind of device is using the bcm4328 ? the
broadcom product brief states:

? Embedded ARM7 CPU that executes the full WLAN driver,
  eliminating the need for complicated wireless LAN integration into
  the host platform.

reading this, i'd say interfacing this device should be fairly easy.




From mb at bu3sch.de  Mon Sep  1 10:19:16 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 1 Sep 2008 10:19:16 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <1220254836.17106.11.camel@pcmik05.zmk.uni-kl.de>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<1220254836.17106.11.camel@pcmik05.zmk.uni-kl.de>
Message-ID: <200809011019.16554.mb@bu3sch.de>

On Monday 01 September 2008 09:40:36 Thomas Ilnseher wrote:
> 
> > > Hi! It's my first post to bcm-43xx list. I searching about bcm4328
> > > device without ndiswrapper, but i didn't found anything. Can you
> > > tell me about this? thanks
> > >
> > "No bcm4328 support so far, we are working on that. Don't ask. There
> > is NO support!", I'm not a developer, but this is the message that I
> > get when  i join to #bcm-users on IRC, however wanna know something
> > about that, I know nobody i paid to answer, but there are some users
> > that wanna know something about this driver and what can we do to help
> > in the process. indeed I would like to make a donation(humble), but i
> > guess that can help.
> 
> out of curiosity: what kind of device is using the bcm4328 ? the
> broadcom product brief states:
> 
> ? Embedded ARM7 CPU that executes the full WLAN driver,
>   eliminating the need for complicated wireless LAN integration into
>   the host platform.
> 
> reading this, i'd say interfacing this device should be fairly easy.

People are _always_ confusing the chip-IDs.

******** THE CHIP-ID IS NOT THE PCI-ID! ***********

The chipid of the chip with the pci-id 0x4328 is 4321 (AFAIR)

-- 
Greetings Michael.


From illth at gmx.de  Mon Sep  1 10:39:30 2008
From: illth at gmx.de (Thomas Ilnseher)
Date: Mon, 01 Sep 2008 10:39:30 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <14b026160809010037x4817e189vb3d4de95f1441141@mail.gmail.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<14b026160809010037x4817e189vb3d4de95f1441141@mail.gmail.com>
Message-ID: <1220258370.17106.18.camel@pcmik05.zmk.uni-kl.de>

Am Montag, den 01.09.2008, 09:37 +0200 schrieb Rafa? Mi?ecki:
> 2008/9/1 Cisco <cisco.inc at gmail.com>:
> > "No bcm4328 support so far, we are working on that. Don't ask. There
> > is NO support!", I'm not a developer, but this is the message that I
> > get when  i join to #bcm-users on IRC, however wanna know something
> > about that, I know nobody i paid to answer, but there are some users
> > that wanna know something about this driver and what can we do to help
> > in the process. indeed I would like to make a donation(humble), but i
> > guess that can help.
> > Jos? Pagola.
> 
> This message with status info is quite "fresh":
> http://lists.berlios.de/pipermail/bcm43xx-dev/2008-August/007932.html
does this apply? The specs of thatbcm4328 look like a fullmac card: arm7
cpu + 384kb sram + 80 kb rom.

I'd say you need a quite different (and simple) driver for this chip,
which does _not_ need to fuck around with phys and such things. at least
that is what broadcom states in their product briefs.

> 
-- 
Thomas Ilnseher <illth at gmx.de>



From seanhodges at bluebottle.com  Mon Sep  1 13:38:33 2008
From: seanhodges at bluebottle.com (Sean Hodges)
Date: Mon, 01 Sep 2008 12:38:33 +0100
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48BB20FD.9020308@gmail.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
Message-ID: <200809011142.m81BgpPv013613@mi0.bluebottle.com>

Hello all,

Before I go any further, please do not read this as criticism, I would
just like to explain my reasoning before making a request...

The situation as I see it is this:

BCM4328 cards are becoming more popular, and obviously support for it in
bcm43xx is underway (which is great, by the way). However, the rise in
popularity means more people turning up on the lists and IRC asking the
same old questions.

When I realised that a laptop I was given required a BCM4328 compatible
driver, the first place I looked was here:

http://bcm43xx.berlios.de/?go=devices

In fact, I would suggest that this is the most common starting point for
anyone who does not know much about wireless drivers and would prefer to
avoid asking FAQ's on discussion forums. Any repeated questions on the
lists or IRC could be reduced dramatically by stating them on the
website.

This page does not list BCM4328 anywhere, it may list the Dell wireless
card model that my laptop has built-in, but I don't wish to open my
laptop up to find out which model it is labelled as, if it is labelled
at all. So people like myself, Javier and Jos? come to the lists and IRC
to find out about support. I'm fairly sure we are not the first to ask,
by a long-short, and this has built some tension over time so responses
like "DONT ASK, THERE IS NO SUPPORT!" are offered.

What I propose is that the Devices page is made more accessible to those
who are less technical and want to help out. Does anyone object to
making it a Wiki so that people can easily update it to help prevent the
amount of "is my card supported" traffic on the lists?

Sean



On Sun, 2008-08-31 at 18:23 -0430, Cisco wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Javier Santos Romero wrote:
> > Hi! It's my first post to bcm-43xx list. I searching about bcm4328
> > device without ndiswrapper, but i didn't found anything. Can you
> > tell me about this? thanks
> >
> > ----------------------------------------------------------------------
> >
> >
> > _______________________________________________ Bcm43xx-dev mailing
> > list Bcm43xx-dev at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
> "No bcm4328 support so far, we are working on that. Don't ask. There
> is NO support!", I'm not a developer, but this is the message that I
> get when  i join to #bcm-users on IRC, however wanna know something
> about that, I know nobody i paid to answer, but there are some users
> that wanna know something about this driver and what can we do to help
> in the process. indeed I would like to make a donation(humble), but i
> guess that can help.
> Jos? Pagola.
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.8 (Darwin)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
> 
> iEYEARECAAYFAki7IP0ACgkQ/B14jtaLFwoDPwCggpLxeBTUN6crFn8vklKxVBfH
> 7NMAoIs/CNwXDVCKa4mDVNl58Q8yevu8
> =ivMz
> -----END PGP SIGNATURE-----
> 
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev



From hs4233 at mail.mn-solutions.de  Mon Sep  1 14:52:19 2008
From: hs4233 at mail.mn-solutions.de (Holger Schurig)
Date: Mon, 1 Sep 2008 14:52:19 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <200809011142.m81BgpPv013613@mi0.bluebottle.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
Message-ID: <200809011452.19651.hs4233@mail.mn-solutions.de>

> http://bcm43xx.berlios.de/?go=devices
>
> In fact, I would suggest that this is the most common starting
> point for anyone who does not know much about wireless drivers
> and would prefer to avoid asking FAQ's on discussion forums.

I tend to disagree.

First thing: bcm43xx is outdated. The in-kernel b43 driver is 
state-if-the-art.

Second thing: when a driver is in-kernel, I'd suggest that the 
driver-webpage contents get's transferred to the central place 
for all in-kernel-drivers, and that would be 
http://wireless.kernel.org.



The main page of bcm43xx (http://bcm43xx.berlios.de/?go=home) 
even states both things: "This site won't be updated anymore. 
Please check the b43 driver page at linuxwireless.org for 
up-to-date information.".

("linuxwireless.org" is an alias to "wireless.kernel.org", the 
now canonical web address).

> This page does not list BCM4328 anywhere 

That's because the web page you referred to doesn't get updated 
anymore. 4328 is mentioned on 
http://linuxwireless.org/en/users/Drivers/b43, thought.




As to the "make more accessible to less technical oriented 
people" I don't have a good answer. Maybe this is the job of 
SuSE, RedHat, Debian, Ubuntu, ...  Not sure about that.


From seanhodges at bluebottle.com  Mon Sep  1 15:37:26 2008
From: seanhodges at bluebottle.com (Sean Hodges)
Date: Mon, 01 Sep 2008 14:37:26 +0100
Subject: bcm-43xx for bcm-4328
In-Reply-To: <200809011452.19651.hs4233@mail.mn-solutions.de>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
Message-ID: <200809011337.m81Dbca5016108@mi1.bluebottle.com>

Holger,

Thanks for your response, it clears a lot of things up.
wireless.kernel.org is the resource I was looking for.

Sean

On Mon, 2008-09-01 at 14:52 +0200, Holger Schurig wrote:
> > http://bcm43xx.berlios.de/?go=devices
> >
> > In fact, I would suggest that this is the most common starting
> > point for anyone who does not know much about wireless drivers
> > and would prefer to avoid asking FAQ's on discussion forums.
> 
> I tend to disagree.
> 
> First thing: bcm43xx is outdated. The in-kernel b43 driver is 
> state-if-the-art.
> 
> Second thing: when a driver is in-kernel, I'd suggest that the 
> driver-webpage contents get's transferred to the central place 
> for all in-kernel-drivers, and that would be 
> http://wireless.kernel.org.
> 
> 
> 
> The main page of bcm43xx (http://bcm43xx.berlios.de/?go=home) 
> even states both things: "This site won't be updated anymore. 
> Please check the b43 driver page at linuxwireless.org for 
> up-to-date information.".
> 
> ("linuxwireless.org" is an alias to "wireless.kernel.org", the 
> now canonical web address).
> 
> > This page does not list BCM4328 anywhere 
> 
> That's because the web page you referred to doesn't get updated 
> anymore. 4328 is mentioned on 
> http://linuxwireless.org/en/users/Drivers/b43, thought.
> 
> 
> 
> 
> As to the "make more accessible to less technical oriented 
> people" I don't have a good answer. Maybe this is the job of 
> SuSE, RedHat, Debian, Ubuntu, ...  Not sure about that.



From mb at bu3sch.de  Mon Sep  1 23:23:05 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 1 Sep 2008 23:23:05 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <200809011452.19651.hs4233@mail.mn-solutions.de>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
Message-ID: <200809012323.05462.mb@bu3sch.de>

On Monday 01 September 2008 14:52:19 Holger Schurig wrote:
> > This page does not list BCM4328 anywhere 
> 
> That's because the web page you referred to doesn't get updated 
> anymore. 4328 is mentioned on 
> http://linuxwireless.org/en/users/Drivers/b43, thought.

Oh, I fixed it right away. ;)

The BCM4328 is _not_ an N-PHY device.
PCI-ID != ChipID.
See the updated wiki.

In the past the PCI-ID -> ChipID confusion didn't matter much,
as numbers didn't clash. Today they do.

I think the BCM4328 might be this SoC embedded USB device. Does
somebody know for sure?
Also see the FIXME I just added to the BCM4322.

> As to the "make more accessible to less technical oriented 
> people" I don't have a good answer. Maybe this is the job of 
> SuSE, RedHat, Debian, Ubuntu, ...  Not sure about that.

I am pretty sure about that.

-- 
Greetings Michael.


From mb at bu3sch.de  Mon Sep  1 23:24:26 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 1 Sep 2008 23:24:26 +0200
Subject: bcm-43xx for bcm-4328
In-Reply-To: <200809011337.m81Dbca5016108@mi1.bluebottle.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
Message-ID: <200809012324.26212.mb@bu3sch.de>

On Monday 01 September 2008 15:37:26 Sean Hodges wrote:
> Holger,
> 
> Thanks for your response, it clears a lot of things up.
> wireless.kernel.org is the resource I was looking for.

It is a wiki. So if you want to add something to it, please do
so. But only if you are really sure that what you're adding
is correct, please. (There's also a FAQ. You asked for one before.
You're welcome to extend it)

-- 
Greetings Michael.


From mb at bu3sch.de  Tue Sep  2 13:00:34 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 2 Sep 2008 13:00:34 +0200
Subject: [PATCH] b43: Split PHY alloc and init
Message-ID: <200809021300.34760.mb@bu3sch.de>

This splits the PHY allocation from the PHY init.
This is needed in order to properly support Analog handling.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

Please queue for the next merge window.


Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2008-09-02 12:13:57.000000000 +0200
@@ -1088,14 +1088,18 @@ void b43_wireless_core_reset(struct b43_
 	msleep(1);
 	tmslow &= ~SSB_TMSLOW_FGC;
 	ssb_write32(dev->dev, SSB_TMSLOW, tmslow);
 	ssb_read32(dev->dev, SSB_TMSLOW);	/* flush */
 	msleep(1);
 
-	/* Turn Analog ON */
-	b43_switch_analog(dev, 1);
+	/* Turn Analog ON, but only if we already know the PHY-type.
+	 * This protects against very early setup where we don't know the
+	 * PHY-type, yet. wireless_core_reset will be called once again later,
+	 * when we know the PHY-type. */
+	if (dev->phy.ops)
+		b43_switch_analog(dev, 1);
 
 	macctl = b43_read32(dev, B43_MMIO_MACCTL);
 	macctl &= ~B43_MACCTL_GMODE;
 	if (flags & B43_TMSLOW_GMODE)
 		macctl |= B43_MACCTL_GMODE;
 	macctl |= B43_MACCTL_IHR_ENABLED;
@@ -2691,12 +2695,13 @@ static void b43_mgmtframe_txantenna(stru
 	b43_shm_write16(dev, B43_SHM_SHARED, B43_SHM_SH_PRPHYCTL, tmp);
 }
 
 /* This is the opposite of b43_chip_init() */
 static void b43_chip_exit(struct b43_wldev *dev)
 {
+	b43_phy_exit(dev);
 	b43_gpio_cleanup(dev);
 	/* firmware is released later */
 }
 
 /* Initialize the chip
  * http://bcm-specs.sipsolutions.net/ChipInit
@@ -3949,13 +3954,12 @@ static void b43_wireless_core_exit(struc
 	b43_chip_exit(dev);
 	b43_switch_analog(dev, 0);
 	if (dev->wl->current_beacon) {
 		dev_kfree_skb_any(dev->wl->current_beacon);
 		dev->wl->current_beacon = NULL;
 	}
-	b43_phy_exit(dev);
 
 	ssb_device_disable(dev->dev, 0);
 	ssb_bus_may_powerdown(dev->dev->bus);
 }
 
 /* Initialize a wireless core */
@@ -3976,30 +3980,29 @@ static int b43_wireless_core_init(struct
 		goto out;
 	if (!ssb_device_is_enabled(dev->dev)) {
 		tmp = phy->gmode ? B43_TMSLOW_GMODE : 0;
 		b43_wireless_core_reset(dev, tmp);
 	}
 
+	/* Reset all data structures. */
 	setup_struct_wldev_for_init(dev);
-	err = b43_phy_operations_setup(dev);
-	if (err)
-		goto err_busdown;
+	phy->ops->prepare_structs(dev);
 
 	/* Enable IRQ routing to this device. */
 	ssb_pcicore_dev_irqvecs_enable(&bus->pcicore, dev->dev);
 
 	b43_imcfglo_timeouts_workaround(dev);
 	b43_bluetooth_coext_disable(dev);
-	if (phy->ops->prepare) {
-		err = phy->ops->prepare(dev);
+	if (phy->ops->prepare_hardware) {
+		err = phy->ops->prepare_hardware(dev);
 		if (err)
-			goto err_phy_exit;
+			goto err_busdown;
 	}
 	err = b43_chip_init(dev);
 	if (err)
-		goto err_phy_exit;
+		goto err_busdown;
 	b43_shm_write16(dev, B43_SHM_SHARED,
 			B43_SHM_SH_WLCOREREV, dev->dev->id.revision);
 	hf = b43_hf_read(dev);
 	if (phy->type == B43_PHYTYPE_G) {
 		hf |= B43_HF_SYMW;
 		if (phy->rev == 1)
@@ -4061,14 +4064,12 @@ static int b43_wireless_core_init(struct
 		b43_leds_init(dev);
 out:
 	return err;
 
 err_chip_exit:
 	b43_chip_exit(dev);
-err_phy_exit:
-	b43_phy_exit(dev);
 err_busdown:
 	ssb_bus_may_powerdown(bus);
 	B43_WARN_ON(b43_status(dev) != B43_STAT_UNINIT);
 	return err;
 }
 
@@ -4339,12 +4340,13 @@ static int b43_setup_bands(struct b43_wl
 
 static void b43_wireless_core_detach(struct b43_wldev *dev)
 {
 	/* We release firmware that late to not be required to re-request
 	 * is all the time when we reinit the core. */
 	b43_release_firmware(dev);
+	b43_phy_free(dev);
 }
 
 static int b43_wireless_core_attach(struct b43_wldev *dev)
 {
 	struct b43_wl *wl = dev->wl;
 	struct ssb_bus *bus = dev->dev->bus;
@@ -4412,22 +4414,26 @@ static int b43_wireless_core_attach(stru
 		if (dev->phy.type != B43_PHYTYPE_N) {
 			have_2ghz_phy = 1;
 			have_5ghz_phy = 0;
 		}
 	}
 
+	err = b43_phy_allocate(dev);
+	if (err)
+		goto err_powerdown;
+
 	dev->phy.gmode = have_2ghz_phy;
 	tmp = dev->phy.gmode ? B43_TMSLOW_GMODE : 0;
 	b43_wireless_core_reset(dev, tmp);
 
 	err = b43_validate_chipaccess(dev);
 	if (err)
-		goto err_powerdown;
+		goto err_phy_free;
 	err = b43_setup_bands(dev, have_2ghz_phy, have_5ghz_phy);
 	if (err)
-		goto err_powerdown;
+		goto err_phy_free;
 
 	/* Now set some default "current_dev" */
 	if (!wl->current_dev)
 		wl->current_dev = dev;
 	INIT_WORK(&dev->restart_work, b43_chip_reset);
 
@@ -4435,12 +4441,14 @@ static int b43_wireless_core_attach(stru
 	ssb_device_disable(dev->dev, 0);
 	ssb_bus_may_powerdown(bus);
 
 out:
 	return err;
 
+err_phy_free:
+	b43_phy_free(dev);
 err_powerdown:
 	ssb_bus_may_powerdown(bus);
 	return err;
 }
 
 static void b43_one_core_detach(struct ssb_device *dev)
Index: wireless-testing/drivers/net/wireless/b43/phy_a.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_a.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_a.c	2008-09-02 12:39:53.000000000 +0200
@@ -388,14 +388,12 @@ static int b43_aphy_op_allocate(struct b
 
 	aphy = kzalloc(sizeof(*aphy), GFP_KERNEL);
 	if (!aphy)
 		return -ENOMEM;
 	dev->phy.a = aphy;
 
-	//TODO init struct b43_phy_a
-
 	err = b43_aphy_init_tssi2dbm_table(dev);
 	if (err)
 		goto err_free_aphy;
 
 	return 0;
 
@@ -403,36 +401,53 @@ err_free_aphy:
 	kfree(aphy);
 	dev->phy.a = NULL;
 
 	return err;
 }
 
-static int b43_aphy_op_init(struct b43_wldev *dev)
+static void b43_aphy_op_prepare_structs(struct b43_wldev *dev)
 {
-	struct b43_phy_a *aphy = dev->phy.a;
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_a *aphy = phy->a;
+	const void *tssi2dbm;
+	int tgt_idle_tssi;
+
+	/* tssi2dbm table is constant, so it is initialized at alloc time.
+	 * Save a copy of the pointer. */
+	tssi2dbm = aphy->tssi2dbm;
+	tgt_idle_tssi = aphy->tgt_idle_tssi;
 
-	b43_phy_inita(dev);
-	aphy->initialised = 1;
+	/* Zero out the whole PHY structure. */
+	memset(aphy, 0, sizeof(*aphy));
+
+	aphy->tssi2dbm = tssi2dbm;
+	aphy->tgt_idle_tssi = tgt_idle_tssi;
+
+	//TODO init struct b43_phy_a
 
-	return 0;
 }
 
-static void b43_aphy_op_exit(struct b43_wldev *dev)
+static void b43_aphy_op_free(struct b43_wldev *dev)
 {
-	struct b43_phy_a *aphy = dev->phy.a;
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_a *aphy = phy->a;
 
-	if (aphy->initialised) {
-		//TODO
-		aphy->initialised = 0;
-	}
-	//TODO
 	kfree(aphy->tssi2dbm);
+	aphy->tssi2dbm = NULL;
+
 	kfree(aphy);
 	dev->phy.a = NULL;
 }
 
+static int b43_aphy_op_init(struct b43_wldev *dev)
+{
+	b43_phy_inita(dev);
+
+	return 0;
+}
+
 static inline u16 adjust_phyreg(struct b43_wldev *dev, u16 offset)
 {
 	/* OFDM registers are base-registers for the A-PHY. */
 	if ((offset & B43_PHYROUTE) == B43_PHYROUTE_OFDM_GPHY) {
 		offset &= ~B43_PHYROUTE;
 		offset |= B43_PHYROUTE_BASE;
@@ -605,14 +620,15 @@ static void b43_aphy_op_pwork_15sec(stru
 static void b43_aphy_op_pwork_60sec(struct b43_wldev *dev)
 {//TODO
 }
 
 const struct b43_phy_operations b43_phyops_a = {
 	.allocate		= b43_aphy_op_allocate,
+	.free			= b43_aphy_op_free,
+	.prepare_structs	= b43_aphy_op_prepare_structs,
 	.init			= b43_aphy_op_init,
-	.exit			= b43_aphy_op_exit,
 	.phy_read		= b43_aphy_op_read,
 	.phy_write		= b43_aphy_op_write,
 	.radio_read		= b43_aphy_op_radio_read,
 	.radio_write		= b43_aphy_op_radio_write,
 	.supports_hwpctl	= b43_aphy_op_supports_hwpctl,
 	.software_rfkill	= b43_aphy_op_software_rfkill,
Index: wireless-testing/drivers/net/wireless/b43/phy_a.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_a.h	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_a.h	2008-09-02 02:37:28.000000000 +0200
@@ -100,14 +100,12 @@ void b43_ofdmtab_write16(struct b43_wlde
 u32 b43_ofdmtab_read32(struct b43_wldev *dev, u16 table, u16 offset);
 void b43_ofdmtab_write32(struct b43_wldev *dev, u16 table,
 			 u16 offset, u32 value);
 
 
 struct b43_phy_a {
-	bool initialised;
-
 	/* Pointer to the table used to convert a
 	 * TSSI value to dBm-Q5.2 */
 	const s8 *tssi2dbm;
 	/* Target idle TSSI */
 	int tgt_idle_tssi;
 	/* Current idle TSSI */
Index: wireless-testing/drivers/net/wireless/b43/phy_common.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_common.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_common.c	2008-09-02 02:37:28.000000000 +0200
@@ -32,13 +32,13 @@
 #include "phy_n.h"
 #include "phy_lp.h"
 #include "b43.h"
 #include "main.h"
 
 
-int b43_phy_operations_setup(struct b43_wldev *dev)
+int b43_phy_allocate(struct b43_wldev *dev)
 {
 	struct b43_phy *phy = &(dev->phy);
 	int err;
 
 	phy->ops = NULL;
 
@@ -67,12 +67,18 @@ int b43_phy_operations_setup(struct b43_
 	if (err)
 		phy->ops = NULL;
 
 	return err;
 }
 
+void b43_phy_free(struct b43_wldev *dev)
+{
+	dev->phy.ops->free(dev);
+	dev->phy.ops = NULL;
+}
+
 int b43_phy_init(struct b43_wldev *dev)
 {
 	struct b43_phy *phy = &dev->phy;
 	const struct b43_phy_operations *ops = phy->ops;
 	int err;
 
Index: wireless-testing/drivers/net/wireless/b43/phy_common.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_common.h	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_common.h	2008-09-02 02:37:28.000000000 +0200
@@ -71,17 +71,27 @@ enum b43_txpwr_result {
 	B43_TXPWR_RES_DONE,
 };
 
 /**
  * struct b43_phy_operations - Function pointers for PHY ops.
  *
- * @prepare:		Prepare the PHY. This is called before @init.
+ * @allocate:		Allocate and initialise the PHY data structures.
+ * 			Must not be NULL.
+ * @free:		Destroy and free the PHY data structures.
+ * 			Must not be NULL.
+ *
+ * @prepare_structs:	Prepare the PHY data structures.
+ * 			The data structures allocated in @allocate are
+ * 			initialized here.
+ * 			Must not be NULL.
+ * @prepare_hardware:	Prepare the PHY. This is called before b43_chip_init to
+ * 			do some early early PHY hardware init.
  * 			Can be NULL, if not required.
  * @init:		Initialize the PHY.
  * 			Must not be NULL.
- * @exit:		Shutdown the PHY and free all data structures.
+ * @exit:		Shutdown the PHY.
  * 			Can be NULL, if not required.
  *
  * @phy_read:		Read from a PHY register.
  * 			Must not be NULL.
  * @phy_write:		Write to a PHY register.
  * 			Must not be NULL.
@@ -130,13 +140,15 @@ enum b43_txpwr_result {
  * @pwork_60sec:	Periodic work. Called every 60 seconds.
  * 			Can be NULL, if not required.
  */
 struct b43_phy_operations {
 	/* Initialisation */
 	int (*allocate)(struct b43_wldev *dev);
-	int (*prepare)(struct b43_wldev *dev);
+	void (*free)(struct b43_wldev *dev);
+	void (*prepare_structs)(struct b43_wldev *dev);
+	int (*prepare_hardware)(struct b43_wldev *dev);
 	int (*init)(struct b43_wldev *dev);
 	void (*exit)(struct b43_wldev *dev);
 
 	/* Register access */
 	u16 (*phy_read)(struct b43_wldev *dev, u16 reg);
 	void (*phy_write)(struct b43_wldev *dev, u16 reg, u16 value);
@@ -234,16 +246,21 @@ struct b43_phy {
 	bool phy_locked;
 #endif /* B43_DEBUG */
 };
 
 
 /**
- * b43_phy_operations_setup - Initialize the PHY operations datastructure
- * based on the current PHY type.
+ * b43_phy_allocate - Allocate PHY structs
+ * Allocate the PHY data structures, based on the current dev->phy.type
+ */
+int b43_phy_allocate(struct b43_wldev *dev);
+
+/**
+ * b43_phy_free - Free PHY structs
  */
-int b43_phy_operations_setup(struct b43_wldev *dev);
+void b43_phy_free(struct b43_wldev *dev);
 
 /**
  * b43_phy_init - Initialise the PHY
  */
 int b43_phy_init(struct b43_wldev *dev);
 
Index: wireless-testing/drivers/net/wireless/b43/phy_g.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_g.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_g.c	2008-09-02 12:40:51.000000000 +0200
@@ -2632,21 +2632,66 @@ static int b43_gphy_init_tssi2dbm_table(
 }
 
 static int b43_gphy_op_allocate(struct b43_wldev *dev)
 {
 	struct b43_phy_g *gphy;
 	struct b43_txpower_lo_control *lo;
-	int err, i;
+	int err;
 
 	gphy = kzalloc(sizeof(*gphy), GFP_KERNEL);
 	if (!gphy) {
 		err = -ENOMEM;
 		goto error;
 	}
 	dev->phy.g = gphy;
 
+	lo = kzalloc(sizeof(*lo), GFP_KERNEL);
+	if (!lo) {
+		err = -ENOMEM;
+		goto err_free_gphy;
+	}
+	gphy->lo_control = lo;
+
+	err = b43_gphy_init_tssi2dbm_table(dev);
+	if (err)
+		goto err_free_lo;
+
+	return 0;
+
+err_free_lo:
+	kfree(lo);
+err_free_gphy:
+	kfree(gphy);
+error:
+	return err;
+}
+
+static void b43_gphy_op_prepare_structs(struct b43_wldev *dev)
+{
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_g *gphy = phy->g;
+	const void *tssi2dbm;
+	int tgt_idle_tssi;
+	struct b43_txpower_lo_control *lo;
+	unsigned int i;
+
+	/* tssi2dbm table is constant, so it is initialized at alloc time.
+	 * Save a copy of the pointer. */
+	tssi2dbm = gphy->tssi2dbm;
+	tgt_idle_tssi = gphy->tgt_idle_tssi;
+	/* Save the LO pointer. */
+	lo = gphy->lo_control;
+
+	/* Zero out the whole PHY structure. */
+	memset(gphy, 0, sizeof(*gphy));
+
+	/* Restore pointers. */
+	gphy->tssi2dbm = tssi2dbm;
+	gphy->tgt_idle_tssi = tgt_idle_tssi;
+	gphy->lo_control = lo;
+
 	memset(gphy->minlowsig, 0xFF, sizeof(gphy->minlowsig));
 
 	/* NRSSI */
 	for (i = 0; i < ARRAY_SIZE(gphy->nrssi); i++)
 		gphy->nrssi[i] = -1000;
 	for (i = 0; i < ARRAY_SIZE(gphy->nrssi_lt); i++)
@@ -2659,37 +2704,34 @@ static int b43_gphy_op_allocate(struct b
 
 	/* OFDM-table address caching. */
 	gphy->ofdmtab_addr_direction = B43_OFDMTAB_DIRECTION_UNKNOWN;
 
 	gphy->average_tssi = 0xFF;
 
-	lo = kzalloc(sizeof(*lo), GFP_KERNEL);
-	if (!lo) {
-		err = -ENOMEM;
-		goto err_free_gphy;
-	}
-	gphy->lo_control = lo;
-
+	/* Local Osciallator structure */
 	lo->tx_bias = 0xFF;
 	INIT_LIST_HEAD(&lo->calib_list);
+}
 
-	err = b43_gphy_init_tssi2dbm_table(dev);
-	if (err)
-		goto err_free_lo;
+static void b43_gphy_op_free(struct b43_wldev *dev)
+{
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_g *gphy = phy->g;
 
-	return 0;
+	kfree(gphy->lo_control);
+
+	if (gphy->dyn_tssi_tbl)
+		kfree(gphy->tssi2dbm);
+	gphy->dyn_tssi_tbl = 0;
+	gphy->tssi2dbm = NULL;
 
-err_free_lo:
-	kfree(lo);
-err_free_gphy:
 	kfree(gphy);
-error:
-	return err;
+	dev->phy.g = NULL;
 }
 
-static int b43_gphy_op_prepare(struct b43_wldev *dev)
+static int b43_gphy_op_prepare_hardware(struct b43_wldev *dev)
 {
 	struct b43_phy *phy = &dev->phy;
 	struct b43_phy_g *gphy = phy->g;
 	struct b43_txpower_lo_control *lo = gphy->lo_control;
 
 	B43_WARN_ON(phy->type != B43_PHYTYPE_G);
@@ -2715,34 +2757,20 @@ static int b43_gphy_op_prepare(struct b4
 
 	return 0;
 }
 
 static int b43_gphy_op_init(struct b43_wldev *dev)
 {
-	struct b43_phy_g *gphy = dev->phy.g;
-
 	b43_phy_initg(dev);
-	gphy->initialised = 1;
 
 	return 0;
 }
 
 static void b43_gphy_op_exit(struct b43_wldev *dev)
 {
-	struct b43_phy_g *gphy = dev->phy.g;
-
-	if (gphy->initialised) {
-		//TODO
-		gphy->initialised = 0;
-	}
 	b43_lo_g_cleanup(dev);
-	kfree(gphy->lo_control);
-	if (gphy->dyn_tssi_tbl)
-		kfree(gphy->tssi2dbm);
-	kfree(gphy);
-	dev->phy.g = NULL;
 }
 
 static u16 b43_gphy_op_read(struct b43_wldev *dev, u16 reg)
 {
 	b43_write16(dev, B43_MMIO_PHY_CONTROL, reg);
 	return b43_read16(dev, B43_MMIO_PHY_DATA);
@@ -3229,13 +3257,15 @@ static void b43_gphy_op_pwork_60sec(stru
 	}
 	b43_mac_enable(dev);
 }
 
 const struct b43_phy_operations b43_phyops_g = {
 	.allocate		= b43_gphy_op_allocate,
-	.prepare		= b43_gphy_op_prepare,
+	.free			= b43_gphy_op_free,
+	.prepare_structs	= b43_gphy_op_prepare_structs,
+	.prepare_hardware	= b43_gphy_op_prepare_hardware,
 	.init			= b43_gphy_op_init,
 	.exit			= b43_gphy_op_exit,
 	.phy_read		= b43_gphy_op_read,
 	.phy_write		= b43_gphy_op_write,
 	.radio_read		= b43_gphy_op_radio_read,
 	.radio_write		= b43_gphy_op_radio_write,
Index: wireless-testing/drivers/net/wireless/b43/phy_g.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_g.h	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_g.h	2008-09-02 02:37:28.000000000 +0200
@@ -111,14 +111,12 @@ static inline bool b43_compare_bbatt(con
 #define B43_TXCTL_PA2DB		0x20	/* PA Gain 2dB */
 #define B43_TXCTL_TXMIX		0x10	/* TX Mixer Gain */
 
 struct b43_txpower_lo_control;
 
 struct b43_phy_g {
-	bool initialised;
-
 	/* ACI (adjacent channel interference) flags. */
 	bool aci_enable;
 	bool aci_wlan_automatic;
 	bool aci_hw_rssi;
 
 	/* Radio switched on/off */
Index: wireless-testing/drivers/net/wireless/b43/phy_lp.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_lp.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_lp.c	2008-09-02 02:37:28.000000000 +0200
@@ -33,40 +33,40 @@ static int b43_lpphy_op_allocate(struct 
 
 	lpphy = kzalloc(sizeof(*lpphy), GFP_KERNEL);
 	if (!lpphy)
 		return -ENOMEM;
 	dev->phy.lp = lpphy;
 
-	//TODO
-
 	return 0;
 }
 
-static int b43_lpphy_op_init(struct b43_wldev *dev)
+static void b43_lpphy_op_prepare_structs(struct b43_wldev *dev)
 {
-	struct b43_phy_lp *lpphy = dev->phy.lp;
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_lp *lpphy = phy->lp;
 
-	//TODO
-	lpphy->initialised = 1;
+	memset(lpphy, 0, sizeof(*lpphy));
 
-	return 0;
+	//TODO
 }
 
-static void b43_lpphy_op_exit(struct b43_wldev *dev)
+static void b43_lpphy_op_free(struct b43_wldev *dev)
 {
 	struct b43_phy_lp *lpphy = dev->phy.lp;
 
-	if (lpphy->initialised) {
-		//TODO
-		lpphy->initialised = 0;
-	}
-
 	kfree(lpphy);
 	dev->phy.lp = NULL;
 }
 
+static int b43_lpphy_op_init(struct b43_wldev *dev)
+{
+	//TODO
+
+	return 0;
+}
+
 static u16 b43_lpphy_op_read(struct b43_wldev *dev, u16 reg)
 {
 	b43_write16(dev, B43_MMIO_PHY_CONTROL, reg);
 	return b43_read16(dev, B43_MMIO_PHY_DATA);
 }
 
@@ -135,14 +135,15 @@ static enum b43_txpwr_result b43_lpphy_o
 	return B43_TXPWR_RES_DONE;
 }
 
 
 const struct b43_phy_operations b43_phyops_lp = {
 	.allocate		= b43_lpphy_op_allocate,
+	.free			= b43_lpphy_op_free,
+	.prepare_structs	= b43_lpphy_op_prepare_structs,
 	.init			= b43_lpphy_op_init,
-	.exit			= b43_lpphy_op_exit,
 	.phy_read		= b43_lpphy_op_read,
 	.phy_write		= b43_lpphy_op_write,
 	.radio_read		= b43_lpphy_op_radio_read,
 	.radio_write		= b43_lpphy_op_radio_write,
 	.software_rfkill	= b43_lpphy_op_software_rfkill,
 	.switch_channel		= b43_lpphy_op_switch_channel,
Index: wireless-testing/drivers/net/wireless/b43/phy_lp.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_lp.h	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_lp.h	2008-09-02 02:37:28.000000000 +0200
@@ -527,13 +527,13 @@
 #define B2063_EXT_TSSI_CTL2			B43_LP_RADIO(0x127) /* EXT TSSI Control 2 */
 #define B2063_AFE_CTL				B43_LP_RADIO(0x128) /* AFE Control */
 
 
 
 struct b43_phy_lp {
-	bool initialised;
+	//TODO
 };
 
 
 struct b43_phy_operations;
 extern const struct b43_phy_operations b43_phyops_lp;
 
Index: wireless-testing/drivers/net/wireless/b43/phy_n.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_n.c	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_n.c	2008-09-02 02:37:28.000000000 +0200
@@ -496,41 +496,37 @@ static int b43_nphy_op_allocate(struct b
 
 	nphy = kzalloc(sizeof(*nphy), GFP_KERNEL);
 	if (!nphy)
 		return -ENOMEM;
 	dev->phy.n = nphy;
 
-	//TODO init struct b43_phy_n
-
 	return 0;
 }
 
-static int b43_nphy_op_init(struct b43_wldev *dev)
+static void b43_nphy_op_prepare_structs(struct b43_wldev *dev)
 {
-	struct b43_phy_n *nphy = dev->phy.n;
-	int err;
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_n *nphy = phy->n;
 
-	err = b43_phy_initn(dev);
-	if (err)
-		return err;
-	nphy->initialised = 1;
+	memset(nphy, 0, sizeof(*nphy));
 
-	return 0;
+	//TODO init struct b43_phy_n
 }
 
-static void b43_nphy_op_exit(struct b43_wldev *dev)
+static void b43_nphy_op_free(struct b43_wldev *dev)
 {
-	struct b43_phy_n *nphy = dev->phy.n;
+	struct b43_phy *phy = &dev->phy;
+	struct b43_phy_n *nphy = phy->n;
 
-	if (nphy->initialised) {
-		//TODO
-		nphy->initialised = 0;
-	}
-	//TODO
 	kfree(nphy);
-	dev->phy.n = NULL;
+	phy->n = NULL;
+}
+
+static int b43_nphy_op_init(struct b43_wldev *dev)
+{
+	return b43_phy_initn(dev);
 }
 
 static inline void check_phyreg(struct b43_wldev *dev, u16 offset)
 {
 #if B43_DEBUG
 	if ((offset & B43_PHYROUTE) == B43_PHYROUTE_OFDM_GPHY) {
@@ -607,14 +603,15 @@ static unsigned int b43_nphy_op_get_defa
 		return 1;
 	return 36;
 }
 
 const struct b43_phy_operations b43_phyops_n = {
 	.allocate		= b43_nphy_op_allocate,
+	.free			= b43_nphy_op_free,
+	.prepare_structs	= b43_nphy_op_prepare_structs,
 	.init			= b43_nphy_op_init,
-	.exit			= b43_nphy_op_exit,
 	.phy_read		= b43_nphy_op_read,
 	.phy_write		= b43_nphy_op_write,
 	.radio_read		= b43_nphy_op_radio_read,
 	.radio_write		= b43_nphy_op_radio_write,
 	.software_rfkill	= b43_nphy_op_software_rfkill,
 	.switch_channel		= b43_nphy_op_switch_channel,
Index: wireless-testing/drivers/net/wireless/b43/phy_n.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_n.h	2008-09-02 02:37:26.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_n.h	2008-09-02 02:37:28.000000000 +0200
@@ -917,14 +917,12 @@
 
 
 
 struct b43_wldev;
 
 struct b43_phy_n {
-	bool initialised;
-
 	//TODO lots of missing stuff
 };
 
 
 struct b43_phy_operations;
 extern const struct b43_phy_operations b43_phyops_n;


From celejar at gmail.com  Wed Sep  3 02:20:54 2008
From: celejar at gmail.com (Celejar)
Date: Tue, 2 Sep 2008 20:20:54 -0400
Subject: [OT] Git trouble
Message-ID: <20080902202054.958d4425.celejar@gmail.com>

[This is off topic, but my entire reason for struggling with git is to
help test patches to b43, so I beg the list's pardon for asking here.]

I'm trying to maintain a git repository of wireless-testing, to test
Michael's patches to b43.  The initial git-clone went fine, and I
tested several patches successfully. I'm currently having a great deal
of trouble trying to update my local repository via git-pull.  I've
spent a while with the various git manpages (git-pull, git-clean,
git-checkout, git-reset, git-tutorial, etc.), as well as with the
wireless.kernel.org git-guide and with google, but I just can't seem to
grok basic git operation.

All I want to do is dump any changes I've made to the code, and then
pull in an updated version, but I just can't make git do that.  I am
getting all kinds of errors; google turns up other instances of them,
but no straightforward solution.

My current state:

$ git-status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#       arch/alpha/include/
#       arch/arm/plat-orion/include/
#       arch/h8300/include/
#       debian/
#       drivers/usb/musb/
nothing added to commit but untracked files present (use "git add" to
track)

$ git-pull
error: Untracked working tree file 'arch/alpha/include/asm/8253pit.h'
would be overwritten by merge. fatal: merging of trees
b09605fa2c229f91c55eb8eeec11b8c30afdad38 and
aee0332143df67e34f69da0c6fdf1a631daec065 failed

$ git-clean -f
Not removing arch/alpha/include/
Not removing arch/arm/plat-orion/include/
Not removing arch/h8300/include/
Not removing debian/
Not removing drivers/usb/musb/

$ git-clean -fx
Not removing .tmp_versions/
Not removing arch/alpha/include/
Not removing arch/arm/plat-orion/include/
Not removing arch/h8300/include/
Not removing arch/i386/
Not removing debian/
Not removing drivers/usb/musb/
Not removing include/config/

$ git-checkout -f
Your branch and the tracked remote branch 'origin/master' have diverged,
and respectively have 15591 and 906 different commit(s) each.

I may be missing something obvious, and I admit that I don't have a
great understanding of git concepts, but can someone point me in the
right direction for fixing my repository?

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From mb at bu3sch.de  Wed Sep  3 12:12:20 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 3 Sep 2008 12:12:20 +0200
Subject: [PATCH] b43: Move Analog switching into phy code
Message-ID: <200809031212.21143.mb@bu3sch.de>

This moves the Analog switching code into the PHY files.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

John, please queue for the next merge window.


Index: wireless-testing/drivers/net/wireless/b43/phy_a.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_a.c	2008-09-02 12:39:53.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_a.c	2008-09-03 11:53:47.000000000 +0200
@@ -629,12 +629,13 @@ const struct b43_phy_operations b43_phyo
 	.phy_read		= b43_aphy_op_read,
 	.phy_write		= b43_aphy_op_write,
 	.radio_read		= b43_aphy_op_radio_read,
 	.radio_write		= b43_aphy_op_radio_write,
 	.supports_hwpctl	= b43_aphy_op_supports_hwpctl,
 	.software_rfkill	= b43_aphy_op_software_rfkill,
+	.switch_analog		= b43_phyop_switch_analog_generic,
 	.switch_channel		= b43_aphy_op_switch_channel,
 	.get_default_chan	= b43_aphy_op_get_default_chan,
 	.set_rx_antenna		= b43_aphy_op_set_rx_antenna,
 	.recalc_txpower		= b43_aphy_op_recalc_txpower,
 	.adjust_txpower		= b43_aphy_op_adjust_txpower,
 	.pwork_15sec		= b43_aphy_op_pwork_15sec,
Index: wireless-testing/drivers/net/wireless/b43/phy_common.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_common.c	2008-09-02 02:37:28.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_common.c	2008-09-03 11:52:50.000000000 +0200
@@ -371,6 +371,11 @@ int b43_phy_shm_tssi_read(struct b43_wld
 		    & B43_HF_CCKBOOST)
 			average = (average >= 13) ? (average - 13) : 0;
 	}
 
 	return average;
 }
+
+void b43_phyop_switch_analog_generic(struct b43_wldev *dev, bool on)
+{
+	b43_write16(dev, B43_MMIO_PHY0, on ? 0 : 0xF4);
+}
Index: wireless-testing/drivers/net/wireless/b43/phy_common.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_common.h	2008-09-02 02:37:28.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_common.h	2008-09-03 11:51:53.000000000 +0200
@@ -105,12 +105,14 @@ enum b43_txpwr_result {
  * 			If NULL, hwpctl is assumed to be never supported.
  * @software_rfkill:	Turn the radio ON or OFF.
  * 			Possible state values are
  * 			RFKILL_STATE_SOFT_BLOCKED or
  * 			RFKILL_STATE_UNBLOCKED
  * 			Must not be NULL.
+ * @switch_analog:	Turn the Analog on/off.
+ * 			Must not be NULL.
  * @switch_channel:	Switch the radio to another channel.
  * 			Must not be NULL.
  * @get_default_chan:	Just returns the default channel number.
  * 			Must not be NULL.
  * @set_rx_antenna:	Set the antenna used for RX.
  * 			Can be NULL, if not supported.
@@ -155,12 +157,13 @@ struct b43_phy_operations {
 	u16 (*radio_read)(struct b43_wldev *dev, u16 reg);
 	void (*radio_write)(struct b43_wldev *dev, u16 reg, u16 value);
 
 	/* Radio */
 	bool (*supports_hwpctl)(struct b43_wldev *dev);
 	void (*software_rfkill)(struct b43_wldev *dev, enum rfkill_state state);
+	void (*switch_analog)(struct b43_wldev *dev, bool on);
 	int (*switch_channel)(struct b43_wldev *dev, unsigned int new_channel);
 	unsigned int (*get_default_chan)(struct b43_wldev *dev);
 	void (*set_rx_antenna)(struct b43_wldev *dev, int antenna);
 	int (*interf_mitigation)(struct b43_wldev *dev,
 				 enum b43_interference_mitigation new_mode);
 
@@ -394,8 +397,17 @@ void b43_phy_txpower_adjust_work(struct 
  * @shm_offset:		The SHM address to read the values from.
  *
  * Returns the average of the 4 TSSI values, or a negative error code.
  */
 int b43_phy_shm_tssi_read(struct b43_wldev *dev, u16 shm_offset);
 
+/**
+ * b43_phy_switch_analog_generic - Generic PHY operation for switching the Analog.
+ *
+ * It does the switching based on the PHY0 core register.
+ * Do _not_ call this directly. Only use it as a switch_analog callback
+ * for struct b43_phy_operations.
+ */
+void b43_phyop_switch_analog_generic(struct b43_wldev *dev, bool on);
+
 
 #endif /* LINUX_B43_PHY_COMMON_H_ */
Index: wireless-testing/drivers/net/wireless/b43/phy_g.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_g.c	2008-09-02 12:40:51.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_g.c	2008-09-03 11:54:09.000000000 +0200
@@ -3268,12 +3268,13 @@ const struct b43_phy_operations b43_phyo
 	.phy_read		= b43_gphy_op_read,
 	.phy_write		= b43_gphy_op_write,
 	.radio_read		= b43_gphy_op_radio_read,
 	.radio_write		= b43_gphy_op_radio_write,
 	.supports_hwpctl	= b43_gphy_op_supports_hwpctl,
 	.software_rfkill	= b43_gphy_op_software_rfkill,
+	.switch_analog		= b43_phyop_switch_analog_generic,
 	.switch_channel		= b43_gphy_op_switch_channel,
 	.get_default_chan	= b43_gphy_op_get_default_chan,
 	.set_rx_antenna		= b43_gphy_op_set_rx_antenna,
 	.interf_mitigation	= b43_gphy_op_interf_mitigation,
 	.recalc_txpower		= b43_gphy_op_recalc_txpower,
 	.adjust_txpower		= b43_gphy_op_adjust_txpower,
Index: wireless-testing/drivers/net/wireless/b43/phy_lp.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_lp.c	2008-09-02 02:37:28.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_lp.c	2008-09-03 11:54:30.000000000 +0200
@@ -143,12 +143,13 @@ const struct b43_phy_operations b43_phyo
 	.init			= b43_lpphy_op_init,
 	.phy_read		= b43_lpphy_op_read,
 	.phy_write		= b43_lpphy_op_write,
 	.radio_read		= b43_lpphy_op_radio_read,
 	.radio_write		= b43_lpphy_op_radio_write,
 	.software_rfkill	= b43_lpphy_op_software_rfkill,
+	.switch_analog		= b43_phyop_switch_analog_generic,
 	.switch_channel		= b43_lpphy_op_switch_channel,
 	.get_default_chan	= b43_lpphy_op_get_default_chan,
 	.set_rx_antenna		= b43_lpphy_op_set_rx_antenna,
 	.recalc_txpower		= b43_lpphy_op_recalc_txpower,
 	.adjust_txpower		= b43_lpphy_op_adjust_txpower,
 };
Index: wireless-testing/drivers/net/wireless/b43/phy_n.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_n.c	2008-09-02 02:37:28.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_n.c	2008-09-03 11:55:35.000000000 +0200
@@ -580,12 +580,18 @@ static void b43_nphy_op_radio_write(stru
 
 static void b43_nphy_op_software_rfkill(struct b43_wldev *dev,
 					enum rfkill_state state)
 {//TODO
 }
 
+static void b43_nphy_op_switch_analog(struct b43_wldev *dev, bool on)
+{
+	b43_phy_write(dev, B43_NPHY_AFECTL_OVER,
+		      on ? 0 : 0x7FFF);
+}
+
 static int b43_nphy_op_switch_channel(struct b43_wldev *dev,
 				      unsigned int new_channel)
 {
 	if (b43_current_band(dev->wl) == IEEE80211_BAND_2GHZ) {
 		if ((new_channel < 1) || (new_channel > 14))
 			return -EINVAL;
@@ -611,11 +617,12 @@ const struct b43_phy_operations b43_phyo
 	.init			= b43_nphy_op_init,
 	.phy_read		= b43_nphy_op_read,
 	.phy_write		= b43_nphy_op_write,
 	.radio_read		= b43_nphy_op_radio_read,
 	.radio_write		= b43_nphy_op_radio_write,
 	.software_rfkill	= b43_nphy_op_software_rfkill,
+	.switch_analog		= b43_nphy_op_switch_analog,
 	.switch_channel		= b43_nphy_op_switch_channel,
 	.get_default_chan	= b43_nphy_op_get_default_chan,
 	.recalc_txpower		= b43_nphy_op_recalc_txpower,
 	.adjust_txpower		= b43_nphy_op_adjust_txpower,
 };
Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2008-09-02 12:13:57.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2008-09-03 11:58:23.000000000 +0200
@@ -1049,29 +1049,12 @@ void b43_power_saving_ctl_bits(struct b4
 				break;
 			udelay(10);
 		}
 	}
 }
 
-/* Turn the Analog ON/OFF */
-static void b43_switch_analog(struct b43_wldev *dev, int on)
-{
-	switch (dev->phy.type) {
-	case B43_PHYTYPE_A:
-	case B43_PHYTYPE_G:
-		b43_write16(dev, B43_MMIO_PHY0, on ? 0 : 0xF4);
-		break;
-	case B43_PHYTYPE_N:
-		b43_phy_write(dev, B43_NPHY_AFECTL_OVER,
-			      on ? 0 : 0x7FFF);
-		break;
-	default:
-		B43_WARN_ON(1);
-	}
-}
-
 void b43_wireless_core_reset(struct b43_wldev *dev, u32 flags)
 {
 	u32 tmslow;
 	u32 macctl;
 
 	flags |= B43_TMSLOW_PHYCLKEN;
@@ -1093,13 +1076,13 @@ void b43_wireless_core_reset(struct b43_
 
 	/* Turn Analog ON, but only if we already know the PHY-type.
 	 * This protects against very early setup where we don't know the
 	 * PHY-type, yet. wireless_core_reset will be called once again later,
 	 * when we know the PHY-type. */
 	if (dev->phy.ops)
-		b43_switch_analog(dev, 1);
+		dev->phy.ops->switch_analog(dev, 1);
 
 	macctl = b43_read32(dev, B43_MMIO_MACCTL);
 	macctl &= ~B43_MACCTL_GMODE;
 	if (flags & B43_TMSLOW_GMODE)
 		macctl |= B43_MACCTL_GMODE;
 	macctl |= B43_MACCTL_IHR_ENABLED;
@@ -3949,13 +3932,13 @@ static void b43_wireless_core_exit(struc
 		b43_leds_exit(dev);
 		b43_rng_exit(dev->wl);
 	}
 	b43_dma_free(dev);
 	b43_pio_free(dev);
 	b43_chip_exit(dev);
-	b43_switch_analog(dev, 0);
+	dev->phy.ops->switch_analog(dev, 0);
 	if (dev->wl->current_beacon) {
 		dev_kfree_skb_any(dev->wl->current_beacon);
 		dev->wl->current_beacon = NULL;
 	}
 
 	ssb_device_disable(dev->dev, 0);
@@ -4434,13 +4417,13 @@ static int b43_wireless_core_attach(stru
 
 	/* Now set some default "current_dev" */
 	if (!wl->current_dev)
 		wl->current_dev = dev;
 	INIT_WORK(&dev->restart_work, b43_chip_reset);
 
-	b43_switch_analog(dev, 0);
+	dev->phy.ops->switch_analog(dev, 0);
 	ssb_device_disable(dev->dev, 0);
 	ssb_bus_may_powerdown(bus);
 
 out:
 	return err;
 


From mb at bu3sch.de  Wed Sep  3 12:31:54 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 3 Sep 2008 12:31:54 +0200
Subject: [PATCH] b43: Replace hardcoded Analog switch
Message-ID: <200809031231.55338.mb@bu3sch.de>

Replace a hardcoded Analog switch (which breaks on N-PHY) by a call to
the switch_analog PHY operation.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

John, please queue for the next merge window.


Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2008-09-03 11:58:23.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2008-09-03 12:27:03.000000000 +0200
@@ -2715,13 +2715,14 @@ static int b43_chip_init(struct b43_wlde
 		goto out;	/* firmware is released later */
 
 	err = b43_upload_initvals(dev);
 	if (err)
 		goto err_gpio_clean;
 
-	b43_write16(dev, 0x03E6, 0x0000);
+	/* Turn the Analog on and initialize the PHY. */
+	phy->ops->switch_analog(dev, 1);
 	err = b43_phy_init(dev);
 	if (err)
 		goto err_gpio_clean;
 
 	/* Disable Interference Mitigation. */
 	if (phy->ops->interf_mitigation)


From artem.v.antonov at gmail.com  Wed Sep  3 20:42:50 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Wed, 3 Sep 2008 22:42:50 +0400
Subject: again bcm4318 & PHY Transmission errors again )
Message-ID: <6bc534830809031142r6594c2a4xd1ff1c3b4faf01f3@mail.gmail.com>

Hi!

I'm trying to find the reason of these errors.
My card is ASUS WL-120g (which is in ASUS WL-500gP router).
The problem seems to be in transmission power control (or something like that).
There are almost no such errors if the distance between PDA and router
~1-2m - and they become often, if the distance is ~4-5m.

I've also noticed, that there are a lot of failed frames
(dot11ACKFailureCount). Is that normal?

Best regards.


From artem.v.antonov at gmail.com  Wed Sep  3 20:43:03 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Wed, 3 Sep 2008 22:43:03 +0400
Subject: again bcm4318 & PHY Transmission errors again )
Message-ID: <6bc534830809031143p1a408eefr8062a09dd533007d@mail.gmail.com>

Hi!

I'm trying to find the reason of these errors.
My card is ASUS WL-120g (which is in ASUS WL-500gP router).
The problem seems to be in transmission power control (or something like that).
There are almost no such errors if the distance between PDA and router
~1-2m - and they become often, if the distance is ~4-5m.

I've also noticed, that there are a lot of failed frames
(dot11ACKFailureCount). Is that normal?

Best regards.


From artem.v.antonov at gmail.com  Wed Sep  3 21:08:19 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Wed, 3 Sep 2008 23:08:19 +0400
Subject: again bcm4318 & PHY Transmission errors again )
In-Reply-To: <6bc534830809031143p1a408eefr8062a09dd533007d@mail.gmail.com>
References: <6bc534830809031143p1a408eefr8062a09dd533007d@mail.gmail.com>
Message-ID: <6bc534830809031208mb093783yb51a5bd72479731b@mail.gmail.com>

Also "PHY transmission errors" are more often if  "hwpctl=1", even if
the distance ~1-2m.

2008/9/3, Artem Antonov <artem.v.antonov at gmail.com>:
> Hi!
>
>  I'm trying to find the reason of these errors.
>  My card is ASUS WL-120g (which is in ASUS WL-500gP router).
>  The problem seems to be in transmission power control (or something like that).
>  There are almost no such errors if the distance between PDA and router
>  ~1-2m - and they become often, if the distance is ~4-5m.
>
>  I've also noticed, that there are a lot of failed frames
>  (dot11ACKFailureCount). Is that normal?
>
>  Best regards.
>


From proski at gnu.org  Thu Sep  4 03:31:23 2008
From: proski at gnu.org (Pavel Roskin)
Date: Wed, 03 Sep 2008 21:31:23 -0400
Subject: [OT] Git trouble
In-Reply-To: <20080902202054.958d4425.celejar@gmail.com>
References: <20080902202054.958d4425.celejar@gmail.com>
Message-ID: <1220491883.7700.15.camel@dv>

On Tue, 2008-09-02 at 20:20 -0400, Celejar wrote:
> [This is off topic, but my entire reason for struggling with git is to
> help test patches to b43, so I beg the list's pardon for asking here.]
> 
> I'm trying to maintain a git repository of wireless-testing, to test
> Michael's patches to b43.  The initial git-clone went fine, and I
> tested several patches successfully. I'm currently having a great deal
> of trouble trying to update my local repository via git-pull.  I've
> spent a while with the various git manpages (git-pull, git-clean,
> git-checkout, git-reset, git-tutorial, etc.), as well as with the
> wireless.kernel.org git-guide and with google, but I just can't seem to
> grok basic git operation.
> 
> All I want to do is dump any changes I've made to the code, and then
> pull in an updated version, but I just can't make git do that.  I am
> getting all kinds of errors; google turns up other instances of them,
> but no straightforward solution.

You may be better off writing to linux-wireless about it.  As far as I
know, there was some botched update made to the tree made in the recent
days, but it have been fixed.

Anyway, many trees are updated in a non-linear way.  This means that you
may need to reset the tree to the remote tip:

git-reset --hard wireless-testing/master

This will lose your uncommitted changes.  If you have your changes in a
separate branch, you should be able to rebase your branch on top on the
newly updated version.

I recommend that you use StGIT for local patches.  While not strictly
required, it's a tool that is primarily designed to working with
patchsets.  It will pop all patches before updates, so that you should
be able to do any dangerous git commands and then push your patches on
top of the result.

If you have any advanced questions about git, please ask them in the git
list.

-- 
Regards,
Pavel Roskin


From mb at bu3sch.de  Thu Sep  4 13:32:19 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 4 Sep 2008 13:32:19 +0200
Subject: Who removed b43's QoS default parameters?
Message-ID: <200809041332.19170.mb@bu3sch.de>

b43 had a mechanism to set default QoS parameters. Somebody
removed it, because changes in mac80211 introduced compiler
warnings for it.
A Bug was introduced. Does somebody know which patch removed that
stuff, so I don't have to dig git history?

-- 
Greetings Michael.


From artem.v.antonov at gmail.com  Thu Sep  4 17:05:25 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Thu, 4 Sep 2008 19:05:25 +0400
Subject: Who removed b43's QoS default parameters?
In-Reply-To: <200809041332.19170.mb@bu3sch.de>
References: <200809041332.19170.mb@bu3sch.de>
Message-ID: <6bc534830809040805p5cce632cy44892bd7d3bc1a36@mail.gmail.com>

possible, this patch:

http://marc.info/?l=linux-wireless&m=121610942801688&w=2

http://git.kernel.org/?p=linux/kernel/git/linville/wireless-testing.git;a=commitdiff;h=0b57664cf2393bc1eff594ff7e5ff26533843fe6

2008/9/4, Michael Buesch <mb at bu3sch.de>:
> b43 had a mechanism to set default QoS parameters. Somebody
>  removed it, because changes in mac80211 introduced compiler
>  warnings for it.
>  A Bug was introduced. Does somebody know which patch removed that
>  stuff, so I don't have to dig git history?
>
>
>  --
>  Greetings Michael.
>  _______________________________________________
>  Bcm43xx-dev mailing list
>  Bcm43xx-dev at lists.berlios.de
>  https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>


From mb at bu3sch.de  Thu Sep  4 23:03:46 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 4 Sep 2008 23:03:46 +0200
Subject: Who removed b43's QoS default parameters?
In-Reply-To: <6bc534830809040805p5cce632cy44892bd7d3bc1a36@mail.gmail.com>
References: <200809041332.19170.mb@bu3sch.de>
	<6bc534830809040805p5cce632cy44892bd7d3bc1a36@mail.gmail.com>
Message-ID: <200809042303.46957.mb@bu3sch.de>

On Thursday 04 September 2008 17:05:25 Artem Antonov wrote:
> possible, this patch:
> 
> http://marc.info/?l=linux-wireless&m=121610942801688&w=2
> 
> http://git.kernel.org/?p=linux/kernel/git/linville/wireless-testing.git;a=commitdiff;h=0b57664cf2393bc1eff594ff7e5ff26533843fe6

Ok, thanks. That's it.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Sat Sep  6 01:02:41 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 05 Sep 2008 18:02:41 -0500
Subject: Speed enhancement for BCM4306/2
Message-ID: <48C1BA91.7050106@lwfinger.net>

I recently found some places where the G-PHY initialization 
specifications were wrong. I updated the relevant parts of the V3 
specifications at http://bcm-specs.sipsolutions.net - the pages for 
GPHY, B6PHY and B5PHY were changed.

When I prepared a patch containing these changes, the speed of the 
BCM4306/2 for OFDM rates more than doubled. As an example, when 
iwconfig is used to set the rate at 36M, the TX rate increased from 
6.8 to 15.8 Mb/s.

Unfortunately, direct submission of my patch would violate the 
clean-room rules. Michael Buesch has other things that are more 
important. As a result, we need someone to look at the changes on the 
web page and prepare a patch for submission. I will be happy to test 
your submission.

Larry


From Larry.Finger at lwfinger.net  Sat Sep  6 06:49:27 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 05 Sep 2008 23:49:27 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C20928.10202@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
Message-ID: <48C20BD7.6080605@lwfinger.net>

gavron at wetwork.net wrote:
> Is this close?
> E
> --- /tmp/phy_g.c    2008-09-05 21:06:57.000000000 -0700
> +++ phy_g.c    2008-09-05 21:36:18.000000000 -0700
> @@ -2198,7 +2198,7 @@
>     else
>         b43_phy_initb6(dev);
> 
> -    if (phy->rev >= 2 || phy->gmode)
> +    if (phy->rev >= 2 && phy->gmode)
>         b43_phy_inita(dev);
> 
>     if (phy->rev >= 2) {
> @@ -2216,9 +2216,9 @@
>     if (phy->gmode || phy->rev >= 2) {
>         tmp = b43_phy_read(dev, B43_PHY_VERSION_OFDM);
>         tmp &= B43_PHYVER_VERSION;
> -        if (tmp == 3 || tmp == 5) {
> +        if (tmp == 4 || tmp == 5) {
>             b43_phy_write(dev, B43_PHY_OFDM(0xC2), 0x1816);
> -            b43_phy_write(dev, B43_PHY_OFDM(0xC3), 0x8006);
> +            b43_phy_write(dev, B43_PHY_OFDM(0xC3), 0x8606);
>         }
>         if (tmp == 5) {
>             b43_phy_write(dev, B43_PHY_OFDM(0xCC),
> @@ -2226,7 +2226,7 @@
>                        & 0x00FF) | 0x1F00);
>         }
>     }
> -    if ((phy->rev <= 2 && phy->gmode) || phy->rev >= 2)
> +    if ((phy->rev >=2)
>         b43_phy_write(dev, B43_PHY_OFDM(0x7E), 0x78);
>     if (phy->radio_rev == 8) {
>         b43_phy_write(dev, B43_PHY_EXTG(0x01),

It is close, but I think you are working on b43. My changes are for 
b43legacy and all changes will be in drivers/net/wireless/b43legacy/phy.c

Larry


From gavron at wetwork.net  Sat Sep  6 07:04:36 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Fri, 05 Sep 2008 22:04:36 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C20BD7.6080605@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net>
Message-ID: <48C20F64.1000700@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>> Is this close?
>> E
>>
>
> It is close, but I think you are working on b43. My changes are for 
> b43legacy and all changes will be in drivers/net/wireless/b43legacy/phy.c
>
> Larry

Ok, here's try #2. 

E
/home/2.6.27/rc4-wl/drivers/net/wireless/b43legacy# diff -uN /tmp/phy.c 
phy.c
--- /tmp/phy.c    2008-09-05 21:56:20.000000000 -0700
+++ phy.c    2008-09-05 22:03:28.000000000 -0700
@@ -1010,7 +1010,7 @@
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1027,15 +1027,17 @@
     }
     if (phy->rev >= 2 || phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
-            b43legacy_phy_write(dev, 0x04C3, 0x8006);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
             if (tmp == 5)
                 b43legacy_phy_write(dev, 0x04CC,
                             (b43legacy_phy_read(dev,
                              0x04CC) & 0x00FF) |
                              0x1F00);
         }
+    }
+    if (phy->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {



From gavron at wetwork.net  Sat Sep  6 06:38:00 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Fri, 05 Sep 2008 21:38:00 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C1BA91.7050106@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net>
Message-ID: <48C20928.10202@wetwork.net>

Is this close? 

E
--- /tmp/phy_g.c    2008-09-05 21:06:57.000000000 -0700
+++ phy_g.c    2008-09-05 21:36:18.000000000 -0700
@@ -2198,7 +2198,7 @@
     else
         b43_phy_initb6(dev);
 
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -2216,9 +2216,9 @@
     if (phy->gmode || phy->rev >= 2) {
         tmp = b43_phy_read(dev, B43_PHY_VERSION_OFDM);
         tmp &= B43_PHYVER_VERSION;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 4 || tmp == 5) {
             b43_phy_write(dev, B43_PHY_OFDM(0xC2), 0x1816);
-            b43_phy_write(dev, B43_PHY_OFDM(0xC3), 0x8006);
+            b43_phy_write(dev, B43_PHY_OFDM(0xC3), 0x8606);
         }
         if (tmp == 5) {
             b43_phy_write(dev, B43_PHY_OFDM(0xCC),
@@ -2226,7 +2226,7 @@
                        & 0x00FF) | 0x1F00);
         }
     }
-    if ((phy->rev <= 2 && phy->gmode) || phy->rev >= 2)
+    if ((phy->rev >=2)
         b43_phy_write(dev, B43_PHY_OFDM(0x7E), 0x78);
     if (phy->radio_rev == 8) {
         b43_phy_write(dev, B43_PHY_EXTG(0x01),


Larry Finger wrote:
> I recently found some places where the G-PHY initialization 
> specifications were wrong. I updated the relevant parts of the V3 
> specifications at http://bcm-specs.sipsolutions.net - the pages for 
> GPHY, B6PHY and B5PHY were changed.
>
> When I prepared a patch containing these changes, the speed of the 
> BCM4306/2 for OFDM rates more than doubled. As an example, when 
> iwconfig is used to set the rate at 36M, the TX rate increased from 
> 6.8 to 15.8 Mb/s.
>
> Unfortunately, direct submission of my patch would violate the 
> clean-room rules. Michael Buesch has other things that are more 
> important. As a result, we need someone to look at the changes on the 
> web page and prepare a patch for submission. I will be happy to test 
> your submission.
>
> Larry
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>   


From mb at bu3sch.de  Sat Sep  6 12:41:19 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 12:41:19 +0200
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C20F64.1000700@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20BD7.6080605@lwfinger.net>
	<48C20F64.1000700@wetwork.net>
Message-ID: <200809061241.19599.mb@bu3sch.de>

On Saturday 06 September 2008 07:04:36 gavron at wetwork.net wrote:
> +    }
> +    if (phy->rev >= 2)
>          b43legacy_phy_write(dev, 0x047E, 0x0078);
>      }

Does this even compile?

-- 
Greetings Michael.


From mb at bu3sch.de  Sat Sep  6 12:41:19 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 12:41:19 +0200
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C20F64.1000700@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20BD7.6080605@lwfinger.net>
	<48C20F64.1000700@wetwork.net>
Message-ID: <200809061241.19599.mb@bu3sch.de>

On Saturday 06 September 2008 07:04:36 gavron at wetwork.net wrote:
> +    }
> +    if (phy->rev >= 2)
>          b43legacy_phy_write(dev, 0x047E, 0x0078);
>      }

Does this even compile?

-- 
Greetings Michael.


From mb at bu3sch.de  Sat Sep  6 16:21:47 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 16:21:47 +0200
Subject: [PATCH] b43: Fix QoS defaults
Message-ID: <200809061621.48449.mb@bu3sch.de>

This fixes the initialization of the default QoS parameters.
This got broken by 0b57664cf2393bc1eff594ff7e5ff26533843fe6

Reported-by: Lorenzo Nava
Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

John, please queue for the next merge window, as I'm not interested
in finding explanations for applying this to 2.6.27 (2.6.27 already has
this bug)


Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2008-09-06 15:09:16.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2008-09-06 15:45:09.000000000 +0200
@@ -3056,37 +3056,40 @@ static void b43_qos_params_upload(struct
 					shm_offset + (i * 2),
 					params[i]);
 		}
 	}
 }
 
+/* Mapping of mac80211 queue numbers to b43 QoS SHM offsets. */
+static const u16 b43_qos_shm_offsets[] = {
+	/* [mac80211-queue-nr] = SHM_OFFSET, */
+	[0] = B43_QOS_VOICE,
+	[1] = B43_QOS_VIDEO,
+	[2] = B43_QOS_BESTEFFORT,
+	[3] = B43_QOS_BACKGROUND,
+};
+
 /* Update the QOS parameters in hardware. */
 static void b43_qos_update(struct b43_wldev *dev)
 {
 	struct b43_wl *wl = dev->wl;
 	struct b43_qos_params *params;
 	unsigned long flags;
 	unsigned int i;
 
-	/* Mapping of mac80211 queues to b43 SHM offsets. */
-	static const u16 qos_shm_offsets[] = {
-		[0] = B43_QOS_VOICE,
-		[1] = B43_QOS_VIDEO,
-		[2] = B43_QOS_BESTEFFORT,
-		[3] = B43_QOS_BACKGROUND,
-	};
-	BUILD_BUG_ON(ARRAY_SIZE(qos_shm_offsets) != ARRAY_SIZE(wl->qos_params));
+	BUILD_BUG_ON(ARRAY_SIZE(b43_qos_shm_offsets) !=
+		     ARRAY_SIZE(wl->qos_params));
 
 	b43_mac_suspend(dev);
 	spin_lock_irqsave(&wl->irq_lock, flags);
 
 	for (i = 0; i < ARRAY_SIZE(wl->qos_params); i++) {
 		params = &(wl->qos_params[i]);
 		if (params->need_hw_update) {
 			b43_qos_params_upload(dev, &(params->p),
-					      qos_shm_offsets[i]);
+					      b43_qos_shm_offsets[i]);
 			params->need_hw_update = 0;
 		}
 	}
 
 	spin_unlock_irqrestore(&wl->irq_lock, flags);
 	b43_mac_enable(dev);
@@ -3094,17 +3097,48 @@ static void b43_qos_update(struct b43_wl
 
 static void b43_qos_clear(struct b43_wl *wl)
 {
 	struct b43_qos_params *params;
 	unsigned int i;
 
+	/* Initialize QoS parameters to sane defaults. */
+
+	BUILD_BUG_ON(ARRAY_SIZE(b43_qos_shm_offsets) !=
+		     ARRAY_SIZE(wl->qos_params));
+
 	for (i = 0; i < ARRAY_SIZE(wl->qos_params); i++) {
 		params = &(wl->qos_params[i]);
 
-		memset(&(params->p), 0, sizeof(params->p));
-		params->p.aifs = -1;
+		switch (b43_qos_shm_offsets[i]) {
+		case B43_QOS_VOICE:
+			params->p.txop = 0;
+			params->p.aifs = 2;
+			params->p.cw_min = 0x0001;
+			params->p.cw_max = 0x0001;
+			break;
+		case B43_QOS_VIDEO:
+			params->p.txop = 0;
+			params->p.aifs = 2;
+			params->p.cw_min = 0x0001;
+			params->p.cw_max = 0x0001;
+			break;
+		case B43_QOS_BESTEFFORT:
+			params->p.txop = 0;
+			params->p.aifs = 3;
+			params->p.cw_min = 0x0001;
+			params->p.cw_max = 0x03FF;
+			break;
+		case B43_QOS_BACKGROUND:
+			params->p.txop = 0;
+			params->p.aifs = 7;
+			params->p.cw_min = 0x0001;
+			params->p.cw_max = 0x03FF;
+			break;
+		default:
+			B43_WARN_ON(1);
+		}
 		params->need_hw_update = 1;
 	}
 }
 
 /* Initialize the core's QOS capabilities */
 static void b43_qos_init(struct b43_wldev *dev)


From Larry.Finger at lwfinger.net  Sat Sep  6 17:29:57 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 10:29:57 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C20F64.1000700@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
Message-ID: <48C2A1F5.6020607@lwfinger.net>

gavron at wetwork.net wrote:
> 
> 
> 
> Ok, here's try #2.
> E
> /home/2.6.27/rc4-wl/drivers/net/wireless/b43legacy# diff -uN /tmp/phy.c 
> phy.c
> --- /tmp/phy.c    2008-09-05 21:56:20.000000000 -0700
> +++ phy.c    2008-09-05 22:03:28.000000000 -0700

For kernel patches, you need to be working in the base directory of 
the kernel sources. For your tree, that would be in 
/home/2.6.27/rc4-wl. That way the patches will apply with the 
effective command of 'patch -p1 < patch_file'. For kernel patches, I 
use quilt so that patches are easy to apply and remove.

> @@ -1010,7 +1010,7 @@
>         b43legacy_phy_initb5(dev);
>     else
>         b43legacy_phy_initb6(dev);
> -    if (phy->rev >= 2 || phy->gmode)
> +    if (phy->rev >= 2 && phy->gmode)
>         b43legacy_phy_inita(dev);
> 
>     if (phy->rev >= 2) {

The above hunk is correct.

> @@ -1027,15 +1027,17 @@
>     }
>     if (phy->rev >= 2 || phy->gmode) {

This does not match step 7 of the specs. It was not changed recently, 
but the code did not match what was on the web site. No, I don't know why.

>         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
> -        if (tmp == 3 || tmp == 5) {
> +        if (tmp == 4 || tmp == 5) {
>             b43legacy_phy_write(dev, 0x04C2, 0x1816);
> -            b43legacy_phy_write(dev, 0x04C3, 0x8006);
> +            b43legacy_phy_write(dev, 0x04C3, 0x8606);
>             if (tmp == 5)
>                 b43legacy_phy_write(dev, 0x04CC,
>                             (b43legacy_phy_read(dev,
>                              0x04CC) & 0x00FF) |
>                              0x1F00);
>         }
> +    }
> +    if (phy->rev >= 2)
>         b43legacy_phy_write(dev, 0x047E, 0x0078);
>     }
>     if (phy->radio_rev == 8) {

This hunk does not match the specs. In addition, I think there are too 
many right-hand curly braces for it to compile.

Larry



From mb at bu3sch.de  Sat Sep  6 19:28:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 19:28:55 +0200
Subject: [PATCH] b43 G-PHY: Remove mmiowb()
Message-ID: <200809061928.56550.mb@bu3sch.de>

It causes compile errors on m68k and it is not needed.
Remove it.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

John, please queue for the next merge window.


Index: wireless-testing/drivers/net/wireless/b43/phy_g.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/phy_g.c	2008-09-06 15:06:56.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/phy_g.c	2008-09-06 19:24:35.000000000 +0200
@@ -383,13 +383,12 @@ static void b43_set_original_gains(struc
 }
 
 /* http://bcm-specs.sipsolutions.net/NRSSILookupTable */
 void b43_nrssi_hw_write(struct b43_wldev *dev, u16 offset, s16 val)
 {
 	b43_phy_write(dev, B43_PHY_NRSSILT_CTRL, offset);
-	mmiowb();
 	b43_phy_write(dev, B43_PHY_NRSSILT_DATA, (u16) val);
 }
 
 /* http://bcm-specs.sipsolutions.net/NRSSILookupTable */
 s16 b43_nrssi_hw_read(struct b43_wldev *dev, u16 offset)
 {


From gavron at wetwork.net  Sat Sep  6 20:07:15 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 11:07:15 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C2A1F5.6020607@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net>
Message-ID: <48C2C6D3.3030601@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>>
>>
>>
>> Ok, here's try #2.
>> E
>> /home/2.6.27/rc4-wl/drivers/net/wireless/b43legacy# diff -uN 
>> /tmp/phy.c phy.c
>> --- /tmp/phy.c    2008-09-05 21:56:20.000000000 -0700
>> +++ phy.c    2008-09-05 22:03:28.000000000 -0700
>
> For kernel patches, you need to be working in the base directory of 
> the kernel sources. For your tree, that would be in 
> /home/2.6.27/rc4-wl. That way the patches will apply with the 
> effective command of 'patch -p1 < patch_file'. For kernel patches, I 
> use quilt so that patches are easy to apply and remove.
>
>> @@ -1010,7 +1010,7 @@
>>         b43legacy_phy_initb5(dev);
>>     else
>>         b43legacy_phy_initb6(dev);
>> -    if (phy->rev >= 2 || phy->gmode)
>> +    if (phy->rev >= 2 && phy->gmode)
>>         b43legacy_phy_inita(dev);
>>
>>     if (phy->rev >= 2) {
>
> The above hunk is correct.
>
>> @@ -1027,15 +1027,17 @@
>>     }
>>     if (phy->rev >= 2 || phy->gmode) {
>
> This does not match step 7 of the specs. It was not changed recently, 
> but the code did not match what was on the web site. No, I don't know 
> why.
>
>>         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
>> -        if (tmp == 3 || tmp == 5) {
>> +        if (tmp == 4 || tmp == 5) {
>>             b43legacy_phy_write(dev, 0x04C2, 0x1816);
>> -            b43legacy_phy_write(dev, 0x04C3, 0x8006);
>> +            b43legacy_phy_write(dev, 0x04C3, 0x8606);
>>             if (tmp == 5)
>>                 b43legacy_phy_write(dev, 0x04CC,
>>                             (b43legacy_phy_read(dev,
>>                              0x04CC) & 0x00FF) |
>>                              0x1F00);
>>         }
>> +    }
>> +    if (phy->rev >= 2)
>>         b43legacy_phy_write(dev, 0x047E, 0x0078);
>>     }
>>     if (phy->radio_rev == 8) {
>
> This hunk does not match the specs. In addition, I think there are too 
> many right-hand curly braces for it to compile.
>
> Larry
>
I've been sitting on a git clone that refuses to proceed faster than 6 
KiB/s (it's a problem here in Melbourne).  Should it complete I will 
correct these issues.   I did see several other ways in which the code 
does not match the specs.  Should that be documented in the code or 
should the code be conformed to the specs even if that ends up breaking 
the driver?

Without getting into specifics it's cases where the specs will say "When 
something=value" but the code says "when variable >=(value -1)".

Ehud


From mb at bu3sch.de  Sat Sep  6 20:07:31 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 20:07:31 +0200
Subject: [PATCH] b43: Remove QoS update workqueue
Message-ID: <200809062007.32422.mb@bu3sch.de>

We don't need the workqueue anymore, as we can now sleep in the callback.

Signed-off-by: Michael Buesch <mb at bu3sch.de>

---

John, please queue for the next merge window.
This patch depends on
[PATCH] mac80211: make conf_tx non-atomic

Index: wireless-testing/drivers/net/wireless/b43/b43.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/b43.h	2008-09-06 15:24:52.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/b43.h	2008-09-06 19:49:14.000000000 +0200
@@ -582,14 +582,12 @@ enum {
 };
 
 /* QOS parameters for a queue. */
 struct b43_qos_params {
 	/* The QOS parameters */
 	struct ieee80211_tx_queue_params p;
-	/* Does this need to get uploaded to hardware? */
-	bool need_hw_update;
 };
 
 struct b43_wldev;
 
 /* Data structure for the WLAN parts (802.11 cores) of the b43 chip. */
 struct b43_wl {
@@ -645,17 +643,14 @@ struct b43_wl {
 	struct sk_buff *current_beacon;
 	bool beacon0_uploaded;
 	bool beacon1_uploaded;
 	bool beacon_templates_virgin; /* Never wrote the templates? */
 	struct work_struct beacon_update_trigger;
 
-	/* The current QOS parameters for the 4 queues.
-	 * This is protected by the irq_lock. */
+	/* The current QOS parameters for the 4 queues. */
 	struct b43_qos_params qos_params[4];
-	/* Workqueue for updating QOS parameters in hardware. */
-	struct work_struct qos_update_work;
 
 	/* Work for adjustment of the transmission power.
 	 * This is scheduled when we determine that the actual TX output
 	 * power doesn't match what we want. */
 	struct work_struct txpower_adjust_work;
 };
Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c	2008-09-06 15:45:09.000000000 +0200
+++ wireless-testing/drivers/net/wireless/b43/main.c	2008-09-06 20:00:49.000000000 +0200
@@ -3065,36 +3065,28 @@ static const u16 b43_qos_shm_offsets[] =
 	[0] = B43_QOS_VOICE,
 	[1] = B43_QOS_VIDEO,
 	[2] = B43_QOS_BESTEFFORT,
 	[3] = B43_QOS_BACKGROUND,
 };
 
-/* Update the QOS parameters in hardware. */
-static void b43_qos_update(struct b43_wldev *dev)
+/* Update all QOS parameters in hardware. */
+static void b43_qos_upload_all(struct b43_wldev *dev)
 {
 	struct b43_wl *wl = dev->wl;
 	struct b43_qos_params *params;
-	unsigned long flags;
 	unsigned int i;
 
 	BUILD_BUG_ON(ARRAY_SIZE(b43_qos_shm_offsets) !=
 		     ARRAY_SIZE(wl->qos_params));
 
 	b43_mac_suspend(dev);
-	spin_lock_irqsave(&wl->irq_lock, flags);
-
 	for (i = 0; i < ARRAY_SIZE(wl->qos_params); i++) {
 		params = &(wl->qos_params[i]);
-		if (params->need_hw_update) {
-			b43_qos_params_upload(dev, &(params->p),
-					      b43_qos_shm_offsets[i]);
-			params->need_hw_update = 0;
-		}
+		b43_qos_params_upload(dev, &(params->p),
+				      b43_qos_shm_offsets[i]);
 	}
-
-	spin_unlock_irqrestore(&wl->irq_lock, flags);
 	b43_mac_enable(dev);
 }
 
 static void b43_qos_clear(struct b43_wl *wl)
 {
 	struct b43_qos_params *params;
@@ -3133,70 +3125,61 @@ static void b43_qos_clear(struct b43_wl 
 			params->p.cw_min = 0x0001;
 			params->p.cw_max = 0x03FF;
 			break;
 		default:
 			B43_WARN_ON(1);
 		}
-		params->need_hw_update = 1;
 	}
 }
 
 /* Initialize the core's QOS capabilities */
 static void b43_qos_init(struct b43_wldev *dev)
 {
-	struct b43_wl *wl = dev->wl;
-	unsigned int i;
-
 	/* Upload the current QOS parameters. */
-	for (i = 0; i < ARRAY_SIZE(wl->qos_params); i++)
-		wl->qos_params[i].need_hw_update = 1;
-	b43_qos_update(dev);
+	b43_qos_upload_all(dev);
 
 	/* Enable QOS support. */
 	b43_hf_write(dev, b43_hf_read(dev) | B43_HF_EDCF);
 	b43_write16(dev, B43_MMIO_IFSCTL,
 		    b43_read16(dev, B43_MMIO_IFSCTL)
 		    | B43_MMIO_IFSCTL_USE_EDCF);
 }
 
-static void b43_qos_update_work(struct work_struct *work)
-{
-	struct b43_wl *wl = container_of(work, struct b43_wl, qos_update_work);
-	struct b43_wldev *dev;
-
-	mutex_lock(&wl->mutex);
-	dev = wl->current_dev;
-	if (likely(dev && (b43_status(dev) >= B43_STAT_INITIALIZED)))
-		b43_qos_update(dev);
-	mutex_unlock(&wl->mutex);
-}
-
 static int b43_op_conf_tx(struct ieee80211_hw *hw, u16 _queue,
 			  const struct ieee80211_tx_queue_params *params)
 {
 	struct b43_wl *wl = hw_to_b43_wl(hw);
-	unsigned long flags;
+	struct b43_wldev *dev;
 	unsigned int queue = (unsigned int)_queue;
-	struct b43_qos_params *p;
+	int err = -ENODEV;
 
 	if (queue >= ARRAY_SIZE(wl->qos_params)) {
 		/* Queue not available or don't support setting
 		 * params on this queue. Return success to not
 		 * confuse mac80211. */
 		return 0;
 	}
+	BUILD_BUG_ON(ARRAY_SIZE(b43_qos_shm_offsets) !=
+		     ARRAY_SIZE(wl->qos_params));
 
-	spin_lock_irqsave(&wl->irq_lock, flags);
-	p = &(wl->qos_params[queue]);
-	memcpy(&(p->p), params, sizeof(p->p));
-	p->need_hw_update = 1;
-	spin_unlock_irqrestore(&wl->irq_lock, flags);
+	mutex_lock(&wl->mutex);
+	dev = wl->current_dev;
+	if (unlikely(!dev || (b43_status(dev) < B43_STAT_INITIALIZED)))
+		goto out_unlock;
 
-	queue_work(hw->workqueue, &wl->qos_update_work);
+	memcpy(&(wl->qos_params[queue].p), params, sizeof(*params));
+	b43_mac_suspend(dev);
+	b43_qos_params_upload(dev, &(wl->qos_params[queue].p),
+			      b43_qos_shm_offsets[queue]);
+	b43_mac_enable(dev);
+	err = 0;
 
-	return 0;
+out_unlock:
+	mutex_unlock(&wl->mutex);
+
+	return err;
 }
 
 static int b43_op_get_tx_stats(struct ieee80211_hw *hw,
 			       struct ieee80211_tx_queue_stats *stats)
 {
 	struct b43_wl *wl = hw_to_b43_wl(hw);
@@ -4217,13 +4200,12 @@ static int b43_op_start(struct ieee80211
 static void b43_op_stop(struct ieee80211_hw *hw)
 {
 	struct b43_wl *wl = hw_to_b43_wl(hw);
 	struct b43_wldev *dev = wl->current_dev;
 
 	b43_rfkill_exit(dev);
-	cancel_work_sync(&(wl->qos_update_work));
 	cancel_work_sync(&(wl->beacon_update_trigger));
 
 	mutex_lock(&wl->mutex);
 	if (b43_status(dev) >= B43_STAT_STARTED)
 		b43_wireless_core_stop(dev);
 	b43_wireless_core_exit(dev);
@@ -4616,13 +4598,12 @@ static int b43_wireless_init(struct ssb_
 	spin_lock_init(&wl->irq_lock);
 	rwlock_init(&wl->tx_lock);
 	spin_lock_init(&wl->leds_lock);
 	spin_lock_init(&wl->shm_lock);
 	mutex_init(&wl->mutex);
 	INIT_LIST_HEAD(&wl->devlist);
-	INIT_WORK(&wl->qos_update_work, b43_qos_update_work);
 	INIT_WORK(&wl->beacon_update_trigger, b43_beacon_update_trigger_work);
 	INIT_WORK(&wl->txpower_adjust_work, b43_phy_txpower_adjust_work);
 
 	ssb_set_devtypedata(dev, wl);
 	b43info(wl, "Broadcom %04X WLAN found\n", dev->bus->chip_id);
 	err = 0;


From mb at bu3sch.de  Sat Sep  6 20:11:35 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 20:11:35 +0200
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C2C6D3.3030601@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C2A1F5.6020607@lwfinger.net>
	<48C2C6D3.3030601@wetwork.net>
Message-ID: <200809062011.35637.mb@bu3sch.de>

On Saturday 06 September 2008 20:07:15 gavron at wetwork.net wrote:
> correct these issues.   I did see several other ways in which the code 
> does not match the specs.  Should that be documented in the code or 
> should the code be conformed to the specs even if that ends up breaking 
> the driver?

You're really considering breaking the driver just to conform the specs?

> Without getting into specifics it's cases where the specs will say "When 
> something=value" but the code says "when variable >=(value -1)".

Please show us the code, so we can give you advise.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Sat Sep  6 20:30:07 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 13:30:07 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C2C6D3.3030601@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C2C6D3.3030601@wetwork.net>
Message-ID: <48C2CC2F.1080708@lwfinger.net>

gavron at wetwork.net wrote:
> I've been sitting on a git clone that refuses to proceed faster than 6 
> KiB/s (it's a problem here in Melbourne).  Should it complete I will 
> correct these issues.   I did see several other ways in which the code 
> does not match the specs.  Should that be documented in the code or 
> should the code be conformed to the specs even if that ends up breaking 
> the driver?
> 
> Without getting into specifics it's cases where the specs will say "When 
> something=value" but the code says "when variable >=(value -1)".

As Michael said, we need to see the specifics. Those specs have not 
been updated for a long time, and there are certainly errors in them. 
The only thing I can say with certainty is that in step 7 of the GPHY 
page, the specs are right and the code is wrong. That has been tested!

Larry



From Larry.Finger at lwfinger.net  Sat Sep  6 20:34:02 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 13:34:02 -0500
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
Message-ID: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>

A coding error present since b43legacy was incorporated into the
kernel has prevented the driver from using the rate-setting mechanism
of mac80211. The driver has been forced to remain at a 1 Mb/s rate.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
Cc: Stable <stable at kernel.org>		[2.6.26], [2.6.25]
---

John,

Although this is not strictly a regression, it is a bug. I hope
it can be sent to 2.6.27.

Thanks,

Larry
---

Index: wireless-testing/drivers/net/wireless/b43legacy/xmit.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/xmit.c
+++ wireless-testing/drivers/net/wireless/b43legacy/xmit.c
@@ -629,7 +629,7 @@ void b43legacy_handle_hwtxstatus(struct
 	status.pm_indicated = !!(tmp & 0x80);
 	status.intermediate = !!(tmp & 0x40);
 	status.for_ampdu = !!(tmp & 0x20);
-	status.acked = !!(tmp & 0x02);
+	status.acked = tmp & 0x01;
 
 	b43legacy_handle_txstatus(dev, &status);
 }
Index: wireless-testing/drivers/net/wireless/b43legacy/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/main.c
+++ wireless-testing/drivers/net/wireless/b43legacy/main.c
@@ -744,7 +744,7 @@ static void handle_irq_transmit_status(s
 
 	while (1) {
 		v0 = b43legacy_read32(dev, B43legacy_MMIO_XMITSTAT_0);
-		if (!(v0 & 0x00000001))
+		if (!v0)
 			break;
 		v1 = b43legacy_read32(dev, B43legacy_MMIO_XMITSTAT_1);
 
@@ -758,7 +758,7 @@ static void handle_irq_transmit_status(s
 		stat.pm_indicated = !!(tmp & 0x0080);
 		stat.intermediate = !!(tmp & 0x0040);
 		stat.for_ampdu = !!(tmp & 0x0020);
-		stat.acked = !!(tmp & 0x0002);
+		stat.acked = tmp & 0x0001;
 
 		b43legacy_handle_txstatus(dev, &stat);
 	}


From mb at bu3sch.de  Sat Sep  6 20:41:05 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 20:41:05 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
Message-ID: <200809062041.06035.mb@bu3sch.de>

On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
> A coding error present since b43legacy was incorporated into the
> kernel has prevented the driver from using the rate-setting mechanism
> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.

Does version3 firmware have a different bitlayout for the status?

> Although this is not strictly a regression, it is a bug. I hope
> it can be sent to 2.6.27.

The new rules don't allow us to fix bugs after the merge window.
Only regressions.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Sat Sep  6 20:52:53 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 13:52:53 -0500
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <200809062041.06035.mb@bu3sch.de>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062041.06035.mb@bu3sch.de>
Message-ID: <48C2D185.4000003@lwfinger.net>

Michael Buesch wrote:
> On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
>> A coding error present since b43legacy was incorporated into the
>> kernel has prevented the driver from using the rate-setting mechanism
>> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> 
> Does version3 firmware have a different bitlayout for the status?

It seems so. I found this because I was not getting any acks back to 
net/mac80211/rc80211_pid_algo.c. I then reviewed the V3 specs, found 
that bit 0, not bit 1, contained the ack. Test prints confirmed that 
result. With this patch, both my BCM4306/2 and BCM4303 reach the 
maximum rate. With the current code, 54 Mb/s is not as fast as 36 
Mb/s, but at least the algorithm is working.

Larry



From mb at bu3sch.de  Sat Sep  6 20:55:51 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 20:55:51 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48C2D185.4000003@lwfinger.net>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062041.06035.mb@bu3sch.de> <48C2D185.4000003@lwfinger.net>
Message-ID: <200809062055.51797.mb@bu3sch.de>

On Saturday 06 September 2008 20:52:53 Larry Finger wrote:
> Michael Buesch wrote:
> > On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
> >> A coding error present since b43legacy was incorporated into the
> >> kernel has prevented the driver from using the rate-setting mechanism
> >> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> > 
> > Does version3 firmware have a different bitlayout for the status?
> 
> It seems so. I found this because I was not getting any acks back to 
> net/mac80211/rc80211_pid_algo.c. I then reviewed the V3 specs, found 
> that bit 0, not bit 1, contained the ack. Test prints confirmed that 
> result. With this patch, both my BCM4306/2 and BCM4303 reach the 
> maximum rate. With the current code, 54 Mb/s is not as fast as 36 
> Mb/s, but at least the algorithm is working.

Yeah ok. I just asked, because it seems the _whole_ flags bitfield
is rightshifted by one (so the other flags are wrong, too. See the
intermediate flag)

-- 
Greetings Michael.


From mb at bu3sch.de  Sat Sep  6 21:04:15 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 21:04:15 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <1220727470.10102.9.camel@johannes.berg>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062055.51797.mb@bu3sch.de>
	<1220727470.10102.9.camel@johannes.berg>
Message-ID: <200809062104.15274.mb@bu3sch.de>

On Saturday 06 September 2008 20:57:50 Johannes Berg wrote:
> On Sat, 2008-09-06 at 20:55 +0200, Michael Buesch wrote:
> > On Saturday 06 September 2008 20:52:53 Larry Finger wrote:
> > > Michael Buesch wrote:
> > > > On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
> > > >> A coding error present since b43legacy was incorporated into the
> > > >> kernel has prevented the driver from using the rate-setting mechanism
> > > >> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> > > > 
> > > > Does version3 firmware have a different bitlayout for the status?
> > > 
> > > It seems so. I found this because I was not getting any acks back to 
> > > net/mac80211/rc80211_pid_algo.c. I then reviewed the V3 specs, found 
> > > that bit 0, not bit 1, contained the ack. Test prints confirmed that 
> > > result. With this patch, both my BCM4306/2 and BCM4303 reach the 
> > > maximum rate. With the current code, 54 Mb/s is not as fast as 36 
> > > Mb/s, but at least the algorithm is working.
> > 
> > Yeah ok. I just asked, because it seems the _whole_ flags bitfield
> > is rightshifted by one (so the other flags are wrong, too. See the
> > intermediate flag)
> 
> It is, this isn't really a difference between the two but a result of
> you shifting it up/down due to the tx status via dma queue vs. tx status
> via registers thing.

Yeah, that's the point. larry's patch modified both the register and dmaqueue
mechanism. I think the register mechanism might be correct as-is (Or is it even
dead code and it's not used by any legacy device?)

-- 
Greetings Michael.


From johannes at sipsolutions.net  Sat Sep  6 20:57:50 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 06 Sep 2008 20:57:50 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <200809062055.51797.mb@bu3sch.de>
	(sfid-20080906_205617_386457_7E0F455E)
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062041.06035.mb@bu3sch.de> <48C2D185.4000003@lwfinger.net>
	<200809062055.51797.mb@bu3sch.de>
	(sfid-20080906_205617_386457_7E0F455E)
Message-ID: <1220727470.10102.9.camel@johannes.berg>

On Sat, 2008-09-06 at 20:55 +0200, Michael Buesch wrote:
> On Saturday 06 September 2008 20:52:53 Larry Finger wrote:
> > Michael Buesch wrote:
> > > On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
> > >> A coding error present since b43legacy was incorporated into the
> > >> kernel has prevented the driver from using the rate-setting mechanism
> > >> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> > > 
> > > Does version3 firmware have a different bitlayout for the status?
> > 
> > It seems so. I found this because I was not getting any acks back to 
> > net/mac80211/rc80211_pid_algo.c. I then reviewed the V3 specs, found 
> > that bit 0, not bit 1, contained the ack. Test prints confirmed that 
> > result. With this patch, both my BCM4306/2 and BCM4303 reach the 
> > maximum rate. With the current code, 54 Mb/s is not as fast as 36 
> > Mb/s, but at least the algorithm is working.
> 
> Yeah ok. I just asked, because it seems the _whole_ flags bitfield
> is rightshifted by one (so the other flags are wrong, too. See the
> intermediate flag)

It is, this isn't really a difference between the two but a result of
you shifting it up/down due to the tx status via dma queue vs. tx status
via registers thing.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080906/6fc24072/attachment.pgp>

From Larry.Finger at lwfinger.net  Sat Sep  6 21:36:43 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 14:36:43 -0500
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <200809062104.15274.mb@bu3sch.de>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062055.51797.mb@bu3sch.de>
	<1220727470.10102.9.camel@johannes.berg>
	<200809062104.15274.mb@bu3sch.de>
Message-ID: <48C2DBCB.1030706@lwfinger.net>

Michael Buesch wrote:
> On Saturday 06 September 2008 20:57:50 Johannes Berg wrote:
>> It is, this isn't really a difference between the two but a result of
>> you shifting it up/down due to the tx status via dma queue vs. tx status
>> via registers thing.
> 
> Yeah, that's the point. larry's patch modified both the register and dmaqueue
> mechanism. I think the register mechanism might be correct as-is (Or is it even
> dead code and it's not used by any legacy device?)
> 

I modified the patch to add printouts in both paths as shown below:

Index: linux-2.6/drivers/net/wireless/b43legacy/xmit.c
===================================================================
--- linux-2.6.orig/drivers/net/wireless/b43legacy/xmit.c
+++ linux-2.6/drivers/net/wireless/b43legacy/xmit.c
@@ -631,7 +631,8 @@ void b43legacy_handle_hwtxstatus(struct
         status.pm_indicated = !!(tmp & 0x80);
         status.intermediate = !!(tmp & 0x40);
         status.for_ampdu = !!(tmp & 0x20);
-       status.acked = !!(tmp & 0x02);
+       status.acked = tmp & 0x01;
+       printk(KERN_INFO "b43legacy: In b43legacy_handle_hwtxstatus, 
hw->flags = 0x%X\n", hw->flags);

         b43legacy_handle_txstatus(dev, &status);
  }
Index: linux-2.6/drivers/net/wireless/b43legacy/main.c
===================================================================
--- linux-2.6.orig/drivers/net/wireless/b43legacy/main.c
+++ linux-2.6/drivers/net/wireless/b43legacy/main.c
@@ -744,7 +744,7 @@ static void handle_irq_transmit_status(s

         while (1) {
                 v0 = b43legacy_read32(dev, B43legacy_MMIO_XMITSTAT_0);
-               if (!(v0 & 0x00000001))
+               if (!v0)
                         break;
                 v1 = b43legacy_read32(dev, B43legacy_MMIO_XMITSTAT_1);

@@ -752,13 +752,14 @@ static void handle_irq_transmit_status(s
                 stat.seq = (v1 & 0x0000FFFF);
                 stat.phy_stat = ((v1 & 0x00FF0000) >> 16);
                 tmp = (v0 & 0x0000FFFF);
+               printk(KERN_INFO "b43legacy: In 
handle_irq_transmit_status, tmp 0x%X\n", tmp);
                 stat.frame_count = ((tmp & 0xF000) >> 12);
                 stat.rts_count = ((tmp & 0x0F00) >> 8);
                 stat.supp_reason = ((tmp & 0x001C) >> 2);
                 stat.pm_indicated = !!(tmp & 0x0080);
                 stat.intermediate = !!(tmp & 0x0040);
                 stat.for_ampdu = !!(tmp & 0x0020);
-               stat.acked = !!(tmp & 0x0002);
+               stat.acked = tmp & 0x0001;

                 b43legacy_handle_txstatus(dev, &stat);
         }


What I see are lots of

b43legacy: In b43legacy_handle_hwtxstatus, hw->flags = 0x1

and this is the only one that ever triggered. ATM, I'm not sure why 
handle_irq_transmit_status() is not called.

Larry




From johannes at sipsolutions.net  Sat Sep  6 21:41:55 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 06 Sep 2008 21:41:55 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48C2DBCB.1030706@lwfinger.net>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062055.51797.mb@bu3sch.de>
	<1220727470.10102.9.camel@johannes.berg>
	<200809062104.15274.mb@bu3sch.de>  <48C2DBCB.1030706@lwfinger.net>
Message-ID: <1220730115.10102.15.camel@johannes.berg>

On Sat, 2008-09-06 at 14:36 -0500, Larry Finger wrote:

> What I see are lots of
> 
> b43legacy: In b43legacy_handle_hwtxstatus, hw->flags = 0x1
> 
> and this is the only one that ever triggered. ATM, I'm not sure why 
> handle_irq_transmit_status() is not called.

The mechanism depends on the card revision, but according to
drivers/net/wireless/b43legacy/dma.c it's always via the dma/pio
mechanism for legacy cards:

        if (dev->dev->id.revision < 5) {
                ring = b43legacy_setup_dmaring(dev, 3, 0, type);
                if (!ring)
                        goto err_destroy_rx0;
                dma->rx_ring3 = ring;
        }

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080906/5a88790d/attachment.pgp>

From Larry.Finger at lwfinger.net  Sat Sep  6 21:59:55 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 14:59:55 -0500
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <1220730115.10102.15.camel@johannes.berg>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>	
	<200809062055.51797.mb@bu3sch.de>
	<1220727470.10102.9.camel@johannes.berg>	
	<200809062104.15274.mb@bu3sch.de> <48C2DBCB.1030706@lwfinger.net>
	<1220730115.10102.15.camel@johannes.berg>
Message-ID: <48C2E13B.9020203@lwfinger.net>

Johannes Berg wrote:
> 
> The mechanism depends on the card revision, but according to
> drivers/net/wireless/b43legacy/dma.c it's always via the dma/pio
> mechanism for legacy cards:
> 
>         if (dev->dev->id.revision < 5) {
>                 ring = b43legacy_setup_dmaring(dev, 3, 0, type);
>                 if (!ring)
>                         goto err_destroy_rx0;
>                 dma->rx_ring3 = ring;
>         }

In the V3 specs, I found

"Transmit Status

When this interrupt is set, the retrieve the TransmitStatus. Note that 
on cores with revision < 5, the last DMA controller or PIO queue can 
also also get the DMA recieve done interrupt, which also triggers the 
TransmitStatus retrieval process. The driver should be prepared to 
deal with both interrupts at any time, on any revision. In AP mode, 
this interrupt also initiates the sending of powersave responses."

The implication is that the interrupt will only be generated if we use 
the last (i.e. #5) DMA controller. As we are only using #3, no 
interrupts and handle_irq_status() is dead code.

Larry


From johannes at sipsolutions.net  Sat Sep  6 22:02:39 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 06 Sep 2008 22:02:39 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48C2E13B.9020203@lwfinger.net>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062055.51797.mb@bu3sch.de>
	<1220727470.10102.9.camel@johannes.berg>
	<200809062104.15274.mb@bu3sch.de>  <48C2DBCB.1030706@lwfinger.net>
	<1220730115.10102.15.camel@johannes.berg>
	<48C2E13B.9020203@lwfinger.net>
Message-ID: <1220731359.10102.16.camel@johannes.berg>

On Sat, 2008-09-06 at 14:59 -0500, Larry Finger wrote:

> In the V3 specs, I found
> 
> "Transmit Status
> 
> When this interrupt is set, the retrieve the TransmitStatus. Note that 
> on cores with revision < 5, the last DMA controller or PIO queue can 
> also also get the DMA recieve done interrupt, which also triggers the 
> TransmitStatus retrieval process. The driver should be prepared to 
> deal with both interrupts at any time, on any revision. In AP mode, 
> this interrupt also initiates the sending of powersave responses."

Yeah, this isn't entirely correct, when the core revision is < 5 then
the register-based TX status doesn't actually exist and the firmware
always uses the FIFO-based mechanism.

> The implication is that the interrupt will only be generated if we use 
> the last (i.e. #5) DMA controller. As we are only using #3, no 
> interrupts and handle_irq_status() is dead code.

Right, only core revisions 2 and 4 are supported here.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080906/def9eb0a/attachment.pgp>

From mb at bu3sch.de  Sat Sep  6 22:07:09 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 6 Sep 2008 22:07:09 +0200
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48C2E13B.9020203@lwfinger.net>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<1220730115.10102.15.camel@johannes.berg>
	<48C2E13B.9020203@lwfinger.net>
Message-ID: <200809062207.10158.mb@bu3sch.de>

On Saturday 06 September 2008 21:59:55 Larry Finger wrote:
> Johannes Berg wrote:
> > 
> > The mechanism depends on the card revision, but according to
> > drivers/net/wireless/b43legacy/dma.c it's always via the dma/pio
> > mechanism for legacy cards:
> > 
> >         if (dev->dev->id.revision < 5) {
> >                 ring = b43legacy_setup_dmaring(dev, 3, 0, type);
> >                 if (!ring)
> >                         goto err_destroy_rx0;
> >                 dma->rx_ring3 = ring;
> >         }
> 
> In the V3 specs, I found
> 
> "Transmit Status
> 
> When this interrupt is set, the retrieve the TransmitStatus. Note that 
> on cores with revision < 5, the last DMA controller or PIO queue can 
> also also get the DMA recieve done interrupt, which also triggers the 
> TransmitStatus retrieval process. The driver should be prepared to 
> deal with both interrupts at any time, on any revision. In AP mode, 
> this interrupt also initiates the sending of powersave responses."
> 
> The implication is that the interrupt will only be generated if we use 
> the last (i.e. #5) DMA controller. As we are only using #3, no 
> interrupts and handle_irq_status() is dead code.

Ok. I'm pretty sure that the current code is correct for the register
mechanism, _however_ it is dead code and will never be called for
b43legacy. So I'd suggest you just do something like this (manually-hacked patch):

Index: wireless-testing/drivers/net/wireless/b43legacy/xmit.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/xmit.c
+++ wireless-testing/drivers/net/wireless/b43legacy/xmit.c
@@ -629,7 +629,7 @@ void b43legacy_handle_hwtxstatus(struct
.......
+ 	tmp <<= 1;
.......
        status.pm_indicated = !!(tmp & 0x80);
        status.intermediate = !!(tmp & 0x40);
        status.for_ampdu = !!(tmp & 0x20);
        status.acked = !!(tmp & 0x02);
 
        b43legacy_handle_txstatus(dev, &status);
 }


Just leave handle_irq_transmit_status as is.


-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Sat Sep  6 23:51:22 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 16:51:22 -0500
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
Message-ID: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>

A coding error present since b43legacy was incorporated into the
kernel has prevented the driver from using the rate-setting mechanism
of mac80211. The driver has been forced to remain at a 1 Mb/s rate.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
Cc: Stable <stable at kernel.org>		[2.6.26], [2.6.25]
---

John,

This is a bug, not a regression. I guess under the new rules that it
is 2.6.28 material.

Thanks,

Larry
---

Index: wireless-testing/drivers/net/wireless/b43legacy/xmit.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43legacy/xmit.c
+++ wireless-testing/drivers/net/wireless/b43legacy/xmit.c
@@ -624,7 +624,7 @@ void b43legacy_handle_hwtxstatus(struct
 	tmp = hw->count;
 	status.frame_count = (tmp >> 4);
 	status.rts_count = (tmp & 0x0F);
-	tmp = hw->flags;
+	tmp = hw->flags << 1;
 	status.supp_reason = ((tmp & 0x1C) >> 2);
 	status.pm_indicated = !!(tmp & 0x80);
 	status.intermediate = !!(tmp & 0x40);


From mb at bu3sch.de  Sun Sep  7 00:40:04 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 7 Sep 2008 00:40:04 +0200
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
Message-ID: <200809070040.04300.mb@bu3sch.de>

On Saturday 06 September 2008 23:51:22 Larry Finger wrote:
> A coding error present since b43legacy was incorporated into the
> kernel has prevented the driver from using the rate-setting mechanism
> of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> Cc: Stable <stable at kernel.org>		[2.6.26], [2.6.25]

Reviewed-by: Michael Buesch <mb at bu3sch.de>

> ---
> 
> John,
> 
> This is a bug, not a regression. I guess under the new rules that it
> is 2.6.28 material.

I wonder what the -stable rules are.
It seems really screwed to me to avoid applying the fix to 2.6.27,
but still apply it to 2.6.25/26-stable.

I'd like to see this patch in .25, .26 and .27, however I'm not sure
what the rules are.

For reference:
Three people agree on the correctness of the patch, it's a oneliner
and it's tested to fix the bug. However it is not a regression. The
bug is in there since day-0 of b43legacy. But this fix improves
TX rates a lot.

> Index: wireless-testing/drivers/net/wireless/b43legacy/xmit.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43legacy/xmit.c
> +++ wireless-testing/drivers/net/wireless/b43legacy/xmit.c
> @@ -624,7 +624,7 @@ void b43legacy_handle_hwtxstatus(struct
>  	tmp = hw->count;
>  	status.frame_count = (tmp >> 4);
>  	status.rts_count = (tmp & 0x0F);
> -	tmp = hw->flags;
> +	tmp = hw->flags << 1;
>  	status.supp_reason = ((tmp & 0x1C) >> 2);
>  	status.pm_indicated = !!(tmp & 0x80);
>  	status.intermediate = !!(tmp & 0x40);

-- 
Greetings Michael.


From gavron at wetwork.net  Sun Sep  7 00:59:10 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 15:59:10 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C2A1F5.6020607@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net>
Message-ID: <48C30B3E.2040302@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>>
>>
>>
>> Ok, here's try #2.
>> E
...
>
> This hunk does not match the specs. In addition, I think there are too 
> many right-hand curly braces for it to compile.
>
> Larry
>
I haven't tried a build yet, but please let me know if I'm on the right 
track.

E
# diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
--- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
+++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
15:54:03.000000000 -0700
@@ -1010,7 +1010,7 @@
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1021,21 +1021,26 @@
         b43legacy_phy_write(dev, 0x0811, 0x0000);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev > 5) {
+    if (phy->rev >= 3) {
         b43legacy_phy_write(dev, 0x0811, 0x0400);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev >= 2 || phy->gmode) {
+    if (phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 3) {
+            b43legacy_phy_write(dev, 0x04C2, 0x1816);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
+        }
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
             b43legacy_phy_write(dev, 0x04C3, 0x8006);
-            if (tmp == 5)
-                b43legacy_phy_write(dev, 0x04CC,
-                            (b43legacy_phy_read(dev,
-                             0x04CC) & 0x00FF) |
-                             0x1F00);
+            b43legacy_phy_write(dev, 0x04CC,
+                        (b43legacy_phy_read(dev,
+                        0x04CC) & 0x00FF) |
+                        0x1F00);
         }
+    }
+    if (phy-->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {




From Larry.Finger at lwfinger.net  Sun Sep  7 01:28:28 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 18:28:28 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C30B3E.2040302@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
Message-ID: <48C3121C.9090309@lwfinger.net>

gavron at wetwork.net wrote:
> I haven't tried a build yet, but please let me know if I'm on the right 
> track.
> 
> E
> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
> +++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
> 15:54:03.000000000 -0700
> @@ -1010,7 +1010,7 @@
>         b43legacy_phy_initb5(dev);
>     else
>         b43legacy_phy_initb6(dev);
> -    if (phy->rev >= 2 || phy->gmode)
> +    if (phy->rev >= 2 && phy->gmode)
>         b43legacy_phy_inita(dev);
> 
>     if (phy->rev >= 2) {
> @@ -1021,21 +1021,26 @@
>         b43legacy_phy_write(dev, 0x0811, 0x0000);
>         b43legacy_phy_write(dev, 0x0015, 0x00C0);
>     }
> -    if (phy->rev > 5) {
> +    if (phy->rev >= 3) {

AFAIK, this change is an error in the specs. I have since changed it. 
Sorry I didn't catch it earlier.

Otherwise, this patch seems to be correct. All you need now are the 
fixes for b43legacy_phy_initb5() and b43legacy_phy_initb6().

Larry


From gavron at wetwork.net  Sun Sep  7 01:46:14 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 16:46:14 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C3121C.9090309@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net>
Message-ID: <48C31646.2020205@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>> I haven't tried a build yet, but please let me know if I'm on the 
>> right track.
>>
>> E
>> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
>> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
>> +++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
>> 15:54:03.000000000 -0700
>> @@ -1010,7 +1010,7 @@
>>         b43legacy_phy_initb5(dev);
>>     else
>>         b43legacy_phy_initb6(dev);
>> -    if (phy->rev >= 2 || phy->gmode)
>> +    if (phy->rev >= 2 && phy->gmode)
>>         b43legacy_phy_inita(dev);
>>
>>     if (phy->rev >= 2) {
>> @@ -1021,21 +1021,26 @@
>>         b43legacy_phy_write(dev, 0x0811, 0x0000);
>>         b43legacy_phy_write(dev, 0x0015, 0x00C0);
>>     }
>> -    if (phy->rev > 5) {
>> +    if (phy->rev >= 3) {
>
> AFAIK, this change is an error in the specs. I have since changed it. 
> Sorry I didn't catch it earlier.
>
> Otherwise, this patch seems to be correct. All you need now are the 
> fixes for b43legacy_phy_initb5() and b43legacy_phy_initb6().
>
> Larry

Ok, I've re-looked at the specs and made the appropriate corrections.  
I've also gone through all of the PHY specs and found one other 
correction.  It's enclosed below for review.

Where do I go to find the stuff for ...initb5() and ...initb6()?

Thanks

E
# diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
--- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
+++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
16:42:40.000000000 -0700
@@ -1010,7 +1010,7 @@
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1025,17 +1025,22 @@
         b43legacy_phy_write(dev, 0x0811, 0x0400);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev >= 2 || phy->gmode) {
+    if (phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 3) {
+            b43legacy_phy_write(dev, 0x04C2, 0x1816);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
+        }
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
             b43legacy_phy_write(dev, 0x04C3, 0x8006);
-            if (tmp == 5)
-                b43legacy_phy_write(dev, 0x04CC,
-                            (b43legacy_phy_read(dev,
-                             0x04CC) & 0x00FF) |
-                             0x1F00);
+            b43legacy_phy_write(dev, 0x04CC,
+                        (b43legacy_phy_read(dev,
+                        0x04CC) & 0x00FF) |
+                        0x1F00);
         }
+    }
+    if (phy-->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {
@@ -1092,7 +1097,7 @@
          */
         b43legacy_nrssi_hw_update(dev, 0xFFFF);
         b43legacy_calc_nrssi_threshold(dev);
-    } else if (phy->gmode || phy->rev >= 2) {
+    } else if (phy->gmode) {
         if (phy->nrssi[0] == -1000) {
             B43legacy_WARN_ON(phy->nrssi[1] != -1000);
             b43legacy_calc_nrssi_slope(dev);



From gavron at wetwork.net  Sun Sep  7 02:14:40 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 17:14:40 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C3121C.9090309@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net>
Message-ID: <48C31CF0.1000505@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>> I haven't tried a build yet, but please let me know if I'm on the 
>> right track.
>>
>> E
>> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
>> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
>> +++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
>> 15:54:03.000000000 -0700
>> @@ -1010,7 +1010,7 @@
>>         b43legacy_phy_initb5(dev);
>>     else
>>         b43legacy_phy_initb6(dev);
>> -    if (phy->rev >= 2 || phy->gmode)
>> +    if (phy->rev >= 2 && phy->gmode)
>>         b43legacy_phy_inita(dev);
>>
>>     if (phy->rev >= 2) {
>> @@ -1021,21 +1021,26 @@
>>         b43legacy_phy_write(dev, 0x0811, 0x0000);
>>         b43legacy_phy_write(dev, 0x0015, 0x00C0);
>>     }
>> -    if (phy->rev > 5) {
>> +    if (phy->rev >= 3) {
>
> AFAIK, this change is an error in the specs. I have since changed it. 
> Sorry I didn't catch it earlier.
>
> Otherwise, this patch seems to be correct. All you need now are the 
> fixes for b43legacy_phy_initb5() and b43legacy_phy_initb6().
>
> Larry
Ok, this one applies changes to the PHY, B5PHY, and B6PHY changes. 
E

# diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
--- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
+++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
17:13:31.000000000 -0700
@@ -595,12 +595,14 @@
                     0x0035) & 0xFFC0) | 0x0064);
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x000A);
+        b43legacy_phy_write(dev, 0x5B, 0x0000);
+        b43legacy_phy_write(dev, 0x5C, 0x0000);
     }
 
     if (dev->bad_frames_preempt)
         b43legacy_phy_write(dev, B43legacy_PHY_RADIO_BITFIELD,
                     b43legacy_phy_read(dev,
-                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 11));
+                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 12));
 
     if (phy->analog == 1) {
         b43legacy_phy_write(dev, 0x0026, 0xCE00);
@@ -771,7 +773,7 @@
         b43legacy_phy_write(dev, 0x002A, 0x8AC0);
     b43legacy_phy_write(dev, 0x0038, 0x0668);
     b43legacy_radio_set_txpower_bg(dev, 0xFFFF, 0xFFFF, 0xFFFF);
-    if (phy->radio_rev <= 5)
+    if (phy->radio_rev == 4 || phy->radio_rev == 5)
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x0003);
     if (phy->radio_rev <= 2)
@@ -1010,7 +1012,7 @@
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1025,17 +1027,22 @@
         b43legacy_phy_write(dev, 0x0811, 0x0400);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev >= 2 || phy->gmode) {
+    if (phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 3) {
+            b43legacy_phy_write(dev, 0x04C2, 0x1816);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
+        }
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
             b43legacy_phy_write(dev, 0x04C3, 0x8006);
-            if (tmp == 5)
-                b43legacy_phy_write(dev, 0x04CC,
-                            (b43legacy_phy_read(dev,
-                             0x04CC) & 0x00FF) |
-                             0x1F00);
+            b43legacy_phy_write(dev, 0x04CC,
+                        (b43legacy_phy_read(dev,
+                        0x04CC) & 0x00FF) |
+                        0x1F00);
         }
+    }
+    if (phy-->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {
@@ -1092,7 +1099,7 @@
          */
         b43legacy_nrssi_hw_update(dev, 0xFFFF);
         b43legacy_calc_nrssi_threshold(dev);
-    } else if (phy->gmode || phy->rev >= 2) {
+    } else if (phy->gmode) {
         if (phy->nrssi[0] == -1000) {
             B43legacy_WARN_ON(phy->nrssi[1] != -1000);
             b43legacy_calc_nrssi_slope(dev);



From Larry.Finger at lwfinger.net  Sun Sep  7 02:18:03 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 19:18:03 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C31646.2020205@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net> <48C31646.2020205@wetwork.net>
Message-ID: <48C31DBB.6000709@lwfinger.net>

gavron at wetwork.net wrote:
> 
> 
> Larry Finger wrote:
>> gavron at wetwork.net wrote:
>>> I haven't tried a build yet, but please let me know if I'm on the 
>>> right track.
>>>
>>> E
>>> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
>>> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
>>> +++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
>>> 15:54:03.000000000 -0700
>>> @@ -1010,7 +1010,7 @@
>>>         b43legacy_phy_initb5(dev);
>>>     else
>>>         b43legacy_phy_initb6(dev);
>>> -    if (phy->rev >= 2 || phy->gmode)
>>> +    if (phy->rev >= 2 && phy->gmode)
>>>         b43legacy_phy_inita(dev);
>>>
>>>     if (phy->rev >= 2) {
>>> @@ -1021,21 +1021,26 @@
>>>         b43legacy_phy_write(dev, 0x0811, 0x0000);
>>>         b43legacy_phy_write(dev, 0x0015, 0x00C0);
>>>     }
>>> -    if (phy->rev > 5) {
>>> +    if (phy->rev >= 3) {
>>
>> AFAIK, this change is an error in the specs. I have since changed it. 
>> Sorry I didn't catch it earlier.
>>
>> Otherwise, this patch seems to be correct. All you need now are the 
>> fixes for b43legacy_phy_initb5() and b43legacy_phy_initb6().
>>
>> Larry
> 
> Ok, I've re-looked at the specs and made the appropriate corrections.  
> I've also gone through all of the PHY specs and found one other 
> correction.  It's enclosed below for review.
> 
> Where do I go to find the stuff for ...initb5() and ...initb6()?

That one was also an error in the specs - fixed now.

On the V3 specifications site, click on the RecentChanges button and 
select B5PHY and B6PHY to get the specs for the other routines. I 
rechecked the specs, and all agree with my current (revised) routines.


Larry


From gavron at wetwork.net  Sun Sep  7 02:25:09 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 17:25:09 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C31DBB.6000709@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net> <48C31646.2020205@wetwork.net>
	<48C31DBB.6000709@lwfinger.net>
Message-ID: <48C31F65.2000406@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>>
>>
>> Larry Finger wrote:
>>> gavron at wetwork.net wrote:
>>>> I haven't tried a build yet, but please let me know if I'm on the 
>>>> right track.
>>>>
>>>> E
>>>> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
>>>> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
>>>> +++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
>>>> 15:54:03.000000000 -0700
>>>> @@ -1010,7 +1010,7 @@
>>>>         b43legacy_phy_initb5(dev);
>>>>     else
>>>>         b43legacy_phy_initb6(dev);
>>>> -    if (phy->rev >= 2 || phy->gmode)
>>>> +    if (phy->rev >= 2 && phy->gmode)
>>>>         b43legacy_phy_inita(dev);
>>>>
>>>>     if (phy->rev >= 2) {
>>>> @@ -1021,21 +1021,26 @@
>>>>         b43legacy_phy_write(dev, 0x0811, 0x0000);
>>>>         b43legacy_phy_write(dev, 0x0015, 0x00C0);
>>>>     }
>>>> -    if (phy->rev > 5) {
>>>> +    if (phy->rev >= 3) {
>>>
>>> AFAIK, this change is an error in the specs. I have since changed 
>>> it. Sorry I didn't catch it earlier.
>>>
>>> Otherwise, this patch seems to be correct. All you need now are the 
>>> fixes for b43legacy_phy_initb5() and b43legacy_phy_initb6().
>>>
>>> Larry
>>
>> Ok, I've re-looked at the specs and made the appropriate 
>> corrections.  I've also gone through all of the PHY specs and found 
>> one other correction.  It's enclosed below for review.
>>
>> Where do I go to find the stuff for ...initb5() and ...initb6()?
>
> That one was also an error in the specs - fixed now.
>
> On the V3 specifications site, click on the RecentChanges button and 
> select B5PHY and B6PHY to get the specs for the other routines. I 
> rechecked the specs, and all agree with my current (revised) routines.
>
>
> Larry

Try #5:
# diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
--- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
+++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
17:24:29.000000000 -0700
@@ -595,12 +595,14 @@
                     0x0035) & 0xFFC0) | 0x0064);
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x000A);
+        b43legacy_phy_write(dev, 0x5B, 0x0000);
+        b43legacy_phy_write(dev, 0x5C, 0x0000);
     }
 
     if (dev->bad_frames_preempt)
         b43legacy_phy_write(dev, B43legacy_PHY_RADIO_BITFIELD,
                     b43legacy_phy_read(dev,
-                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 11));
+                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 12));
 
     if (phy->analog == 1) {
         b43legacy_phy_write(dev, 0x0026, 0xCE00);
@@ -771,7 +773,7 @@
         b43legacy_phy_write(dev, 0x002A, 0x8AC0);
     b43legacy_phy_write(dev, 0x0038, 0x0668);
     b43legacy_radio_set_txpower_bg(dev, 0xFFFF, 0xFFFF, 0xFFFF);
-    if (phy->radio_rev <= 5)
+    if (phy->radio_rev == 4 || phy->radio_rev == 5)
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x0003);
     if (phy->radio_rev <= 2)
@@ -1010,7 +1012,7 @@
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1025,17 +1027,22 @@
         b43legacy_phy_write(dev, 0x0811, 0x0400);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev >= 2 || phy->gmode) {
+    if (phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 3) {
+            b43legacy_phy_write(dev, 0x04C2, 0x1816);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
+        }
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
             b43legacy_phy_write(dev, 0x04C3, 0x8006);
-            if (tmp == 5)
-                b43legacy_phy_write(dev, 0x04CC,
-                            (b43legacy_phy_read(dev,
-                             0x04CC) & 0x00FF) |
-                             0x1F00);
+            b43legacy_phy_write(dev, 0x04CC,
+                        (b43legacy_phy_read(dev,
+                        0x04CC) & 0x00FF) |
+                        0x1F00);
         }
+    }
+    if (phy->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {
@@ -1078,7 +1085,7 @@
         else
             b43legacy_phy_write(dev, 0x002F, 0x0202);
     }
-    if (phy->gmode || phy->rev >= 2) {
+    if (phy->gmode) {
         b43legacy_phy_lo_adjust(dev, 0);
         b43legacy_phy_write(dev, 0x080F, 0x8078);
     }



From Larry.Finger at lwfinger.net  Sun Sep  7 02:35:59 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 06 Sep 2008 19:35:59 -0500
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C31F65.2000406@wetwork.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net> <48C31646.2020205@wetwork.net>
	<48C31DBB.6000709@lwfinger.net> <48C31F65.2000406@wetwork.net>
Message-ID: <48C321EF.30909@lwfinger.net>

gavron at wetwork.net wrote:
> 
> Try #5:
> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700

This one is pretty close, but I think you missed a change at line 16a 
of B6PHY.

One other thing - use the -uNp switch for diff.

Larry



From gavron at wetwork.net  Sun Sep  7 02:41:33 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 17:41:33 -0700
Subject: Speed enhancement for BCM4306/2
In-Reply-To: <48C321EF.30909@lwfinger.net>
References: <48C1BA91.7050106@lwfinger.net> <48C20928.10202@wetwork.net>
	<48C20BD7.6080605@lwfinger.net> <48C20F64.1000700@wetwork.net>
	<48C2A1F5.6020607@lwfinger.net> <48C30B3E.2040302@wetwork.net>
	<48C3121C.9090309@lwfinger.net> <48C31646.2020205@wetwork.net>
	<48C31DBB.6000709@lwfinger.net> <48C31F65.2000406@wetwork.net>
	<48C321EF.30909@lwfinger.net>
Message-ID: <48C3233D.60201@wetwork.net>



Larry Finger wrote:
> gavron at wetwork.net wrote:
>>
>> Try #5:
>> # diff -uN /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
>> --- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
>
> This one is pretty close, but I think you missed a change at line 16a 
> of B6PHY.
>
> One other thing - use the -uNp switch for diff.
>
> Larry
>
T6:
# diff -uNp /tmp/phy.c drivers/net/wireless/b43legacy/phy.c
--- /tmp/phy.c    2008-09-06 15:13:33.000000000 -0700
+++ drivers/net/wireless/b43legacy/phy.c    2008-09-06 
17:40:20.000000000 -0700
@@ -595,12 +595,14 @@ static void b43legacy_phy_initb5(struct
                     0x0035) & 0xFFC0) | 0x0064);
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x000A);
+        b43legacy_phy_write(dev, 0x5B, 0x0000);
+        b43legacy_phy_write(dev, 0x5C, 0x0000);
     }
 
     if (dev->bad_frames_preempt)
         b43legacy_phy_write(dev, B43legacy_PHY_RADIO_BITFIELD,
                     b43legacy_phy_read(dev,
-                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 11));
+                    B43legacy_PHY_RADIO_BITFIELD) | (1 << 12));
 
     if (phy->analog == 1) {
         b43legacy_phy_write(dev, 0x0026, 0xCE00);
@@ -753,7 +755,7 @@ static void b43legacy_phy_initb6(struct
         b43legacy_radio_write16(dev, 0x0050, 0x0020);
     }
     if (phy->radio_rev <= 2) {
-        b43legacy_radio_write16(dev, 0x007C, 0x0020);
+        b43legacy_radio_write16(dev, 0x0050, 0x0020);
         b43legacy_radio_write16(dev, 0x005A, 0x0070);
         b43legacy_radio_write16(dev, 0x005B, 0x007B);
         b43legacy_radio_write16(dev, 0x005C, 0x00B0);
@@ -771,7 +773,7 @@ static void b43legacy_phy_initb6(struct
         b43legacy_phy_write(dev, 0x002A, 0x8AC0);
     b43legacy_phy_write(dev, 0x0038, 0x0668);
     b43legacy_radio_set_txpower_bg(dev, 0xFFFF, 0xFFFF, 0xFFFF);
-    if (phy->radio_rev <= 5)
+    if (phy->radio_rev == 4 || phy->radio_rev == 5)
         b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
                     0x005D) & 0xFF80) | 0x0003);
     if (phy->radio_rev <= 2)
@@ -1010,7 +1012,7 @@ static void b43legacy_phy_initg(struct b
         b43legacy_phy_initb5(dev);
     else
         b43legacy_phy_initb6(dev);
-    if (phy->rev >= 2 || phy->gmode)
+    if (phy->rev >= 2 && phy->gmode)
         b43legacy_phy_inita(dev);
 
     if (phy->rev >= 2) {
@@ -1025,17 +1027,22 @@ static void b43legacy_phy_initg(struct b
         b43legacy_phy_write(dev, 0x0811, 0x0400);
         b43legacy_phy_write(dev, 0x0015, 0x00C0);
     }
-    if (phy->rev >= 2 || phy->gmode) {
+    if (phy->gmode) {
         tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-        if (tmp == 3 || tmp == 5) {
+        if (tmp == 3) {
+            b43legacy_phy_write(dev, 0x04C2, 0x1816);
+            b43legacy_phy_write(dev, 0x04C3, 0x8606);
+        }
+        if (tmp == 4 || tmp == 5) {
             b43legacy_phy_write(dev, 0x04C2, 0x1816);
             b43legacy_phy_write(dev, 0x04C3, 0x8006);
-            if (tmp == 5)
-                b43legacy_phy_write(dev, 0x04CC,
-                            (b43legacy_phy_read(dev,
-                             0x04CC) & 0x00FF) |
-                             0x1F00);
+            b43legacy_phy_write(dev, 0x04CC,
+                        (b43legacy_phy_read(dev,
+                        0x04CC) & 0x00FF) |
+                        0x1F00);
         }
+    }
+    if (phy->rev >= 2)
         b43legacy_phy_write(dev, 0x047E, 0x0078);
     }
     if (phy->radio_rev == 8) {
@@ -1078,7 +1085,7 @@ static void b43legacy_phy_initg(struct b
         else
             b43legacy_phy_write(dev, 0x002F, 0x0202);
     }
-    if (phy->gmode || phy->rev >= 2) {
+    if (phy->gmode) {
         b43legacy_phy_lo_adjust(dev, 0);
         b43legacy_phy_write(dev, 0x080F, 0x8078);



From linville at tuxdriver.com  Sat Sep  6 20:44:08 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Sat, 6 Sep 2008 14:44:08 -0400
Subject: [PATCH] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <200809062041.06035.mb@bu3sch.de>
References: <48c2cd1a.pA60sTEK0WsW6wtt%Larry.Finger@lwfinger.net>
	<200809062041.06035.mb@bu3sch.de>
Message-ID: <20080906184408.GA2923@tuxdriver.com>

On Sat, Sep 06, 2008 at 08:41:05PM +0200, Michael Buesch wrote:
> On Saturday 06 September 2008 20:34:02 Larry Finger wrote:
> > A coding error present since b43legacy was incorporated into the
> > kernel has prevented the driver from using the rate-setting mechanism
> > of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> 
> Does version3 firmware have a different bitlayout for the status?
> 
> > Although this is not strictly a regression, it is a bug. I hope
> > it can be sent to 2.6.27.
> 
> The new rules don't allow us to fix bugs after the merge window.
> Only regressions.

I imagine the powers that be would claim it isn't a new rule, but it
is a new enforcement policy...

John


From gavron at wetwork.net  Sun Sep  7 06:30:00 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Sat, 06 Sep 2008 21:30:00 -0700
Subject: [PATCH] b43legacy: Fix to enhance TX speed
Message-ID: <48C358C8.3080607@wetwork.net>

Recent changes in the specifications have improved the performance
of the BCM4306/2 devices that use b43legacy as the driver. These
"errors" in the specs have been present from the very first implementation
of bcm43xx.

Signed-off-by: Ehud Gavron <gavron at wetwork.net>
Tested-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

This is 2.6.28.material.

Ehud
---

Index: linux-2.6/drivers/net/wireless/b43legacy/phy.c
===================================================================
--- linux-2.6.orig/drivers/net/wireless/b43legacy/phy.c
+++ linux-2.6/drivers/net/wireless/b43legacy/phy.c
@@ -595,12 +595,14 @@ static void b43legacy_phy_initb5(struct
 				    0x0035) & 0xFFC0) | 0x0064);
 		b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
 				    0x005D) & 0xFF80) | 0x000A);
+		b43legacy_phy_write(dev, 0x5B, 0x0000);
+		b43legacy_phy_write(dev, 0x5C, 0x0000);
 	}
 
 	if (dev->bad_frames_preempt)
 		b43legacy_phy_write(dev, B43legacy_PHY_RADIO_BITFIELD,
 				    b43legacy_phy_read(dev,
-				    B43legacy_PHY_RADIO_BITFIELD) | (1 << 11));
+				    B43legacy_PHY_RADIO_BITFIELD) | (1 << 12));
 
 	if (phy->analog == 1) {
 		b43legacy_phy_write(dev, 0x0026, 0xCE00);
@@ -753,7 +755,7 @@ static void b43legacy_phy_initb6(struct
 		b43legacy_radio_write16(dev, 0x0050, 0x0020);
 	}
 	if (phy->radio_rev <= 2) {
-		b43legacy_radio_write16(dev, 0x007C, 0x0020);
+		b43legacy_radio_write16(dev, 0x0050, 0x0020);
 		b43legacy_radio_write16(dev, 0x005A, 0x0070);
 		b43legacy_radio_write16(dev, 0x005B, 0x007B);
 		b43legacy_radio_write16(dev, 0x005C, 0x00B0);
@@ -771,7 +773,7 @@ static void b43legacy_phy_initb6(struct
 		b43legacy_phy_write(dev, 0x002A, 0x8AC0);
 	b43legacy_phy_write(dev, 0x0038, 0x0668);
 	b43legacy_radio_set_txpower_bg(dev, 0xFFFF, 0xFFFF, 0xFFFF);
-	if (phy->radio_rev <= 5)
+	if (phy->radio_rev == 4 || phy->radio_rev == 5)
 		b43legacy_phy_write(dev, 0x005D, (b43legacy_phy_read(dev,
 				    0x005D) & 0xFF80) | 0x0003);
 	if (phy->radio_rev <= 2)
@@ -1010,7 +1012,7 @@ static void b43legacy_phy_initg(struct b
 		b43legacy_phy_initb5(dev);
 	else
 		b43legacy_phy_initb6(dev);
-	if (phy->rev >= 2 || phy->gmode)
+	if (phy->rev >= 2 && phy->gmode)
 		b43legacy_phy_inita(dev);
 
 	if (phy->rev >= 2) {
@@ -1025,18 +1027,22 @@ static void b43legacy_phy_initg(struct b
 		b43legacy_phy_write(dev, 0x0811, 0x0400);
 		b43legacy_phy_write(dev, 0x0015, 0x00C0);
 	}
-	if (phy->rev >= 2 || phy->gmode) {
+	if (phy->gmode) {
 		tmp = b43legacy_phy_read(dev, 0x0400) & 0xFF;
-		if (tmp == 3 || tmp == 5) {
+		if (tmp == 3) {
+			b43legacy_phy_write(dev, 0x04C2, 0x1816);
+			b43legacy_phy_write(dev, 0x04C3, 0x8606);
+		}
+		if (tmp == 4 || tmp == 5) {
 			b43legacy_phy_write(dev, 0x04C2, 0x1816);
 			b43legacy_phy_write(dev, 0x04C3, 0x8006);
-			if (tmp == 5)
-				b43legacy_phy_write(dev, 0x04CC,
-						    (b43legacy_phy_read(dev,
-						     0x04CC) & 0x00FF) |
-						     0x1F00);
+			b43legacy_phy_write(dev, 0x04CC,
+					    (b43legacy_phy_read(dev,
+					     0x04CC) & 0x00FF) |
+					     0x1F00);
 		}
-		b43legacy_phy_write(dev, 0x047E, 0x0078);
+		if (phy->rev >= 2)
+			b43legacy_phy_write(dev, 0x047E, 0x0078);
 	}
 	if (phy->radio_rev == 8) {
 		b43legacy_phy_write(dev, 0x0801, b43legacy_phy_read(dev, 0x0801)
@@ -1078,7 +1084,7 @@ static void b43legacy_phy_initg(struct b
 		else
 			b43legacy_phy_write(dev, 0x002F, 0x0202);
 	}
-	if (phy->gmode || phy->rev >= 2) {
+	if (phy->gmode) {
 		b43legacy_phy_lo_adjust(dev, 0);
 		b43legacy_phy_write(dev, 0x080F, 0x8078);
 	}


From nigifabio at gmx.it  Sun Sep  7 10:20:06 2008
From: nigifabio at gmx.it (Fabio Nigi)
Date: Sun, 07 Sep 2008 10:20:06 +0200
Subject: bcm4310
Message-ID: <48C38EB6.6040803@gmx.it>

hi all,

waiting for a beta or samething else of b43 driver that support my card.

wich is the best way to use it?

ndiswrapper or wl driver (distribuited by broadcom)

and there is same svn/cvs where i can take the source for this card?

many thanks
Fabio

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080907/9af56ac3/attachment.pgp>

From Larry.Finger at lwfinger.net  Sun Sep  7 15:59:40 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sun, 07 Sep 2008 08:59:40 -0500
Subject: bcm4310
In-Reply-To: <48C38EB6.6040803@gmx.it>
References: <48C38EB6.6040803@gmx.it>
Message-ID: <48C3DE4C.3040608@lwfinger.net>

Fabio Nigi wrote:
> hi all,
> 
> waiting for a beta or samething else of b43 driver that support my card.
> 
> wich is the best way to use it?
> 
> ndiswrapper or wl driver (distribuited by broadcom)
> 
> and there is same svn/cvs where i can take the source for this card?

Assuming that your BCM4310 has a PCI ID 0f 4315, no beta or alpha code 
is yet available. We are still completing the reverse engineering. 
Source is still vaporware!! When anything is available, it will be in 
the wireless-testing git tree.

Both ndiswrapper with the Windows driver and the hybrid wl driver load 
a binary blob that has not been reviewed. There are reports of them 
working in some instances, and other reports of crashes. Start with 
one - your choice. If it works, keep it. If it crashes, try the other.

Larry


From artem.v.antonov at gmail.com  Sun Sep  7 19:58:52 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Sun, 7 Sep 2008 21:58:52 +0400
Subject: [PATCH] Fix hardware power control init
Message-ID: <6bc534830809071058o4316300fgd6a3ad967b7c1a3d@mail.gmail.com>

Hi!
This patch fixes hardware power control init. Now it works better :)

--- linux-2.6.27/drivers/net/wireless/b43/phy_g.c	2008-09-07
20:16:35.000000000 +0400
+++ linux-2.6.27/drivers/net/wireless/b43/phy_g.c	2008-09-07
20:18:22.000000000 +0400
@@ -275,9 +275,9 @@
 	u16 value;

 	for (i = 0; i < 32; i++)
-		b43_ofdmtab_write16(dev, 0x3C20, i, gphy->tssi2dbm[i]);
+		b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i + 32, gphy->tssi2dbm[i]);
 	for (i = 32; i < 64; i++)
-		b43_ofdmtab_write16(dev, 0x3C00, i - 32, gphy->tssi2dbm[i]);
+		b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i - 32, gphy->tssi2dbm[i]);
 	for (i = 0; i < 64; i += 2) {
 		value = (u16) gphy->tssi2dbm[i];
 		value |= ((u16) gphy->tssi2dbm[i + 1]) << 8;
@@ -302,9 +302,9 @@
 			tmp = lo->bbatt_list.list[bb].att;
 			tmp <<= 8;
 			if (phy->radio_rev == 8)
-				tmp |= 0x50;
-			else
 				tmp |= 0x40;
+			else
+				tmp |= 0x50;
 			tmp |= lo->rfatt_list.list[rf].att;
 			b43_phy_write(dev, 0x3C0 + nr_written, tmp);
 			nr_written++;
@@ -2053,7 +2053,7 @@
 	if (phy->radio_ver == 0x2050 && phy->radio_rev == 8) {
 		b43_phy_write(dev, 0x047A, (b43_phy_read(dev, 0x047A)
 					    & 0xFF0F) | 0x0010);
-		b43_phy_write(dev, 0x005D, b43_phy_read(dev, 0x005D)
+		b43_phy_write(dev, 0x004D, b43_phy_read(dev, 0x004D)
 			      | 0x8000);
 		b43_phy_write(dev, 0x004E, (b43_phy_read(dev, 0x004E)
 					    & 0xFFC0) | 0x0010);

Best regards.


From mb at bu3sch.de  Sun Sep  7 20:03:39 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 7 Sep 2008 20:03:39 +0200
Subject: [PATCH] Fix hardware power control init
In-Reply-To: <6bc534830809071058o4316300fgd6a3ad967b7c1a3d@mail.gmail.com>
References: <6bc534830809071058o4316300fgd6a3ad967b7c1a3d@mail.gmail.com>
Message-ID: <200809072003.40091.mb@bu3sch.de>

On Sunday 07 September 2008 19:58:52 Artem Antonov wrote:
> Hi!
> This patch fixes hardware power control init. Now it works better :)

Hardware power control cannot work, as we don't implement major parts of it.

> --- linux-2.6.27/drivers/net/wireless/b43/phy_g.c	2008-09-07
> 20:16:35.000000000 +0400
> +++ linux-2.6.27/drivers/net/wireless/b43/phy_g.c	2008-09-07
> 20:18:22.000000000 +0400
> @@ -275,9 +275,9 @@
>  	u16 value;
> 
>  	for (i = 0; i < 32; i++)
> -		b43_ofdmtab_write16(dev, 0x3C20, i, gphy->tssi2dbm[i]);
> +		b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i + 32, gphy->tssi2dbm[i]);
>  	for (i = 32; i < 64; i++)
> -		b43_ofdmtab_write16(dev, 0x3C00, i - 32, gphy->tssi2dbm[i]);
> +		b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i - 32, gphy->tssi2dbm[i]);
>  	for (i = 0; i < 64; i += 2) {
>  		value = (u16) gphy->tssi2dbm[i];
>  		value |= ((u16) gphy->tssi2dbm[i + 1]) << 8;
> @@ -302,9 +302,9 @@
>  			tmp = lo->bbatt_list.list[bb].att;
>  			tmp <<= 8;
>  			if (phy->radio_rev == 8)
> -				tmp |= 0x50;
> -			else
>  				tmp |= 0x40;
> +			else
> +				tmp |= 0x50;
>  			tmp |= lo->rfatt_list.list[rf].att;
>  			b43_phy_write(dev, 0x3C0 + nr_written, tmp);
>  			nr_written++;
> @@ -2053,7 +2053,7 @@
>  	if (phy->radio_ver == 0x2050 && phy->radio_rev == 8) {
>  		b43_phy_write(dev, 0x047A, (b43_phy_read(dev, 0x047A)
>  					    & 0xFF0F) | 0x0010);
> -		b43_phy_write(dev, 0x005D, b43_phy_read(dev, 0x005D)
> +		b43_phy_write(dev, 0x004D, b43_phy_read(dev, 0x004D)
>  			      | 0x8000);
>  		b43_phy_write(dev, 0x004E, (b43_phy_read(dev, 0x004E)
>  					    & 0xFFC0) | 0x0010);
> 
> Best regards.
> 
> 



-- 
Greetings Michael.


From mb at bu3sch.de  Sun Sep  7 20:13:24 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 7 Sep 2008 20:13:24 +0200
Subject: [PATCH] b43legacy: Fix to enhance TX speed
In-Reply-To: <48C358C8.3080607@wetwork.net>
References: <48C358C8.3080607@wetwork.net>
Message-ID: <200809072013.24693.mb@bu3sch.de>

On Sunday 07 September 2008 06:30:00 gavron at wetwork.net wrote:
> 

(Please inline the patch next time.)

Acked-by: Michael Buesch <mb at bu3sch.de>


-- 
Greetings Michael.


From artem.v.antonov at gmail.com  Sun Sep  7 20:17:38 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Sun, 7 Sep 2008 22:17:38 +0400
Subject: [PATCH] Fix hardware power control init
In-Reply-To: <200809072003.40091.mb@bu3sch.de>
References: <6bc534830809071058o4316300fgd6a3ad967b7c1a3d@mail.gmail.com>
	<200809072003.40091.mb@bu3sch.de>
Message-ID: <6bc534830809071117h624fc9a9y92935bdd6d3be862@mail.gmail.com>

ok. Than this patch fixes the existing code of it :)
With "hwpctl=1" driver works more stable, than without this patch.
just synced code to specs )

2008/9/7, Michael Buesch <mb at bu3sch.de>:
> On Sunday 07 September 2008 19:58:52 Artem Antonov wrote:
>  > Hi!
>  > This patch fixes hardware power control init. Now it works better :)
>
>
> Hardware power control cannot work, as we don't implement major parts of it.
>
>
>  > --- linux-2.6.27/drivers/net/wireless/b43/phy_g.c     2008-09-07
>  > 20:16:35.000000000 +0400
>  > +++ linux-2.6.27/drivers/net/wireless/b43/phy_g.c     2008-09-07
>  > 20:18:22.000000000 +0400
>  > @@ -275,9 +275,9 @@
>  >       u16 value;
>  >
>  >       for (i = 0; i < 32; i++)
>  > -             b43_ofdmtab_write16(dev, 0x3C20, i, gphy->tssi2dbm[i]);
>  > +             b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i + 32, gphy->tssi2dbm[i]);
>  >       for (i = 32; i < 64; i++)
>  > -             b43_ofdmtab_write16(dev, 0x3C00, i - 32, gphy->tssi2dbm[i]);
>  > +             b43_ofdmtab_write16(dev, B43_OFDMTAB_TSSI, i - 32, gphy->tssi2dbm[i]);
>  >       for (i = 0; i < 64; i += 2) {
>  >               value = (u16) gphy->tssi2dbm[i];
>  >               value |= ((u16) gphy->tssi2dbm[i + 1]) << 8;
>  > @@ -302,9 +302,9 @@
>  >                       tmp = lo->bbatt_list.list[bb].att;
>  >                       tmp <<= 8;
>  >                       if (phy->radio_rev == 8)
>  > -                             tmp |= 0x50;
>  > -                     else
>  >                               tmp |= 0x40;
>  > +                     else
>  > +                             tmp |= 0x50;
>  >                       tmp |= lo->rfatt_list.list[rf].att;
>  >                       b43_phy_write(dev, 0x3C0 + nr_written, tmp);
>  >                       nr_written++;
>  > @@ -2053,7 +2053,7 @@
>  >       if (phy->radio_ver == 0x2050 && phy->radio_rev == 8) {
>  >               b43_phy_write(dev, 0x047A, (b43_phy_read(dev, 0x047A)
>  >                                           & 0xFF0F) | 0x0010);
>  > -             b43_phy_write(dev, 0x005D, b43_phy_read(dev, 0x005D)
>  > +             b43_phy_write(dev, 0x004D, b43_phy_read(dev, 0x004D)
>  >                             | 0x8000);
>  >               b43_phy_write(dev, 0x004E, (b43_phy_read(dev, 0x004E)
>  >                                           & 0xFFC0) | 0x0010);
>  >
>  > Best regards.
>  >
>  >
>
>
>
>
> --
>  Greetings Michael.
>


From mb at bu3sch.de  Mon Sep  8 14:53:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 8 Sep 2008 14:53:55 +0200
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <20080908053155.GI4099@kroah.com>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
	<200809070040.04300.mb@bu3sch.de> <20080908053155.GI4099@kroah.com>
Message-ID: <200809081453.56241.mb@bu3sch.de>

On Monday 08 September 2008 07:31:55 Greg KH wrote:
> On Sun, Sep 07, 2008 at 12:40:04AM +0200, Michael Buesch wrote:
> > On Saturday 06 September 2008 23:51:22 Larry Finger wrote:
> > > A coding error present since b43legacy was incorporated into the
> > > kernel has prevented the driver from using the rate-setting mechanism
> > > of mac80211. The driver has been forced to remain at a 1 Mb/s rate.
> > > 
> > > Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> > > Cc: Stable <stable at kernel.org>		[2.6.26], [2.6.25]
> > 
> > Reviewed-by: Michael Buesch <mb at bu3sch.de>
> > 
> > > ---
> > > 
> > > John,
> > > 
> > > This is a bug, not a regression. I guess under the new rules that it
> > > is 2.6.28 material.
> > 
> > I wonder what the -stable rules are.
> 
> Bug fixes, not new features, it's pretty simple :)

Yeah, well. My concern was:
- We put it into .25-stable and .26-stable, because it's a bugfix.
  That's perfectly fine.
- We do _not_ put it into .27 mainline, because it is just a simple
  bug, but not a regression. Instead we wait for .27-stable.

Doesn't make a lot sense to me. :)

So I'd like to see it in .27, too, despite the strict regressions-only
rule. A general regressions-only rule simply doesn't always make sense, IMO.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Mon Sep  8 18:22:43 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 08 Sep 2008 11:22:43 -0500
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <20080908053155.GI4099@kroah.com>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
	<200809070040.04300.mb@bu3sch.de> <20080908053155.GI4099@kroah.com>
Message-ID: <48C55153.3070309@lwfinger.net>

Greg KH wrote:
> 
> Bug fixes, not new features, it's pretty simple :)

Just bug fixes, or does it have to be a regression?

Larry



From linville at tuxdriver.com  Mon Sep  8 22:54:59 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Mon, 8 Sep 2008 16:54:59 -0400
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <48C55153.3070309@lwfinger.net>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
	<200809070040.04300.mb@bu3sch.de> <20080908053155.GI4099@kroah.com>
	<48C55153.3070309@lwfinger.net>
Message-ID: <20080908205459.GC24557@tuxdriver.com>

On Mon, Sep 08, 2008 at 11:22:43AM -0500, Larry Finger wrote:
> Greg KH wrote:
>>
>> Bug fixes, not new features, it's pretty simple :)
>
> Just bug fixes, or does it have to be a regression?

As I understand it, the rule is more like "bug fixes that are committed
in the linux-2.6 tree".  Since Linus has become more strict about
requiring "regressions only" after the merge window, that effectively
enforces the "regressions only" rule on the -stable trees as well.

John
-- 
John W. Linville
linville at tuxdriver.com


From dwmw2 at infradead.org  Tue Sep  9 02:37:23 2008
From: dwmw2 at infradead.org (David Woodhouse)
Date: Mon, 08 Sep 2008 19:37:23 -0500
Subject: [PATCH] b43legacy: Fix to enhance TX speed
In-Reply-To: <48C358C8.3080607@wetwork.net>
References: <48C358C8.3080607@wetwork.net>
Message-ID: <1220920643.5748.22.camel@shinybook.infradead.org>

On Sat, 2008-09-06 at 21:30 -0700, gavron at wetwork.net wrote:
> Recent changes in the specifications have improved the performance
> of the BCM4306/2 devices that use b43legacy as the driver. These
> "errors" in the specs have been present from the very first
> implementation of bcm43xx.

I haven't verified any speed improvement, but certainly this patch (when
applied on top of the Fedora 9 kernel) doesn't make my shinybook get bus
errors, which has been a common problem when updating this part of the
code to match the specs.

-- 
David Woodhouse                            Open Source Technology Centre
David.Woodhouse at intel.com                              Intel Corporation



From navalorenx at gmail.com  Wed Sep 10 00:15:14 2008
From: navalorenx at gmail.com (Lorenzo Nava)
Date: Wed, 10 Sep 2008 00:15:14 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <200809061621.48449.mb@bu3sch.de>
References: <200809061621.48449.mb@bu3sch.de>
Message-ID: <EEE47678-6181-439E-AAA8-0D024C85CC46@gmail.com>

Hi everybody,

I worked with the QoS parameters trying to understand why, checking  
them within the firmware, they don't seems to have the correct values  
even if they were set correctly by the driver.
I think that there could be an error in the b43.h file:

/* SHM offsets to the QOS data structures for the 4 different queues. */
#define B43_QOS_PARAMS(queue)   (B43_SHM_SH_EDCFQ + \
                                  (B43_NR_QOSPARAMS * sizeof(u16) *  
(queue)))
#define B43_QOS_BACKGROUND      B43_QOS_PARAMS(0)
#define B43_QOS_BESTEFFORT      B43_QOS_PARAMS(1)
#define B43_QOS_VIDEO           B43_QOS_PARAMS(2)
#define B43_QOS_VOICE           B43_QOS_PARAMS(3)

/* QOS parameter hardware data structure offsets. */
#define B43_NR_QOSPARAMS        22

Each EDCF parameters set take up 32 byte (in the firmware the offset  
between 2 EDCFQ is 0x010 that is equivalent to 0x020 if the offset was  
expressed in byte). This means that the B43_NR_QOSPARAMS must be set  
to 16.
With the value equal to 16 I can access correctly the aifs, cwcur,  
cwmax, etc within the firmware.

What do you think about that?

regards.

Lorenzo.


From solca at guug.org  Wed Sep 10 08:40:44 2008
From: solca at guug.org (Otto Solares)
Date: Wed, 10 Sep 2008 00:40:44 -0600
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <20080908205459.GC24557@tuxdriver.com>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
	<200809070040.04300.mb@bu3sch.de> <20080908053155.GI4099@kroah.com>
	<48C55153.3070309@lwfinger.net>
	<20080908205459.GC24557@tuxdriver.com>
Message-ID: <20080910064044.GB8669@guug.org>

On Mon, Sep 08, 2008 at 04:54:59PM -0400, John W. Linville wrote:
> On Mon, Sep 08, 2008 at 11:22:43AM -0500, Larry Finger wrote:
> > Greg KH wrote:
> >>
> >> Bug fixes, not new features, it's pretty simple :)
> >
> > Just bug fixes, or does it have to be a regression?
> 
> As I understand it, the rule is more like "bug fixes that are committed
> in the linux-2.6 tree".  Since Linus has become more strict about
> requiring "regressions only" after the merge window, that effectively
> enforces the "regressions only" rule on the -stable trees as well.

In this case that rule is harming, is not idiotic to not accept bug
fixes early or later?

-otto


From mb at bu3sch.de  Wed Sep 10 14:58:56 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 10 Sep 2008 14:58:56 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <EEE47678-6181-439E-AAA8-0D024C85CC46@gmail.com>
References: <200809061621.48449.mb@bu3sch.de>
	<EEE47678-6181-439E-AAA8-0D024C85CC46@gmail.com>
Message-ID: <200809101458.56868.mb@bu3sch.de>

On Wednesday 10 September 2008 00:15:14 Lorenzo Nava wrote:
> Hi everybody,
> 
> I worked with the QoS parameters trying to understand why, checking  
> them within the firmware, they don't seems to have the correct values  
> even if they were set correctly by the driver.
> I think that there could be an error in the b43.h file:
> 
> /* SHM offsets to the QOS data structures for the 4 different queues. */
> #define B43_QOS_PARAMS(queue)   (B43_SHM_SH_EDCFQ + \
>                                   (B43_NR_QOSPARAMS * sizeof(u16) *  
> (queue)))
> #define B43_QOS_BACKGROUND      B43_QOS_PARAMS(0)
> #define B43_QOS_BESTEFFORT      B43_QOS_PARAMS(1)
> #define B43_QOS_VIDEO           B43_QOS_PARAMS(2)
> #define B43_QOS_VOICE           B43_QOS_PARAMS(3)
> 
> /* QOS parameter hardware data structure offsets. */
> #define B43_NR_QOSPARAMS        22
> 
> Each EDCF parameters set take up 32 byte (in the firmware the offset  
> between 2 EDCFQ is 0x010 that is equivalent to 0x020 if the offset was  
> expressed in byte). This means that the B43_NR_QOSPARAMS must be set  
> to 16.
> With the value equal to 16 I can access correctly the aifs, cwcur,  
> cwmax, etc within the firmware.
> 
> What do you think about that?

The specifications says there are 22 (decimal) entries.



-- 
Greetings Michael.


From linville at tuxdriver.com  Wed Sep 10 15:21:09 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Wed, 10 Sep 2008 09:21:09 -0400
Subject: [PATCH V2] b43legacy: Fix failure in rate-adjustment mechanism
In-Reply-To: <20080910064044.GB8669@guug.org>
References: <48c2fb5a.JqLELi8PJxjxmDaY%Larry.Finger@lwfinger.net>
	<200809070040.04300.mb@bu3sch.de> <20080908053155.GI4099@kroah.com>
	<48C55153.3070309@lwfinger.net>
	<20080908205459.GC24557@tuxdriver.com>
	<20080910064044.GB8669@guug.org>
Message-ID: <20080910132108.GA5216@tuxdriver.com>

On Wed, Sep 10, 2008 at 12:40:44AM -0600, Otto Solares wrote:
> On Mon, Sep 08, 2008 at 04:54:59PM -0400, John W. Linville wrote:
> > On Mon, Sep 08, 2008 at 11:22:43AM -0500, Larry Finger wrote:
> > > Greg KH wrote:
> > >>
> > >> Bug fixes, not new features, it's pretty simple :)
> > >
> > > Just bug fixes, or does it have to be a regression?
> > 
> > As I understand it, the rule is more like "bug fixes that are committed
> > in the linux-2.6 tree".  Since Linus has become more strict about
> > requiring "regressions only" after the merge window, that effectively
> > enforces the "regressions only" rule on the -stable trees as well.
> 
> In this case that rule is harming, is not idiotic to not accept bug
> fixes early or later?

I'm just the messenger...FWIW the argument is that even a "fix"
can introduce a new "bug" somewhere else, often quite unexpectedly.

John
-- 
John W. Linville
linville at tuxdriver.com


From francesco.gringoli at ing.unibs.it  Wed Sep 10 15:18:07 2008
From: francesco.gringoli at ing.unibs.it (Francesco Gringoli)
Date: Wed, 10 Sep 2008 15:18:07 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <200809101458.56868.mb@bu3sch.de>
References: <200809061621.48449.mb@bu3sch.de>
	<EEE47678-6181-439E-AAA8-0D024C85CC46@gmail.com>
	<200809101458.56868.mb@bu3sch.de>
Message-ID: <9B374125-A4B2-4888-96B4-0E118BD281F3@ing.unibs.it>

Hi Michael,

we are collecting every kind of material about Broadcom board, too.  
Could you please point out the document with such specifications?

I confirm what Lorenzo wrote: there are 32 bytes for queue. If you  
leave 22 then all the Qos mechanisms go wrong. Indeed, the bcm board  
takes (quite) exclusive control of the channel as gap is always set to  
zero.

Cheers,
-FG

On Sep 10, 2008, at 2:58 PM, Michael Buesch wrote:

> On Wednesday 10 September 2008 00:15:14 Lorenzo Nava wrote:
>> Hi everybody,
>>
>> I worked with the QoS parameters trying to understand why, checking
>> them within the firmware, they don't seems to have the correct values
>> even if they were set correctly by the driver.
>> I think that there could be an error in the b43.h file:
>>
>> /* SHM offsets to the QOS data structures for the 4 different  
>> queues. */
>> #define B43_QOS_PARAMS(queue)   (B43_SHM_SH_EDCFQ + \
>>                                  (B43_NR_QOSPARAMS * sizeof(u16) *
>> (queue)))
>> #define B43_QOS_BACKGROUND      B43_QOS_PARAMS(0)
>> #define B43_QOS_BESTEFFORT      B43_QOS_PARAMS(1)
>> #define B43_QOS_VIDEO           B43_QOS_PARAMS(2)
>> #define B43_QOS_VOICE           B43_QOS_PARAMS(3)
>>
>> /* QOS parameter hardware data structure offsets. */
>> #define B43_NR_QOSPARAMS        22
>>
>> Each EDCF parameters set take up 32 byte (in the firmware the offset
>> between 2 EDCFQ is 0x010 that is equivalent to 0x020 if the offset  
>> was
>> expressed in byte). This means that the B43_NR_QOSPARAMS must be set
>> to 16.
>> With the value equal to 16 I can access correctly the aifs, cwcur,
>> cwmax, etc within the firmware.
>>
>> What do you think about that?
>
> The specifications says there are 22 (decimal) entries.
>
>
>
> -- 
> Greetings Michael.
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev




From mb at bu3sch.de  Wed Sep 10 16:00:53 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 10 Sep 2008 16:00:53 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <9B374125-A4B2-4888-96B4-0E118BD281F3@ing.unibs.it>
References: <200809061621.48449.mb@bu3sch.de> <200809101458.56868.mb@bu3sch.de>
	<9B374125-A4B2-4888-96B4-0E118BD281F3@ing.unibs.it>
Message-ID: <200809101600.53777.mb@bu3sch.de>

On Wednesday 10 September 2008 15:18:07 Francesco Gringoli wrote:
> Hi Michael,
> 
> we are collecting every kind of material about Broadcom board, too.  
> Could you please point out the document with such specifications?

http://bcm-v4.sipsolutions.net/802.11/QoS

> I confirm what Lorenzo wrote: there are 32 bytes for queue. If you  
> leave 22 then all the Qos mechanisms go wrong. Indeed, the bcm board  
> takes (quite) exclusive control of the channel as gap is always set to  
> zero.

The code is correct wrt specs. It says there are 0x16 words.
First fix specs, then fix code, please.

-- 
Greetings Michael.


From tjaviss at gmail.com  Wed Sep 10 16:30:59 2008
From: tjaviss at gmail.com (Tyler Aviss)
Date: Wed, 10 Sep 2008 10:30:59 -0400
Subject: BCM4322 Info
Message-ID: <3a97ef0809100730i4bfde2e5yf60849f3dcf1fa0a@mail.gmail.com>

Hey All,


First of all, a quick introduction of myself. In general, I'm more of
a sysadmin than a kernel developer, though in the odd case I've
tracked down a few driver or FOSS-project bugs here and there (webcams
and gatekeeper proejcts, small bugs usually caused by simple
mistakes). So while I've never really delved heavily into writing
drivers, I can at least do a step-by-step testing in many cases.

I'm joining the list because:

a) I have a bunch of laptops with Broadcomm cards, which - thanks to
you developers - now happily work without me needing to use
NDISwrapper
b) I have a newer laptop with a Broadcomm card which seems to be
something of an enigma at the moment.

Now onward to (b), and what is currently one of the driving causes
behind my joining this list. I notice that on the "LinuxWireless"
page, the origins/status of the BCM4322 chipset seems to be somewhat
unknown. The current comment in the unsupported section is:

* BCM 4322 - We are working on support for this device (FIXME: what
the hell is a BCM4322? ?mb)

If you haven't sighted this card in the wild, I currently have one in
my newer HP laptop: A tx5254ca (Canadian TX2500 series, one of the
reversible-screen tablet jobs). These went up for sale in a bunch of
places at Future Shop and Best Buy, etc, so we may be seeing more
Linux users with this chipset in the future.

I'd be happy to lend and support I can in supplying info/dumps/etc and
testing the driver on this chipset as needed. Broadcomm actually has
their own Linux/closed-source driver that somewhat works for this
chipset (wl), but at the moment it's buggy as heck and tends to
regularly disconnect and reconnect. I'd love to see the B43 driver get
this chipset working, both so that I can have a working card and so
that users can use a "true" FOSS driver rather than a buggy
closed-source one.


Regards,


Tyler Aviss


From Larry.Finger at lwfinger.net  Wed Sep 10 18:42:52 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 10 Sep 2008 11:42:52 -0500
Subject: BCM4322 Info
In-Reply-To: <3a97ef0809100730i4bfde2e5yf60849f3dcf1fa0a@mail.gmail.com>
References: <3a97ef0809100730i4bfde2e5yf60849f3dcf1fa0a@mail.gmail.com>
Message-ID: <48C7F90C.4080006@lwfinger.net>

Tyler Aviss wrote:
> Hey All,
> 
> 
> First of all, a quick introduction of myself. In general, I'm more of
> a sysadmin than a kernel developer, though in the odd case I've
> tracked down a few driver or FOSS-project bugs here and there (webcams
> and gatekeeper proejcts, small bugs usually caused by simple
> mistakes). So while I've never really delved heavily into writing
> drivers, I can at least do a step-by-step testing in many cases.
> 
> I'm joining the list because:
> 
> a) I have a bunch of laptops with Broadcomm cards, which - thanks to
> you developers - now happily work without me needing to use
> NDISwrapper
> b) I have a newer laptop with a Broadcomm card which seems to be
> something of an enigma at the moment.
> 
> Now onward to (b), and what is currently one of the driving causes
> behind my joining this list. I notice that on the "LinuxWireless"
> page, the origins/status of the BCM4322 chipset seems to be somewhat
> unknown. The current comment in the unsupported section is:
> 
> * BCM 4322 - We are working on support for this device (FIXME: what
> the hell is a BCM4322? ?mb)
> 
> I'd be happy to lend and support I can in supplying info/dumps/etc and
> testing the driver on this chipset as needed. Broadcomm actually has
> their own Linux/closed-source driver that somewhat works for this
> chipset (wl), but at the moment it's buggy as heck and tends to
> regularly disconnect and reconnect. I'd love to see the B43 driver get
> this chipset working, both so that I can have a working card and so
> that users can use a "true" FOSS driver rather than a buggy
> closed-source one.

When you issue an 'lspci -nnv' for one of these devices, what is the 
PCI ID for the BCM4322?

I suspect that this is an 802.11n device. If so, the reverse 
engineering for this device is going slowly. We had one person working 
on decompiling a MIPS Broadcom driver, but he has been busy with other 
things lately. I have been busy with working on the LP PHY (an 802.11g 
variant) for a couple of reasons - it is a lot more like the other G 
PHYs, and I personally have one of the devices. Once the LP PHY is 
working, then I will start on the N PHY code.

Larry


From alexeisergeev at gmail.com  Wed Sep 10 19:27:31 2008
From: alexeisergeev at gmail.com (Alexei Sergeev)
Date: Wed, 10 Sep 2008 21:27:31 +0400
Subject: [update] Asus 138G v2
Message-ID: <200809102127.37380.alexeisergeev@gmail.com>

I sent another mail day ago, and while I was waiting and get no 
support on irc I tried different drivers and firmwares.

So far I tried bcm43xx and ndiswrapper (both gives me no success) 
and I revert to b43. But now wireless card can't either connect to 
network, it can see network but stop at "Configure device" state. 
(Before it was able to connect but was very slow)

So here is debug output again (now can't connect to AP, but see it):
uname -a
Linux server 2.6.24-19-generic #1 SMP Fri Jul 11 21:01:46 UTC 2008 
x86_64 GNU/Linux

lspci -vvn|grep 43 -A7:
05:00.0 0280: 14e4:4318 (rev 02)
        Subsystem: 1043:100f
        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- 
ParErr- Stepping- SERR- FastB2B-
        Status: Cap- 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- 
<TAbort- <MAbort- >SERR- <PERR-
        Latency: 32
        Interrupt: pin A routed to IRQ 20
        Region 0: Memory at e8100000 (32-bit, non-prefetchable) 
[size=8K]

05:01.0 0480: 1131:7133 (rev d1)

dmesg 
[    0.000000] Initializing cgroup subsys cpuset
[    0.000000] Initializing cgroup subsys cpu   
[    0.000000] Linux version 2.6.24-19-generic (buildd at king) (gcc 
version 4.2.3 (Ubuntu 4.2.3-2ubuntu7)) #1 SMP Fri Jul 11 21:01:46 UTC 
2008 (Ubuntu 2.6.24-19.36-generic)                                        
[    0.000000] Command line: root=UUID=05c8eb05-27d3-48a0-
be4f-75b22f6ece9b ro quiet splash              
[    0.000000] BIOS-provided physical RAM map:                                                           
[    0.000000]  BIOS-e820: 0000000000000000 - 000000000009e800 
(usable)                                  
[    0.000000]  BIOS-e820: 000000000009f800 - 00000000000a0000 
(reserved)                                
[    0.000000]  BIOS-e820: 00000000000f0000 - 0000000000100000 
(reserved)                                
[    0.000000]  BIOS-e820: 0000000000100000 - 000000007fee0000 
(usable)                                  
[    0.000000]  BIOS-e820: 000000007fee0000 - 000000007fee3000 
(ACPI NVS)                                
[    0.000000]  BIOS-e820: 000000007fee3000 - 000000007fef0000 
(ACPI data)                               
[    0.000000]  BIOS-e820: 000000007fef0000 - 000000007ff00000 
(reserved)                                
[    0.000000]  BIOS-e820: 00000000e0000000 - 00000000e4000000 
(reserved)                                
[    0.000000]  BIOS-e820: 00000000fec00000 - 0000000100000000 
(reserved)                                
[    0.000000] Entering add_active_range(0, 0, 158) 0 entries of 3200 
used                               
[    0.000000] Entering add_active_range(0, 256, 524000) 1 entries of 
3200 used                          
[    0.000000] end_pfn_map = 1048576                                                                     
[    0.000000] DMI 2.4 present.                                                                          
[    0.000000] ACPI: RSDP signature @ 0xFFFF8100000F6F00 
checksum 0                                      
[    0.000000] ACPI: RSDP 000F6F00, 0014 (r0 GBT   )                                                     
[    0.000000] ACPI: RSDT 7FEE3040, 0038 (r1 GBT    GBTUACPI 
42302E31 GBTU  1010101)                     
[    0.000000] ACPI: FACP 7FEE30C0, 0074 (r1 GBT    GBTUACPI 
42302E31 GBTU  1010101)                     
[    0.000000] ACPI: DSDT 7FEE3180, 4B82 (r1 GBT    GBTUACPI     1000 
MSFT  100000C)                     
[    0.000000] ACPI: FACS 7FEE0000, 0040                                                                 
[    0.000000] ACPI: HPET 7FEE7E80, 0038 (r1 GBT    GBTUACPI 
42302E31 GBTU       98)                     
[    0.000000] ACPI: MCFG 7FEE7F00, 003C (r1 GBT    GBTUACPI 
42302E31 GBTU  1010101)                     
[    0.000000] ACPI: APIC 7FEE7D80, 0084 (r1 GBT    GBTUACPI 
42302E31 GBTU  1010101)                     
[    0.000000] ACPI: SSDT 7FEE8860, 03AB (r1  PmRef    CpuPm     3000 
INTL 20040311)                     
[    0.000000] No NUMA configuration found                                                               
[    0.000000] Faking a node at 
0000000000000000-000000007fee0000                                        
[    0.000000] Entering add_active_range(0, 0, 158) 0 entries of 3200 
used                               
[    0.000000] Entering add_active_range(0, 256, 524000) 1 entries of 
3200 used                          
[    0.000000] Bootmem setup node 0 
0000000000000000-000000007fee0000                                    
[    0.000000] Zone PFN ranges:                                                                          
[    0.000000]   DMA             0 ->     4096                                                           
[    0.000000]   DMA32        4096 ->  1048576                                                           
[    0.000000]   Normal    1048576 ->  1048576                                                           
[    0.000000] Movable zone start PFN for each node                                                      
[    0.000000] early_node_map[2] active PFN ranges                                                       
[    0.000000]     0:        0 ->      158                                                               
[    0.000000]     0:      256 ->   524000                                                               
[    0.000000] On node 0 totalpages: 523902                                                              
[    0.000000]   DMA zone: 56 pages used for memmap                                                      
[    0.000000]   DMA zone: 1221 pages reserved                                                           
[    0.000000]   DMA zone: 2721 pages, LIFO batch:0                                                      
[    0.000000]   DMA32 zone: 7108 pages used for memmap                                                  
[    0.000000]   DMA32 zone: 512796 pages, LIFO batch:31                                                 
[    0.000000]   Normal zone: 0 pages used for memmap                                                    
[    0.000000]   Movable zone: 0 pages used for memmap                                                   
[    0.000000] ACPI: PM-Timer IO Port: 0x408                                                             
[    0.000000] ACPI: Local APIC address 0xfee00000                                                       
[    0.000000] ACPI: LAPIC (acpi_id[0x00] lapic_id[0x00] enabled)                                        
[    0.000000] Processor #0 (Bootup-CPU)                                                                 
[    0.000000] ACPI: LAPIC (acpi_id[0x01] lapic_id[0x03] enabled)                                        
[    0.000000] Processor #3                                                                              
[    0.000000] ACPI: LAPIC (acpi_id[0x02] lapic_id[0x02] enabled)                                        
[    0.000000] Processor #2                                                                              
[    0.000000] ACPI: LAPIC (acpi_id[0x03] lapic_id[0x01] enabled)                                        
[    0.000000] Processor #1                                                                              
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x00] dfl dfl lint[0x1])                                         
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x01] dfl dfl lint[0x1])                                         
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x02] dfl dfl lint[0x1])                                         
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x03] dfl dfl lint[0x1])                                         
[    0.000000] ACPI: IOAPIC (id[0x02] address[0xfec00000] 
gsi_base[0])                                   
[    0.000000] IOAPIC[0]: apic_id 2, address 0xfec00000, GSI 0-23                                        
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)                                  
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high 
level)                               
[    0.000000] ACPI: IRQ0 used by override.                                                              
[    0.000000] ACPI: IRQ2 used by override.                                                              
[    0.000000] ACPI: IRQ9 used by override.                                                              
[    0.000000] Setting APIC routing to flat                                                              
[    0.000000] ACPI: HPET id: 0x8086a201 base: 0xfed00000                                                
[    0.000000] Using ACPI (MADT) for SMP configuration information                                       
[    0.000000] swsusp: Registered nosave memory region: 
000000000009e000 - 00000000000a0000              
[    0.000000] swsusp: Registered nosave memory region: 
00000000000a0000 - 00000000000f0000              
[    0.000000] swsusp: Registered nosave memory region: 
00000000000f0000 - 0000000000100000              
[    0.000000] Allocating PCI resources starting at 80000000 (gap: 
7ff00000:60100000)                    
[    0.000000] SMP: Allowing 4 CPUs, 0 hotplug CPUs                                                      
[    0.000000] PERCPU: Allocating 34656 bytes of per cpu data                                            
[    0.000000] Built 1 zonelists in Node order, mobility grouping on.  
Total pages: 515517               
[    0.000000] Policy zone: DMA32                                                                        
[    0.000000] Kernel command line: root=UUID=05c8eb05-27d3-48a0-
be4f-75b22f6ece9b ro quiet splash       
[    0.000000] Initializing CPU#0                                                                        
[    0.000000] PID hash table entries: 4096 (order: 12, 32768 bytes)                                     
[    0.000000] hpet clockevent registered                                                                
[    0.000000] TSC calibrated against HPET                                                               
[   37.682298] Marking TSC unstable due to TSCs unsynchronized                                           
[   37.682300] time.c: Detected 2400.083 MHz processor.                                                  
[   37.683002] Console: colour VGA+ 80x25                                                                
[   37.683005] console [tty0] enabled                                                                    
[   37.683020] Checking aperture...                                                                      
[   37.683027] Calgary: detecting Calgary via BIOS EBDA area                                             
[   37.683028] Calgary: Unable to locate Rio Grande table in EBDA - 
bailing!                             
[   37.702129] Memory: 2053812k/2096000k available (2489k kernel 
code, 41796k reserved, 1318k data, 320k init)                                                                                                    
[   37.702162] SLUB: Genslabs=12, HWalign=64, Order=0-1, 
MinObjects=4, CPUs=4, Nodes=1                   
[   37.780138] Calibrating delay using timer specific routine.. 4803.53 
BogoMIPS (lpj=9607078)           
[   37.780166] Security Framework initialized                                                            
[   37.780172] SELinux:  Disabled at boot.                                                               
[   37.780182] AppArmor: AppArmor initialized                                                            
[   37.780185] Failure registering capabilities with primary security 
module.                            
[   37.780340] Dentry cache hash table entries: 262144 (order: 9, 
2097152 bytes)                         
[   37.781442] Inode-cache hash table entries: 131072 (order: 8, 
1048576 bytes)                          
[   37.782031] Mount-cache hash table entries: 256                                                       
[   37.782146] Initializing cgroup subsys ns                                                             
[   37.782151] Initializing cgroup subsys cpuacct                                                        
[   37.782164] CPU: L1 I cache: 32K, L1 D cache: 32K                                                     
[   37.782165] CPU: L2 cache: 4096K                                                                      
[   37.782167] CPU 0/0 -> Node 0                                                                         
[   37.782168] using mwait in idle threads.                                                              
[   37.782170] CPU: Physical Processor ID: 0                                                             
[   37.782170] CPU: Processor Core ID: 0                                                                 
[   37.782176] CPU0: Thermal monitoring enabled (TM2)                                                    
[   37.782187] SMP alternatives: switching to UP code                                                    
[   37.782883] Early unpacking initramfs... done                                                         
[   38.083111] ACPI: Core revision 20070126                                                              
[   38.083145] ACPI: Looking for DSDT in initramfs... error, file 
/DSDT.aml not found.                   
[   38.163745] Using local APIC timer interrupts.                                                        
[   38.205351] APIC timer calibration result 16667228                                                    
[   38.205352] Detected 16.667 MHz APIC timer.                                                           
[   38.205420] SMP alternatives: switching to SMP code                                                   
[   38.206026] Booting processor 1/4 APIC 0x3                                                            
[   38.216365] Initializing CPU#1                                                                        
[   38.293220] Calibrating delay using timer specific routine.. 4800.20 
BogoMIPS (lpj=9600404)           
[   38.293226] CPU: L1 I cache: 32K, L1 D cache: 32K                                                     
[   38.293227] CPU: L2 cache: 4096K                                                                      
[   38.293229] CPU 1/3 -> Node 0                                                                         
[   38.293230] CPU: Physical Processor ID: 0                                                             
[   38.293231] CPU: Processor Core ID: 3                                                                 
[   38.293236] CPU1: Thermal monitoring enabled (TM2)                                                    
[   38.293664] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz 
stepping 0b                               
[   38.293762] SMP alternatives: switching to SMP code                                                   
[   38.294142] Booting processor 2/4 APIC 0x2                                                            
[   38.304481] Initializing CPU#2                                                                        
[   38.381085] Calibrating delay using timer specific routine.. 4800.20 
BogoMIPS (lpj=9600417)           
[   38.381090] CPU: L1 I cache: 32K, L1 D cache: 32K                                                     
[   38.381091] CPU: L2 cache: 4096K                                                                      
[   38.381093] CPU 2/2 -> Node 0                                                                         
[   38.381094] CPU: Physical Processor ID: 0                                                             
[   38.381095] CPU: Processor Core ID: 2                                                                 
[   38.381100] CPU2: Thermal monitoring enabled (TM2)                                                    
[   38.381528] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz 
stepping 0b                               
[   38.381676] SMP alternatives: switching to SMP code                                                   
[   38.382057] Booting processor 3/4 APIC 0x1                                                            
[   38.392395] Initializing CPU#3                                                                        
[   38.468949] Calibrating delay using timer specific routine.. 4800.15 
BogoMIPS (lpj=9600310)           
[   38.468954] CPU: L1 I cache: 32K, L1 D cache: 32K                                                     
[   38.468956] CPU: L2 cache: 4096K                                                                      
[   38.468957] CPU 3/1 -> Node 0                                                                         
[   38.468958] CPU: Physical Processor ID: 0                                                             
[   38.468959] CPU: Processor Core ID: 1                                                                 
[   38.468964] CPU3: Thermal monitoring enabled (TM2)                                                    
[   38.469395] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz 
stepping 0b                               
[   38.469452] Brought up 4 CPUs                                                                         
[   38.469532] CPU0 attaching sched-domain:                                                              
[   38.469534]  domain 0: span 09                                                                        
[   38.469535]   groups: 01 08                                                                           
[   38.469537]   domain 1: span 0f                                                                       
[   38.469538]    groups: 09 06                                                                          
[   38.469540]    domain 2: span 0f                                                                      
[   38.469541]     groups: 0f                                                                            
[   38.469543] CPU1 attaching sched-domain:                                                              
[   38.469544]  domain 0: span 06                                                                        
[   38.469545]   groups: 02 04                                                                           
[   38.469546]   domain 1: span 0f                                                                       
[   38.469547]    groups: 06 09                                                                          
[   38.469549]    domain 2: span 0f                                                                      
[   38.469550]     groups: 0f                                                                            
[   38.469551] CPU2 attaching sched-domain:                                                              
[   38.469552]  domain 0: span 06                                                                        
[   38.469553]   groups: 04 02                                                                           
[   38.469555]   domain 1: span 0f                                                                       
[   38.469556]    groups: 06 09                                                                          
[   38.469558]    domain 2: span 0f                                                                      
[   38.469559]     groups: 0f                                                                            
[   38.469560] CPU3 attaching sched-domain:                                                              
[   38.469561]  domain 0: span 09                                                                        
[   38.469562]   groups: 08 01                                                                           
[   38.469563]   domain 1: span 0f                                                                       
[   38.469564]    groups: 09 06                                                                          
[   38.469566]    domain 2: span 0f                                                                      
[   38.469567]     groups: 0f                                                                            
[   38.469850] net_namespace: 120 bytes                                                                  
[   38.470139] Time: 18:00:02  Date: 09/10/08                                                            
[   38.470161] NET: Registered protocol family 16                                                        
[   38.470306] ACPI: bus type pci registered                                                             
[   38.470363] PCI: Using configuration type 1                                                           
[   38.471427] ACPI: EC: Look up EC in DSDT                                                              
[   38.475072] ACPI: Interpreter enabled                                                                 
[   38.475077] ACPI: (supports S0 S3 S4 S5)                                                              
[   38.475089] ACPI: Using IOAPIC for interrupt routing                                                  
[   38.479109] ACPI: PCI Root Bridge [PCI0] (0000:00)                                                    
[   38.480399] PCI: Transparent bridge - 0000:00:1e.0                                                    
[   38.480425] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]                                       
[   38.480556] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX0._PRT]                                  
[   38.480618] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX4._PRT]                                  
[   38.480678] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX5._PRT]                                  
[   38.480734] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.HUB0._PRT]                                  
[   38.492475] ACPI: PCI Interrupt Link [LNKA] (IRQs 3 4 5 6 7 9 10 11 
12 14 *15)                        
[   38.492550] ACPI: PCI Interrupt Link [LNKB] (IRQs 3 4 5 6 7 9 *10 11 
12 14 15)                        
[   38.492624] ACPI: PCI Interrupt Link [LNKC] (IRQs 3 4 5 6 7 *9 10 11 
12 14 15)                        
[   38.492698] ACPI: PCI Interrupt Link [LNKD] (IRQs 3 4 5 6 7 9 10 *11 
12 14 15)                        
[   38.492772] ACPI: PCI Interrupt Link [LNKE] (IRQs 3 4 5 6 7 9 10 11 
12 *14 15)                        
[   38.492846] ACPI: PCI Interrupt Link [LNKF] (IRQs 3 4 5 6 7 9 10 11 
12 14 *15)                        
[   38.492922] ACPI: PCI Interrupt Link [LNK0] (IRQs 3 4 *5 6 7 9 10 11 
12 14 15)                        
[   38.492999] ACPI: PCI Interrupt Link [LNK1] (IRQs *3 4 5 6 7 9 10 11 
12 14 15)                        
[   38.493090] Linux Plug and Play Support v0.97 (c) Adam Belay                                          
[   38.493111] pnp: PnP ACPI init                                                                        
[   38.493117] ACPI: bus type pnp registered                                                             
[   38.495100] pnpacpi: exceeded the max number of mem resources: 
12                                     
[   38.495203] pnp: PnP ACPI: found 15 devices                                                           
[   38.495204] ACPI: ACPI bus type pnp unregistered                                                      
[   38.495380] PCI: Using ACPI for IRQ routing                                                           
[   38.495381] PCI: If a device doesn't work, try "pci=routeirq".  If it 
helps, post a report            
[   38.505005] NET: Registered protocol family 8                                                         
[   38.505007] NET: Registered protocol family 20                                                        
[   38.505042] PCI-GART: No AMD northbridge found.                                                       
[   38.505047] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0, 0                                                
[   38.505051] hpet0: 4 64-bit timers, 14318180 Hz                                                       
[   38.506097] AppArmor: AppArmor Filesystem Enabled                                                     
[   38.510467] Time: hpet clocksource has been installed.                                                
[   38.510483] Switched to high resolution mode on CPU 0                                                 
[   38.513410] Switched to high resolution mode on CPU 3                                                 
[   38.514073] Switched to high resolution mode on CPU 2                                                 
[   38.514091] Switched to high resolution mode on CPU 1                                                 
[   38.518528] system 00:01: ioport range 0x4d0-0x4d1 has been 
reserved                                  
[   38.518532] system 00:01: ioport range 0x290-0x29f has been 
reserved                                  
[   38.518536] system 00:01: ioport range 0x800-0x87f has been 
reserved                                  
[   38.518539] system 00:01: ioport range 0x290-0x294 has been 
reserved                                  
[   38.518542] system 00:01: ioport range 0x880-0x88f has been 
reserved                                  
[   38.518556] system 00:0b: ioport range 0x400-0x4bf has been 
reserved                                  
[   38.518564] system 00:0c: iomem range 0xe0000000-0xe3ffffff 
could not be reserved                     
[   38.518571] system 00:0d: iomem range 0xd2000-0xd3fff has been 
reserved                               
[   38.518575] system 00:0d: iomem range 0xf0000-0xf7fff could not 
be reserved                           
[   38.518578] system 00:0d: iomem range 0xf8000-0xfbfff could not 
be reserved                           
[   38.518581] system 00:0d: iomem range 0xfc000-0xfffff could not be 
reserved                           
[   38.518584] system 00:0d: iomem range 0x7fee0000-0x7fefffff could 
not be reserved                     
[   38.518593] system 00:0d: iomem range 0x0-0x9ffff could not be 
reserved                               
[   38.518595] system 00:0d: iomem range 0x100000-0x7fedffff could 
not be reserved                       
[   38.518598] system 00:0d: iomem range 0xfec00000-0xfec00fff has 
been reserved                         
[   38.518600] system 00:0d: iomem range 0xfed10000-0xfed1dfff has 
been reserved                         
[   38.518602] system 00:0d: iomem range 0xfed20000-0xfed8ffff has 
been reserved                         
[   38.518605] system 00:0d: iomem range 0xfee00000-0xfee00fff 
could not be reserved                     
[   38.518607] system 00:0d: iomem range 0xffb00000-0xffb7ffff has 
been reserved                         
[   38.518956] PCI: Bridge: 0000:00:01.0                                                                 
[   38.518958]   IO window: b000-bfff                                                                    
[   38.518960]   MEM window: e4000000-e5ffffff                                                           
[   38.518962]   PREFETCH window: d0000000-dfffffff                                                      
[   38.518965] PCI: Bridge: 0000:00:1c.0                                                                 
[   38.518966]   IO window: disabled.                                                                    
[   38.518969]   MEM window: disabled.                                                                   
[   38.518971]   PREFETCH window: disabled.                                                              
[   38.518974] PCI: Bridge: 0000:00:1c.4                                                                 
[   38.518976]   IO window: c000-cfff                                                                    
[   38.518979]   MEM window: e6000000-e6ffffff                                                           
[   38.518982]   PREFETCH window: disabled.                                                              
[   38.518986] PCI: Bridge: 0000:00:1c.5                                                                 
[   38.518987]   IO window: d000-dfff                                                                    
[   38.518990]   MEM window: e7000000-e7ffffff                                                           
[   38.518993]   PREFETCH window: e8000000-e80fffff                                                      
[   38.518997] PCI: Bridge: 0000:00:1e.0                                                                 
[   38.518998]   IO window: disabled.                                                                    
[   38.519001]   MEM window: e8100000-e81fffff                                                           
[   38.519004]   PREFETCH window: disabled.                                                              
[   38.519017] ACPI: PCI Interrupt 0000:00:01.0[A] -> GSI 16 (level, 
low) -> IRQ 16                      
[   38.519021] PCI: Setting latency timer of device 0000:00:01.0 to 64                                   
[   38.519037] ACPI: PCI Interrupt 0000:00:1c.0[A] -> GSI 16 (level, 
low) -> IRQ 16                      
[   38.519041] PCI: Setting latency timer of device 0000:00:1c.0 to 64                                   
[   38.519054] ACPI: PCI Interrupt 0000:00:1c.4[A] -> GSI 16 (level, 
low) -> IRQ 16                      
[   38.519058] PCI: Setting latency timer of device 0000:00:1c.4 to 64                                   
[   38.519071] ACPI: PCI Interrupt 0000:00:1c.5[B] -> GSI 17 (level, 
low) -> IRQ 17                      
[   38.519075] PCI: Setting latency timer of device 0000:00:1c.5 to 64                                   
[   38.519082] PCI: Setting latency timer of device 0000:00:1e.0 to 64                                   
[   38.519093] NET: Registered protocol family 2                                                         
[   38.554479] IP route cache hash table entries: 65536 (order: 7, 
524288 bytes)                         
[   38.554971] TCP established hash table entries: 262144 (order: 10, 
4194304 bytes)                     
[   38.556278] TCP bind hash table entries: 65536 (order: 8, 1048576 
bytes)                              
[   38.556775] TCP: Hash tables configured (established 262144 bind 
65536)                               
[   38.556777] TCP reno registered                                                                       
[   38.566523] checking if image is initramfs... it is                                                   
[   39.157035] Freeing initrd memory: 7983k freed                                                        
[   39.161240] audit: initializing netlink socket (disabled)                                             
[   39.161258] audit(1221069602.412:1): initialized                                                      
[   39.162821] VFS: Disk quotas dquot_6.5.1                                                              
[   39.162869] Dquot-cache hash table entries: 512 (order 0, 4096 
bytes)                                 
[   39.162960] io scheduler noop registered                                                              
[   39.162961] io scheduler anticipatory registered                                                      
[   39.162962] io scheduler deadline registered                                                          
[   39.163040] io scheduler cfq registered (default)                                                     
[   39.166298] Boot video device is 0000:01:00.0                                                         
[   39.166434] PCI: Setting latency timer of device 0000:00:01.0 to 64                                   
[   39.166458] assign_interrupt_mode Found MSI capability                                                
[   39.166479] Allocate Port Service[0000:00:01.0:pcie00]                                                
[   39.166547] PCI: Setting latency timer of device 0000:00:1c.0 to 64                                   
[   39.166578] assign_interrupt_mode Found MSI capability                                                
[   39.166603] Allocate Port Service[0000:00:1c.0:pcie00]                                                
[   39.166624] Allocate Port Service[0000:00:1c.0:pcie02]                                                
[   39.166686] PCI: Setting latency timer of device 0000:00:1c.4 to 64                                   
[   39.166717] assign_interrupt_mode Found MSI capability                                                
[   39.166741] Allocate Port Service[0000:00:1c.4:pcie00]                                                
[   39.166766] Allocate Port Service[0000:00:1c.4:pcie02]                                                
[   39.166826] PCI: Setting latency timer of device 0000:00:1c.5 to 64                                   
[   39.166857] assign_interrupt_mode Found MSI capability                                                
[   39.166881] Allocate Port Service[0000:00:1c.5:pcie00]                                                
[   39.166904] Allocate Port Service[0000:00:1c.5:pcie02]                                                
[   39.184378] Real Time Clock Driver v1.12ac                                                            
[   39.184507] hpet_resources: 0xfed00000 is busy                                                        
[   39.184551] Linux agpgart interface v0.102                                                            
[   39.184553] Serial: 8250/16550 driver $Revision: 1.90 $ 4 ports, IRQ 
sharing enabled                  
[   39.184658] serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A                                      
[   39.185058] 00:08: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A                                           
[   39.185598] RAMDISK driver initialized: 16 RAM disks of 65536K size 
1024 blocksize                    
[   39.185644] input: Macintosh mouse button emulation as 
/devices/virtual/input/input0                  
[   39.185708] PNP: PS/2 Controller [PNP0303:PS2K] at 0x60,0x64 irq 1                                    
[   39.185710] PNP: PS/2 appears to have AUX port disabled, if this is 
incorrect please boot with i8042.nopnp                                                                                                     
[   39.185778] serio: i8042 KBD port at 0x60,0x64 irq 1                                                  
[   39.198947] mice: PS/2 mouse device common for all mice                                               
[   39.198984] cpuidle: using governor ladder                                                            
[   39.198986] cpuidle: using governor menu                                                              
[   39.199098] NET: Registered protocol family 1                                                         
[   39.199173] registered taskstats version 1                                                            
[   39.199264]   Magic number: 8:639:38                                                                  
[   39.199311]   hash matches device 00:0a                                                               
[   39.199322] /build/buildd/linux-2.6.24/drivers/rtc/hctosys.c: unable 
to open rtc device (rtc0)        
[   39.199324] BIOS EDD facility v0.16 2004-Jun-25, 0 devices found                                      
[   39.199326] EDD information not available.                                                            
[   39.199332] Freeing unused kernel memory: 320k freed                                                  
[   39.233574] input: AT Translated Set 2 keyboard as 
/devices/platform/i8042/serio0/input/input1        
[   40.343760] fuse init (API version 7.9)                                                               
[   40.357026] ACPI: SSDT 7FEE7F80, 022A (r1  PmRef  Cpu0Ist     3000 
INTL 20040311)                     
[   40.357212] ACPI: CPU0 (power states: C1[C1] C2[C2])                                                  
[   40.357215] ACPI: Processor [CPU0] (supports 8 throttling states)                                     
[   40.357326] ACPI: SSDT 7FEE8440, 0152 (r1  PmRef  Cpu1Ist     3000 
INTL 20040311)                     
[   40.357543] ACPI: CPU1 (power states: C1[C1] C2[C2])                                                  
[   40.357549] ACPI: Processor [CPU1] (supports 8 throttling states)                                     
[   40.357697] ACPI: SSDT 7FEE85A0, 0152 (r1  PmRef  Cpu2Ist     3000 
INTL 20040311)                     
[   40.357899] ACPI: CPU2 (power states: C1[C1] C2[C2])                                                  
[   40.357903] ACPI: Processor [CPU2] (supports 8 throttling states)                                     
[   40.358006] ACPI: SSDT 7FEE8700, 0152 (r1  PmRef  Cpu3Ist     3000 
INTL 20040311)                     
[   40.358183] ACPI: CPU3 (power states: C1[C1] C2[C2])                                                  
[   40.358187] ACPI: Processor [CPU3] (supports 8 throttling states)                                     
[   40.446890] usbcore: registered new interface driver usbfs                                            
[   40.446918] usbcore: registered new interface driver hub                                              
[   40.447172] usbcore: registered new device driver usb                                                 
[   40.447849] USB Universal Host Controller Interface driver v3.0                                       
[   40.447904] ACPI: PCI Interrupt 0000:00:1a.0[A] -> GSI 16 (level, 
low) -> IRQ 16                      
[   40.447915] PCI: Setting latency timer of device 0000:00:1a.0 to 64                                   
[   40.447918] uhci_hcd 0000:00:1a.0: UHCI Host Controller                                               
[   40.448150] uhci_hcd 0000:00:1a.0: new USB bus registered, 
assigned bus number 1                      
[   40.448177] uhci_hcd 0000:00:1a.0: irq 16, io base 0x0000e100                                         
[   40.448271] usb usb1: configuration #1 chosen from 1 choice                                           
[   40.448287] hub 1-0:1.0: USB hub found                                                                
[   40.448290] hub 1-0:1.0: 2 ports detected                                                             
[   40.510624] SCSI subsystem initialized                                                                
[   40.515051] libata version 3.00 loaded.                                                               
[   40.551313] ACPI: PCI Interrupt 0000:00:1a.1[B] -> GSI 21 (level, 
low) -> IRQ 21                      
[   40.551326] PCI: Setting latency timer of device 0000:00:1a.1 to 64                                   
[   40.551329] uhci_hcd 0000:00:1a.1: UHCI Host Controller                                               
[   40.551375] uhci_hcd 0000:00:1a.1: new USB bus registered, 
assigned bus number 2                      
[   40.551404] uhci_hcd 0000:00:1a.1: irq 21, io base 0x0000e200                                         
[   40.551410] Floppy drive(s): fd0 is 1.44M                                                             
[   40.551486] usb usb2: configuration #1 chosen from 1 choice                                           
[   40.551509] hub 2-0:1.0: USB hub found                                                                
[   40.551513] hub 2-0:1.0: 2 ports detected                                                             
[   40.568378] FDC 0 is a post-1991 82077                                                                
[   40.651167] ACPI: PCI Interrupt 0000:00:1a.2[C] -> GSI 18 (level, 
low) -> IRQ 18                      
[   40.651176] PCI: Setting latency timer of device 0000:00:1a.2 to 64                                   
[   40.651178] uhci_hcd 0000:00:1a.2: UHCI Host Controller                                               
[   40.651195] uhci_hcd 0000:00:1a.2: new USB bus registered, 
assigned bus number 3                      
[   40.651218] uhci_hcd 0000:00:1a.2: irq 18, io base 0x0000e000                                         
[   40.651289] usb usb3: configuration #1 chosen from 1 choice                                           
[   40.651305] hub 3-0:1.0: USB hub found                                                                
[   40.651308] hub 3-0:1.0: 2 ports detected                                                             
[   40.755006] ACPI: PCI Interrupt 0000:00:1d.0[A] -> GSI 23 (level, 
low) -> IRQ 23                      
[   40.755015] PCI: Setting latency timer of device 0000:00:1d.0 to 64                                   
[   40.755018] uhci_hcd 0000:00:1d.0: UHCI Host Controller                                               
[   40.755035] uhci_hcd 0000:00:1d.0: new USB bus registered, 
assigned bus number 4                      
[   40.755058] uhci_hcd 0000:00:1d.0: irq 23, io base 0x0000e300                                         
[   40.755127] usb usb4: configuration #1 chosen from 1 choice                                           
[   40.755141] hub 4-0:1.0: USB hub found                                                                
[   40.755145] hub 4-0:1.0: 2 ports detected                                                             
[   40.786865] usb 1-1: new low speed USB device using uhci_hcd and 
address 2                            
[   40.858819] ACPI: PCI Interrupt 0000:00:1d.1[B] -> GSI 19 (level, 
low) -> IRQ 19                      
[   40.858827] PCI: Setting latency timer of device 0000:00:1d.1 to 64                                   
[   40.858831] uhci_hcd 0000:00:1d.1: UHCI Host Controller                                               
[   40.858852] uhci_hcd 0000:00:1d.1: new USB bus registered, 
assigned bus number 5                      
[   40.858877] uhci_hcd 0000:00:1d.1: irq 19, io base 0x0000e400                                         
[   40.858964] usb usb5: configuration #1 chosen from 1 choice                                           
[   40.858979] hub 5-0:1.0: USB hub found                                                                
[   40.858982] hub 5-0:1.0: 2 ports detected                                                             
[   40.962653] ACPI: PCI Interrupt 0000:00:1d.2[C] -> GSI 18 (level, 
low) -> IRQ 18                      
[   40.962660] PCI: Setting latency timer of device 0000:00:1d.2 to 64                                   
[   40.962663] uhci_hcd 0000:00:1d.2: UHCI Host Controller                                               
[   40.962684] uhci_hcd 0000:00:1d.2: new USB bus registered, 
assigned bus number 6                      
[   40.962706] uhci_hcd 0000:00:1d.2: irq 18, io base 0x0000e500                                         
[   40.962792] usb usb6: configuration #1 chosen from 1 choice                                           
[   40.962814] hub 6-0:1.0: USB hub found                                                                
[   40.962818] hub 6-0:1.0: 2 ports detected                                                             
[   40.963510] usb 1-1: configuration #1 chosen from 1 choice                                            
[   41.066518] ACPI: PCI Interrupt 0000:00:1a.7[C] -> GSI 18 (level, 
low) -> IRQ 18                      
[   41.067549] PCI: Setting latency timer of device 0000:00:1a.7 to 64                                   
[   41.067556] ehci_hcd 0000:00:1a.7: EHCI Host Controller                                               
[   41.067609] ehci_hcd 0000:00:1a.7: new USB bus registered, 
assigned bus number 7                      
[   41.071529] PCI: cache line size of 32 is not supported by device 
0000:00:1a.7                        
[   41.071536] ehci_hcd 0000:00:1a.7: irq 18, io mem 0xe8205000                                          
[   41.087690] ehci_hcd 0000:00:1a.7: USB 2.0 started, EHCI 1.00, 
driver 10 Dec 2004                     
[   41.087783] usb usb7: configuration #1 chosen from 1 choice                                           
[   41.087800] hub 7-0:1.0: USB hub found                                                                
[   41.087805] hub 7-0:1.0: 6 ports detected                                                             
[   41.191410] ACPI: PCI Interrupt 0000:00:1d.7[A] -> GSI 23 (level, 
low) -> IRQ 23                      
[   41.191414] ACPI: PCI Interrupt 0000:05:00.0[A] -> GSI 20 (level, 
low) -> IRQ 20                      
[   41.192217] PCI: Setting latency timer of device 0000:00:1d.7 to 64                                   
[   41.192222] ehci_hcd 0000:00:1d.7: EHCI Host Controller                                               
[   41.192272] ehci_hcd 0000:00:1d.7: new USB bus registered, 
assigned bus number 8                      
[   41.196187] PCI: cache line size of 32 is not supported by device 
0000:00:1d.7                        
[   41.196192] ehci_hcd 0000:00:1d.7: irq 23, io mem 0xe8204000                                          
[   41.210196] ehci_hcd 0000:00:1d.7: USB 2.0 started, EHCI 1.00, 
driver 10 Dec 2004                     
[   41.210837] usb usb8: configuration #1 chosen from 1 choice                                           
[   41.210862] hub 8-0:1.0: USB hub found                                                                
[   41.210869] hub 8-0:1.0: 6 ports detected                                                             
[   41.211102] ssb: Core 0 found: ChipCommon (cc 0x800, rev 0x0D, 
vendor 0x4243)                         
[   41.211110] ssb: Core 1 found: IEEE 802.11 (cc 0x812, rev 0x09, 
vendor 0x4243)                        
[   41.211115] ssb: Core 2 found: PCI (cc 0x804, rev 0x0C, vendor 
0x4243)                                
[   41.211119] ssb: Core 3 found: PCMCIA (cc 0x80D, rev 0x07, vendor 
0x4243)                             
[   41.250183] ssb: Sonics Silicon Backplane found on PCI device 
0000:05:00.0                            
[   41.314118] r8169 Gigabit Ethernet driver 2.2LK loaded                                                
[   41.314146] ACPI: PCI Interrupt 0000:04:00.0[A] -> GSI 17 (level, 
low) -> IRQ 17                      
[   41.314166] PCI: Setting latency timer of device 0000:04:00.0 to 64                                   
[   41.314398] eth0: RTL8168c/8111c at 0xffffc200008b4000, 
00:1f:d0:83:71:b4, XID 3c4000c0 IRQ 507       
[   41.316144] ahci 0000:00:1f.2: version 3.0                                                            
[   41.316172] ACPI: PCI Interrupt 0000:00:1f.2[B] -> <6>ACPI: PCI 
Interrupt 0000:03:00.0[A] -> GSI 16 (level, low) -> IRQ 16                                                                                     
[   41.316176] GSI 19 (level, low) -> IRQ 19                                                             
[   41.316571] PCI: Setting latency timer of device 0000:03:00.0 to 64                                   
[   41.316720] scsi0 : pata_jmicron                                                                      
[   41.316783] scsi1 : pata_jmicron                                                                      
[   41.317214] ata1: PATA max UDMA/100 cmd 0xc000 ctl 0xc100 
bmdma 0xc400 irq 16                         
[   41.317217] ata2: PATA max UDMA/100 cmd 0xc200 ctl 0xc300 
bmdma 0xc408 irq 16                         
[   41.609567] usb 1-1: USB disconnect, address 2                                                        
[   41.609587] usbcore: registered new interface driver hiddev                                           
[   41.634066] ata1.00: ATAPI: PIONEER DVD-RW  DVR-111D, 1.06, max 
UDMA/66                               
[   41.805774] ata1.00: configured for UDMA/66                                                           
[   41.967430] scsi 0:0:0:0: CD-ROM            PIONEER  DVD-RW  
DVR-111D 1.06 PQ: 0 ANSI: 5              
[   42.316463] ahci 0000:00:1f.2: AHCI 0001.0200 32 slots 6 ports 3 
Gbps 0x3f impl SATA mode             
[   42.316467] ahci 0000:00:1f.2: flags: 64bit ncq sntf stag pm led clo 
pmp pio slum part                
[   42.316472] PCI: Setting latency timer of device 0000:00:1f.2 to 64                                   
[   42.316695] scsi2 : ahci                                                                              
[   42.316745] scsi3 : ahci                                                                              
[   42.316783] scsi4 : ahci                                                                              
[   42.316814] scsi5 : ahci                                                                              
[   42.316843] scsi6 : ahci                                                                              
[   42.316873] scsi7 : ahci                                                                              
[   42.316941] ata3: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206100 irq 506                     
[   42.316943] ata4: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206180 irq 506                     
[   42.316945] ata5: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206200 irq 506                     
[   42.316947] ata6: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206280 irq 506                     
[   42.316949] ata7: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206300 irq 506                     
[   42.316951] ata8: SATA max UDMA/133 abar m2048 at 0xe8206000 
port 0xe8206380 irq 506                     
[   42.400299] usb 8-1: new high speed USB device using ehci_hcd 
and address 2                           
[   42.534781] usb 8-1: configuration #1 chosen from 1 choice                                            
[   42.771707] usb 8-5: new high speed USB device using ehci_hcd 
and address 3                           
[   42.907335] usb 8-5: configuration #1 chosen from 1 choice                                            
[   42.955420] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300)                                    
[   42.964827] ata3.00: ATA-7: WDC WD7500AAKS-00RBA0, 30.04G30, 
max UDMA/133                             
[   42.964830] ata3.00: 1465149168 sectors, multi 0: LBA48 NCQ 
(depth 31/32)                             
[   42.965685] ata3.00: configured for UDMA/133                                                          
[   43.143189] usbcore: registered new interface driver usbhid                                           
[   43.143193] /build/buildd/linux-2.6.24/drivers/hid/usbhid/hid-core.c: 
v2.6:USB HID core driver        
[   43.143235] usbcore: registered new interface driver libusual                                         
[   43.145573] Initializing USB Mass Storage driver...                                                   
[   43.383764] usb 6-2: new full speed USB device using uhci_hcd and 
address 2                           
[   43.570850] usb 6-2: configuration #1 chosen from 1 choice                                            
[   43.580164] scsi8 : SCSI emulation for USB Mass Storage devices                                       
[   43.580649] usbcore: registered new interface driver usb-storage                                      
[   43.580651] USB Mass Storage support registered.                                                      
[   43.580731] usb-storage: device found at 2                                                            
[   43.580732] usb-storage: waiting for device to settle before 
scanning                                 
[   43.606384] ata4: SATA link up 3.0 Gbps (SStatus 123 SControl 300)                                    
[   43.643498] ata4.00: ATA-7: ST3160811AS, 3.AAE, max UDMA/133                                          
[   43.643501] ata4.00: 312581808 sectors, multi 0: LBA48 NCQ 
(depth 31/32)                              
[   43.701722] ata4.00: configured for UDMA/133                                                          
[   43.810070] usb 1-1: new low speed USB device using uhci_hcd and 
address 3                            
[   43.986886] usb 1-1: configuration #1 chosen from 1 choice                                            
[   44.004009] input: B16_b_02 USB-PS/2 Optical Mouse as 
/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1:1.0/input/input2                                                                                           
[   44.017737] ata5: SATA link down (SStatus 0 SControl 300)                                             
[   44.021775] input,hidraw0: USB HID v1.10 Mouse [B16_b_02 USB-
PS/2 Optical Mouse] on usb-0000:00:1a.0-1
[   44.261343] usb 2-2: new full speed USB device using uhci_hcd and 
address 2                           
[   44.337240] ata6: SATA link down (SStatus 0 SControl 300)                                             
[   44.448579] usb 2-2: configuration #1 chosen from 1 choice                                            
[   44.656721] ata7: SATA link down (SStatus 0 SControl 300)                                             
[   44.980206] ata8: SATA link down (SStatus 0 SControl 300)                                             
[   44.980315] scsi 2:0:0:0: Direct-Access     ATA      WDC 
WD7500AAKS-0 30.0 PQ: 0 ANSI: 5              
[   44.980429] scsi 3:0:0:0: Direct-Access     ATA      ST3160811AS      
3.AA PQ: 0 ANSI: 5              
[   44.987269] Driver 'sd' needs updating - please use bus_type 
methods                                  
[   44.990425] Driver 'sr' needs updating - please use bus_type 
methods                                  
[   44.996723] sd 2:0:0:0: [sda] 1465149168 512-byte hardware 
sectors (750156 MB)                        
[   44.996731] sd 2:0:0:0: [sda] Write Protect is off                                                    
[   44.996733] sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00                                                 
[   44.996744] sd 2:0:0:0: [sda] Write cache: enabled, read cache: 
enabled, doesn't support DPO or FUA   
[   44.996793] sd 2:0:0:0: [sda] 1465149168 512-byte hardware 
sectors (750156 MB)                        
[   44.996835] sd 2:0:0:0: [sda] Write Protect is off                                                    
[   44.996837] sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00                                                 
[   44.996848] sd 2:0:0:0: [sda] Write cache: enabled, read cache: 
enabled, doesn't support DPO or FUA   
[   44.996851]  sda: sda1 sda2 sda3 sda4 < sda5sr0: scsi3-mmc 
drive: 40x/40x writer cd/rw xa/form2 cdda tray                                                                                                      
[   45.021368] Uniform CD-ROM driver Revision: 3.20                                                      
[   45.021396] sr 0:0:0:0: Attached scsi CD-ROM sr0                                                      
[   45.029173]  sda6 sda7 >                                                                              
[   45.051763] sd 2:0:0:0: [sda] Attached SCSI disk                                                      
[   45.051817] sd 3:0:0:0: [sdb] 312581808 512-byte hardware 
sectors (160042 MB)                         
[   45.051826] sd 3:0:0:0: [sdb] Write Protect is off                                                    
[   45.051828] sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00                                                 
[   45.051839] sd 3:0:0:0: [sdb] Write cache: enabled, read cache: 
enabled, doesn't support DPO or FUA   
[   45.051870] sd 3:0:0:0: [sdb] 312581808 512-byte hardware 
sectors (160042 MB)                         
[   45.051877] sd 3:0:0:0: [sdb] Write Protect is off                                                    
[   45.051878] sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00                                                 
[   45.051889] sd 3:0:0:0: [sdb] Write cache: enabled, read cache: 
enabled, doesn't support DPO or FUA   
[   45.051891]  sdb: sdb1                                                                                
[   45.072117] sd 3:0:0:0: [sdb] Attached SCSI disk                                                      
[   45.074906] sr 0:0:0:0: Attached scsi generic sg0 type 5                                              
[   45.074921] sd 2:0:0:0: Attached scsi generic sg1 type 0                                              
[   45.074935] sd 3:0:0:0: Attached scsi generic sg2 type 0                                              
[   45.363886] Attempting manual resume                                                                  
[   45.363889] swsusp: Resume From Partition 8:3                                                         
[   45.363890] PM: Checking swsusp image.                                                                
[   45.364021] PM: Resume from disk failed.                                                              
[   45.383661] kjournald starting.  Commit interval 5 seconds                                            
[   45.383670] EXT3-fs: mounted filesystem with ordered data mode.                                       
[   48.574741] usb-storage: device scan complete                                                         
[   48.575617] scsi 8:0:0:0: Direct-Access     JetFlash TS2GJFV90        
1100 PQ: 0 ANSI: 0 CCS          
[   48.576849] sd 8:0:0:0: [sdc] 3964928 512-byte hardware sectors 
(2030 MB)                             
[   48.577602] sd 8:0:0:0: [sdc] Write Protect is off                                                    
[   48.577604] sd 8:0:0:0: [sdc] Mode Sense: 43 00 00 00                                                 
[   48.577606] sd 8:0:0:0: [sdc] Assuming drive cache: write through                                     
[   48.580349] sd 8:0:0:0: [sdc] 3964928 512-byte hardware sectors 
(2030 MB)                             
[   48.581095] sd 8:0:0:0: [sdc] Write Protect is off                                                    
[   48.581097] sd 8:0:0:0: [sdc] Mode Sense: 43 00 00 00                                                 
[   48.581102] sd 8:0:0:0: [sdc] Assuming drive cache: write through                                     
[   48.581105]  sdc: sdc1                                                                                
[   48.581790] sd 8:0:0:0: [sdc] Attached SCSI removable disk                                            
[   48.581820] sd 8:0:0:0: Attached scsi generic sg3 type 0                                              
[   50.548051] input: Power Button (FF) as /devices/virtual/input/input3                                 
[   50.575022] input: PC Speaker as 
/devices/platform/pcspkr/input/input4                                
[   50.579833] ACPI: Power Button (FF) [PWRF]                                                            
[   50.579882] input: Power Button (CM) as 
/devices/virtual/input/input5                                 
[   50.632228] ACPI: Power Button (CM) [PWRB]                                                            
[   50.664511] pci_hotplug: PCI Hot Plug PCI Core version: 0.5                                           
[   50.666668] shpchp: Standard Hot Plug PCI Controller Driver 
version: 0.4                              
[   50.741101] Linux video capture interface: v2.00                                                      
[   50.925931] udev: renamed network interface eth0 to eth2                                              
[   51.100198] saa7130/34: v4l2 driver version 0.2.14 loaded                                             
[   51.100261] ACPI: PCI Interrupt 0000:05:01.0[A] -> GSI 19 (level, 
low) -> IRQ 19                      
[   51.100268] saa7133[0]: found at 0000:05:01.0, rev: 209, irq: 19, 
latency: 32, mmio: 0xe8102000       
[   51.100273] saa7133[0]: subsystem: 1461:9715, board: Avermedia 
AVerTV Studio 507 [card=102,autodetected]                                                                                                       
[   51.100281] saa7133[0]: board init: gpio is 208                                                       
[   51.100331] input: saa7134 IR (Avermedia AVerTV St as 
/devices/pci0000:00/0000:00:1e.0/0000:05:01.0/input/input6                                                                                               
[   51.278783] fglrx: module license 'Proprietary. (C) 2002 - ATI 
Technologies, Starnberg, GERMANY' taints kernel.                                                                                                
[   51.287369] saa7133[0]: i2c eeprom 00: 61 14 15 97 ff ff ff ff ff ff ff 
ff ff ff ff ff                
[   51.287376] saa7133[0]: i2c eeprom 10: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.287381] saa7133[0]: i2c eeprom 20: ff f1 f7 ff ff ff ff ff ff ff ff ff ff 
ff ff ff                
[   51.287386] saa7133[0]: i2c eeprom 30: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.287390] saa7133[0]: i2c eeprom 40: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.287395] saa7133[0]: i2c eeprom 50: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.287399] saa7133[0]: i2c eeprom 60: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.287404] saa7133[0]: i2c eeprom 70: ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff                
[   51.293138] [fglrx]   vendor: 1002 device: 9505 count: 1                                              
[   51.293242] [fglrx] Maximum main memory to use for locked dma 
buffers: 1886 MBytes.                   
[   51.294927] [fglrx] PAT is enabled successfully!                                                      
[   51.294954] [fglrx] module loaded - fglrx 8.50.3 [Jun  2 2008] with 1 
minors                          
[   51.379676] /build/buildd/linux-ubuntu-
modules-2.6.24-2.6.24/debian/build/build-
generic/media/gspcav1/gspca_core.c: USB GSPCA camera found.
(ZC3XX)                                                             
[   51.395944] parport_pc 00:09: reported by Plug and Play ACPI                                          
[   51.395989] parport0: PC-style at 0x378, irq 7 [PCSPP,TRISTATE]                                       
[   51.411803] usblp0: USB Bidirectional printer dev 2 if 0 alt 0 proto 2 
vid 0x03F0 pid 0x8104          
[   51.471480] tuner 0-0043: chip found @ 0x86 (saa7133[0])                                              
[   51.471508] tda9887 0-0043: tda988[5/6/7] found @ 0x43 (tuner)                                        
[   51.471510] tuner 0-0043: type set to tda9887                                                         
[   51.479495] tuner 0-0061: chip found @ 0xc2 (saa7133[0])                                              
[   51.479511] tuner-simple 0-0061: type set to 51 (Philips 
PAL/SECAM_D (FM 1256 I-H3))                  
[   51.479513] tuner 0-0061: type set to Philips PAL/SECAM_D                                             
[   51.479515] tuner-simple 0-0061: type set to 51 (Philips 
PAL/SECAM_D (FM 1256 I-H3))                  
[   51.479517] tuner 0-0061: type set to Philips PAL/SECAM_D                                             
[   51.484768] saa7133[0]: registered device video0 [v4l2]                                               
[   51.484785] saa7133[0]: registered device vbi0                                                        
[   51.484803] saa7133[0]: registered device radio0                                                      
[   51.485075] ACPI: PCI Interrupt 0000:00:1b.0[A] -> GSI 22 (level, 
low) -> IRQ 22                      
[   51.485924] PCI: Setting latency timer of device 0000:00:1b.0 to 64                                   
[   51.506754] b43-phy0: Broadcom 4318 WLAN found                                                        
[   51.515483] saa7134 ALSA driver for DMA sound loaded                                                  
[   51.515503] saa7133[0]/alsa: saa7133[0] at 0xe8102000 irq 19 
registered as card -2                    
[   51.550307] b43-phy0 debug: Found PHY: Analog 3, Type 2, Revision 
7                                   
[   51.550316] b43-phy0 debug: Found Radio: Manuf 0x17F, Version 
0x2050, Revision 8                      
[   51.556633] ACPI: PCI Interrupt 0000:01:00.1[B] -> GSI 17 (level, 
low) -> IRQ 17                      
[   51.557531] PCI: Setting latency timer of device 0000:01:00.1 to 64                                   
[   51.581885] phy0: Selected rate control algorithm 'simple'                                            
[   52.011004] usbcore: registered new interface driver gspca                                            
[   52.011010] /build/buildd/linux-ubuntu-
modules-2.6.24-2.6.24/debian/build/build-
generic/media/gspcav1/gspca_core.c: gspca driver 01.00.20 
registered                                                           
[   52.013557] usbcore: registered new interface driver usblp                                            
[   52.061119] usbcore: registered new interface driver snd-usb-audio                                    
[   52.196317] lp0: using parport0 (interrupt-driven).                                                   
[   52.234167] it87: Found IT8718F chip at 0x290, revision 5                                             
[   52.234174] it87: in3 is VCC (+5V)                                                                    
[   52.244334] coretemp coretemp.0: Using undocumented features, 
absolute temperature might be wrong!    
[   52.244373] coretemp coretemp.1: Using undocumented features, 
absolute temperature might be wrong!    
[   52.244399] coretemp coretemp.2: Using undocumented features, 
absolute temperature might be wrong!    
[   52.244428] coretemp coretemp.3: Using undocumented features, 
absolute temperature might be wrong!    
[   52.310763] Adding 2104504k swap on /dev/sda3.  Priority:-1 
extents:1 across:2104504k                 
[   52.851788] EXT3 FS on sda5, internal journal                                                         
[   52.953148] device-mapper: uevent: version 1.0.3                                                      
[   52.953174] device-mapper: ioctl: 4.12.0-ioctl (2007-10-02) 
initialised: dm-devel at redhat.com          
[   53.771478] kjournald starting.  Commit interval 5 seconds                                            
[   53.771712] EXT3 FS on sda6, internal journal                                                         
[   53.771717] EXT3-fs: mounted filesystem with ordered data mode.                                       
[   54.444680] kjournald starting.  Commit interval 5 seconds                                            
[   54.444688] EXT3-fs warning: maximal mount count reached, 
running e2fsck is recommended               
[   54.450810] EXT3 FS on sdb1, internal journal                                                         
[   54.450816] EXT3-fs: mounted filesystem with ordered data mode.                                       
[   54.872248] ip_tables: (C) 2000-2006 Netfilter Core Team                                              
[   54.987735] nf_conntrack version 0.5.0 (16384 buckets, 65536 
max)                                     
[   55.407736] No dock devices found.                                                                    
[   56.256977] NET: Registered protocol family 10                                                        
[   56.257224] lo: Disabled Privacy Extensions                                                           
[   58.083149] ppdev: user-space parallel port driver                                                    
[   58.216460] audit(1221055222.094:2): type=1503 
operation="inode_permission" requested_mask="a::" 
denied_mask="a::" name="/dev/tty" pid=6216 
profile="/usr/sbin/cupsd" namespace="default"                      
[   59.983811] vboxdrv: Trying to deactivate the NMI watchdog 
permanently...                             
[   59.983819] vboxdrv: Successfully done.                                                               
[   59.984074] vboxdrv: TSC mode is 'synchronous', kernel timer mode 
is 'normal'.                        
[   59.984077] vboxdrv: Successfully loaded version 1.5.6_OSE 
(interface 0x00050002).                    
[   64.043410] input: b43-phy0 as /devices/virtual/input/input7                                          
[   64.093550] Bluetooth: Core ver 2.11                                                                  
[   64.093778] NET: Registered protocol family 31                                                        
[   64.093782] Bluetooth: HCI device and connection manager 
initialized                                  
[   64.093787] Bluetooth: HCI socket layer initialized                                                   
[   64.101982] Bluetooth: L2CAP ver 2.9                                                                  
[   64.101987] Bluetooth: L2CAP socket layer initialized                                                 
[   64.147942] Bluetooth: RFCOMM socket layer initialized                                                
[   64.147958] Bluetooth: RFCOMM TTY layer initialized                                                   
[   64.147960] Bluetooth: RFCOMM ver 1.8                                                                 
[   64.410659] b43-phy0 debug: Loading firmware version 351.126 
(2006-07-29 05:54:02)                    
[   65.407047] b43-phy0 debug: Chip initialized                                                          
[   65.407198] b43-phy0 debug: 32-bit DMA initialized                                                    
[   65.424104] Registered led device: b43-phy0:tx                                                        
[   65.424122] Registered led device: b43-phy0:rx                                                        
[   65.424136] Registered led device: b43-phy0:assoc                                                     
[   65.424151] Registered led device: b43-phy0:radio                                                     
[   65.424180] b43-phy0 debug: Wireless interface started                                                
[   65.424189] b43-phy0 debug: Adding Interface type 2                                                   
[   65.428126] ADDRCONF(NETDEV_UP): wlan0: link is not ready                                             
[   65.506537] r8169: eth2: link up                                                                      
[   65.506548] r8169: eth2: link up                                                                      
[   66.509562] ACPI: PCI Interrupt 0000:01:00.0[A] -> GSI 16 (level, 
low) -> IRQ 16                      
[   68.043308] [fglrx] Reserved FB block: Shared offset:0, size:1000000                                  
[   68.043315] [fglrx] Reserved FB block: Unshared offset:ff7f000, 
size:80000                            
[   76.286517] eth2: no IPv6 routers present                                                             
[  110.180625] NET: Registered protocol family 17                                                        
[  111.240614] wlan0: Initial auth_alg=0                                                                 
[  111.240623] wlan0: authenticate with AP 00:1a:92:d3:be:3a                                             
[  111.242043] wlan0: RX authentication from 00:1a:92:d3:be:3a 
(alg=0 transaction=2 status=0)            
[  111.242047] wlan0: authenticated                                                                      
[  111.242051] wlan0: associate with AP 00:1a:92:d3:be:3a                                                
[  111.244444] wlan0: RX AssocResp from 00:1a:92:d3:be:3a 
(capab=0x401 status=0 aid=2)                   
[  111.244449] wlan0: associated                                                                         
[  111.244453] wlan0: switched to short barker preamble 
(BSSID=00:1a:92:d3:be:3a)                        
[  111.244490] wlan0: WMM queue=2 aci=0 acm=0 aifs=3 cWmin=15 
cWmax=1023 burst=0                         
[  111.244495] wlan0: WMM queue=3 aci=1 acm=0 aifs=7 cWmin=15 
cWmax=1023 burst=0                         
[  111.244499] wlan0: WMM queue=1 aci=2 acm=0 aifs=2 cWmin=7 
cWmax=15 burst=30                           
[  111.244503] wlan0: WMM queue=0 aci=3 acm=0 aifs=2 cWmin=3 
cWmax=7 burst=15                            
[  111.247515] ADDRCONF(NETDEV_CHANGE): wlan0: link becomes 
ready                                        
[  121.718441] wlan0: no IPv6 routers present                                                            
[  156.319638] wlan0: deauthenticate(reason=3)                                                           
[ 1867.955895] wlan0: No ProbeResp from current AP 
00:1a:92:d3:be:3a - assume out of range 

I use AP with Open Auth without encryption.






-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080910/a1473bb9/attachment.pgp>

From mb at bu3sch.de  Wed Sep 10 20:20:30 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 10 Sep 2008 20:20:30 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <A1EAA6F4-0332-4173-A504-D203B4523F9E@ing.unibs.it>
References: <200809061621.48449.mb@bu3sch.de> <200809101600.53777.mb@bu3sch.de>
	<A1EAA6F4-0332-4173-A504-D203B4523F9E@ing.unibs.it>
Message-ID: <200809102020.31073.mb@bu3sch.de>

Stay on list.
I'm not going to start another private thread for this.
In general, I avoid private threads most of the time and
barely answer them. There are so many people on the list
that can answer your questions.

On Wednesday 10 September 2008 17:50:33 Francesco Gringoli wrote:
> > The code is correct wrt specs. It says there are 0x16 words.
> > First fix specs, then fix code, please.
> I do not understand: those specs say that there are 16 words.

The table has 0x16 entries.

-- 
Greetings Michael.


From francesco.gringoli at ing.unibs.it  Wed Sep 10 21:42:57 2008
From: francesco.gringoli at ing.unibs.it (Francesco Gringoli)
Date: Wed, 10 Sep 2008 21:42:57 +0200
Subject: b43: out-of-standard behavior
In-Reply-To: <200809102020.31073.mb@bu3sch.de>
References: <200809061621.48449.mb@bu3sch.de> <200809101600.53777.mb@bu3sch.de>
	<A1EAA6F4-0332-4173-A504-D203B4523F9E@ing.unibs.it>
	<200809102020.31073.mb@bu3sch.de>
Message-ID: <B22D8628-19FE-4FEC-83F2-51BAD3597CE2@ing.unibs.it>

Hello everybody,

we found a strange behavior problem with the b43 driver. We begin  
investigating this when doing some access tests with several boards:  
we discovered that the Broadcom boards usually acquire the channel  
usage with higher priority when the b43 driver is used as respect to  
other vendor boards.

After investigating we saw that the intra-queue contention procedure  
is carried out by the firmware which stores information, such as AIFS  
and current backoffs for each queue, inside the shared memory. The  
AIFS for each queue is used to compute the initial backoff so that  
internal contention usually gives more priority to VO queue (smallest  
AIFS) and less to background (biggest AIFS). AIFS parameters are  
initialized by the driver which is told to use a 22 words long  
structures. The firmware instead use 16 words structures: this means  
that AIFS parameters initialized by the driver do not match the  
corresponding values read by the firmware. We saw that the firmware  
reads (2,0,0,0) instead of (2,2,3,7) which results in very short  
backoff procedures.

Has anyone noticed similar behavior? For the sake of clarity, I'm  
referring to latest (30 minutes ago) version of wireless-git and  
broadcom-wl-4.150.10.5 driver version. I verified that all ucode5.s,  
ucode9.s, ucode11.s, ucode13.s and ucode14.s firmwares use 16 words  
structures, and the driver instead still uses 22 words long  
structures.  Probably the attached patch sorts out the problem.

I also noticed that the specs say that these structures are 16 words:  
could not someone read 16 as 0x16 that finally became 0x16 = 22?

Cheers,
FG

--- b43.h.old	2008-09-10 21:12:59.000000000 +0200
+++ b43.h	2008-09-10 21:13:09.000000000 +0200
@@ -569,7 +569,7 @@
  #define B43_QOS_VOICE		B43_QOS_PARAMS(3)

  /* QOS parameter hardware data structure offsets. */
-#define B43_NR_QOSPARAMS	22
+#define B43_NR_QOSPARAMS	16
  enum {
  	B43_QOSPARAM_TXOP = 0,
  	B43_QOSPARAM_CWMIN,





From navalorenx at gmail.com  Wed Sep 10 22:11:53 2008
From: navalorenx at gmail.com (Lorenzo Nava)
Date: Wed, 10 Sep 2008 22:11:53 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <200809101600.53777.mb@bu3sch.de>
References: <200809061621.48449.mb@bu3sch.de> <200809101458.56868.mb@bu3sch.de>
	<9B374125-A4B2-4888-96B4-0E118BD281F3@ing.unibs.it>
	<200809101600.53777.mb@bu3sch.de>
Message-ID: <D3082ED8-F925-4AD3-8230-F0434162DDF6@gmail.com>

>>
> The code is correct wrt specs. It says there are 0x16 words.
> First fix specs, then fix code, please.
>
Yes you're right, but just above the table of the parameters reported  
at http://bcm-v4.sipsolutions.net/802.11/QoS it says:

The EDCF Q Info array in SHM contains four structs of 16 16-bit words

So there is something that is not correct: as I said before I think  
that the error is in the table, and I checked it within the firmware,  
so I am quite sure of that.

Do you agree with me that there is an error in the specs?

regards

Lorenzo

> -- 
> Greetings Michael.



From mb at bu3sch.de  Wed Sep 10 22:17:40 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 10 Sep 2008 22:17:40 +0200
Subject: b43: out-of-standard behavior
In-Reply-To: <B22D8628-19FE-4FEC-83F2-51BAD3597CE2@ing.unibs.it>
References: <200809061621.48449.mb@bu3sch.de> <200809102020.31073.mb@bu3sch.de>
	<B22D8628-19FE-4FEC-83F2-51BAD3597CE2@ing.unibs.it>
Message-ID: <200809102217.40888.mb@bu3sch.de>

On Wednesday 10 September 2008 21:42:57 Francesco Gringoli wrote:
> Hello everybody,
> 
> we found a strange behavior problem with the b43 driver. We begin  
> investigating this when doing some access tests with several boards:  
> we discovered that the Broadcom boards usually acquire the channel  
> usage with higher priority when the b43 driver is used as respect to  
> other vendor boards.
> 
> After investigating we saw that the intra-queue contention procedure  
> is carried out by the firmware which stores information, such as AIFS  
> and current backoffs for each queue, inside the shared memory. The  
> AIFS for each queue is used to compute the initial backoff so that  
> internal contention usually gives more priority to VO queue (smallest  
> AIFS) and less to background (biggest AIFS). AIFS parameters are  
> initialized by the driver which is told to use a 22 words long  
> structures. The firmware instead use 16 words structures: this means  
> that AIFS parameters initialized by the driver do not match the  
> corresponding values read by the firmware. We saw that the firmware  
> reads (2,0,0,0) instead of (2,2,3,7) which results in very short  
> backoff procedures.
> 
> Has anyone noticed similar behavior? For the sake of clarity, I'm  
> referring to latest (30 minutes ago) version of wireless-git and  
> broadcom-wl-4.150.10.5 driver version. I verified that all ucode5.s,  
> ucode9.s, ucode11.s, ucode13.s and ucode14.s firmwares use 16 words  
> structures, and the driver instead still uses 22 words long  
> structures.  Probably the attached patch sorts out the problem.
> 
> I also noticed that the specs say that these structures are 16 words:  
> could not someone read 16 as 0x16 that finally became 0x16 = 22?

The specs are ambiguous here.
The specs table for QoS clearly has 0x16 fields. So I implemented it
this way and read the "foobar has 16 words" text in hex.

"How many people can read hex, if only you and dead people can read hex?" ;)


> --- b43.h.old	2008-09-10 21:12:59.000000000 +0200
> +++ b43.h	2008-09-10 21:13:09.000000000 +0200
> @@ -569,7 +569,7 @@
>   #define B43_QOS_VOICE		B43_QOS_PARAMS(3)
> 
>   /* QOS parameter hardware data structure offsets. */
> -#define B43_NR_QOSPARAMS	22
> +#define B43_NR_QOSPARAMS	16
>   enum {
>   	B43_QOSPARAM_TXOP = 0,
>   	B43_QOSPARAM_CWMIN,

PS: Can you please avoid starting yet another thread for the topic?
We already have one.

Please, guys, keep _threads_. It's important to _not_ start new threads
all the time, so email archive searching is made possible. This is _also_
the case for private mail from you.
You're not the only one in my inbox, but every time I have to search for
your old mail it's a headache.
So good subjects (this one is _not_ a good one) and not breaking threads
is very important.

-- 
Greetings Michael.


From mb at bu3sch.de  Wed Sep 10 22:19:42 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 10 Sep 2008 22:19:42 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <D3082ED8-F925-4AD3-8230-F0434162DDF6@gmail.com>
References: <200809061621.48449.mb@bu3sch.de> <200809101600.53777.mb@bu3sch.de>
	<D3082ED8-F925-4AD3-8230-F0434162DDF6@gmail.com>
Message-ID: <200809102219.42932.mb@bu3sch.de>

On Wednesday 10 September 2008 22:11:53 Lorenzo Nava wrote:
> >>
> > The code is correct wrt specs. It says there are 0x16 words.
> > First fix specs, then fix code, please.
> >
> Yes you're right, but just above the table of the parameters reported  
> at http://bcm-v4.sipsolutions.net/802.11/QoS it says:
> 
> The EDCF Q Info array in SHM contains four structs of 16 16-bit words
> 
> So there is something that is not correct: as I said before I think  
> that the error is in the table, and I checked it within the firmware,  
> so I am quite sure of that.
> 
> Do you agree with me that there is an error in the specs?

I'm not a reverse engineer, so I have no chance to check the original
code to agree (or not) with you.

-- 
Greetings Michael.


From netrolller.3d at gmail.com  Wed Sep 10 22:20:22 2008
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?Stefanik_G=E1bor?=)
Date: Wed, 10 Sep 2008 22:20:22 +0200
Subject: [update] Asus 138G v2
In-Reply-To: <200809102127.37380.alexeisergeev@gmail.com>
References: <200809102127.37380.alexeisergeev@gmail.com>
Message-ID: <69e28c910809101320t392b0c29k38649f887f8f0314@mail.gmail.com>

On Wed, Sep 10, 2008 at 7:27 PM, Alexei Sergeev <alexeisergeev at gmail.com> wrote:
> I sent another mail day ago, and while I was waiting and get no
> support on irc I tried different drivers and firmwares.
>
> So far I tried bcm43xx and ndiswrapper (both gives me no success)
> and I revert to b43. But now wireless card can't either connect to
> network, it can see network but stop at "Configure device" state.
> (Before it was able to connect but was very slow)
>
> So here is debug output again (now can't connect to AP, but see it):
> uname -a
> Linux server 2.6.24-19-generic #1 SMP Fri Jul 11 21:01:46 UTC 2008
> x86_64 GNU/Linux
>
> lspci -vvn|grep 43 -A7:
> 05:00.0 0280: 14e4:4318 (rev 02)
>        Subsystem: 1043:100f
>        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop-
> ParErr- Stepping- SERR- FastB2B-
>        Status: Cap- 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
> <TAbort- <MAbort- >SERR- <PERR-
>        Latency: 32
>        Interrupt: pin A routed to IRQ 20
>        Region 0: Memory at e8100000 (32-bit, non-prefetchable)
> [size=8K]
>
> 05:01.0 0480: 1131:7133 (rev d1)
>
> dmesg
> [    0.000000] Initializing cgroup subsys cpuset
> [    0.000000] Initializing cgroup subsys cpu
> [    0.000000] Linux version 2.6.24-19-generic (buildd at king) (gcc
> version 4.2.3 (Ubuntu 4.2.3-2ubuntu7)) #1 SMP Fri Jul 11 21:01:46 UTC
> 2008 (Ubuntu 2.6.24-19.36-generic)
> [    0.000000] Command line: root=UUID=05c8eb05-27d3-48a0-
> be4f-75b22f6ece9b ro quiet splash
> [    0.000000] BIOS-provided physical RAM map:
> [    0.000000]  BIOS-e820: 0000000000000000 - 000000000009e800
> (usable)
> [    0.000000]  BIOS-e820: 000000000009f800 - 00000000000a0000
> (reserved)
> [    0.000000]  BIOS-e820: 00000000000f0000 - 0000000000100000
> (reserved)
> [    0.000000]  BIOS-e820: 0000000000100000 - 000000007fee0000
> (usable)
> [    0.000000]  BIOS-e820: 000000007fee0000 - 000000007fee3000
> (ACPI NVS)
> [    0.000000]  BIOS-e820: 000000007fee3000 - 000000007fef0000
> (ACPI data)
> [    0.000000]  BIOS-e820: 000000007fef0000 - 000000007ff00000
> (reserved)
> [    0.000000]  BIOS-e820: 00000000e0000000 - 00000000e4000000
> (reserved)
> [    0.000000]  BIOS-e820: 00000000fec00000 - 0000000100000000
> (reserved)
> [    0.000000] Entering add_active_range(0, 0, 158) 0 entries of 3200
> used
> [    0.000000] Entering add_active_range(0, 256, 524000) 1 entries of
> 3200 used
> [    0.000000] end_pfn_map = 1048576
> [    0.000000] DMI 2.4 present.
> [    0.000000] ACPI: RSDP signature @ 0xFFFF8100000F6F00
> checksum 0
> [    0.000000] ACPI: RSDP 000F6F00, 0014 (r0 GBT   )
> [    0.000000] ACPI: RSDT 7FEE3040, 0038 (r1 GBT    GBTUACPI
> 42302E31 GBTU  1010101)
> [    0.000000] ACPI: FACP 7FEE30C0, 0074 (r1 GBT    GBTUACPI
> 42302E31 GBTU  1010101)
> [    0.000000] ACPI: DSDT 7FEE3180, 4B82 (r1 GBT    GBTUACPI     1000
> MSFT  100000C)
> [    0.000000] ACPI: FACS 7FEE0000, 0040
> [    0.000000] ACPI: HPET 7FEE7E80, 0038 (r1 GBT    GBTUACPI
> 42302E31 GBTU       98)
> [    0.000000] ACPI: MCFG 7FEE7F00, 003C (r1 GBT    GBTUACPI
> 42302E31 GBTU  1010101)
> [    0.000000] ACPI: APIC 7FEE7D80, 0084 (r1 GBT    GBTUACPI
> 42302E31 GBTU  1010101)
> [    0.000000] ACPI: SSDT 7FEE8860, 03AB (r1  PmRef    CpuPm     3000
> INTL 20040311)
> [    0.000000] No NUMA configuration found
> [    0.000000] Faking a node at
> 0000000000000000-000000007fee0000
> [    0.000000] Entering add_active_range(0, 0, 158) 0 entries of 3200
> used
> [    0.000000] Entering add_active_range(0, 256, 524000) 1 entries of
> 3200 used
> [    0.000000] Bootmem setup node 0
> 0000000000000000-000000007fee0000
> [    0.000000] Zone PFN ranges:
> [    0.000000]   DMA             0 ->     4096
> [    0.000000]   DMA32        4096 ->  1048576
> [    0.000000]   Normal    1048576 ->  1048576
> [    0.000000] Movable zone start PFN for each node
> [    0.000000] early_node_map[2] active PFN ranges
> [    0.000000]     0:        0 ->      158
> [    0.000000]     0:      256 ->   524000
> [    0.000000] On node 0 totalpages: 523902
> [    0.000000]   DMA zone: 56 pages used for memmap
> [    0.000000]   DMA zone: 1221 pages reserved
> [    0.000000]   DMA zone: 2721 pages, LIFO batch:0
> [    0.000000]   DMA32 zone: 7108 pages used for memmap
> [    0.000000]   DMA32 zone: 512796 pages, LIFO batch:31
> [    0.000000]   Normal zone: 0 pages used for memmap
> [    0.000000]   Movable zone: 0 pages used for memmap
> [    0.000000] ACPI: PM-Timer IO Port: 0x408
> [    0.000000] ACPI: Local APIC address 0xfee00000
> [    0.000000] ACPI: LAPIC (acpi_id[0x00] lapic_id[0x00] enabled)
> [    0.000000] Processor #0 (Bootup-CPU)
> [    0.000000] ACPI: LAPIC (acpi_id[0x01] lapic_id[0x03] enabled)
> [    0.000000] Processor #3
> [    0.000000] ACPI: LAPIC (acpi_id[0x02] lapic_id[0x02] enabled)
> [    0.000000] Processor #2
> [    0.000000] ACPI: LAPIC (acpi_id[0x03] lapic_id[0x01] enabled)
> [    0.000000] Processor #1
> [    0.000000] ACPI: LAPIC_NMI (acpi_id[0x00] dfl dfl lint[0x1])
> [    0.000000] ACPI: LAPIC_NMI (acpi_id[0x01] dfl dfl lint[0x1])
> [    0.000000] ACPI: LAPIC_NMI (acpi_id[0x02] dfl dfl lint[0x1])
> [    0.000000] ACPI: LAPIC_NMI (acpi_id[0x03] dfl dfl lint[0x1])
> [    0.000000] ACPI: IOAPIC (id[0x02] address[0xfec00000]
> gsi_base[0])
> [    0.000000] IOAPIC[0]: apic_id 2, address 0xfec00000, GSI 0-23
> [    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
> [    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high
> level)
> [    0.000000] ACPI: IRQ0 used by override.
> [    0.000000] ACPI: IRQ2 used by override.
> [    0.000000] ACPI: IRQ9 used by override.
> [    0.000000] Setting APIC routing to flat
> [    0.000000] ACPI: HPET id: 0x8086a201 base: 0xfed00000
> [    0.000000] Using ACPI (MADT) for SMP configuration information
> [    0.000000] swsusp: Registered nosave memory region:
> 000000000009e000 - 00000000000a0000
> [    0.000000] swsusp: Registered nosave memory region:
> 00000000000a0000 - 00000000000f0000
> [    0.000000] swsusp: Registered nosave memory region:
> 00000000000f0000 - 0000000000100000
> [    0.000000] Allocating PCI resources starting at 80000000 (gap:
> 7ff00000:60100000)
> [    0.000000] SMP: Allowing 4 CPUs, 0 hotplug CPUs
> [    0.000000] PERCPU: Allocating 34656 bytes of per cpu data
> [    0.000000] Built 1 zonelists in Node order, mobility grouping on.
> Total pages: 515517
> [    0.000000] Policy zone: DMA32
> [    0.000000] Kernel command line: root=UUID=05c8eb05-27d3-48a0-
> be4f-75b22f6ece9b ro quiet splash
> [    0.000000] Initializing CPU#0
> [    0.000000] PID hash table entries: 4096 (order: 12, 32768 bytes)
> [    0.000000] hpet clockevent registered
> [    0.000000] TSC calibrated against HPET
> [   37.682298] Marking TSC unstable due to TSCs unsynchronized
> [   37.682300] time.c: Detected 2400.083 MHz processor.
> [   37.683002] Console: colour VGA+ 80x25
> [   37.683005] console [tty0] enabled
> [   37.683020] Checking aperture...
> [   37.683027] Calgary: detecting Calgary via BIOS EBDA area
> [   37.683028] Calgary: Unable to locate Rio Grande table in EBDA -
> bailing!
> [   37.702129] Memory: 2053812k/2096000k available (2489k kernel
> code, 41796k reserved, 1318k data, 320k init)
> [   37.702162] SLUB: Genslabs=12, HWalign=64, Order=0-1,
> MinObjects=4, CPUs=4, Nodes=1
> [   37.780138] Calibrating delay using timer specific routine.. 4803.53
> BogoMIPS (lpj=9607078)
> [   37.780166] Security Framework initialized
> [   37.780172] SELinux:  Disabled at boot.
> [   37.780182] AppArmor: AppArmor initialized
> [   37.780185] Failure registering capabilities with primary security
> module.
> [   37.780340] Dentry cache hash table entries: 262144 (order: 9,
> 2097152 bytes)
> [   37.781442] Inode-cache hash table entries: 131072 (order: 8,
> 1048576 bytes)
> [   37.782031] Mount-cache hash table entries: 256
> [   37.782146] Initializing cgroup subsys ns
> [   37.782151] Initializing cgroup subsys cpuacct
> [   37.782164] CPU: L1 I cache: 32K, L1 D cache: 32K
> [   37.782165] CPU: L2 cache: 4096K
> [   37.782167] CPU 0/0 -> Node 0
> [   37.782168] using mwait in idle threads.
> [   37.782170] CPU: Physical Processor ID: 0
> [   37.782170] CPU: Processor Core ID: 0
> [   37.782176] CPU0: Thermal monitoring enabled (TM2)
> [   37.782187] SMP alternatives: switching to UP code
> [   37.782883] Early unpacking initramfs... done
> [   38.083111] ACPI: Core revision 20070126
> [   38.083145] ACPI: Looking for DSDT in initramfs... error, file
> /DSDT.aml not found.
> [   38.163745] Using local APIC timer interrupts.
> [   38.205351] APIC timer calibration result 16667228
> [   38.205352] Detected 16.667 MHz APIC timer.
> [   38.205420] SMP alternatives: switching to SMP code
> [   38.206026] Booting processor 1/4 APIC 0x3
> [   38.216365] Initializing CPU#1
> [   38.293220] Calibrating delay using timer specific routine.. 4800.20
> BogoMIPS (lpj=9600404)
> [   38.293226] CPU: L1 I cache: 32K, L1 D cache: 32K
> [   38.293227] CPU: L2 cache: 4096K
> [   38.293229] CPU 1/3 -> Node 0
> [   38.293230] CPU: Physical Processor ID: 0
> [   38.293231] CPU: Processor Core ID: 3
> [   38.293236] CPU1: Thermal monitoring enabled (TM2)
> [   38.293664] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz
> stepping 0b
> [   38.293762] SMP alternatives: switching to SMP code
> [   38.294142] Booting processor 2/4 APIC 0x2
> [   38.304481] Initializing CPU#2
> [   38.381085] Calibrating delay using timer specific routine.. 4800.20
> BogoMIPS (lpj=9600417)
> [   38.381090] CPU: L1 I cache: 32K, L1 D cache: 32K
> [   38.381091] CPU: L2 cache: 4096K
> [   38.381093] CPU 2/2 -> Node 0
> [   38.381094] CPU: Physical Processor ID: 0
> [   38.381095] CPU: Processor Core ID: 2
> [   38.381100] CPU2: Thermal monitoring enabled (TM2)
> [   38.381528] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz
> stepping 0b
> [   38.381676] SMP alternatives: switching to SMP code
> [   38.382057] Booting processor 3/4 APIC 0x1
> [   38.392395] Initializing CPU#3
> [   38.468949] Calibrating delay using timer specific routine.. 4800.15
> BogoMIPS (lpj=9600310)
> [   38.468954] CPU: L1 I cache: 32K, L1 D cache: 32K
> [   38.468956] CPU: L2 cache: 4096K
> [   38.468957] CPU 3/1 -> Node 0
> [   38.468958] CPU: Physical Processor ID: 0
> [   38.468959] CPU: Processor Core ID: 1
> [   38.468964] CPU3: Thermal monitoring enabled (TM2)
> [   38.469395] Intel(R) Core(TM)2 Quad CPU    Q6600  @ 2.40GHz
> stepping 0b
> [   38.469452] Brought up 4 CPUs
> [   38.469532] CPU0 attaching sched-domain:
> [   38.469534]  domain 0: span 09
> [   38.469535]   groups: 01 08
> [   38.469537]   domain 1: span 0f
> [   38.469538]    groups: 09 06
> [   38.469540]    domain 2: span 0f
> [   38.469541]     groups: 0f
> [   38.469543] CPU1 attaching sched-domain:
> [   38.469544]  domain 0: span 06
> [   38.469545]   groups: 02 04
> [   38.469546]   domain 1: span 0f
> [   38.469547]    groups: 06 09
> [   38.469549]    domain 2: span 0f
> [   38.469550]     groups: 0f
> [   38.469551] CPU2 attaching sched-domain:
> [   38.469552]  domain 0: span 06
> [   38.469553]   groups: 04 02
> [   38.469555]   domain 1: span 0f
> [   38.469556]    groups: 06 09
> [   38.469558]    domain 2: span 0f
> [   38.469559]     groups: 0f
> [   38.469560] CPU3 attaching sched-domain:
> [   38.469561]  domain 0: span 09
> [   38.469562]   groups: 08 01
> [   38.469563]   domain 1: span 0f
> [   38.469564]    groups: 09 06
> [   38.469566]    domain 2: span 0f
> [   38.469567]     groups: 0f
> [   38.469850] net_namespace: 120 bytes
> [   38.470139] Time: 18:00:02  Date: 09/10/08
> [   38.470161] NET: Registered protocol family 16
> [   38.470306] ACPI: bus type pci registered
> [   38.470363] PCI: Using configuration type 1
> [   38.471427] ACPI: EC: Look up EC in DSDT
> [   38.475072] ACPI: Interpreter enabled
> [   38.475077] ACPI: (supports S0 S3 S4 S5)
> [   38.475089] ACPI: Using IOAPIC for interrupt routing
> [   38.479109] ACPI: PCI Root Bridge [PCI0] (0000:00)
> [   38.480399] PCI: Transparent bridge - 0000:00:1e.0
> [   38.480425] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]
> [   38.480556] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX0._PRT]
> [   38.480618] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX4._PRT]
> [   38.480678] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PEX5._PRT]
> [   38.480734] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.HUB0._PRT]
> [   38.492475] ACPI: PCI Interrupt Link [LNKA] (IRQs 3 4 5 6 7 9 10 11
> 12 14 *15)
> [   38.492550] ACPI: PCI Interrupt Link [LNKB] (IRQs 3 4 5 6 7 9 *10 11
> 12 14 15)
> [   38.492624] ACPI: PCI Interrupt Link [LNKC] (IRQs 3 4 5 6 7 *9 10 11
> 12 14 15)
> [   38.492698] ACPI: PCI Interrupt Link [LNKD] (IRQs 3 4 5 6 7 9 10 *11
> 12 14 15)
> [   38.492772] ACPI: PCI Interrupt Link [LNKE] (IRQs 3 4 5 6 7 9 10 11
> 12 *14 15)
> [   38.492846] ACPI: PCI Interrupt Link [LNKF] (IRQs 3 4 5 6 7 9 10 11
> 12 14 *15)
> [   38.492922] ACPI: PCI Interrupt Link [LNK0] (IRQs 3 4 *5 6 7 9 10 11
> 12 14 15)
> [   38.492999] ACPI: PCI Interrupt Link [LNK1] (IRQs *3 4 5 6 7 9 10 11
> 12 14 15)
> [   38.493090] Linux Plug and Play Support v0.97 (c) Adam Belay
> [   38.493111] pnp: PnP ACPI init
> [   38.493117] ACPI: bus type pnp registered
> [   38.495100] pnpacpi: exceeded the max number of mem resources:
> 12
> [   38.495203] pnp: PnP ACPI: found 15 devices
> [   38.495204] ACPI: ACPI bus type pnp unregistered
> [   38.495380] PCI: Using ACPI for IRQ routing
> [   38.495381] PCI: If a device doesn't work, try "pci=routeirq".  If it
> helps, post a report
> [   38.505005] NET: Registered protocol family 8
> [   38.505007] NET: Registered protocol family 20
> [   38.505042] PCI-GART: No AMD northbridge found.
> [   38.505047] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0, 0
> [   38.505051] hpet0: 4 64-bit timers, 14318180 Hz
> [   38.506097] AppArmor: AppArmor Filesystem Enabled
> [   38.510467] Time: hpet clocksource has been installed.
> [   38.510483] Switched to high resolution mode on CPU 0
> [   38.513410] Switched to high resolution mode on CPU 3
> [   38.514073] Switched to high resolution mode on CPU 2
> [   38.514091] Switched to high resolution mode on CPU 1
> [   38.518528] system 00:01: ioport range 0x4d0-0x4d1 has been
> reserved
> [   38.518532] system 00:01: ioport range 0x290-0x29f has been
> reserved
> [   38.518536] system 00:01: ioport range 0x800-0x87f has been
> reserved
> [   38.518539] system 00:01: ioport range 0x290-0x294 has been
> reserved
> [   38.518542] system 00:01: ioport range 0x880-0x88f has been
> reserved
> [   38.518556] system 00:0b: ioport range 0x400-0x4bf has been
> reserved
> [   38.518564] system 00:0c: iomem range 0xe0000000-0xe3ffffff
> could not be reserved
> [   38.518571] system 00:0d: iomem range 0xd2000-0xd3fff has been
> reserved
> [   38.518575] system 00:0d: iomem range 0xf0000-0xf7fff could not
> be reserved
> [   38.518578] system 00:0d: iomem range 0xf8000-0xfbfff could not
> be reserved
> [   38.518581] system 00:0d: iomem range 0xfc000-0xfffff could not be
> reserved
> [   38.518584] system 00:0d: iomem range 0x7fee0000-0x7fefffff could
> not be reserved
> [   38.518593] system 00:0d: iomem range 0x0-0x9ffff could not be
> reserved
> [   38.518595] system 00:0d: iomem range 0x100000-0x7fedffff could
> not be reserved
> [   38.518598] system 00:0d: iomem range 0xfec00000-0xfec00fff has
> been reserved
> [   38.518600] system 00:0d: iomem range 0xfed10000-0xfed1dfff has
> been reserved
> [   38.518602] system 00:0d: iomem range 0xfed20000-0xfed8ffff has
> been reserved
> [   38.518605] system 00:0d: iomem range 0xfee00000-0xfee00fff
> could not be reserved
> [   38.518607] system 00:0d: iomem range 0xffb00000-0xffb7ffff has
> been reserved
> [   38.518956] PCI: Bridge: 0000:00:01.0
> [   38.518958]   IO window: b000-bfff
> [   38.518960]   MEM window: e4000000-e5ffffff
> [   38.518962]   PREFETCH window: d0000000-dfffffff
> [   38.518965] PCI: Bridge: 0000:00:1c.0
> [   38.518966]   IO window: disabled.
> [   38.518969]   MEM window: disabled.
> [   38.518971]   PREFETCH window: disabled.
> [   38.518974] PCI: Bridge: 0000:00:1c.4
> [   38.518976]   IO window: c000-cfff
> [   38.518979]   MEM window: e6000000-e6ffffff
> [   38.518982]   PREFETCH window: disabled.
> [   38.518986] PCI: Bridge: 0000:00:1c.5
> [   38.518987]   IO window: d000-dfff
> [   38.518990]   MEM window: e7000000-e7ffffff
> [   38.518993]   PREFETCH window: e8000000-e80fffff
> [   38.518997] PCI: Bridge: 0000:00:1e.0
> [   38.518998]   IO window: disabled.
> [   38.519001]   MEM window: e8100000-e81fffff
> [   38.519004]   PREFETCH window: disabled.
> [   38.519017] ACPI: PCI Interrupt 0000:00:01.0[A] -> GSI 16 (level,
> low) -> IRQ 16
> [   38.519021] PCI: Setting latency timer of device 0000:00:01.0 to 64
> [   38.519037] ACPI: PCI Interrupt 0000:00:1c.0[A] -> GSI 16 (level,
> low) -> IRQ 16
> [   38.519041] PCI: Setting latency timer of device 0000:00:1c.0 to 64
> [   38.519054] ACPI: PCI Interrupt 0000:00:1c.4[A] -> GSI 16 (level,
> low) -> IRQ 16
> [   38.519058] PCI: Setting latency timer of device 0000:00:1c.4 to 64
> [   38.519071] ACPI: PCI Interrupt 0000:00:1c.5[B] -> GSI 17 (level,
> low) -> IRQ 17
> [   38.519075] PCI: Setting latency timer of device 0000:00:1c.5 to 64
> [   38.519082] PCI: Setting latency timer of device 0000:00:1e.0 to 64
> [   38.519093] NET: Registered protocol family 2
> [   38.554479] IP route cache hash table entries: 65536 (order: 7,
> 524288 bytes)
> [   38.554971] TCP established hash table entries: 262144 (order: 10,
> 4194304 bytes)
> [   38.556278] TCP bind hash table entries: 65536 (order: 8, 1048576
> bytes)
> [   38.556775] TCP: Hash tables configured (established 262144 bind
> 65536)
> [   38.556777] TCP reno registered
> [   38.566523] checking if image is initramfs... it is
> [   39.157035] Freeing initrd memory: 7983k freed
> [   39.161240] audit: initializing netlink socket (disabled)
> [   39.161258] audit(1221069602.412:1): initialized
> [   39.162821] VFS: Disk quotas dquot_6.5.1
> [   39.162869] Dquot-cache hash table entries: 512 (order 0, 4096
> bytes)
> [   39.162960] io scheduler noop registered
> [   39.162961] io scheduler anticipatory registered
> [   39.162962] io scheduler deadline registered
> [   39.163040] io scheduler cfq registered (default)
> [   39.166298] Boot video device is 0000:01:00.0
> [   39.166434] PCI: Setting latency timer of device 0000:00:01.0 to 64
> [   39.166458] assign_interrupt_mode Found MSI capability
> [   39.166479] Allocate Port Service[0000:00:01.0:pcie00]
> [   39.166547] PCI: Setting latency timer of device 0000:00:1c.0 to 64
> [   39.166578] assign_interrupt_mode Found MSI capability
> [   39.166603] Allocate Port Service[0000:00:1c.0:pcie00]
> [   39.166624] Allocate Port Service[0000:00:1c.0:pcie02]
> [   39.166686] PCI: Setting latency timer of device 0000:00:1c.4 to 64
> [   39.166717] assign_interrupt_mode Found MSI capability
> [   39.166741] Allocate Port Service[0000:00:1c.4:pcie00]
> [   39.166766] Allocate Port Service[0000:00:1c.4:pcie02]
> [   39.166826] PCI: Setting latency timer of device 0000:00:1c.5 to 64
> [   39.166857] assign_interrupt_mode Found MSI capability
> [   39.166881] Allocate Port Service[0000:00:1c.5:pcie00]
> [   39.166904] Allocate Port Service[0000:00:1c.5:pcie02]
> [   39.184378] Real Time Clock Driver v1.12ac
> [   39.184507] hpet_resources: 0xfed00000 is busy
> [   39.184551] Linux agpgart interface v0.102
> [   39.184553] Serial: 8250/16550 driver $Revision: 1.90 $ 4 ports, IRQ
> sharing enabled
> [   39.184658] serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
> [   39.185058] 00:08: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
> [   39.185598] RAMDISK driver initialized: 16 RAM disks of 65536K size
> 1024 blocksize
> [   39.185644] input: Macintosh mouse button emulation as
> /devices/virtual/input/input0
> [   39.185708] PNP: PS/2 Controller [PNP0303:PS2K] at 0x60,0x64 irq 1
> [   39.185710] PNP: PS/2 appears to have AUX port disabled, if this is
> incorrect please boot with i8042.nopnp
> [   39.185778] serio: i8042 KBD port at 0x60,0x64 irq 1
> [   39.198947] mice: PS/2 mouse device common for all mice
> [   39.198984] cpuidle: using governor ladder
> [   39.198986] cpuidle: using governor menu
> [   39.199098] NET: Registered protocol family 1
> [   39.199173] registered taskstats version 1
> [   39.199264]   Magic number: 8:639:38
> [   39.199311]   hash matches device 00:0a
> [   39.199322] /build/buildd/linux-2.6.24/drivers/rtc/hctosys.c: unable
> to open rtc device (rtc0)
> [   39.199324] BIOS EDD facility v0.16 2004-Jun-25, 0 devices found
> [   39.199326] EDD information not available.
> [   39.199332] Freeing unused kernel memory: 320k freed
> [   39.233574] input: AT Translated Set 2 keyboard as
> /devices/platform/i8042/serio0/input/input1
> [   40.343760] fuse init (API version 7.9)
> [   40.357026] ACPI: SSDT 7FEE7F80, 022A (r1  PmRef  Cpu0Ist     3000
> INTL 20040311)
> [   40.357212] ACPI: CPU0 (power states: C1[C1] C2[C2])
> [   40.357215] ACPI: Processor [CPU0] (supports 8 throttling states)
> [   40.357326] ACPI: SSDT 7FEE8440, 0152 (r1  PmRef  Cpu1Ist     3000
> INTL 20040311)
> [   40.357543] ACPI: CPU1 (power states: C1[C1] C2[C2])
> [   40.357549] ACPI: Processor [CPU1] (supports 8 throttling states)
> [   40.357697] ACPI: SSDT 7FEE85A0, 0152 (r1  PmRef  Cpu2Ist     3000
> INTL 20040311)
> [   40.357899] ACPI: CPU2 (power states: C1[C1] C2[C2])
> [   40.357903] ACPI: Processor [CPU2] (supports 8 throttling states)
> [   40.358006] ACPI: SSDT 7FEE8700, 0152 (r1  PmRef  Cpu3Ist     3000
> INTL 20040311)
> [   40.358183] ACPI: CPU3 (power states: C1[C1] C2[C2])
> [   40.358187] ACPI: Processor [CPU3] (supports 8 throttling states)
> [   40.446890] usbcore: registered new interface driver usbfs
> [   40.446918] usbcore: registered new interface driver hub
> [   40.447172] usbcore: registered new device driver usb
> [   40.447849] USB Universal Host Controller Interface driver v3.0
> [   40.447904] ACPI: PCI Interrupt 0000:00:1a.0[A] -> GSI 16 (level,
> low) -> IRQ 16
> [   40.447915] PCI: Setting latency timer of device 0000:00:1a.0 to 64
> [   40.447918] uhci_hcd 0000:00:1a.0: UHCI Host Controller
> [   40.448150] uhci_hcd 0000:00:1a.0: new USB bus registered,
> assigned bus number 1
> [   40.448177] uhci_hcd 0000:00:1a.0: irq 16, io base 0x0000e100
> [   40.448271] usb usb1: configuration #1 chosen from 1 choice
> [   40.448287] hub 1-0:1.0: USB hub found
> [   40.448290] hub 1-0:1.0: 2 ports detected
> [   40.510624] SCSI subsystem initialized
> [   40.515051] libata version 3.00 loaded.
> [   40.551313] ACPI: PCI Interrupt 0000:00:1a.1[B] -> GSI 21 (level,
> low) -> IRQ 21
> [   40.551326] PCI: Setting latency timer of device 0000:00:1a.1 to 64
> [   40.551329] uhci_hcd 0000:00:1a.1: UHCI Host Controller
> [   40.551375] uhci_hcd 0000:00:1a.1: new USB bus registered,
> assigned bus number 2
> [   40.551404] uhci_hcd 0000:00:1a.1: irq 21, io base 0x0000e200
> [   40.551410] Floppy drive(s): fd0 is 1.44M
> [   40.551486] usb usb2: configuration #1 chosen from 1 choice
> [   40.551509] hub 2-0:1.0: USB hub found
> [   40.551513] hub 2-0:1.0: 2 ports detected
> [   40.568378] FDC 0 is a post-1991 82077
> [   40.651167] ACPI: PCI Interrupt 0000:00:1a.2[C] -> GSI 18 (level,
> low) -> IRQ 18
> [   40.651176] PCI: Setting latency timer of device 0000:00:1a.2 to 64
> [   40.651178] uhci_hcd 0000:00:1a.2: UHCI Host Controller
> [   40.651195] uhci_hcd 0000:00:1a.2: new USB bus registered,
> assigned bus number 3
> [   40.651218] uhci_hcd 0000:00:1a.2: irq 18, io base 0x0000e000
> [   40.651289] usb usb3: configuration #1 chosen from 1 choice
> [   40.651305] hub 3-0:1.0: USB hub found
> [   40.651308] hub 3-0:1.0: 2 ports detected
> [   40.755006] ACPI: PCI Interrupt 0000:00:1d.0[A] -> GSI 23 (level,
> low) -> IRQ 23
> [   40.755015] PCI: Setting latency timer of device 0000:00:1d.0 to 64
> [   40.755018] uhci_hcd 0000:00:1d.0: UHCI Host Controller
> [   40.755035] uhci_hcd 0000:00:1d.0: new USB bus registered,
> assigned bus number 4
> [   40.755058] uhci_hcd 0000:00:1d.0: irq 23, io base 0x0000e300
> [   40.755127] usb usb4: configuration #1 chosen from 1 choice
> [   40.755141] hub 4-0:1.0: USB hub found
> [   40.755145] hub 4-0:1.0: 2 ports detected
> [   40.786865] usb 1-1: new low speed USB device using uhci_hcd and
> address 2
> [   40.858819] ACPI: PCI Interrupt 0000:00:1d.1[B] -> GSI 19 (level,
> low) -> IRQ 19
> [   40.858827] PCI: Setting latency timer of device 0000:00:1d.1 to 64
> [   40.858831] uhci_hcd 0000:00:1d.1: UHCI Host Controller
> [   40.858852] uhci_hcd 0000:00:1d.1: new USB bus registered,
> assigned bus number 5
> [   40.858877] uhci_hcd 0000:00:1d.1: irq 19, io base 0x0000e400
> [   40.858964] usb usb5: configuration #1 chosen from 1 choice
> [   40.858979] hub 5-0:1.0: USB hub found
> [   40.858982] hub 5-0:1.0: 2 ports detected
> [   40.962653] ACPI: PCI Interrupt 0000:00:1d.2[C] -> GSI 18 (level,
> low) -> IRQ 18
> [   40.962660] PCI: Setting latency timer of device 0000:00:1d.2 to 64
> [   40.962663] uhci_hcd 0000:00:1d.2: UHCI Host Controller
> [   40.962684] uhci_hcd 0000:00:1d.2: new USB bus registered,
> assigned bus number 6
> [   40.962706] uhci_hcd 0000:00:1d.2: irq 18, io base 0x0000e500
> [   40.962792] usb usb6: configuration #1 chosen from 1 choice
> [   40.962814] hub 6-0:1.0: USB hub found
> [   40.962818] hub 6-0:1.0: 2 ports detected
> [   40.963510] usb 1-1: configuration #1 chosen from 1 choice
> [   41.066518] ACPI: PCI Interrupt 0000:00:1a.7[C] -> GSI 18 (level,
> low) -> IRQ 18
> [   41.067549] PCI: Setting latency timer of device 0000:00:1a.7 to 64
> [   41.067556] ehci_hcd 0000:00:1a.7: EHCI Host Controller
> [   41.067609] ehci_hcd 0000:00:1a.7: new USB bus registered,
> assigned bus number 7
> [   41.071529] PCI: cache line size of 32 is not supported by device
> 0000:00:1a.7
> [   41.071536] ehci_hcd 0000:00:1a.7: irq 18, io mem 0xe8205000
> [   41.087690] ehci_hcd 0000:00:1a.7: USB 2.0 started, EHCI 1.00,
> driver 10 Dec 2004
> [   41.087783] usb usb7: configuration #1 chosen from 1 choice
> [   41.087800] hub 7-0:1.0: USB hub found
> [   41.087805] hub 7-0:1.0: 6 ports detected
> [   41.191410] ACPI: PCI Interrupt 0000:00:1d.7[A] -> GSI 23 (level,
> low) -> IRQ 23
> [   41.191414] ACPI: PCI Interrupt 0000:05:00.0[A] -> GSI 20 (level,
> low) -> IRQ 20
> [   41.192217] PCI: Setting latency timer of device 0000:00:1d.7 to 64
> [   41.192222] ehci_hcd 0000:00:1d.7: EHCI Host Controller
> [   41.192272] ehci_hcd 0000:00:1d.7: new USB bus registered,
> assigned bus number 8
> [   41.196187] PCI: cache line size of 32 is not supported by device
> 0000:00:1d.7
> [   41.196192] ehci_hcd 0000:00:1d.7: irq 23, io mem 0xe8204000
> [   41.210196] ehci_hcd 0000:00:1d.7: USB 2.0 started, EHCI 1.00,
> driver 10 Dec 2004
> [   41.210837] usb usb8: configuration #1 chosen from 1 choice
> [   41.210862] hub 8-0:1.0: USB hub found
> [   41.210869] hub 8-0:1.0: 6 ports detected
> [   41.211102] ssb: Core 0 found: ChipCommon (cc 0x800, rev 0x0D,
> vendor 0x4243)
> [   41.211110] ssb: Core 1 found: IEEE 802.11 (cc 0x812, rev 0x09,
> vendor 0x4243)
> [   41.211115] ssb: Core 2 found: PCI (cc 0x804, rev 0x0C, vendor
> 0x4243)
> [   41.211119] ssb: Core 3 found: PCMCIA (cc 0x80D, rev 0x07, vendor
> 0x4243)
> [   41.250183] ssb: Sonics Silicon Backplane found on PCI device
> 0000:05:00.0
> [   41.314118] r8169 Gigabit Ethernet driver 2.2LK loaded
> [   41.314146] ACPI: PCI Interrupt 0000:04:00.0[A] -> GSI 17 (level,
> low) -> IRQ 17
> [   41.314166] PCI: Setting latency timer of device 0000:04:00.0 to 64
> [   41.314398] eth0: RTL8168c/8111c at 0xffffc200008b4000,
> 00:1f:d0:83:71:b4, XID 3c4000c0 IRQ 507
> [   41.316144] ahci 0000:00:1f.2: version 3.0
> [   41.316172] ACPI: PCI Interrupt 0000:00:1f.2[B] -> <6>ACPI: PCI
> Interrupt 0000:03:00.0[A] -> GSI 16 (level, low) -> IRQ 16
> [   41.316176] GSI 19 (level, low) -> IRQ 19
> [   41.316571] PCI: Setting latency timer of device 0000:03:00.0 to 64
> [   41.316720] scsi0 : pata_jmicron
> [   41.316783] scsi1 : pata_jmicron
> [   41.317214] ata1: PATA max UDMA/100 cmd 0xc000 ctl 0xc100
> bmdma 0xc400 irq 16
> [   41.317217] ata2: PATA max UDMA/100 cmd 0xc200 ctl 0xc300
> bmdma 0xc408 irq 16
> [   41.609567] usb 1-1: USB disconnect, address 2
> [   41.609587] usbcore: registered new interface driver hiddev
> [   41.634066] ata1.00: ATAPI: PIONEER DVD-RW  DVR-111D, 1.06, max
> UDMA/66
> [   41.805774] ata1.00: configured for UDMA/66
> [   41.967430] scsi 0:0:0:0: CD-ROM            PIONEER  DVD-RW
> DVR-111D 1.06 PQ: 0 ANSI: 5
> [   42.316463] ahci 0000:00:1f.2: AHCI 0001.0200 32 slots 6 ports 3
> Gbps 0x3f impl SATA mode
> [   42.316467] ahci 0000:00:1f.2: flags: 64bit ncq sntf stag pm led clo
> pmp pio slum part
> [   42.316472] PCI: Setting latency timer of device 0000:00:1f.2 to 64
> [   42.316695] scsi2 : ahci
> [   42.316745] scsi3 : ahci
> [   42.316783] scsi4 : ahci
> [   42.316814] scsi5 : ahci
> [   42.316843] scsi6 : ahci
> [   42.316873] scsi7 : ahci
> [   42.316941] ata3: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206100 irq 506
> [   42.316943] ata4: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206180 irq 506
> [   42.316945] ata5: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206200 irq 506
> [   42.316947] ata6: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206280 irq 506
> [   42.316949] ata7: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206300 irq 506
> [   42.316951] ata8: SATA max UDMA/133 abar m2048 at 0xe8206000
> port 0xe8206380 irq 506
> [   42.400299] usb 8-1: new high speed USB device using ehci_hcd
> and address 2
> [   42.534781] usb 8-1: configuration #1 chosen from 1 choice
> [   42.771707] usb 8-5: new high speed USB device using ehci_hcd
> and address 3
> [   42.907335] usb 8-5: configuration #1 chosen from 1 choice
> [   42.955420] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300)
> [   42.964827] ata3.00: ATA-7: WDC WD7500AAKS-00RBA0, 30.04G30,
> max UDMA/133
> [   42.964830] ata3.00: 1465149168 sectors, multi 0: LBA48 NCQ
> (depth 31/32)
> [   42.965685] ata3.00: configured for UDMA/133
> [   43.143189] usbcore: registered new interface driver usbhid
> [   43.143193] /build/buildd/linux-2.6.24/drivers/hid/usbhid/hid-core.c:
> v2.6:USB HID core driver
> [   43.143235] usbcore: registered new interface driver libusual
> [   43.145573] Initializing USB Mass Storage driver...
> [   43.383764] usb 6-2: new full speed USB device using uhci_hcd and
> address 2
> [   43.570850] usb 6-2: configuration #1 chosen from 1 choice
> [   43.580164] scsi8 : SCSI emulation for USB Mass Storage devices
> [   43.580649] usbcore: registered new interface driver usb-storage
> [   43.580651] USB Mass Storage support registered.
> [   43.580731] usb-storage: device found at 2
> [   43.580732] usb-storage: waiting for device to settle before
> scanning
> [   43.606384] ata4: SATA link up 3.0 Gbps (SStatus 123 SControl 300)
> [   43.643498] ata4.00: ATA-7: ST3160811AS, 3.AAE, max UDMA/133
> [   43.643501] ata4.00: 312581808 sectors, multi 0: LBA48 NCQ
> (depth 31/32)
> [   43.701722] ata4.00: configured for UDMA/133
> [   43.810070] usb 1-1: new low speed USB device using uhci_hcd and
> address 3
> [   43.986886] usb 1-1: configuration #1 chosen from 1 choice
> [   44.004009] input: B16_b_02 USB-PS/2 Optical Mouse as
> /devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1:1.0/input/input2
> [   44.017737] ata5: SATA link down (SStatus 0 SControl 300)
> [   44.021775] input,hidraw0: USB HID v1.10 Mouse [B16_b_02 USB-
> PS/2 Optical Mouse] on usb-0000:00:1a.0-1
> [   44.261343] usb 2-2: new full speed USB device using uhci_hcd and
> address 2
> [   44.337240] ata6: SATA link down (SStatus 0 SControl 300)
> [   44.448579] usb 2-2: configuration #1 chosen from 1 choice
> [   44.656721] ata7: SATA link down (SStatus 0 SControl 300)
> [   44.980206] ata8: SATA link down (SStatus 0 SControl 300)
> [   44.980315] scsi 2:0:0:0: Direct-Access     ATA      WDC
> WD7500AAKS-0 30.0 PQ: 0 ANSI: 5
> [   44.980429] scsi 3:0:0:0: Direct-Access     ATA      ST3160811AS
> 3.AA PQ: 0 ANSI: 5
> [   44.987269] Driver 'sd' needs updating - please use bus_type
> methods
> [   44.990425] Driver 'sr' needs updating - please use bus_type
> methods
> [   44.996723] sd 2:0:0:0: [sda] 1465149168 512-byte hardware
> sectors (750156 MB)
> [   44.996731] sd 2:0:0:0: [sda] Write Protect is off
> [   44.996733] sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00
> [   44.996744] sd 2:0:0:0: [sda] Write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
> [   44.996793] sd 2:0:0:0: [sda] 1465149168 512-byte hardware
> sectors (750156 MB)
> [   44.996835] sd 2:0:0:0: [sda] Write Protect is off
> [   44.996837] sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00
> [   44.996848] sd 2:0:0:0: [sda] Write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
> [   44.996851]  sda: sda1 sda2 sda3 sda4 < sda5sr0: scsi3-mmc
> drive: 40x/40x writer cd/rw xa/form2 cdda tray
> [   45.021368] Uniform CD-ROM driver Revision: 3.20
> [   45.021396] sr 0:0:0:0: Attached scsi CD-ROM sr0
> [   45.029173]  sda6 sda7 >
> [   45.051763] sd 2:0:0:0: [sda] Attached SCSI disk
> [   45.051817] sd 3:0:0:0: [sdb] 312581808 512-byte hardware
> sectors (160042 MB)
> [   45.051826] sd 3:0:0:0: [sdb] Write Protect is off
> [   45.051828] sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00
> [   45.051839] sd 3:0:0:0: [sdb] Write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
> [   45.051870] sd 3:0:0:0: [sdb] 312581808 512-byte hardware
> sectors (160042 MB)
> [   45.051877] sd 3:0:0:0: [sdb] Write Protect is off
> [   45.051878] sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00
> [   45.051889] sd 3:0:0:0: [sdb] Write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
> [   45.051891]  sdb: sdb1
> [   45.072117] sd 3:0:0:0: [sdb] Attached SCSI disk
> [   45.074906] sr 0:0:0:0: Attached scsi generic sg0 type 5
> [   45.074921] sd 2:0:0:0: Attached scsi generic sg1 type 0
> [   45.074935] sd 3:0:0:0: Attached scsi generic sg2 type 0
> [   45.363886] Attempting manual resume
> [   45.363889] swsusp: Resume From Partition 8:3
> [   45.363890] PM: Checking swsusp image.
> [   45.364021] PM: Resume from disk failed.
> [   45.383661] kjournald starting.  Commit interval 5 seconds
> [   45.383670] EXT3-fs: mounted filesystem with ordered data mode.
> [   48.574741] usb-storage: device scan complete
> [   48.575617] scsi 8:0:0:0: Direct-Access     JetFlash TS2GJFV90
> 1100 PQ: 0 ANSI: 0 CCS
> [   48.576849] sd 8:0:0:0: [sdc] 3964928 512-byte hardware sectors
> (2030 MB)
> [   48.577602] sd 8:0:0:0: [sdc] Write Protect is off
> [   48.577604] sd 8:0:0:0: [sdc] Mode Sense: 43 00 00 00
> [   48.577606] sd 8:0:0:0: [sdc] Assuming drive cache: write through
> [   48.580349] sd 8:0:0:0: [sdc] 3964928 512-byte hardware sectors
> (2030 MB)
> [   48.581095] sd 8:0:0:0: [sdc] Write Protect is off
> [   48.581097] sd 8:0:0:0: [sdc] Mode Sense: 43 00 00 00
> [   48.581102] sd 8:0:0:0: [sdc] Assuming drive cache: write through
> [   48.581105]  sdc: sdc1
> [   48.581790] sd 8:0:0:0: [sdc] Attached SCSI removable disk
> [   48.581820] sd 8:0:0:0: Attached scsi generic sg3 type 0
> [   50.548051] input: Power Button (FF) as /devices/virtual/input/input3
> [   50.575022] input: PC Speaker as
> /devices/platform/pcspkr/input/input4
> [   50.579833] ACPI: Power Button (FF) [PWRF]
> [   50.579882] input: Power Button (CM) as
> /devices/virtual/input/input5
> [   50.632228] ACPI: Power Button (CM) [PWRB]
> [   50.664511] pci_hotplug: PCI Hot Plug PCI Core version: 0.5
> [   50.666668] shpchp: Standard Hot Plug PCI Controller Driver
> version: 0.4
> [   50.741101] Linux video capture interface: v2.00
> [   50.925931] udev: renamed network interface eth0 to eth2
> [   51.100198] saa7130/34: v4l2 driver version 0.2.14 loaded
> [   51.100261] ACPI: PCI Interrupt 0000:05:01.0[A] -> GSI 19 (level,
> low) -> IRQ 19
> [   51.100268] saa7133[0]: found at 0000:05:01.0, rev: 209, irq: 19,
> latency: 32, mmio: 0xe8102000
> [   51.100273] saa7133[0]: subsystem: 1461:9715, board: Avermedia
> AVerTV Studio 507 [card=102,autodetected]
> [   51.100281] saa7133[0]: board init: gpio is 208
> [   51.100331] input: saa7134 IR (Avermedia AVerTV St as
> /devices/pci0000:00/0000:00:1e.0/0000:05:01.0/input/input6
> [   51.278783] fglrx: module license 'Proprietary. (C) 2002 - ATI
> Technologies, Starnberg, GERMANY' taints kernel.
> [   51.287369] saa7133[0]: i2c eeprom 00: 61 14 15 97 ff ff ff ff ff ff ff
> ff ff ff ff ff
> [   51.287376] saa7133[0]: i2c eeprom 10: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.287381] saa7133[0]: i2c eeprom 20: ff f1 f7 ff ff ff ff ff ff ff ff ff ff
> ff ff ff
> [   51.287386] saa7133[0]: i2c eeprom 30: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.287390] saa7133[0]: i2c eeprom 40: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.287395] saa7133[0]: i2c eeprom 50: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.287399] saa7133[0]: i2c eeprom 60: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.287404] saa7133[0]: i2c eeprom 70: ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> ff ff
> [   51.293138] [fglrx]   vendor: 1002 device: 9505 count: 1
> [   51.293242] [fglrx] Maximum main memory to use for locked dma
> buffers: 1886 MBytes.
> [   51.294927] [fglrx] PAT is enabled successfully!
> [   51.294954] [fglrx] module loaded - fglrx 8.50.3 [Jun  2 2008] with 1
> minors
> [   51.379676] /build/buildd/linux-ubuntu-
> modules-2.6.24-2.6.24/debian/build/build-
> generic/media/gspcav1/gspca_core.c: USB GSPCA camera found.
> (ZC3XX)
> [   51.395944] parport_pc 00:09: reported by Plug and Play ACPI
> [   51.395989] parport0: PC-style at 0x378, irq 7 [PCSPP,TRISTATE]
> [   51.411803] usblp0: USB Bidirectional printer dev 2 if 0 alt 0 proto 2
> vid 0x03F0 pid 0x8104
> [   51.471480] tuner 0-0043: chip found @ 0x86 (saa7133[0])
> [   51.471508] tda9887 0-0043: tda988[5/6/7] found @ 0x43 (tuner)
> [   51.471510] tuner 0-0043: type set to tda9887
> [   51.479495] tuner 0-0061: chip found @ 0xc2 (saa7133[0])
> [   51.479511] tuner-simple 0-0061: type set to 51 (Philips
> PAL/SECAM_D (FM 1256 I-H3))
> [   51.479513] tuner 0-0061: type set to Philips PAL/SECAM_D
> [   51.479515] tuner-simple 0-0061: type set to 51 (Philips
> PAL/SECAM_D (FM 1256 I-H3))
> [   51.479517] tuner 0-0061: type set to Philips PAL/SECAM_D
> [   51.484768] saa7133[0]: registered device video0 [v4l2]
> [   51.484785] saa7133[0]: registered device vbi0
> [   51.484803] saa7133[0]: registered device radio0
> [   51.485075] ACPI: PCI Interrupt 0000:00:1b.0[A] -> GSI 22 (level,
> low) -> IRQ 22
> [   51.485924] PCI: Setting latency timer of device 0000:00:1b.0 to 64
> [   51.506754] b43-phy0: Broadcom 4318 WLAN found
> [   51.515483] saa7134 ALSA driver for DMA sound loaded
> [   51.515503] saa7133[0]/alsa: saa7133[0] at 0xe8102000 irq 19
> registered as card -2
> [   51.550307] b43-phy0 debug: Found PHY: Analog 3, Type 2, Revision
> 7
> [   51.550316] b43-phy0 debug: Found Radio: Manuf 0x17F, Version
> 0x2050, Revision 8
> [   51.556633] ACPI: PCI Interrupt 0000:01:00.1[B] -> GSI 17 (level,
> low) -> IRQ 17
> [   51.557531] PCI: Setting latency timer of device 0000:01:00.1 to 64
> [   51.581885] phy0: Selected rate control algorithm 'simple'
> [   52.011004] usbcore: registered new interface driver gspca
> [   52.011010] /build/buildd/linux-ubuntu-
> modules-2.6.24-2.6.24/debian/build/build-
> generic/media/gspcav1/gspca_core.c: gspca driver 01.00.20
> registered
> [   52.013557] usbcore: registered new interface driver usblp
> [   52.061119] usbcore: registered new interface driver snd-usb-audio
> [   52.196317] lp0: using parport0 (interrupt-driven).
> [   52.234167] it87: Found IT8718F chip at 0x290, revision 5
> [   52.234174] it87: in3 is VCC (+5V)
> [   52.244334] coretemp coretemp.0: Using undocumented features,
> absolute temperature might be wrong!
> [   52.244373] coretemp coretemp.1: Using undocumented features,
> absolute temperature might be wrong!
> [   52.244399] coretemp coretemp.2: Using undocumented features,
> absolute temperature might be wrong!
> [   52.244428] coretemp coretemp.3: Using undocumented features,
> absolute temperature might be wrong!
> [   52.310763] Adding 2104504k swap on /dev/sda3.  Priority:-1
> extents:1 across:2104504k
> [   52.851788] EXT3 FS on sda5, internal journal
> [   52.953148] device-mapper: uevent: version 1.0.3
> [   52.953174] device-mapper: ioctl: 4.12.0-ioctl (2007-10-02)
> initialised: dm-devel at redhat.com
> [   53.771478] kjournald starting.  Commit interval 5 seconds
> [   53.771712] EXT3 FS on sda6, internal journal
> [   53.771717] EXT3-fs: mounted filesystem with ordered data mode.
> [   54.444680] kjournald starting.  Commit interval 5 seconds
> [   54.444688] EXT3-fs warning: maximal mount count reached,
> running e2fsck is recommended
> [   54.450810] EXT3 FS on sdb1, internal journal
> [   54.450816] EXT3-fs: mounted filesystem with ordered data mode.
> [   54.872248] ip_tables: (C) 2000-2006 Netfilter Core Team
> [   54.987735] nf_conntrack version 0.5.0 (16384 buckets, 65536
> max)
> [   55.407736] No dock devices found.
> [   56.256977] NET: Registered protocol family 10
> [   56.257224] lo: Disabled Privacy Extensions
> [   58.083149] ppdev: user-space parallel port driver
> [   58.216460] audit(1221055222.094:2): type=1503
> operation="inode_permission" requested_mask="a::"
> denied_mask="a::" name="/dev/tty" pid=6216
> profile="/usr/sbin/cupsd" namespace="default"
> [   59.983811] vboxdrv: Trying to deactivate the NMI watchdog
> permanently...
> [   59.983819] vboxdrv: Successfully done.
> [   59.984074] vboxdrv: TSC mode is 'synchronous', kernel timer mode
> is 'normal'.
> [   59.984077] vboxdrv: Successfully loaded version 1.5.6_OSE
> (interface 0x00050002).
> [   64.043410] input: b43-phy0 as /devices/virtual/input/input7
> [   64.093550] Bluetooth: Core ver 2.11
> [   64.093778] NET: Registered protocol family 31
> [   64.093782] Bluetooth: HCI device and connection manager
> initialized
> [   64.093787] Bluetooth: HCI socket layer initialized
> [   64.101982] Bluetooth: L2CAP ver 2.9
> [   64.101987] Bluetooth: L2CAP socket layer initialized
> [   64.147942] Bluetooth: RFCOMM socket layer initialized
> [   64.147958] Bluetooth: RFCOMM TTY layer initialized
> [   64.147960] Bluetooth: RFCOMM ver 1.8
> [   64.410659] b43-phy0 debug: Loading firmware version 351.126
> (2006-07-29 05:54:02)
> [   65.407047] b43-phy0 debug: Chip initialized
> [   65.407198] b43-phy0 debug: 32-bit DMA initialized
> [   65.424104] Registered led device: b43-phy0:tx
> [   65.424122] Registered led device: b43-phy0:rx
> [   65.424136] Registered led device: b43-phy0:assoc
> [   65.424151] Registered led device: b43-phy0:radio
> [   65.424180] b43-phy0 debug: Wireless interface started
> [   65.424189] b43-phy0 debug: Adding Interface type 2
> [   65.428126] ADDRCONF(NETDEV_UP): wlan0: link is not ready
> [   65.506537] r8169: eth2: link up
> [   65.506548] r8169: eth2: link up
> [   66.509562] ACPI: PCI Interrupt 0000:01:00.0[A] -> GSI 16 (level,
> low) -> IRQ 16
> [   68.043308] [fglrx] Reserved FB block: Shared offset:0, size:1000000
> [   68.043315] [fglrx] Reserved FB block: Unshared offset:ff7f000,
> size:80000
> [   76.286517] eth2: no IPv6 routers present
> [  110.180625] NET: Registered protocol family 17
> [  111.240614] wlan0: Initial auth_alg=0
> [  111.240623] wlan0: authenticate with AP 00:1a:92:d3:be:3a
> [  111.242043] wlan0: RX authentication from 00:1a:92:d3:be:3a
> (alg=0 transaction=2 status=0)
> [  111.242047] wlan0: authenticated
> [  111.242051] wlan0: associate with AP 00:1a:92:d3:be:3a
> [  111.244444] wlan0: RX AssocResp from 00:1a:92:d3:be:3a
> (capab=0x401 status=0 aid=2)
> [  111.244449] wlan0: associated
> [  111.244453] wlan0: switched to short barker preamble
> (BSSID=00:1a:92:d3:be:3a)
> [  111.244490] wlan0: WMM queue=2 aci=0 acm=0 aifs=3 cWmin=15
> cWmax=1023 burst=0
> [  111.244495] wlan0: WMM queue=3 aci=1 acm=0 aifs=7 cWmin=15
> cWmax=1023 burst=0
> [  111.244499] wlan0: WMM queue=1 aci=2 acm=0 aifs=2 cWmin=7
> cWmax=15 burst=30
> [  111.244503] wlan0: WMM queue=0 aci=3 acm=0 aifs=2 cWmin=3
> cWmax=7 burst=15
> [  111.247515] ADDRCONF(NETDEV_CHANGE): wlan0: link becomes
> ready
> [  121.718441] wlan0: no IPv6 routers present
> [  156.319638] wlan0: deauthenticate(reason=3)
> [ 1867.955895] wlan0: No ProbeResp from current AP
> 00:1a:92:d3:be:3a - assume out of range
>
> I use AP with Open Auth without encryption.
>
>
>
>
>
>
>
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>
>

I have the exact same card, and it works fine with b43. However, I am
using 2.6.26, and important 138G V2-specific fixes were added in
2.6.25.1. (Without the fix, the card refuses to transmit.) So, you
should upgrade your kernel to 2.6.25.x or newer.

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From navalorenx at gmail.com  Wed Sep 10 22:34:36 2008
From: navalorenx at gmail.com (Lorenzo Nava)
Date: Wed, 10 Sep 2008 22:34:36 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <200809102219.42932.mb@bu3sch.de>
References: <200809061621.48449.mb@bu3sch.de> <200809101600.53777.mb@bu3sch.de>
	<D3082ED8-F925-4AD3-8230-F0434162DDF6@gmail.com>
	<200809102219.42932.mb@bu3sch.de>
Message-ID: <249B3A71-B537-4A17-91AD-58408D382AA5@gmail.com>

>
> I'm not a reverse engineer, so I have no chance to check the original
> code to agree (or not) with you.
>
Ok, the mail has Johannes in Cc. I hope that he can tell me if me and  
Francesco are right or not.
Johannes please check it (I mean specs at http://bcm-v4.sipsolutions.net/802.11/QoS) 
, thank you.

regards

Lorenzo
> -- 
> Greetings Michael.



From peter at stuge.se  Thu Sep 11 01:14:29 2008
From: peter at stuge.se (Peter Stuge)
Date: Thu, 11 Sep 2008 01:14:29 +0200
Subject: The A in 4311AG
Message-ID: <20080910231429.26512.qmail@stuge.se>

Hello list.

I'm looking at buying an HP laptop which HP claims has "4311AG" wifi.

I like to use .11a whenever possible and was a little sad to see that
b43 doesn't support it.

I am curious about why. "Just" lack of resources, or something more
technical?

Maybe I'll be able to help, in any case.

Really lovely work on getting an open firmware going, Michael.


//Peter


From tjaviss at gmail.com  Thu Sep 11 05:15:20 2008
From: tjaviss at gmail.com (Tyler Aviss)
Date: Wed, 10 Sep 2008 23:15:20 -0400
Subject: BCM4322 Info
In-Reply-To: <48C7F90C.4080006@lwfinger.net>
References: <3a97ef0809100730i4bfde2e5yf60849f3dcf1fa0a@mail.gmail.com>
	<48C7F90C.4080006@lwfinger.net>
Message-ID: <3a97ef0809102015l361a0d3al6ecd4be312c11e7e@mail.gmail.com>

According to the specs on the actual laptop, it's a "Draft N" router.
I had thought that the b/g part would be pretty much the same as other
adaptors (and work) with the "N" part being added functionality (that
I can't use regardless, since my router is only B/G). However I
haven't had much luck getting the sucker to work under linux just yet,
except for the works-but-disconnects-regularly driver supplied by
Broadcomm.

I was hoping to at least have some luck with ndiswrapper but even that
one hasn't been giving me much love with this card. Luckily I've got
an old USB-G adaptor kicking around that I can use in the meantime.

Let me know if there's any other information you need...

Here's the dump from "lspci -vv"


08:00.0 Network controller: Broadcom Corporation BCM4322 802.11a/b/g/n
Wireless LAN Controller (rev 01)
        Subsystem: Hewlett-Packard Company Unknown device 137f
        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop-
ParErr- Stepping- SERR- FastB2B-
        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR-
        Latency: 0
        Interrupt: pin A routed to IRQ 7
        Region 0: Memory at d1100000 (64-bit, non-prefetchable) [size=16K]
        Capabilities: [40] Power Management version 3
                Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA
PME(D0-,D1-,D2-,D3hot-,D3cold-)
                Status: D0 PME-Enable- DSel=0 DScale=2 PME-
        Capabilities: [58] Vendor Specific Information
        Capabilities: [e8] Message Signalled Interrupts: Mask- 64bit+
Queue=0/0 Enable-
                Address: 0000000000000000  Data: 0000
        Capabilities: [d0] Express Endpoint IRQ 0
                Device: Supported: MaxPayload 128 bytes, PhantFunc 0, ExtTag+
                Device: Latency L0s <4us, L1 unlimited
                Device: AtnBtn- AtnInd- PwrInd-
                Device: Errors: Correctable- Non-Fatal- Fatal- Unsupported-
                Device: RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop-
                Device: MaxPayload 128 bytes, MaxReadReq 128 bytes
                Link: Supported Speed 2.5Gb/s, Width x1, ASPM L0s L1, Port 0
                Link: Latency L0s <4us, L1 <64us
                Link: ASPM L0s L1 Enabled RCB 64 bytes CommClk+ ExtSynch-
                Link: Speed 2.5Gb/s, Width x1
        Capabilities: [100] Advanced Error Reporting
        Capabilities: [13c] Virtual Channel
        Capabilities: [160] Device Serial Number 21-00-36-ff-ff-00-be-89
        Capabilities: [16c] Power Budgeting

And from "lspci -nvv"

08:00.0 0280: 14e4:432b (rev 01)
        Subsystem: 103c:137f
        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop-
ParErr- Stepping- SERR- FastB2B-
        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort-
<TAbort- <MAbort- >SERR- <PERR-
        Latency: 0
        Interrupt: pin A routed to IRQ 7
        Region 0: Memory at d1100000 (64-bit, non-prefetchable) [size=16K]
        Capabilities: [40] Power Management version 3
                Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA
PME(D0-,D1-,D2-,D3hot-,D3cold-)
                Status: D0 PME-Enable- DSel=0 DScale=2 PME-
        Capabilities: [58] Vendor Specific Information
        Capabilities: [e8] Message Signalled Interrupts: Mask- 64bit+
Queue=0/0 Enable-
                Address: 0000000000000000  Data: 0000
        Capabilities: [d0] Express Endpoint IRQ 0
                Device: Supported: MaxPayload 128 bytes, PhantFunc 0, ExtTag+
                Device: Latency L0s <4us, L1 unlimited
                Device: AtnBtn- AtnInd- PwrInd-
                Device: Errors: Correctable- Non-Fatal- Fatal- Unsupported-
                Device: RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop-
                Device: MaxPayload 128 bytes, MaxReadReq 128 bytes
                Link: Supported Speed 2.5Gb/s, Width x1, ASPM L0s L1, Port 0
                Link: Latency L0s <4us, L1 <64us
                Link: ASPM L0s L1 Enabled RCB 64 bytes CommClk+ ExtSynch-
                Link: Speed 2.5Gb/s, Width x1
        Capabilities: [100] Advanced Error Reporting
        Capabilities: [13c] Virtual Channel
        Capabilities: [160] Device Serial Number 21-00-36-ff-ff-00-be-89
        Capabilities: [16c] Power Budgeting


Let me know if there's any other info I can provide.


- TJA

On Wed, Sep 10, 2008 at 12:42 PM, Larry Finger
<Larry.Finger at lwfinger.net> wrote:
> Tyler Aviss wrote:
>>
>> Hey All,
>>
>>
>> First of all, a quick introduction of myself. In general, I'm more of
>> a sysadmin than a kernel developer, though in the odd case I've
>> tracked down a few driver or FOSS-project bugs here and there (webcams
>> and gatekeeper proejcts, small bugs usually caused by simple
>> mistakes). So while I've never really delved heavily into writing
>> drivers, I can at least do a step-by-step testing in many cases.
>>
>> I'm joining the list because:
>>
>> a) I have a bunch of laptops with Broadcomm cards, which - thanks to
>> you developers - now happily work without me needing to use
>> NDISwrapper
>> b) I have a newer laptop with a Broadcomm card which seems to be
>> something of an enigma at the moment.
>>
>> Now onward to (b), and what is currently one of the driving causes
>> behind my joining this list. I notice that on the "LinuxWireless"
>> page, the origins/status of the BCM4322 chipset seems to be somewhat
>> unknown. The current comment in the unsupported section is:
>>
>> * BCM 4322 - We are working on support for this device (FIXME: what
>> the hell is a BCM4322? ?mb)
>>
>> I'd be happy to lend and support I can in supplying info/dumps/etc and
>> testing the driver on this chipset as needed. Broadcomm actually has
>> their own Linux/closed-source driver that somewhat works for this
>> chipset (wl), but at the moment it's buggy as heck and tends to
>> regularly disconnect and reconnect. I'd love to see the B43 driver get
>> this chipset working, both so that I can have a working card and so
>> that users can use a "true" FOSS driver rather than a buggy
>> closed-source one.
>
> When you issue an 'lspci -nnv' for one of these devices, what is the PCI ID
> for the BCM4322?
>
> I suspect that this is an 802.11n device. If so, the reverse engineering for
> this device is going slowly. We had one person working on decompiling a MIPS
> Broadcom driver, but he has been busy with other things lately. I have been
> busy with working on the LP PHY (an 802.11g variant) for a couple of reasons
> - it is a lot more like the other G PHYs, and I personally have one of the
> devices. Once the LP PHY is working, then I will start on the N PHY code.
>
> Larry
>



-- 
Tyler Aviss
Systems Support
LPIC/LPIC-2
(647) 302-0942


From Larry.Finger at lwfinger.net  Thu Sep 11 05:28:30 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 10 Sep 2008 22:28:30 -0500
Subject: BCM4322 Info
In-Reply-To: <3a97ef0809102015l361a0d3al6ecd4be312c11e7e@mail.gmail.com>
References: <3a97ef0809100730i4bfde2e5yf60849f3dcf1fa0a@mail.gmail.com>	
	<48C7F90C.4080006@lwfinger.net>
	<3a97ef0809102015l361a0d3al6ecd4be312c11e7e@mail.gmail.com>
Message-ID: <48C8905E.20103@lwfinger.net>

Tyler Aviss wrote:
> According to the specs on the actual laptop, it's a "Draft N" router.
> I had thought that the b/g part would be pretty much the same as other
> adaptors (and work) with the "N" part being added functionality (that
> I can't use regardless, since my router is only B/G). However I
> haven't had much luck getting the sucker to work under linux just yet,
> except for the works-but-disconnects-regularly driver supplied by
> Broadcomm.
> 
> I was hoping to at least have some luck with ndiswrapper but even that
> one hasn't been giving me much love with this card. Luckily I've got
> an old USB-G adaptor kicking around that I can use in the meantime.
> 
> Let me know if there's any other information you need...

For the moment, what you sent is sufficient. Thanks.

Unfortunately, the programming of the b/g part is different for the N 
PHY devices than it is for the G PHY units.

Larry


From Larry.Finger at lwfinger.net  Thu Sep 11 05:37:48 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 10 Sep 2008 22:37:48 -0500
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <249B3A71-B537-4A17-91AD-58408D382AA5@gmail.com>
References: <200809061621.48449.mb@bu3sch.de>
	<200809101600.53777.mb@bu3sch.de>	<D3082ED8-F925-4AD3-8230-F0434162DDF6@gmail.com>	<200809102219.42932.mb@bu3sch.de>
	<249B3A71-B537-4A17-91AD-58408D382AA5@gmail.com>
Message-ID: <48C8928C.2080707@lwfinger.net>

Lorenzo Nava wrote:
>> I'm not a reverse engineer, so I have no chance to check the original
>> code to agree (or not) with you.
>>
> Ok, the mail has Johannes in Cc. I hope that he can tell me if me and  
> Francesco are right or not.
> Johannes please check it (I mean specs at http://bcm-v4.sipsolutions.net/802.11/QoS) 
> , thank you.

It took me a while to find it, but the definitive statement is in the 
structure that defines the EDCF Q info array. It contains 16 2-byte 
words. The first 8 match the variables in the page mentioned above, 
and the last 8 are padding. Lorenzo and Francesco are right.

I have modified the specs to conform to this finding.

Larry




From alexeisergeev at gmail.com  Thu Sep 11 13:17:20 2008
From: alexeisergeev at gmail.com (Alexei Sergeev)
Date: Thu, 11 Sep 2008 15:17:20 +0400
Subject: [update] Asus 138G v2
Message-ID: <200809111517.29568.alexeisergeev@gmail.com>

This is not about b43 drivers, but I just want you to know that I bought D-
Link DWA-520 and it work out of box with Kubunu8.04 hardy. So I'm not 
interested in Asus 138G v2 anymore.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080911/2e447f5a/attachment.pgp>

From gavron at wetwork.net  Thu Sep 11 13:26:47 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Thu, 11 Sep 2008 04:26:47 -0700
Subject: [update] Asus 138G v2
In-Reply-To: <200809111517.29568.alexeisergeev@gmail.com>
References: <200809111517.29568.alexeisergeev@gmail.com>
Message-ID: <48C90077.504@wetwork.net>

> This is not about b43 drivers, but I just want you to know that I bought D-
> Link DWA-520 and it work out of box with Kubunu8.04 hardy. So I'm not 
> interested in Asus 138G v2 anymore.

This is not about helicopters, but I just want you to know that I'm 
selling my TigerHawke Raptor 60, and it works out of the box (RTF).  So 
I'm not interested in Bell 222 mockups that look like Airwolf Anymore.

Aw, who am I kidding.  Yeah, bring on a turbine-powered Airwolf.

Ehud
P.S. There is no technical content relating to b43 in this posting.  I 
apologize profusely in advance.


From mark.hagger at m-spatial.com  Thu Sep 11 13:38:28 2008
From: mark.hagger at m-spatial.com (Mark Hagger)
Date: Thu, 11 Sep 2008 12:38:28 +0100
Subject: [update] Asus 138G v2
In-Reply-To: <48C90077.504@wetwork.net>
References: <200809111517.29568.alexeisergeev@gmail.com>
	<48C90077.504@wetwork.net>
Message-ID: <1221133108.18087.56.camel@giga.cambridge.m-spatial.com>

On Thu, 2008-09-11 at 04:26 -0700, gavron at wetwork.net wrote:
> This is not about helicopters, but I just want you to know that I'm 
> selling my TigerHawke Raptor 60, and it works out of the box (RTF).  So 
> I'm not interested in Bell 222 mockups that look like Airwolf Anymore.
> 
> Aw, who am I kidding.  Yeah, bring on a turbine-powered Airwolf.
> 
> Ehud
> P.S. There is no technical content relating to b43 in this posting.  I 
> apologize profusely in advance.

Oh, so you're telling me that the story about Airwolf's computers
running Linux and using b43 driver based Broadcom wifi networks for
internal communications aren't true then?

I don't believe you, next you'll be saying that a helicopter that can do
Mach 2 isn't theoretically possible.

Mark



________________________________________________________________________
This email has been scanned for all known viruses by the MessageLabs SkyScan service.


From mb at bu3sch.de  Thu Sep 11 14:49:03 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 11 Sep 2008 14:49:03 +0200
Subject: [PATCH] b43: Fix QoS defaults
In-Reply-To: <48C8928C.2080707@lwfinger.net>
References: <200809061621.48449.mb@bu3sch.de>
	<249B3A71-B537-4A17-91AD-58408D382AA5@gmail.com>
	<48C8928C.2080707@lwfinger.net>
Message-ID: <200809111449.03974.mb@bu3sch.de>

On Thursday 11 September 2008 05:37:48 Larry Finger wrote:
> Lorenzo Nava wrote:
> >> I'm not a reverse engineer, so I have no chance to check the original
> >> code to agree (or not) with you.
> >>
> > Ok, the mail has Johannes in Cc. I hope that he can tell me if me and  
> > Francesco are right or not.
> > Johannes please check it (I mean specs at http://bcm-v4.sipsolutions.net/802.11/QoS) 
> > , thank you.
> 
> It took me a while to find it, but the definitive statement is in the 
> structure that defines the EDCF Q info array. It contains 16 2-byte 
> words. The first 8 match the variables in the page mentioned above, 
> and the last 8 are padding. Lorenzo and Francesco are right.
> 
> I have modified the specs to conform to this finding.

Can somebody who cares please send a patch to John Linville,
for inclusion in the next merge window?

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 11 14:53:40 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 11 Sep 2008 14:53:40 +0200
Subject: The A in 4311AG
In-Reply-To: <20080910231429.26512.qmail@stuge.se>
References: <20080910231429.26512.qmail@stuge.se>
Message-ID: <200809111453.41142.mb@bu3sch.de>

On Thursday 11 September 2008 01:14:29 Peter Stuge wrote:
> I'm looking at buying an HP laptop which HP claims has "4311AG" wifi.
> 
> I like to use .11a whenever possible and was a little sad to see that
> b43 doesn't support it.
> 
> I am curious about why. "Just" lack of resources, or something more
> technical?
> 
> Maybe I'll be able to help, in any case.

Nobody is reverse engineering and nobody is implementing this.
None of the current team members are really interested in 802.11a.

> Really lovely work on getting an open firmware going, Michael.

Yeah, thanks.
It's currently suspended, however :)

-- 
Greetings Michael.


From gavron at wetwork.net  Thu Sep 11 15:02:22 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Thu, 11 Sep 2008 06:02:22 -0700
Subject: [update] Asus 138G v2
In-Reply-To: <1221133108.18087.56.camel@giga.cambridge.m-spatial.com>
References: <200809111517.29568.alexeisergeev@gmail.com>
	<48C90077.504@wetwork.net>
	<1221133108.18087.56.camel@giga.cambridge.m-spatial.com>
Message-ID: <48C916DE.4000006@wetwork.net>

Mark Hagger wrote:
> On Thu, 2008-09-11 at 04:26 -0700, gavron at wetwork.net wrote:
>   
>> This is not about helicopters, but I just want you to know that I'm 
>> selling my TigerHawke Raptor 60, and it works out of the box (RTF).  So 
>> I'm not interested in Bell 222 mockups that look like Airwolf Anymore
...
>
> I don't believe you, next you'll be saying that a helicopter that can do
> Mach 2 isn't theoretically possible.
>
> Mark
>
>   
The differing speed between the leading edge and a trailing edge of a 
rotating aerofoil where not only is the difference in excess of the 
speed of Sound (sonic boom) but the Cyclick may encounter a sonic boom 
on the control surfaces during normal maneoeuvers depending on V-x where 
V is the absolete speed in a vector and x is the speed back or sideways 
such that the speed of Sound is crossed.

A rotatry wing was not constructed for that.

So to answer your comment, if you can get a rotary winng to Mach 1 you 
can get it to Mach 2.

In fact if you have a SUFFICCIENTLY SLOW rotary wing, you SCRAMjet it to 
MACH2+, and then the trailing edge will still be higher than mach 1 so 
you'll be ok.

Back to b43 it is.

Ehud
> ________________________________________________________________________
> This email has been scanned for all known viruses by the MessageLabs SkyScan service.
>   



From navalorenx at gmail.com  Thu Sep 11 15:06:24 2008
From: navalorenx at gmail.com (Lorenzo Nava)
Date: Thu, 11 Sep 2008 15:06:24 +0200
Subject: [PATCH] b43: fix QoS parameters initialization
Message-ID: <A3B19C99-DDA8-4622-ADA1-79CD9B81A19B@gmail.com>

This fixes the initialization of QoS parameters.

Reported-by: Lorenzo Nava, Francesco Gringoli
Signed-off-by: Francesco Gringoli <francesco.gringoli at ing.unibs.it>


Index: wireless-testing/drivers/net/wireless/b43/b43.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/b43.h
+++ wireless-testing/drivers/net/wireless/b43/b43.h
@@ -569,7 +569,7 @@
  #define B43_QOS_VOICE		B43_QOS_PARAMS(3)

  /* QOS parameter hardware data structure offsets. */
-#define B43_NR_QOSPARAMS	22
+#define B43_NR_QOSPARAMS	16
  enum {
  	B43_QOSPARAM_TXOP = 0,
  	B43_QOSPARAM_CWMIN,


From Larry.Finger at lwfinger.net  Thu Sep 11 15:24:02 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 11 Sep 2008 08:24:02 -0500
Subject: [PATCH] b43: fix QoS parameters initialization
In-Reply-To: <A3B19C99-DDA8-4622-ADA1-79CD9B81A19B@gmail.com>
References: <A3B19C99-DDA8-4622-ADA1-79CD9B81A19B@gmail.com>
Message-ID: <48C91BF2.40402@lwfinger.net>

Lorenzo Nava wrote:
> This fixes the initialization of QoS parameters.
> 
> Reported-by: Lorenzo Nava, Francesco Gringoli
> Signed-off-by: Francesco Gringoli <francesco.gringoli at ing.unibs.it>
> 
Acked-by: Larry Finger <Larry.finger at lwfinger.net>
---

John,

This is 2.6.28 material.

Larry



From mb at bu3sch.de  Thu Sep 11 15:36:48 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 11 Sep 2008 15:36:48 +0200
Subject: [PATCH] b43: fix QoS parameters initialization
In-Reply-To: <48C91BF2.40402@lwfinger.net>
References: <A3B19C99-DDA8-4622-ADA1-79CD9B81A19B@gmail.com>
	<48C91BF2.40402@lwfinger.net>
Message-ID: <200809111536.48720.mb@bu3sch.de>

On Thursday 11 September 2008 15:24:02 Larry Finger wrote:
> Lorenzo Nava wrote:
> > This fixes the initialization of QoS parameters.
> > 
> > Reported-by: Lorenzo Nava, Francesco Gringoli
> > Signed-off-by: Francesco Gringoli <francesco.gringoli at ing.unibs.it>
> > 
> Acked-by: Larry Finger <Larry.finger at lwfinger.net>
> ---
> 
> John,
> 
> This is 2.6.28 material.

ack

-- 
Greetings Michael.


From ccmcphe at verizon.net  Thu Sep 11 23:12:23 2008
From: ccmcphe at verizon.net (Tex)
Date: Thu, 11 Sep 2008 17:12:23 -0400
Subject: bcm-43xx for bcm-4328
In-Reply-To: <200809011337.m81Dbca5016108@mi1.bluebottle.com>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
Message-ID: <48C989B7.2020004@verizon.net>

Sean Hodges wrote:
> Holger,
>
> Thanks for your response, it clears a lot of things up.
> wireless.kernel.org is the resource I was looking for.
>
> Sean
>
> On Mon, 2008-09-01 at 14:52 +0200, Holger Schurig wrote:
>   
>>> http://bcm43xx.berlios.de/?go=devices
>>>
>>> In fact, I would suggest that this is the most common starting
>>> point for anyone who does not know much about wireless drivers
>>> and would prefer to avoid asking FAQ's on discussion forums.
>>>       
>> I tend to disagree.
>>
>> First thing: bcm43xx is outdated. The in-kernel b43 driver is 
>> state-if-the-art.
>>
>> Second thing: when a driver is in-kernel, I'd suggest that the 
>> driver-webpage contents get's transferred to the central place 
>> for all in-kernel-drivers, and that would be 
>> http://wireless.kernel.org.
>>
>>
>>
>> The main page of bcm43xx (http://bcm43xx.berlios.de/?go=home) 
>> even states both things: "This site won't be updated anymore. 
>> Please check the b43 driver page at linuxwireless.org for 
>> up-to-date information.".
>>
>> ("linuxwireless.org" is an alias to "wireless.kernel.org", the 
>> now canonical web address).
>>
>>     
>>> This page does not list BCM4328 anywhere 
>>>       
>> That's because the web page you referred to doesn't get updated 
>> anymore. 4328 is mentioned on 
>> http://linuxwireless.org/en/users/Drivers/b43, thought.
>>
>>
>>
>>
>> As to the "make more accessible to less technical oriented 
>> people" I don't have a good answer. Maybe this is the job of 
>> SuSE, RedHat, Debian, Ubuntu, ...  Not sure about that.
>>     
>
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>
>   
Broadcom's reference driver for PCI ID 4328 , 4321 can be downloaded at 
http://www.broadcom.com/support/802.11/linux_sta.php . I haven't tried 
it yet, your on your own with this driver..

-Tex



From Larry.Finger at lwfinger.net  Fri Sep 12 00:00:58 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 11 Sep 2008 17:00:58 -0500
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48C989B7.2020004@verizon.net>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>	<48BB20FD.9020308@gmail.com>	<200809011142.m81BgpPv013613@mi0.bluebottle.com>	<200809011452.19651.hs4233@mail.mn-solutions.de>	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
	<48C989B7.2020004@verizon.net>
Message-ID: <48C9951A.3090501@lwfinger.net>

Tex wrote:
> Broadcom's reference driver for PCI ID 4328 , 4321 can be downloaded at 
> http://www.broadcom.com/support/802.11/linux_sta.php . I haven't tried 
> it yet, your on your own with this driver..

The reports I get from the openSUSE and Ubuntu lists are that this 
driver continually disconnects, if it works at all, and locks up the 
system for other users. It doesn't seem to be much better than 
ndiswrapper.

Larry


From ccmcphe at verizon.net  Fri Sep 12 22:48:13 2008
From: ccmcphe at verizon.net (Tex)
Date: Fri, 12 Sep 2008 16:48:13 -0400
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48C9951A.3090501@lwfinger.net>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
	<48C989B7.2020004@verizon.net> <48C9951A.3090501@lwfinger.net>
Message-ID: <48CAD58D.90601@verizon.net>

Larry Finger wrote:
> Tex wrote:
>> Broadcom's reference driver for PCI ID 4328 , 4321 can be downloaded 
>> at http://www.broadcom.com/support/802.11/linux_sta.php . I haven't 
>> tried it yet, your on your own with this driver..
>
> The reports I get from the openSUSE and Ubuntu lists are that this 
> driver continually disconnects, if it works at all, and locks up the 
> system for other users. It doesn't seem to be much better than 
> ndiswrapper.
>
> Larry
>
Yeah, I tried it at work today using a Macbook. It will associate at 
times and at times it won't.  Once you get associated with an AP, I had 
trouble getting an IP. When I did get an IP, like you said, it will 
disconnect randomly and sometimes lockup.

-Tex


From seanhodges at bluebottle.com  Sat Sep 13 00:52:07 2008
From: seanhodges at bluebottle.com (Sean Hodges)
Date: Fri, 12 Sep 2008 23:52:07 +0100
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48CAD58D.90601@verizon.net>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
	<48C989B7.2020004@verizon.net> <48C9951A.3090501@lwfinger.net>
	<48CAD58D.90601@verizon.net>
Message-ID: <1221259927.7599.12.camel@metis>

On Fri, 2008-09-12 at 16:48 -0400, Tex wrote:
> Larry Finger wrote:
> > Tex wrote:
> >> Broadcom's reference driver for PCI ID 4328 , 4321 can be downloaded 
> >> at http://www.broadcom.com/support/802.11/linux_sta.php . I haven't 
> >> tried it yet, your on your own with this driver..
> >
> > The reports I get from the openSUSE and Ubuntu lists are that this 
> > driver continually disconnects, if it works at all, and locks up the 
> > system for other users. It doesn't seem to be much better than 
> > ndiswrapper.
> >
> > Larry
> >
> Yeah, I tried it at work today using a Macbook. It will associate at 
> times and at times it won't.  Once you get associated with an AP, I had 
> trouble getting an IP. When I did get an IP, like you said, it will 
> disconnect randomly and sometimes lockup.
> 
> -Tex

Tex,

Thanks for the heads-up. I have also tried the Broadcom driver with
little success.

The main problems that I encountered were:

1) Intermittent disconnections with AP
2) VERY occasionally, it would refuse to connect to the AP completely,
but most times it would succeed until I would hit (1).
3) Once something went wrong (anything), it remained that way until I
rebooted, despite my best efforts.
4) I could never manage to start an SSH connection with this driver, no
idea why. It would return with "no route to host".

I would communicate these problems with Broadcom, but experience tells
me that this will fall on deaf ears (someone correct me if I'm wrong
here).

For now, I'll stick with ndiswrapper (which works, albeit with a few
small bugs and no monitor mode), and keep listening out for a better
alternative.

I do appreciate you letting me know about the driver, there are likely
to be others who have not tried it as well.

Sean





From tjaviss at gmail.com  Sat Sep 13 17:47:07 2008
From: tjaviss at gmail.com (Tyler Aviss)
Date: Sat, 13 Sep 2008 11:47:07 -0400
Subject: bcm-43xx for bcm-4328
In-Reply-To: <48CAD58D.90601@verizon.net>
References: <649170550808311450u75194affjbb1e4fc59492ac51@mail.gmail.com>
	<48BB20FD.9020308@gmail.com>
	<200809011142.m81BgpPv013613@mi0.bluebottle.com>
	<200809011452.19651.hs4233@mail.mn-solutions.de>
	<200809011337.m81Dbca5016108@mi1.bluebottle.com>
	<48C989B7.2020004@verizon.net> <48C9951A.3090501@lwfinger.net>
	<48CAD58D.90601@verizon.net>
Message-ID: <3a97ef0809130847u53c8d30bo428225962b4419ea@mail.gmail.com>

I can verify that. It never froze my machine, but the "wl" driver did
like to sporadically disconnect. Usually it seems to be fine if I
wasn't doing anything on the network connection, but as soon as I
started transferring any meaningful amount of data it would mess up,
disconnect, and reconnect.

This is without WEP or anything like that as well (some others seemed
to think it was an encryption issue). Setting the data rate lower
didn't seem to help. The only thing I haven't tried is connecting to
an "N" router as I only have a "G", in case it perhaps doesn't like
certain routers or protocols.

Good thing I still have a USB 802.11G card that works nicely in 'nix :-)

On Fri, Sep 12, 2008 at 4:48 PM, Tex <ccmcphe at verizon.net> wrote:
> Larry Finger wrote:
>> Tex wrote:
>>> Broadcom's reference driver for PCI ID 4328 , 4321 can be downloaded
>>> at http://www.broadcom.com/support/802.11/linux_sta.php . I haven't
>>> tried it yet, your on your own with this driver..
>>
>> The reports I get from the openSUSE and Ubuntu lists are that this
>> driver continually disconnects, if it works at all, and locks up the
>> system for other users. It doesn't seem to be much better than
>> ndiswrapper.
>>
>> Larry
>>
> Yeah, I tried it at work today using a Macbook. It will associate at
> times and at times it won't.  Once you get associated with an AP, I had
> trouble getting an IP. When I did get an IP, like you said, it will
> disconnect randomly and sometimes lockup.
>
> -Tex
> _______________________________________________
> Bcm43xx-dev mailing list
> Bcm43xx-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/bcm43xx-dev
>



-- 
Tyler Aviss
Systems Support
LPIC/LPIC-2
(647) 302-0942


From artem.v.antonov at gmail.com  Sat Sep 13 19:08:08 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Sat, 13 Sep 2008 21:08:08 +0400
Subject: [BUG] latest changes in mac80211 & b43
Message-ID: <6bc534830809131008s7011fd43g7a694caec50e6b48@mail.gmail.com>

Hi all!

It seems, a new bug was introduced in latest wireless-testing.git.

With this patch

http://git.kernel.org/?p=linux/kernel/git/linville/wireless-testing.git;a=commit;h=65657dc205ec6146185f17229e0e1e5e5d9a7429

b43 doesn't work in AP-mode, hostapd print such errors:

wlan0: STA 00:1b:fc:f2:49:b2 WPA: EAPOL-Key timeout
WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state PTKSTART
wlan0: STA 00:1b:fc:f2:49:b2 WPA: sending 1/4 msg of 4-Way Handshake
WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8
kde_len=0 keyidx=0 encr=0)
WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state DISCONNECT
hostapd_wpa_auth_disconnect: WPA authenticator requests disconnect:
STA 00:1b:fc:f2:49:b2 reason 2
WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state DISCONNECTED
WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state INITIALIZE
wlan0: STA 00:1b:fc:f2:49:b2 IEEE 802.1X: unauthorizing port
Could not set station 00:1b:fc:f2:49:b2 flags for kernel driver (errno=124).
wlan0: STA 00:1b:fc:f2:49:b2 IEEE 802.11: deauthenticated due to local
deauth request

Without the above patch b43 works in AP-mode with hostapd.

Best regards.


From johannes at sipsolutions.net  Sat Sep 13 19:44:46 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 13 Sep 2008 19:44:46 +0200
Subject: [BUG] latest changes in mac80211 & b43
In-Reply-To: <6bc534830809131008s7011fd43g7a694caec50e6b48@mail.gmail.com>
	(sfid-20080913_190812_156748_27DE21A9)
References: <6bc534830809131008s7011fd43g7a694caec50e6b48@mail.gmail.com>
	(sfid-20080913_190812_156748_27DE21A9)
Message-ID: <1221327886.3700.13.camel@johannes.berg>

Hi,

Please use linux-wireless, CC added.

> b43 doesn't work in AP-mode, hostapd print such errors:
> 
> wlan0: STA 00:1b:fc:f2:49:b2 WPA: EAPOL-Key timeout
> WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state PTKSTART
> wlan0: STA 00:1b:fc:f2:49:b2 WPA: sending 1/4 msg of 4-Way Handshake
> WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8
> kde_len=0 keyidx=0 encr=0)
> WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state DISCONNECT
> hostapd_wpa_auth_disconnect: WPA authenticator requests disconnect:
> STA 00:1b:fc:f2:49:b2 reason 2
> WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state DISCONNECTED
> WPA: 00:1b:fc:f2:49:b2 WPA_PTK entering state INITIALIZE
> wlan0: STA 00:1b:fc:f2:49:b2 IEEE 802.1X: unauthorizing port
> Could not set station 00:1b:fc:f2:49:b2 flags for kernel driver (errno=124).
> wlan0: STA 00:1b:fc:f2:49:b2 IEEE 802.11: deauthenticated due to local
> deauth request

That makes no sense at all, but that's because you snipped the log so
much that the actual problem is gone.

The actual problem seems to be that we're sending those EAPOL frames
encrypted, I'll take a look tomorrow or Monday.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080913/94ac0a9c/attachment.pgp>

From johannes at sipsolutions.net  Sun Sep 14 09:52:44 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sun, 14 Sep 2008 09:52:44 +0200
Subject: [BUG] latest changes in mac80211 & b43
In-Reply-To: <1221327886.3700.13.camel@johannes.berg>
	(sfid-20080914_093153_425361_0FC25BA1)
References: <6bc534830809131008s7011fd43g7a694caec50e6b48@mail.gmail.com>
	(sfid-20080913_190812_156748_27DE21A9)
	<1221327886.3700.13.camel@johannes.berg>
	(sfid-20080914_093153_425361_0FC25BA1)
Message-ID: <1221378764.3700.18.camel@johannes.berg>

On Sat, 2008-09-13 at 19:44 +0200, Johannes Berg wrote:

> The actual problem seems to be that we're sending those EAPOL frames
> encrypted, I'll take a look tomorrow or Monday.

It's a problem in hostapd, patch posted.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080914/86f8b444/attachment.pgp>

From Larry.Finger at lwfinger.net  Mon Sep 15 21:43:06 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 15 Sep 2008 14:43:06 -0500
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
Message-ID: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>

If the system is misconfigured with CONFIG_RFKILL set but CONFIG_RFKILL_INPUT
not set, the built-in radio LEDs will not work. In the current code, no warning
is issued.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

This is material for the next merge.

Larry


Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -186,6 +186,9 @@ void b43_rfkill_init(struct b43_wldev *d
 	if (err)
 		b43warn(wl, "Failed to load the rfkill-input module. "
 			"The built-in radio LED will not work.\n");
+#else
+	b43warn(wl, "The rfkill-input subsystem is not available. "
+		"The built-in radio LED will not work.\n");
 #endif /* CONFIG_RFKILL_INPUT */
 
 	err = input_register_polled_device(rfk->poll_dev);


From mb at bu3sch.de  Tue Sep 16 15:11:10 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 16 Sep 2008 15:11:10 +0200
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
References: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
Message-ID: <200809161511.11503.mb@bu3sch.de>

On Monday 15 September 2008 21:43:06 Larry Finger wrote:
> If the system is misconfigured with CONFIG_RFKILL set but CONFIG_RFKILL_INPUT
> not set, the built-in radio LEDs will not work. In the current code, no warning
> is issued.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---

This is wrong. Please do something like the following:

Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -186,6 +186,9 @@ void b43_rfkill_init(struct b43_wldev *d
        if (err)
                b43warn(wl, "Failed to load the rfkill-input module. "
                        "The built-in radio LED will not work.\n");
 #endif /* CONFIG_RFKILL_INPUT */
+
+#if !defined(CONFIG_RFKILL_INPUT) && !defined(CONFIG_RFKILL_INPUT_MODULE)
+       b43warn(wl, "The rfkill-input subsystem is not available. "
+               "The built-in radio LED will not work.\n");
+#endif
 
        err = input_register_polled_device(rfk->poll_dev);


-- 
Greetings Michael.


From post at hendrik-sattler.de  Tue Sep 16 15:24:12 2008
From: post at hendrik-sattler.de (Hendrik Sattler)
Date: Tue, 16 Sep 2008 15:24:12 +0200
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <200809161511.11503.mb@bu3sch.de>
References: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
	<200809161511.11503.mb@bu3sch.de>
Message-ID: <20080916152412.swm6icp9wcwcocoo@v1539.ncsrv.de>

Zitat von Michael Buesch <mb at bu3sch.de>:
> This is wrong. Please do something like the following:

It maybe annoying that some people don't get that but....
Reading the documentation of RFKILL_INPUT, is it impossible to have a  
userspace program doing this? In that case, the warning would be plain  
wrong.

HS

> Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
> +++ wireless-testing/drivers/net/wireless/b43/rfkill.c
> @@ -186,6 +186,9 @@ void b43_rfkill_init(struct b43_wldev *d
>         if (err)
>                 b43warn(wl, "Failed to load the rfkill-input module. "
>                         "The built-in radio LED will not work.\n");
>  #endif /* CONFIG_RFKILL_INPUT */
> +
> +#if !defined(CONFIG_RFKILL_INPUT) && !defined(CONFIG_RFKILL_INPUT_MODULE)
> +       b43warn(wl, "The rfkill-input subsystem is not available. "
> +               "The built-in radio LED will not work.\n");
> +#endif
>
>         err = input_register_polled_device(rfk->poll_dev);





From mb at bu3sch.de  Tue Sep 16 15:32:23 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 16 Sep 2008 15:32:23 +0200
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <20080916152412.swm6icp9wcwcocoo@v1539.ncsrv.de>
References: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
	<200809161511.11503.mb@bu3sch.de>
	<20080916152412.swm6icp9wcwcocoo@v1539.ncsrv.de>
Message-ID: <200809161532.23646.mb@bu3sch.de>

On Tuesday 16 September 2008 15:24:12 Hendrik Sattler wrote:
> Zitat von Michael Buesch <mb at bu3sch.de>:
> > This is wrong. Please do something like the following:
> 
> It maybe annoying that some people don't get that but....
> Reading the documentation of RFKILL_INPUT, is it impossible to have a  
> userspace program doing this? In that case, the warning would be plain  
> wrong.

Who is talking about userspace?

PS: Don't kill CCs next time, please.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Tue Sep 16 16:18:34 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 09:18:34 -0500
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
Message-ID: <48CFC03A.8020708@lwfinger.net>

Since commit bc19d6e0b74ef03a3baf035412c95192b54dfc6f entitled
"b43/b43legacy: add RFKILL_STATE_HARD_BLOCKED support", the radio LED
no longer responds to rfkill switch events.

ATM, I do not have a fix, other than reversion of this commit.

Larry



From post at hendrik-sattler.de  Tue Sep 16 16:32:29 2008
From: post at hendrik-sattler.de (Hendrik Sattler)
Date: Tue, 16 Sep 2008 16:32:29 +0200
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <200809161532.23646.mb@bu3sch.de>
References: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
	<200809161511.11503.mb@bu3sch.de>
	<20080916152412.swm6icp9wcwcocoo@v1539.ncsrv.de>
	<200809161532.23646.mb@bu3sch.de>
Message-ID: <20080916163229.y3aabo65cg888gwg@v1539.ncsrv.de>

Zitat von Michael Buesch <mb at bu3sch.de>:

> On Tuesday 16 September 2008 15:24:12 Hendrik Sattler wrote:
>> Zitat von Michael Buesch <mb at bu3sch.de>:
>> > This is wrong. Please do something like the following:
>>
>> It maybe annoying that some people don't get that but....
>> Reading the documentation of RFKILL_INPUT, is it impossible to have a
>> userspace program doing this? In that case, the warning would be plain
>> wrong.
>
> Who is talking about userspace?

RFKILL_INPUT does something that could also be done in userspace,  
instead (at least its help text says so). If you use the userspace  
solution, you will probably not have RFKILL_INPUT and thus get a  
warning. Why?
It's ok to try to load that module but why should you print a warning  
if it is not there. That is totally contrary to the help text of  
RFKILL_INPUT. At least s/will not work/may not work/.

HS




From mb at bu3sch.de  Tue Sep 16 17:32:50 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 16 Sep 2008 17:32:50 +0200
Subject: [PATCH] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <20080916163229.y3aabo65cg888gwg@v1539.ncsrv.de>
References: <48cebaca.pA4AdA6Dj23Wwt4K%Larry.Finger@lwfinger.net>
	<200809161532.23646.mb@bu3sch.de>
	<20080916163229.y3aabo65cg888gwg@v1539.ncsrv.de>
Message-ID: <200809161732.51076.mb@bu3sch.de>

On Tuesday 16 September 2008 16:32:29 Hendrik Sattler wrote:
> Zitat von Michael Buesch <mb at bu3sch.de>:
> 
> > On Tuesday 16 September 2008 15:24:12 Hendrik Sattler wrote:
> >> Zitat von Michael Buesch <mb at bu3sch.de>:
> >> > This is wrong. Please do something like the following:
> >>
> >> It maybe annoying that some people don't get that but....
> >> Reading the documentation of RFKILL_INPUT, is it impossible to have a
> >> userspace program doing this? In that case, the warning would be plain
> >> wrong.
> >
> > Who is talking about userspace?
> 
> RFKILL_INPUT does something that could also be done in userspace,

Not in this case.

-- 
Greetings Michael.


From mb at bu3sch.de  Tue Sep 16 17:42:15 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 16 Sep 2008 17:42:15 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48CFC03A.8020708@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net>
Message-ID: <200809161742.15527.mb@bu3sch.de>

On Tuesday 16 September 2008 16:18:34 Larry Finger wrote:
> Since commit bc19d6e0b74ef03a3baf035412c95192b54dfc6f entitled
> "b43/b43legacy: add RFKILL_STATE_HARD_BLOCKED support", the radio LED
> no longer responds to rfkill switch events.
> 
> ATM, I do not have a fix, other than reversion of this commit.

It's kind of bogus that it pokes with the software rfkill state
from within the hardware rfkill handler.

Please revert this patch. The commit log says nothing about
why this is needed and I don't see a point in overriding the state
in the rfkill-private data structure from within the driver.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Tue Sep 16 19:08:48 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 12:08:48 -0500
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <200809161742.15527.mb@bu3sch.de>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
Message-ID: <48CFE820.7010305@lwfinger.net>

Michael Buesch wrote:
> On Tuesday 16 September 2008 16:18:34 Larry Finger wrote:
>> Since commit bc19d6e0b74ef03a3baf035412c95192b54dfc6f entitled
>> "b43/b43legacy: add RFKILL_STATE_HARD_BLOCKED support", the radio LED
>> no longer responds to rfkill switch events.
>>
>> ATM, I do not have a fix, other than reversion of this commit.
> 
> It's kind of bogus that it pokes with the software rfkill state
> from within the hardware rfkill handler.
> 
> Please revert this patch. The commit log says nothing about
> why this is needed and I don't see a point in overriding the state
> in the rfkill-private data structure from within the driver.

I agree with Michael. From what I know, the only possible reason for
having this state would be if user space could somehow affect the
state of the hardware switch. As the user's finger is the only such
thing, then there is no use for the RFKILL_STATE_HARD_BLOCKED state,
particularly when it breaks LED operations.

Please revert the patch.

Larry


From mb at bu3sch.de  Tue Sep 16 21:25:18 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 16 Sep 2008 21:25:18 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <200809162018.28548.carlos@strangeworlds.co.uk>
References: <48CFC03A.8020708@lwfinger.net> <48CFE820.7010305@lwfinger.net>
	<200809162018.28548.carlos@strangeworlds.co.uk>
Message-ID: <200809162125.18978.mb@bu3sch.de>

On Tuesday 16 September 2008 21:18:27 Carlos Corbacho wrote:
> On Tuesday 16 September 2008 18:08:48 Larry Finger wrote:
> > I agree with Michael. From what I know, the only possible reason for
> > having [RFKILL_STATE_HARD_BLOCKED] would be if user space could
> > somehow affect the state of the hardware switch.
> 
> When I disable the b43 device in my laptop via acer-wmi (which in turn, calls 
> into the laptops firmware), b43 physically cannot re-enable it (a not 
> uncommon case on a lot of laptops). In which case, as far as b43 is 
> concerned, the wireless radio is then in RFKILL_STATE_HARD_BLOCKED, since b43 
> is unable to re-enable the radio on the hardware.
> 
> So yes, it is quite possible for b43 to be in RFKILL_STATE_HARD_BLOCKED.

Sure it is. It's the common case, if there's a button.

But I don't know how to tell the rfkill subsystem about the states and
I do not _want_ to. See, that crap code _always_ blew up for every single
patch we did. I'm tired of this and I am not interested in that anymore.
Please revert that patch and if that makes it work I'm fine with it.

I'm still waiting for the sane rfkill API where we have three functions
rfkill-allocate
rfkill-hw-state-changed
rfkill-free

That's all I need. All that input stuff, which was _the_ way to go some
months ago, but is now deprecated it seems (but I don't know what it it
replaced by) is just so really confusing.

-- 
Greetings Michael.


From carlos at strangeworlds.co.uk  Tue Sep 16 21:18:27 2008
From: carlos at strangeworlds.co.uk (Carlos Corbacho)
Date: Tue, 16 Sep 2008 20:18:27 +0100
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48CFE820.7010305@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
Message-ID: <200809162018.28548.carlos@strangeworlds.co.uk>

On Tuesday 16 September 2008 18:08:48 Larry Finger wrote:
> I agree with Michael. From what I know, the only possible reason for
> having [RFKILL_STATE_HARD_BLOCKED] would be if user space could
> somehow affect the state of the hardware switch.

When I disable the b43 device in my laptop via acer-wmi (which in turn, calls 
into the laptops firmware), b43 physically cannot re-enable it (a not 
uncommon case on a lot of laptops). In which case, as far as b43 is 
concerned, the wireless radio is then in RFKILL_STATE_HARD_BLOCKED, since b43 
is unable to re-enable the radio on the hardware.

So yes, it is quite possible for b43 to be in RFKILL_STATE_HARD_BLOCKED.

-Carlos
-- 
E-Mail: carlos at strangeworlds.co.uk
Web: strangeworlds.co.uk
GPG Key ID: 0x23EE722D


From Larry.Finger at lwfinger.net  Tue Sep 16 21:30:35 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 14:30:35 -0500
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <200809162018.28548.carlos@strangeworlds.co.uk>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<200809162018.28548.carlos@strangeworlds.co.uk>
Message-ID: <48D0095B.40403@lwfinger.net>

Carlos Corbacho wrote:
> On Tuesday 16 September 2008 18:08:48 Larry Finger wrote:
>> I agree with Michael. From what I know, the only possible reason for
>> having [RFKILL_STATE_HARD_BLOCKED] would be if user space could
>> somehow affect the state of the hardware switch.
> 
> When I disable the b43 device in my laptop via acer-wmi (which in turn, calls 
> into the laptops firmware), b43 physically cannot re-enable it (a not 
> uncommon case on a lot of laptops). In which case, as far as b43 is 
> concerned, the wireless radio is then in RFKILL_STATE_HARD_BLOCKED, since b43 
> is unable to re-enable the radio on the hardware.
> 
> So yes, it is quite possible for b43 to be in RFKILL_STATE_HARD_BLOCKED.

I didn't say it was not possible. What I said is that _ONLY_ the
operator's finger could change the state, just like in your laptop.
Thus it makes absolutely no difference what state RFKILL thinks it is
in. The driver knows what state the software wants, and can read but
not write the hardware state. There has to be a bug in RFKILL that got
exposed when this commit was included. This regression needs to be
fixed ASAP, otherwise 2.6.27 will be released with it. If the RFKILL
guys want to fix their bug, I'll be happy to test code, but not now.

Larry


From Larry.Finger at lwfinger.net  Tue Sep 16 21:56:49 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 14:56:49 -0500
Subject: [PATCH V2] b43: Issue warning when RFKILL_INPUT is not enabled
Message-ID: <48d00f81./8rb7yGSb9PmJx+R%Larry.Finger@lwfinger.net>

If the system is misconfigured with CONFIG_RFKILL set but CONFIG_RFKILL_INPUT
not set, the built-in radio LEDs will not work. In the current code, no warning
is issued.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

This is material for the next merge.

Larry


Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -188,6 +188,11 @@ void b43_rfkill_init(struct b43_wldev *d
 			"The built-in radio LED will not work.\n");
 #endif /* CONFIG_RFKILL_INPUT */
 
+#if !defined(CONFIG_RFKILL_INPUT) && !defined(CONFIG_RFKILL_INPUT_MODULE)
+	b43warn(wl, "The rfkill-input subsystem is not available. "
+		"The built-in radio LED will not work.\n");
+#endif
+
 	err = input_register_polled_device(rfk->poll_dev);
 	if (err)
 		goto err_unreg_rfk;


From mjg59 at srcf.ucam.org  Tue Sep 16 21:51:34 2008
From: mjg59 at srcf.ucam.org (Matthew Garrett)
Date: Tue, 16 Sep 2008 20:51:34 +0100
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48CFE820.7010305@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
Message-ID: <20080916195134.GB14879@srcf.ucam.org>

On Tue, Sep 16, 2008 at 12:08:48PM -0500, Larry Finger wrote:

> I agree with Michael. From what I know, the only possible reason for
> having this state would be if user space could somehow affect the
> state of the hardware switch. As the user's finger is the only such
> thing, then there is no use for the RFKILL_STATE_HARD_BLOCKED state,
> particularly when it breaks LED operations.

RFKILL_STATE_HARD_BLOCKED indicates that the hardware is disabled in a 
way that userspace can't influence, so sounds like exactly the right 
state to have here. I still have absolutely no idea what b43 rfkill is 
supposed to be doing - why on earth is it requesting rfkill-input, and 
why does it generate keypress events? I /think/ it should e something 
like the following (untested, I'm not near any of my b43 hardware at the 
moment). This basically does the following:

1) Split the update function in two, so it can be called by either 
polling or an interrupt driven event on newer hardware (not implemented 
yet)
2) Remove all the input handling
3) Change the state updates to use rfkill_force_state, which will 
generate an event that gets sent up to userland
4) Retains the RFKILL_STATE_HARD_BLOCKED code

When the user flicks a switch or presses a button that physically 
disables the radio, the state will now automatically change to 
RFKILL_STATE_HARD_BLOCKED. If they have a key that generates KEY_WLAN 
but doesn't change the radio state, rfkill-input will trigger a change 
to RFKILL_STATE_SOFT_BLOCKED.

Like I said, this is only build-tested - I won't be back at a b43 until 
next week. If someone could give this a go, that would be great.

diff --git a/drivers/net/wireless/b43/rfkill.c b/drivers/net/wireless/b43/rfkill.c
index fec5645..e8b2acb 100644
--- a/drivers/net/wireless/b43/rfkill.c
+++ b/drivers/net/wireless/b43/rfkill.c
@@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev *dev)
 	struct b43_rfkill *rfk = &(dev->wl->rfkill);
 
 	if (!dev->radio_hw_enable) {
-		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
 		return;
 	}
 
 	if (!dev->phy.radio_on)
-		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
 	else
-		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
-
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
 }
 
-/* The poll callback for the hardware button. */
-static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
+static void b43_rfkill_update(struct b43_wldev *dev)
 {
-	struct b43_wldev *dev = poll_dev->private;
 	struct b43_wl *wl = dev->wl;
 	bool enabled;
 	bool report_change = 0;
@@ -82,13 +79,25 @@ static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
 			enabled ? "ENABLED" : "DISABLED");
 	}
 	mutex_unlock(&wl->mutex);
+}
 
-	/* send the radio switch event to the system - note both a key press
-	 * and a release are required */
-	if (unlikely(report_change)) {
-		input_report_key(poll_dev->input, KEY_WLAN, 1);
-		input_report_key(poll_dev->input, KEY_WLAN, 0);
-	}
+static void b43_rfkill_poll(unsigned long data)
+{
+	struct b43_rfkill *rfkill = (struct b43_rfkill *)data;
+	schedule_work(&rfkill->poll_queue);
+}
+
+static void b43_rfkill_work(struct work_struct *work)
+{
+	struct b43_rfkill *rfk = container_of(work, struct b43_rfkill, 
+					      poll_queue);
+	struct b43_wl *wl = container_of(rfk, struct b43_wl, rfkill);
+	struct b43_wldev *dev = wl->current_dev;
+
+	b43_rfkill_update(dev);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	add_timer(&rfk->poll_timer);
 }
 
 /* Called when the RFKILL toggled in software. */
@@ -158,48 +167,23 @@ void b43_rfkill_init(struct b43_wldev *dev)
 	rfk->rfkill->toggle_radio = b43_rfkill_soft_toggle;
 	rfk->rfkill->user_claim_unsupported = 1;
 
-	rfk->poll_dev = input_allocate_polled_device();
-	if (!rfk->poll_dev) {
-		rfkill_free(rfk->rfkill);
-		goto err_freed_rfk;
-	}
-
-	rfk->poll_dev->private = dev;
-	rfk->poll_dev->poll = b43_rfkill_poll;
-	rfk->poll_dev->poll_interval = 1000; /* msecs */
-
-	rfk->poll_dev->input->name = rfk->name;
-	rfk->poll_dev->input->id.bustype = BUS_HOST;
-	rfk->poll_dev->input->id.vendor = dev->dev->bus->boardinfo.vendor;
-	rfk->poll_dev->input->evbit[0] = BIT(EV_KEY);
-	set_bit(KEY_WLAN, rfk->poll_dev->input->keybit);
-
 	err = rfkill_register(rfk->rfkill);
 	if (err)
-		goto err_free_polldev;
+		goto err_free_rfk;
 
-#ifdef CONFIG_RFKILL_INPUT_MODULE
-	/* B43 RF-kill isn't useful without the rfkill-input subsystem.
-	 * Try to load the module. */
-	err = request_module("rfkill-input");
-	if (err)
-		b43warn(wl, "Failed to load the rfkill-input module. "
-			"The built-in radio LED will not work.\n");
-#endif /* CONFIG_RFKILL_INPUT */
+	rfk->registered = 1;
 
-	err = input_register_polled_device(rfk->poll_dev);
-	if (err)
-		goto err_unreg_rfk;
+	INIT_WORK(&rfk->poll_queue, b43_rfkill_work);
 
-	rfk->registered = 1;
+	init_timer(&rfk->poll_timer);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	rfk->poll_timer.data = (unsigned long)dev;
+	add_timer(&rfk->poll_timer);
 
 	return;
-err_unreg_rfk:
-	rfkill_unregister(rfk->rfkill);
-err_free_polldev:
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
-err_freed_rfk:
+err_free_rfk:
+	rfkill_free(rfk->rfkill);
 	rfk->rfkill = NULL;
 out_error:
 	rfk->registered = 0;
@@ -214,9 +198,8 @@ void b43_rfkill_exit(struct b43_wldev *dev)
 		return;
 	rfk->registered = 0;
 
-	input_unregister_polled_device(rfk->poll_dev);
+	del_timer(&rfk->poll_timer);
+
 	rfkill_unregister(rfk->rfkill);
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
 	rfk->rfkill = NULL;
 }
diff --git a/drivers/net/wireless/b43/rfkill.h b/drivers/net/wireless/b43/rfkill.h
index adacf93..1a4a719 100644
--- a/drivers/net/wireless/b43/rfkill.h
+++ b/drivers/net/wireless/b43/rfkill.h
@@ -7,14 +7,14 @@ struct b43_wldev;
 #ifdef CONFIG_B43_RFKILL
 
 #include <linux/rfkill.h>
-#include <linux/input-polldev.h>
-
 
 struct b43_rfkill {
 	/* The RFKILL subsystem data structure */
 	struct rfkill *rfkill;
-	/* The poll device for the RFKILL input button */
-	struct input_polled_dev *poll_dev;
+	/* The timer list for the RFKILL polling */
+	struct timer_list poll_timer;
+	/* Workqueue for the RFKILL polling */
+	struct work_struct poll_queue;
 	/* Did initialization succeed? Used for freeing. */
 	bool registered;
 	/* The unique name of this rfkill switch */


-- 
Matthew Garrett | mjg59 at srcf.ucam.org


From Larry.Finger at lwfinger.net  Tue Sep 16 22:34:06 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 15:34:06 -0500
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916195134.GB14879@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<20080916195134.GB14879@srcf.ucam.org>
Message-ID: <48D0183E.9010301@lwfinger.net>

Matthew Garrett wrote:
> On Tue, Sep 16, 2008 at 12:08:48PM -0500, Larry Finger wrote:
> 
>> I agree with Michael. From what I know, the only possible reason for
>> having this state would be if user space could somehow affect the
>> state of the hardware switch. As the user's finger is the only such
>> thing, then there is no use for the RFKILL_STATE_HARD_BLOCKED state,
>> particularly when it breaks LED operations.
> 
> RFKILL_STATE_HARD_BLOCKED indicates that the hardware is disabled in a 
> way that userspace can't influence, so sounds like exactly the right 
> state to have here. I still have absolutely no idea what b43 rfkill is 
> supposed to be doing - why on earth is it requesting rfkill-input, and 
> why does it generate keypress events? I /think/ it should e something 
> like the following (untested, I'm not near any of my b43 hardware at the 
> moment). This basically does the following:
> 
> 1) Split the update function in two, so it can be called by either 
> polling or an interrupt driven event on newer hardware (not implemented 
> yet)
> 2) Remove all the input handling
> 3) Change the state updates to use rfkill_force_state, which will 
> generate an event that gets sent up to userland
> 4) Retains the RFKILL_STATE_HARD_BLOCKED code
> 
> When the user flicks a switch or presses a button that physically 
> disables the radio, the state will now automatically change to 
> RFKILL_STATE_HARD_BLOCKED. If they have a key that generates KEY_WLAN 
> but doesn't change the radio state, rfkill-input will trigger a change 
> to RFKILL_STATE_SOFT_BLOCKED.
> 
> Like I said, this is only build-tested - I won't be back at a b43 until 
> next week. If someone could give this a go, that would be great.

It locks up tight with a kernel panic when booting. I have a screen
picture that I will send separately to Matthew.

Larry


From carlos at strangeworlds.co.uk  Tue Sep 16 22:44:06 2008
From: carlos at strangeworlds.co.uk (Carlos Corbacho)
Date: Tue, 16 Sep 2008 20:44:06 -0000 (UTC)
Subject: Regression in 2.6.27-rcX caused by commit 
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916195134.GB14879@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<20080916195134.GB14879@srcf.ucam.org>
Message-ID: <39295.87.81.255.5.1221597846.squirrel@phoenix.slamd64.com>

> diff --git a/drivers/net/wireless/b43/rfkill.c
> b/drivers/net/wireless/b43/rfkill.c
> index fec5645..e8b2acb 100644
> --- a/drivers/net/wireless/b43/rfkill.c
> +++ b/drivers/net/wireless/b43/rfkill.c
> @@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev
> *dev)
>  	struct b43_rfkill *rfk = &(dev->wl->rfkill);
>
>  	if (!dev->radio_hw_enable) {
> -		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
>  		return;
>  	}
>
>  	if (!dev->phy.radio_on)
> -		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
>  	else
> -		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
> -
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
>  }

Just this should be enough to fix the regression for 2.6.27 (and should be
trivial to port to b43legacy) in the immediate term (I was planning to
send something similar).

The rest of the patch is out-of-scope for 2.6.27, but is definitely along
he right lines, IMHO (and it would be good if we can get a working version
of it in to 2.6.28). I may try and look at it later, as I do have my b43
hardware handy.

-Carlos
-- 
E-Mail: carlos at strangeworlds.co.uk
Web: strangeworlds.co.uk
GPG Key ID: 0x23EE722D


From Larry.Finger at lwfinger.net  Tue Sep 16 23:07:07 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 16:07:07 -0500
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <39295.87.81.255.5.1221597846.squirrel@phoenix.slamd64.com>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<20080916195134.GB14879@srcf.ucam.org>
	<39295.87.81.255.5.1221597846.squirrel@phoenix.slamd64.com>
Message-ID: <48D01FFB.1010302@lwfinger.net>

Carlos Corbacho wrote:
>> diff --git a/drivers/net/wireless/b43/rfkill.c
>> b/drivers/net/wireless/b43/rfkill.c
>> index fec5645..e8b2acb 100644
>> --- a/drivers/net/wireless/b43/rfkill.c
>> +++ b/drivers/net/wireless/b43/rfkill.c
>> @@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev
>> *dev)
>>  	struct b43_rfkill *rfk = &(dev->wl->rfkill);
>>
>>  	if (!dev->radio_hw_enable) {
>> -		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
>> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
>>  		return;
>>  	}
>>
>>  	if (!dev->phy.radio_on)
>> -		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
>> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
>>  	else
>> -		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
>> -
>> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
>>  }
> 
> Just this should be enough to fix the regression for 2.6.27 (and should be
> trivial to port to b43legacy) in the immediate term (I was planning to
> send something similar).
> 
> The rest of the patch is out-of-scope for 2.6.27, but is definitely along
> he right lines, IMHO (and it would be good if we can get a working version
> of it in to 2.6.28). I may try and look at it later, as I do have my b43
> hardware handy.

This one doesn't crash, but it doesn't turn the light off.

I'm done testing for now!

John,

Revert the patch until the rfkill guys get their house in order.

Larry




From mjg59 at srcf.ucam.org  Tue Sep 16 23:09:20 2008
From: mjg59 at srcf.ucam.org (Matthew Garrett)
Date: Tue, 16 Sep 2008 22:09:20 +0100
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48D0183E.9010301@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<20080916195134.GB14879@srcf.ucam.org>
	<48D0183E.9010301@lwfinger.net>
Message-ID: <20080916210920.GC16470@srcf.ucam.org>

Oh, hey, I suck. This one might stand a better chance of not falling 
over.

diff --git a/drivers/net/wireless/b43/rfkill.c b/drivers/net/wireless/b43/rfkill.c
index fec5645..991e318 100644
--- a/drivers/net/wireless/b43/rfkill.c
+++ b/drivers/net/wireless/b43/rfkill.c
@@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev *dev)
 	struct b43_rfkill *rfk = &(dev->wl->rfkill);
 
 	if (!dev->radio_hw_enable) {
-		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
 		return;
 	}
 
 	if (!dev->phy.radio_on)
-		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
 	else
-		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
-
+		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
 }
 
-/* The poll callback for the hardware button. */
-static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
+static void b43_rfkill_update(struct b43_wldev *dev)
 {
-	struct b43_wldev *dev = poll_dev->private;
 	struct b43_wl *wl = dev->wl;
 	bool enabled;
 	bool report_change = 0;
@@ -82,13 +79,25 @@ static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
 			enabled ? "ENABLED" : "DISABLED");
 	}
 	mutex_unlock(&wl->mutex);
+}
 
-	/* send the radio switch event to the system - note both a key press
-	 * and a release are required */
-	if (unlikely(report_change)) {
-		input_report_key(poll_dev->input, KEY_WLAN, 1);
-		input_report_key(poll_dev->input, KEY_WLAN, 0);
-	}
+static void b43_rfkill_poll(unsigned long data)
+{
+	struct b43_rfkill *rfkill = (struct b43_rfkill *)data;
+	schedule_work(&rfkill->poll_queue);
+}
+
+static void b43_rfkill_work(struct work_struct *work)
+{
+	struct b43_rfkill *rfk = container_of(work, struct b43_rfkill, 
+					      poll_queue);
+	struct b43_wl *wl = container_of(rfk, struct b43_wl, rfkill);
+	struct b43_wldev *dev = wl->current_dev;
+
+	b43_rfkill_update(dev);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	add_timer(&rfk->poll_timer);
 }
 
 /* Called when the RFKILL toggled in software. */
@@ -158,48 +167,23 @@ void b43_rfkill_init(struct b43_wldev *dev)
 	rfk->rfkill->toggle_radio = b43_rfkill_soft_toggle;
 	rfk->rfkill->user_claim_unsupported = 1;
 
-	rfk->poll_dev = input_allocate_polled_device();
-	if (!rfk->poll_dev) {
-		rfkill_free(rfk->rfkill);
-		goto err_freed_rfk;
-	}
-
-	rfk->poll_dev->private = dev;
-	rfk->poll_dev->poll = b43_rfkill_poll;
-	rfk->poll_dev->poll_interval = 1000; /* msecs */
-
-	rfk->poll_dev->input->name = rfk->name;
-	rfk->poll_dev->input->id.bustype = BUS_HOST;
-	rfk->poll_dev->input->id.vendor = dev->dev->bus->boardinfo.vendor;
-	rfk->poll_dev->input->evbit[0] = BIT(EV_KEY);
-	set_bit(KEY_WLAN, rfk->poll_dev->input->keybit);
-
 	err = rfkill_register(rfk->rfkill);
 	if (err)
-		goto err_free_polldev;
+		goto err_free_rfk;
 
-#ifdef CONFIG_RFKILL_INPUT_MODULE
-	/* B43 RF-kill isn't useful without the rfkill-input subsystem.
-	 * Try to load the module. */
-	err = request_module("rfkill-input");
-	if (err)
-		b43warn(wl, "Failed to load the rfkill-input module. "
-			"The built-in radio LED will not work.\n");
-#endif /* CONFIG_RFKILL_INPUT */
+	rfk->registered = 1;
 
-	err = input_register_polled_device(rfk->poll_dev);
-	if (err)
-		goto err_unreg_rfk;
+	INIT_WORK(&rfk->poll_queue, b43_rfkill_work);
 
-	rfk->registered = 1;
+	init_timer(&rfk->poll_timer);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	rfk->poll_timer.data = (unsigned long)rfk;
+	add_timer(&rfk->poll_timer);
 
 	return;
-err_unreg_rfk:
-	rfkill_unregister(rfk->rfkill);
-err_free_polldev:
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
-err_freed_rfk:
+err_free_rfk:
+	rfkill_free(rfk->rfkill);
 	rfk->rfkill = NULL;
 out_error:
 	rfk->registered = 0;
@@ -214,9 +198,8 @@ void b43_rfkill_exit(struct b43_wldev *dev)
 		return;
 	rfk->registered = 0;
 
-	input_unregister_polled_device(rfk->poll_dev);
+	del_timer(&rfk->poll_timer);
+
 	rfkill_unregister(rfk->rfkill);
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
 	rfk->rfkill = NULL;
 }
diff --git a/drivers/net/wireless/b43/rfkill.h b/drivers/net/wireless/b43/rfkill.h
index adacf93..1a4a719 100644
--- a/drivers/net/wireless/b43/rfkill.h
+++ b/drivers/net/wireless/b43/rfkill.h
@@ -7,14 +7,14 @@ struct b43_wldev;
 #ifdef CONFIG_B43_RFKILL
 
 #include <linux/rfkill.h>
-#include <linux/input-polldev.h>
-
 
 struct b43_rfkill {
 	/* The RFKILL subsystem data structure */
 	struct rfkill *rfkill;
-	/* The poll device for the RFKILL input button */
-	struct input_polled_dev *poll_dev;
+	/* The timer list for the RFKILL polling */
+	struct timer_list poll_timer;
+	/* Workqueue for the RFKILL polling */
+	struct work_struct poll_queue;
 	/* Did initialization succeed? Used for freeing. */
 	bool registered;
 	/* The unique name of this rfkill switch */

-- 
Matthew Garrett | mjg59 at srcf.ucam.org


From mjg59 at srcf.ucam.org  Wed Sep 17 01:32:40 2008
From: mjg59 at srcf.ucam.org (Matthew Garrett)
Date: Wed, 17 Sep 2008 00:32:40 +0100
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48D0095B.40403@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<200809162018.28548.carlos@strangeworlds.co.uk>
	<48D0095B.40403@lwfinger.net>
Message-ID: <20080916233240.GA18574@srcf.ucam.org>

On Tue, Sep 16, 2008 at 02:30:35PM -0500, Larry Finger wrote:

> I didn't say it was not possible. What I said is that _ONLY_ the
> operator's finger could change the state, just like in your laptop.
> Thus it makes absolutely no difference what state RFKILL thinks it is
> in.

Of course it makes a difference. The reason why two states are provided 
is to allow userspace to distinguish whether it can unblock the device 
or not. It's clear that b43's rfkill code is astonishingly broken (and 
that's not a criticism of anyone involved - the documentation's 
confusing and there weren't any good examples of how it should be 
implemented).

The real question is how the LED state is supposed to be being toggled, 
and what that's got to do with rfkill. I /think/ that the current state 
of events is:

1) User toggles state
2) State toggle is used by b43 to generate KEY_WLAN (this is broken)
3) rfkill-input toggles the rfkill state, changing the LED state in the 
process

What *should* be happening is:

1) User toggles state
2) b43 changes rfkill state (by using rfkill_force_state). The LED state 
should also be changed in the process.

It looks like the commit in question gets part of the way to 
implementing the second of these situations, but will now change the 
rfkill state at the same time that rfkill-input tries to. I agree that 
it should be reverted for now, but because it's (a) broken (changing the 
state member directly is wrong) and (b) potentially open to strange 
states being generated by rfkill-input trying to change the state after 
it's already been changed. The general intent is correct.

-- 
Matthew Garrett | mjg59 at srcf.ucam.org


From celejar at gmail.com  Wed Sep 17 04:09:04 2008
From: celejar at gmail.com (Celejar)
Date: Tue, 16 Sep 2008 22:09:04 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
Message-ID: <20080916220904.75283811.celejar@gmail.com>

Hi,

With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
to APs that broadcast essid, but not one that doesn't.  The card does
not associate.  Is this a b43 issue, or a mac80211 issue, or something
else? Kernels are from wireless-testing.git.

$ dmesg | grep b43
b43-pci-bridge 0000:06:02.0: enabling device (0000 -> 0002)
b43-pci-bridge 0000:06:02.0: PCI INT A -> GSI 22 (level, low) -> IRQ 22
b43-pci-bridge 0000:06:02.0: setting latency timer to 64
b43-phy0: Broadcom 4318 WLAN found
b43-phy0 debug: Found PHY: Analog 3, Type 2, Revision 7
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 8
input: b43-phy0 as /class/input/input7
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
b43-phy0: Radio turned on by software

$ lspci -v

06:02.0 Network controller: Broadcom Corporation BCM4318 [AirForce One
54g] 802.11g Wireless LAN Controller (rev 02) Subsystem: AMBIT
Microsystem Corp. Device 0312 Flags: bus master, fast devsel, latency
64, IRQ 22 Memory at d0002000 (32-bit, non-prefetchable) [size=8K]
        Kernel driver in use: b43-pci-bridge
        Kernel modules: ssb

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Wed Sep 17 04:29:50 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 21:29:50 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080916220904.75283811.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>
Message-ID: <48D06B9E.70307@lwfinger.net>

Celejar wrote:
> Hi,
> 
> With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
> to APs that broadcast essid, but not one that doesn't.  The card does
> not associate.  Is this a b43 issue, or a mac80211 issue, or something
> else? Kernels are from wireless-testing.git.

It is difficult to say. As you have wireless-testing.git, please
bisect the source to find the problem. If you don't know how to use
git for this, see

http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html

Larry



From Larry.Finger at lwfinger.net  Wed Sep 17 04:52:12 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Tue, 16 Sep 2008 21:52:12 -0500
Subject: Regression in 2.6.27-rcX caused by
	commit	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080917023334.GA1187@khazad-dum.debian.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<200809162018.28548.carlos@strangeworlds.co.uk>
	<48D0095B.40403@lwfinger.net>
	<20080916233240.GA18574@srcf.ucam.org>
	<20080917023334.GA1187@khazad-dum.debian.net>
Message-ID: <48D070DC.80007@lwfinger.net>

Henrique de Moraes Holschuh wrote:
> 
> However, rfkill_force_state() is NOT updating LED states (I just checked).
> I will sleep on the issue, and send in a patch tomorrow.
> 
> This probably means a small patch to rfkill + Matthew's fixed patch to use
> rfkill_force_state() in b43 will fix the regression in the right way.
> 
> I don't care either way which kind of fix goes to 2.6.27, though.
> 
> The proper fix for rfkill will be in two stages. A small fix now, and a
> complete change on the LED handling to use the blocking notifier chain
> instead later on (which will clean up rfkill code somewhat).
> 

I do not dispute that rfkill-handling in b43 is broken; however, prior
to the commit in question, it worked.

I also think we can agree that we need to get it working before 2.6.27
is released. If the small fix now is the reversion of bc19d6e, then I
think this is the correct path. We will then have a couple of weeks to
get the code working correctly before the 2.6.28 merge starts.

I admit that I never tested any of the RFKILL patches as they went in.
One of the reasons is that the development process seemed rather
untidy to an outsider, and I wasn't sure that any of the code would
ever be in the kernel. As such, it snuck up on me. I'll not let that
happen again. After the reversion, I will again test any suggested
code changes, but do not expect me to work out any of the changes. I
have enough to do.

Larry



From mb at bu3sch.de  Wed Sep 17 16:07:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:07:55 +0200
Subject: [PATCH V2] b43: Issue warning when RFKILL_INPUT is not enabled
In-Reply-To: <48d00f81./8rb7yGSb9PmJx+R%Larry.Finger@lwfinger.net>
References: <48d00f81./8rb7yGSb9PmJx+R%Larry.Finger@lwfinger.net>
Message-ID: <200809171607.55403.mb@bu3sch.de>

On Tuesday 16 September 2008 21:56:49 Larry Finger wrote:
> If the system is misconfigured with CONFIG_RFKILL set but CONFIG_RFKILL_INPUT
> not set, the built-in radio LEDs will not work. In the current code, no warning
> is issued.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---
> 
> John,
> 
> This is material for the next merge.


ACK

> Larry
> 
> 
> Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
> +++ wireless-testing/drivers/net/wireless/b43/rfkill.c
> @@ -188,6 +188,11 @@ void b43_rfkill_init(struct b43_wldev *d
>  			"The built-in radio LED will not work.\n");
>  #endif /* CONFIG_RFKILL_INPUT */
>  
> +#if !defined(CONFIG_RFKILL_INPUT) && !defined(CONFIG_RFKILL_INPUT_MODULE)
> +	b43warn(wl, "The rfkill-input subsystem is not available. "
> +		"The built-in radio LED will not work.\n");
> +#endif
> +
>  	err = input_register_polled_device(rfk->poll_dev);
>  	if (err)
>  		goto err_unreg_rfk;
> 
> 



-- 
Greetings Michael.


From linville at tuxdriver.com  Wed Sep 17 15:23:07 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Wed, 17 Sep 2008 09:23:07 -0400
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <48D070DC.80007@lwfinger.net>
References: <48CFC03A.8020708@lwfinger.net> <200809161742.15527.mb@bu3sch.de>
	<48CFE820.7010305@lwfinger.net>
	<200809162018.28548.carlos@strangeworlds.co.uk>
	<48D0095B.40403@lwfinger.net>
	<20080916233240.GA18574@srcf.ucam.org>
	<20080917023334.GA1187@khazad-dum.debian.net>
	<48D070DC.80007@lwfinger.net>
Message-ID: <20080917132305.GA5407@tuxdriver.com>

On Tue, Sep 16, 2008 at 09:52:12PM -0500, Larry Finger wrote:

> I admit that I never tested any of the RFKILL patches as they went in.
> One of the reasons is that the development process seemed rather
> untidy to an outsider, and I wasn't sure that any of the code would
> ever be in the kernel. As such, it snuck up on me. I'll not let that
> happen again. After the reversion, I will again test any suggested
> code changes, but do not expect me to work out any of the changes. I
> have enough to do.

FWIW, Henrique has been very persistant with driving rfkill.  He has
posted and reposted his patch series many times.  I'm sorry that it
snuck-up on you but it was on the list for quite a while.

John
-- 
John W. Linville
linville at tuxdriver.com


From mb at bu3sch.de  Wed Sep 17 16:19:33 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:19:33 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916210920.GC16470@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <48D0183E.9010301@lwfinger.net>
	<20080916210920.GC16470@srcf.ucam.org>
Message-ID: <200809171619.33377.mb@bu3sch.de>

On Tuesday 16 September 2008 23:09:20 Matthew Garrett wrote:
> Oh, hey, I suck. This one might stand a better chance of not falling 
> over.
> 
> diff --git a/drivers/net/wireless/b43/rfkill.c b/drivers/net/wireless/b43/rfkill.c
> index fec5645..991e318 100644
> --- a/drivers/net/wireless/b43/rfkill.c
> +++ b/drivers/net/wireless/b43/rfkill.c
> @@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev *dev)
>  	struct b43_rfkill *rfk = &(dev->wl->rfkill);
>  
>  	if (!dev->radio_hw_enable) {
> -		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
>  		return;
>  	}
>  
>  	if (!dev->phy.radio_on)
> -		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
>  	else
> -		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
> -
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
>  }

I still thing that it is really wrong to check and change the software
rfkill state from within the _hardware_ rfkill state handler.
So let's say this handler sets the state to SOFT_BLOCKED. Who is going
to set it back to unblocked, if the user unblocks the radio?

We can turn the radio on/off from the mac80211 config callback. Possibly
we must tell rfkill about it (I'm not sure. I don't understand the API).
I think this is pretty hard to get right, actually. HW-block and SW-block
are two completely independent states in b43. You can HW-block and SW-block
the device at the same time. So one must make sure that at any time the rfkill
is in a sane state if _either_ HW-block or SW-block changes. Currently I think
we only change rfkill state if HW-block state changes. Which is wrong.


In the end, I do not care about this crap anymore.
Feel free to remove my copyright notice from that file and put yours in
there. So feel free to send any patch to the rfkill code to john, but please
handle any regressions resulting from it. If not, I will handle them by reverting
patches until it starts to work again. ;)

-- 
Greetings Michael.


From mb at bu3sch.de  Wed Sep 17 16:22:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:22:55 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916233240.GA18574@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <48D0095B.40403@lwfinger.net>
	<20080916233240.GA18574@srcf.ucam.org>
Message-ID: <200809171622.55882.mb@bu3sch.de>

On Wednesday 17 September 2008 01:32:40 Matthew Garrett wrote:
> On Tue, Sep 16, 2008 at 02:30:35PM -0500, Larry Finger wrote:
> 
> > I didn't say it was not possible. What I said is that _ONLY_ the
> > operator's finger could change the state, just like in your laptop.
> > Thus it makes absolutely no difference what state RFKILL thinks it is
> > in.
> 
> Of course it makes a difference. The reason why two states are provided 
> is to allow userspace to distinguish whether it can unblock the device 
> or not. It's clear that b43's rfkill code is astonishingly broken (and 
> that's not a criticism of anyone involved - the documentation's 
> confusing and there weren't any good examples of how it should be 
> implemented).
> 
> The real question is how the LED state is supposed to be being toggled, 
> and what that's got to do with rfkill. I /think/ that the current state 
> of events is:

Read the rfkill code. It toggles a LED trigger if the state changes from
UNBLOCKED to BLOCKED. b43 uses that trigger to run the radio LED.

> 1) User toggles state
> 2) b43 changes rfkill state (by using rfkill_force_state). The LED state 
> should also be changed in the process.

No it shouldn't. LEDs are entirely handled by triggers. We must _never_ toggle
the LED state from within b43 directly via hardcoded stuff.
rfkill is responsible for handling the radio LEDs in the machine.

-- 
Greetings Michael.


From mb at bu3sch.de  Wed Sep 17 16:26:28 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:26:28 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916223729.GC26035@khazad-dum.debian.net>
References: <48CFC03A.8020708@lwfinger.net> <200809162125.18978.mb@bu3sch.de>
	<20080916223729.GC26035@khazad-dum.debian.net>
Message-ID: <200809171626.28782.mb@bu3sch.de>

On Wednesday 17 September 2008 00:37:29 Henrique de Moraes Holschuh wrote:
> On Tue, 16 Sep 2008, Michael Buesch wrote:
> > But I don't know how to tell the rfkill subsystem about the states and
> 
> rfkill_force_state().  Must NOT be called from within atomic contextes,
> something I haven't got around to find a proper way of fixing, and nobody
> else seems to be on a rfkill coding frenzy right now.

That's a showstopper for us, as we have to change the state from
within an interrupt tasklet.

> I won't go on the rfkill-allocate/-free stuff, messing with that API means
> you need to fix a lot of other people's drivers.  But you have the
> rfkill-hw-state-changed now, it is called rfkill_force_state().  The only
> crap is that it cannot be called from atomic contexts.

Yeah well. I didn't know. I lost interest in rfkill pretty much when it
stopped blowing up (until it started again when somebody merged a patch
recently).

-- 
Greetings Michael.


From linville at tuxdriver.com  Wed Sep 17 16:29:31 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Wed, 17 Sep 2008 10:29:31 -0400
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <200809171626.28782.mb@bu3sch.de>
References: <48CFC03A.8020708@lwfinger.net> <200809162125.18978.mb@bu3sch.de>
	<20080916223729.GC26035@khazad-dum.debian.net>
	<200809171626.28782.mb@bu3sch.de>
Message-ID: <20080917142931.GF5407@tuxdriver.com>

On Wed, Sep 17, 2008 at 04:26:28PM +0200, Michael Buesch wrote:
> On Wednesday 17 September 2008 00:37:29 Henrique de Moraes Holschuh wrote:
> > On Tue, 16 Sep 2008, Michael Buesch wrote:
> > > But I don't know how to tell the rfkill subsystem about the states and
> > 
> > rfkill_force_state().  Must NOT be called from within atomic contextes,
> > something I haven't got around to find a proper way of fixing, and nobody
> > else seems to be on a rfkill coding frenzy right now.
> 
> That's a showstopper for us, as we have to change the state from
> within an interrupt tasklet.

Workqueue?

-- 
John W. Linville
linville at tuxdriver.com


From mb at bu3sch.de  Wed Sep 17 16:33:41 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:33:41 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080917142931.GF5407@tuxdriver.com>
References: <48CFC03A.8020708@lwfinger.net> <200809171626.28782.mb@bu3sch.de>
	<20080917142931.GF5407@tuxdriver.com>
Message-ID: <200809171633.41397.mb@bu3sch.de>

On Wednesday 17 September 2008 16:29:31 John W. Linville wrote:
> On Wed, Sep 17, 2008 at 04:26:28PM +0200, Michael Buesch wrote:
> > On Wednesday 17 September 2008 00:37:29 Henrique de Moraes Holschuh wrote:
> > > On Tue, 16 Sep 2008, Michael Buesch wrote:
> > > > But I don't know how to tell the rfkill subsystem about the states and
> > > 
> > > rfkill_force_state().  Must NOT be called from within atomic contextes,
> > > something I haven't got around to find a proper way of fixing, and nobody
> > > else seems to be on a rfkill coding frenzy right now.
> > 
> > That's a showstopper for us, as we have to change the state from
> > within an interrupt tasklet.
> 
> Workqueue?

Yeah, that's possible to implement yet another workaround using a workqueue.
However it would be nice to have rfkill either support atomic context
or implement the workaround in the rfkill core, as I'm sure there are more
devices that report rfkill changes via interrupt.

-- 
Greetings Michael.


From mb at bu3sch.de  Wed Sep 17 16:22:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:22:55 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916233240.GA18574@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <48D0095B.40403@lwfinger.net> 
	<20080916233240.GA18574@srcf.ucam.org>
Message-ID: <200809171622.55882.mb@bu3sch.de>

On Wednesday 17 September 2008 01:32:40 Matthew Garrett wrote:
> On Tue, Sep 16, 2008 at 02:30:35PM -0500, Larry Finger wrote:
> 
> > I didn't say it was not possible. What I said is that _ONLY_ the
> > operator's finger could change the state, just like in your laptop.
> > Thus it makes absolutely no difference what state RFKILL thinks it is
> > in.
> 
> Of course it makes a difference. The reason why two states are provided 
> is to allow userspace to distinguish whether it can unblock the device 
> or not. It's clear that b43's rfkill code is astonishingly broken (and 
> that's not a criticism of anyone involved - the documentation's 
> confusing and there weren't any good examples of how it should be 
> implemented).
> 
> The real question is how the LED state is supposed to be being toggled, 
> and what that's got to do with rfkill. I /think/ that the current state 
> of events is:

Read the rfkill code. It toggles a LED trigger if the state changes from
UNBLOCKED to BLOCKED. b43 uses that trigger to run the radio LED.

> 1) User toggles state
> 2) b43 changes rfkill state (by using rfkill_force_state). The LED state 
> should also be changed in the process.

No it shouldn't. LEDs are entirely handled by triggers. We must _never_ toggle
the LED state from within b43 directly via hardcoded stuff.
rfkill is responsible for handling the radio LEDs in the machine.

-- 
Greetings Michael.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo at vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/


From mb at bu3sch.de  Wed Sep 17 16:19:33 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 16:19:33 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080916210920.GC16470@srcf.ucam.org>
References: <48CFC03A.8020708@lwfinger.net> <48D0183E.9010301@lwfinger.net> 
	<20080916210920.GC16470@srcf.ucam.org>
Message-ID: <200809171619.33377.mb@bu3sch.de>

On Tuesday 16 September 2008 23:09:20 Matthew Garrett wrote:
> Oh, hey, I suck. This one might stand a better chance of not falling 
> over.
> 
> diff --git a/drivers/net/wireless/b43/rfkill.c b/drivers/net/wireless/b43/rfkill.c
> index fec5645..991e318 100644
> --- a/drivers/net/wireless/b43/rfkill.c
> +++ b/drivers/net/wireless/b43/rfkill.c
> @@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev *dev)
>  	struct b43_rfkill *rfk = &(dev->wl->rfkill);
>  
>  	if (!dev->radio_hw_enable) {
> -		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
>  		return;
>  	}
>  
>  	if (!dev->phy.radio_on)
> -		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
>  	else
> -		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
> -
> +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
>  }

I still thing that it is really wrong to check and change the software
rfkill state from within the _hardware_ rfkill state handler.
So let's say this handler sets the state to SOFT_BLOCKED. Who is going
to set it back to unblocked, if the user unblocks the radio?

We can turn the radio on/off from the mac80211 config callback. Possibly
we must tell rfkill about it (I'm not sure. I don't understand the API).
I think this is pretty hard to get right, actually. HW-block and SW-block
are two completely independent states in b43. You can HW-block and SW-block
the device at the same time. So one must make sure that at any time the rfkill
is in a sane state if _either_ HW-block or SW-block changes. Currently I think
we only change rfkill state if HW-block state changes. Which is wrong.


In the end, I do not care about this crap anymore.
Feel free to remove my copyright notice from that file and put yours in
there. So feel free to send any patch to the rfkill code to john, but please
handle any regressions resulting from it. If not, I will handle them by reverting
patches until it starts to work again. ;)

-- 
Greetings Michael.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo at vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/


From Larry.Finger at lwfinger.net  Wed Sep 17 17:28:27 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 17 Sep 2008 10:28:27 -0500
Subject: Regression in 2.6.27-rcX caused by
	commit	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080917145007.GA5186@khazad-dum.debian.net>
References: <48CFC03A.8020708@lwfinger.net> <48D0095B.40403@lwfinger.net>
	<20080916233240.GA18574@srcf.ucam.org>
	<200809171622.55882.mb@bu3sch.de>
	<20080917145007.GA5186@khazad-dum.debian.net>
Message-ID: <48D1221B.1000601@lwfinger.net>

Henrique de Moraes Holschuh wrote:
> 
> He means rfkill_force_state() should change the LED state in the process,
> which it isn't doing.
> 
> It is an one-line patch, I am testing it now.
> 

If your one-line patch fixes my regression, then I'll ACK it for 2.6.27.

Larry


From Larry.Finger at lwfinger.net  Wed Sep 17 17:47:40 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 17 Sep 2008 10:47:40 -0500
Subject: Regression in 2.6.27-rcX caused by
	commit	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080917153637.GD5186@khazad-dum.debian.net>
References: <48CFC03A.8020708@lwfinger.net> <48D0095B.40403@lwfinger.net>
	<20080916233240.GA18574@srcf.ucam.org>
	<200809171622.55882.mb@bu3sch.de>
	<20080917145007.GA5186@khazad-dum.debian.net>
	<48D1221B.1000601@lwfinger.net>
	<20080917153637.GD5186@khazad-dum.debian.net>
Message-ID: <48D1269C.4060301@lwfinger.net>

Henrique de Moraes Holschuh wrote:
> 
> Sorry, it can't fix that regression by itself, since b43 is not using
> rfkill_force_state() in mainline.
> 
> It will fix the same issue you are experiencing on b43 in anything that uses
> rfkill_force_state(), which means (for mainline): iwlwifi, rt2x00,
> thinkpad-acpi and hp-wmi.
> 
> It is a regression only on b43 and thinkpad-acpi, as the other drivers above
> didn't use rfkill_force_state() in 2.6.26.
> 
> To fix the regression in b43, you'd be faced with the need of both my simple
> patch AND Matthew's more complex one.

I don't expect that the more complex one will be accepted into 2.6.27.

Larry


From mb at bu3sch.de  Wed Sep 17 17:59:32 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Wed, 17 Sep 2008 17:59:32 +0200
Subject: Regression in 2.6.27-rcX caused by commit
	bc19d6e0b74ef03a3baf035412c95192b54dfc6f
In-Reply-To: <20080917151822.GB5186@khazad-dum.debian.net>
References: <48CFC03A.8020708@lwfinger.net> <200809171619.33377.mb@bu3sch.de>
	<20080917151822.GB5186@khazad-dum.debian.net>
Message-ID: <200809171759.32645.mb@bu3sch.de>

On Wednesday 17 September 2008 17:18:22 Henrique de Moraes Holschuh wrote:
> On Wed, 17 Sep 2008, Michael Buesch wrote:
> > On Tuesday 16 September 2008 23:09:20 Matthew Garrett wrote:
> > > Oh, hey, I suck. This one might stand a better chance of not falling 
> > > over.
> > > 
> > > diff --git a/drivers/net/wireless/b43/rfkill.c b/drivers/net/wireless/b43/rfkill.c
> > > index fec5645..991e318 100644
> > > --- a/drivers/net/wireless/b43/rfkill.c
> > > +++ b/drivers/net/wireless/b43/rfkill.c
> > > @@ -49,21 +49,18 @@ static void b43_rfkill_update_state(struct b43_wldev *dev)
> > >  	struct b43_rfkill *rfk = &(dev->wl->rfkill);
> > >  
> > >  	if (!dev->radio_hw_enable) {
> > > -		rfk->rfkill->state = RFKILL_STATE_HARD_BLOCKED;
> > > +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_HARD_BLOCKED);
> > >  		return;
> > >  	}
> > >  
> > >  	if (!dev->phy.radio_on)
> > > -		rfk->rfkill->state = RFKILL_STATE_SOFT_BLOCKED;
> > > +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_SOFT_BLOCKED);
> > >  	else
> > > -		rfk->rfkill->state = RFKILL_STATE_UNBLOCKED;
> > > -
> > > +		rfkill_force_state(rfk->rfkill, RFKILL_STATE_UNBLOCKED);
> > >  }
> > 
> > I still thing that it is really wrong to check and change the software
> > rfkill state from within the _hardware_ rfkill state handler.
> > So let's say this handler sets the state to SOFT_BLOCKED. Who is going
> > to set it back to unblocked, if the user unblocks the radio?
> 
> I would suggest reading the updated docs, but I know you'd rather just stay
> away from rfkill.
> 
> For reference:
> 
> Basically, your wireless device driver has to monitor any hardware rfkill
> lines and call rfkill_force_state() accordingly (you don't even need to
> track if the state changed, rfkill core will do that).
> 
> The call to rfkill_force_state() should set state to HARD_BLOCKED (any of
> the hardware rfkill lines are active), SOFT_BLOCKED (no hardware rfkill
> lines are active, but one of the software rfkill lines are active), or
> UNBLOCKED (no rfkill lines of any type are active).
> 
> Whether this is to be done through interrupts or pooling is something that
> depends on your driver and the hardware.
> 
> User and userspace interaction is taken care of by the rfkill core.  You do
> nothing of the sort in the wireless device driver.
> 
> There are *very few* exceptions for the above as far as wireless device
> drivers go.  They are explained in the docs, and I know of no wireless
> device driver that would require any them.
> 
> > We can turn the radio on/off from the mac80211 config callback. Possibly
> > we must tell rfkill about it (I'm not sure. I don't understand the API).
> > I think this is pretty hard to get right, actually. HW-block and SW-block
> > are two completely independent states in b43. You can HW-block and SW-block
> > the device at the same time. So one must make sure that at any time the rfkill
> > is in a sane state if _either_ HW-block or SW-block changes. Currently I think
> > we only change rfkill state if HW-block state changes. Which is wrong.
> 
> Again, for reference:
> 
> You need to synthesize a single state (unblock/soft-block/hard-block) for a
> transmitter from every rfkill line that affects that transmitter.  This
> happens because the interface is a SINGLE ONE rfkill class per independent
> wireless interface ("transmitter").

Right. But that's not what I was talking about. The hw and sw rfkill is something
_completely_ different in b43 and it's handled by _completely_ different codepaths.
I just said that currently the sw-rfkill path does _not_ announce the state
correctly to the rfkill subsystem. Additionally we must _not_ check the sw rfkill
state from within the hw rfkill handlers, as it will get out of sync this way.
(that's what we're currently doing. If you revert the commit from the subject
this will go away, afaics).
Telling rfkill about the state isn't the hard part, but the
"You need to synthesize a single state" part, which currently is not done correctly.
We currently have _two_ states. (Don't get me wrong, the fix is _not_ to remove
either of these. The fix is to introduce a common rfkill notifier that constructs
a common rfkill state from these two states. This notifier is called from hw-rfkill
and sw-rfkill.)

-- 
Greetings Michael.


From celejar at gmail.com  Thu Sep 18 06:45:09 2008
From: celejar at gmail.com (Celejar)
Date: Thu, 18 Sep 2008 00:45:09 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D06B9E.70307@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
Message-ID: <20080918004509.23a4bdc9.celejar@gmail.com>

On Tue, 16 Sep 2008 21:29:50 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Celejar wrote:
> > Hi,
> > 
> > With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
> > to APs that broadcast essid, but not one that doesn't.  The card does
> > not associate.  Is this a b43 issue, or a mac80211 issue, or something
> > else? Kernels are from wireless-testing.git.
> 
> It is difficult to say. As you have wireless-testing.git, please
> bisect the source to find the problem. If you don't know how to use
> git for this, see
> 
> http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html

Done.

544ec9a11fdef5142a76a8eb4b186a80a272c035 is first bad commit
commit 544ec9a11fdef5142a76a8eb4b186a80a272c035
Author: Luis R. Rodriguez <lrodriguez at atheros.com>
Date:   Tue Sep 9 23:19:48 2008 -0700

    cfg80211: Add new wireless regulatory infrastructure
    
    This adds the new wireless regulatory infrastructure. The
    main motiviation behind this was to centralize regulatory
    code as each driver was implementing their own regulatory solution,
    and to replace the initial centralized code we have where:
    
    * only 3 regulatory domains are supported: US, JP and EU
    * regulatory domains can only be changed through module parameter
    * all rules were built statically in the kernel
    
    We now have support for regulatory domains for many countries
    and regulatory domains are now queried through a userspace agent
    through udev allowing distributions to update regulatory rules
    without updating the kernel.
    
    Each driver can regulatory_hint() a regulatory domain
    based on either their EEPROM mapped regulatory domain value to a
    respective ISO/IEC 3166-1 country code or pass an internally built
    regulatory domain. We also add support to let the user set the
    regulatory domain through userspace in case of faulty EEPROMs to
    further help compliance.
    
    Support for world roaming will be added soon for cards capable of
    this.

    
    For more information see:
    
    http://wireless.kernel.org/en/developers/Regulatory/CRDA
    
    For now we leave an option to enable the old module parameter,
    ieee80211_regdom, and to build the 3 old regdomains statically
    (US, JP and EU). This option is CONFIG_WIRELESS_OLD_REGULATORY.
    These old static definitions and the module parameter is being
    scheduled for removal for 2.6.29. Note that if you use this
    you won't make use of a world regulatory domain as its pointless.
    If you leave this option enabled and if CRDA is present and you
    use US or JP we will try to ask CRDA to update us a regulatory
    domain for us.
    
    Signed-off-by: Luis R. Rodriguez <lrodriguez at atheros.com>
    Signed-off-by: John W. Linville <linville at tuxdriver.com>

:040000 040000 ae38882f5bc91650e02efa252cc2e303995c0819 7b9e7e18ce3a926c37c220c78841b6186b6f5775 M	Documentation
:040000 040000 806765c9be407e6e750675d61abbedb33c940c81 30635573ce219fe8164254743eb03a095f0b3b22 M	include
:040000 040000 2344737e872cfc7d0b91d0e4210f5961f62a712e 1bf6ec2032aaa262731579778c8f9f5e7e65d78c M	net

> Larry

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Thu Sep 18 07:07:51 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 00:07:51 -0500
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
Message-ID: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>

The changes below, along with Henriques patch "[PATCH] rfkill: update
LEDs for all state changes", and the reversion of commit bc19d6e make
the wireless LED toggle correctly.

I'll let the experts discuss whether the changes below have problems
of the sort that were discussed in the context of the regression I
found.

Larry

Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -44,13 +44,11 @@ static bool b43_is_hw_radio_enabled(stru
 	return 0;
 }
 
-/* The poll callback for the hardware button. */
-static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
+static void b43_rfkill_update(struct b43_wldev *dev)
 {
-	struct b43_wldev *dev = poll_dev->private;
 	struct b43_wl *wl = dev->wl;
 	bool enabled;
-	bool report_change = 0;
+	struct b43_rfkill *rfk = &(dev->wl->rfkill);
 
 	mutex_lock(&wl->mutex);
 	if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {
@@ -60,18 +58,40 @@ static void b43_rfkill_poll(struct input
 	enabled = b43_is_hw_radio_enabled(dev);
 	if (unlikely(enabled != dev->radio_hw_enable)) {
 		dev->radio_hw_enable = enabled;
-		report_change = 1;
 		b43info(wl, "Radio hardware status changed to %s\n",
 			enabled ? "ENABLED" : "DISABLED");
+		if (!enabled)
+			rfkill_force_state(rfk->rfkill,
+					   RFKILL_STATE_HARD_BLOCKED);
+		else {
+			if (!dev->phy.radio_on)
+				rfkill_force_state(rfk->rfkill,
+						   RFKILL_STATE_SOFT_BLOCKED);
+			else
+				rfkill_force_state(rfk->rfkill,
+						   RFKILL_STATE_UNBLOCKED);
+		}
 	}
 	mutex_unlock(&wl->mutex);
+}
 
-	/* send the radio switch event to the system - note both a key press
-	 * and a release are required */
-	if (unlikely(report_change)) {
-		input_report_key(poll_dev->input, KEY_WLAN, 1);
-		input_report_key(poll_dev->input, KEY_WLAN, 0);
-	}
+static void b43_rfkill_poll(unsigned long data)
+{
+	struct b43_rfkill *rfkill = (struct b43_rfkill *)data;
+	schedule_work(&rfkill->poll_queue);
+}
+
+static void b43_rfkill_work(struct work_struct *work)
+{
+	struct b43_rfkill *rfk = container_of(work, struct b43_rfkill,
+					      poll_queue);
+	struct b43_wl *wl = container_of(rfk, struct b43_wl, rfkill);
+	struct b43_wldev *dev = wl->current_dev;
+
+	b43_rfkill_update(dev);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	add_timer(&rfk->poll_timer);
 }
 
 /* Called when the RFKILL toggled in software. */
@@ -141,48 +161,23 @@ void b43_rfkill_init(struct b43_wldev *d
 	rfk->rfkill->toggle_radio = b43_rfkill_soft_toggle;
 	rfk->rfkill->user_claim_unsupported = 1;
 
-	rfk->poll_dev = input_allocate_polled_device();
-	if (!rfk->poll_dev) {
-		rfkill_free(rfk->rfkill);
-		goto err_freed_rfk;
-	}
-
-	rfk->poll_dev->private = dev;
-	rfk->poll_dev->poll = b43_rfkill_poll;
-	rfk->poll_dev->poll_interval = 1000; /* msecs */
-
-	rfk->poll_dev->input->name = rfk->name;
-	rfk->poll_dev->input->id.bustype = BUS_HOST;
-	rfk->poll_dev->input->id.vendor = dev->dev->bus->boardinfo.vendor;
-	rfk->poll_dev->input->evbit[0] = BIT(EV_KEY);
-	set_bit(KEY_WLAN, rfk->poll_dev->input->keybit);
-
 	err = rfkill_register(rfk->rfkill);
 	if (err)
-		goto err_free_polldev;
+		goto err_free_rfk;
 
-#ifdef CONFIG_RFKILL_INPUT_MODULE
-	/* B43 RF-kill isn't useful without the rfkill-input subsystem.
-	 * Try to load the module. */
-	err = request_module("rfkill-input");
-	if (err)
-		b43warn(wl, "Failed to load the rfkill-input module. "
-			"The built-in radio LED will not work.\n");
-#endif /* CONFIG_RFKILL_INPUT */
+	rfk->registered = 1;
 
-	err = input_register_polled_device(rfk->poll_dev);
-	if (err)
-		goto err_unreg_rfk;
+	INIT_WORK(&rfk->poll_queue, b43_rfkill_work);
 
-	rfk->registered = 1;
+	init_timer(&rfk->poll_timer);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	rfk->poll_timer.data = (unsigned long)rfk;
+	add_timer(&rfk->poll_timer);
 
 	return;
-err_unreg_rfk:
-	rfkill_unregister(rfk->rfkill);
-err_free_polldev:
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
-err_freed_rfk:
+err_free_rfk:
+	rfkill_free(rfk->rfkill);
 	rfk->rfkill = NULL;
 out_error:
 	rfk->registered = 0;
@@ -197,9 +192,8 @@ void b43_rfkill_exit(struct b43_wldev *d
 		return;
 	rfk->registered = 0;
 
-	input_unregister_polled_device(rfk->poll_dev);
+	del_timer(&rfk->poll_timer);
+
 	rfkill_unregister(rfk->rfkill);
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
 	rfk->rfkill = NULL;
 }
Index: wireless-testing/drivers/net/wireless/b43/rfkill.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.h
+++ wireless-testing/drivers/net/wireless/b43/rfkill.h
@@ -7,14 +7,14 @@ struct b43_wldev;
 #ifdef CONFIG_B43_RFKILL
 
 #include <linux/rfkill.h>
-#include <linux/input-polldev.h>
-
 
 struct b43_rfkill {
 	/* The RFKILL subsystem data structure */
 	struct rfkill *rfkill;
-	/* The poll device for the RFKILL input button */
-	struct input_polled_dev *poll_dev;
+	/* The timer list for the RFKILL polling */
+	struct timer_list poll_timer;
+	/* Workqueue for the RFKILL polling */
+	struct work_struct poll_queue;
 	/* Did initialization succeed? Used for freeing. */
 	bool registered;
 	/* The unique name of this rfkill switch */


From Larry.Finger at lwfinger.net  Thu Sep 18 07:16:28 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 00:16:28 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080918004509.23a4bdc9.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
Message-ID: <48D1E42C.70904@lwfinger.net>

Celejar wrote:
> On Tue, 16 Sep 2008 21:29:50 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> 
>> Celejar wrote:
>>> Hi,
>>>
>>> With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
>>> to APs that broadcast essid, but not one that doesn't.  The card does
>>> not associate.  Is this a b43 issue, or a mac80211 issue, or something
>>> else? Kernels are from wireless-testing.git.
>> It is difficult to say. As you have wireless-testing.git, please
>> bisect the source to find the problem. If you don't know how to use
>> git for this, see
>>
>> http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html
> 
> Done.
> 
> 544ec9a11fdef5142a76a8eb4b186a80a272c035 is first bad commit
> commit 544ec9a11fdef5142a76a8eb4b186a80a272c035
> Author: Luis R. Rodriguez <lrodriguez at atheros.com>
> Date:   Tue Sep 9 23:19:48 2008 -0700

You need the patch at

http://marc.info/?l=linux-wireless&m=122117070715002&w=2

Your mention of hidden essid's made me think this was a different
problem. This bug makes all the channels disabled and kills all wireless.

Larry


From celejar at gmail.com  Thu Sep 18 07:52:02 2008
From: celejar at gmail.com (Celejar)
Date: Thu, 18 Sep 2008 01:52:02 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D1E42C.70904@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
Message-ID: <20080918015202.8c5f6381.celejar@gmail.com>

On Thu, 18 Sep 2008 00:16:28 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Celejar wrote:
> > On Tue, 16 Sep 2008 21:29:50 -0500
> > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > 
> >> Celejar wrote:
> >>> Hi,
> >>>
> >>> With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
> >>> to APs that broadcast essid, but not one that doesn't.  The card does
> >>> not associate.  Is this a b43 issue, or a mac80211 issue, or something
> >>> else? Kernels are from wireless-testing.git.
> >> It is difficult to say. As you have wireless-testing.git, please
> >> bisect the source to find the problem. If you don't know how to use
> >> git for this, see
> >>
> >> http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html
> > 
> > Done.
> > 
> > 544ec9a11fdef5142a76a8eb4b186a80a272c035 is first bad commit
> > commit 544ec9a11fdef5142a76a8eb4b186a80a272c035
> > Author: Luis R. Rodriguez <lrodriguez at atheros.com>
> > Date:   Tue Sep 9 23:19:48 2008 -0700
> 
> You need the patch at
> 
> http://marc.info/?l=linux-wireless&m=122117070715002&w=2
> 
> Your mention of hidden essid's made me think this was a different
> problem. This bug makes all the channels disabled and kills all wireless.

No; wireless *works* with another AP, although there are some PHY
transmission errors.  At least two differences between the two APs -
the working one broadcasts essid, as I mentioned earlier, and it uses
WPA-PSK TKIP.  The non-working one hides its essid, and doesn't use
encryption.  Earlier kernels worked fine on both.  iw shows that even
on the bad kernel, the channels aren't disabled, as they are in the
page you link to.  This seems to be a different problem.

$ bin/iw dev wmaster0 info
Band 1:
        Frequencies:
                * 2412 MHz (passive scanning, no IBSS)
                * 2417 MHz (passive scanning, no IBSS)
                * 2422 MHz (passive scanning, no IBSS)
                * 2427 MHz (passive scanning, no IBSS)
                * 2432 MHz (passive scanning, no IBSS)
                * 2437 MHz (passive scanning, no IBSS)
                * 2442 MHz (passive scanning, no IBSS)
                * 2447 MHz (passive scanning, no IBSS)
                * 2452 MHz (passive scanning, no IBSS)
                * 2457 MHz (passive scanning, no IBSS)
                * 2462 MHz (passive scanning, no IBSS)
                * 2467 MHz (disabled)
                * 2472 MHz (disabled)
                * 2484 MHz (disabled)

> Larry

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Thu Sep 18 14:26:57 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 07:26:57 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080918015202.8c5f6381.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>	<48D06B9E.70307@lwfinger.net>	<20080918004509.23a4bdc9.celejar@gmail.com>	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
Message-ID: <48D24911.80101@lwfinger.net>

Celejar wrote:
> On Thu, 18 Sep 2008 00:16:28 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> 
>> Celejar wrote:
>>> On Tue, 16 Sep 2008 21:29:50 -0500
>>> Larry Finger <Larry.Finger at lwfinger.net> wrote:
>>>
>>>> Celejar wrote:
>>>>> Hi,
>>>>>
>>>>> With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
>>>>> to APs that broadcast essid, but not one that doesn't.  The card does
>>>>> not associate.  Is this a b43 issue, or a mac80211 issue, or something
>>>>> else? Kernels are from wireless-testing.git.
>>>> It is difficult to say. As you have wireless-testing.git, please
>>>> bisect the source to find the problem. If you don't know how to use
>>>> git for this, see
>>>>
>>>> http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html
>>> Done.
>>>
>>> 544ec9a11fdef5142a76a8eb4b186a80a272c035 is first bad commit
>>> commit 544ec9a11fdef5142a76a8eb4b186a80a272c035
>>> Author: Luis R. Rodriguez <lrodriguez at atheros.com>
>>> Date:   Tue Sep 9 23:19:48 2008 -0700
>> You need the patch at
>>
>> http://marc.info/?l=linux-wireless&m=122117070715002&w=2
>>
>> Your mention of hidden essid's made me think this was a different
>> problem. This bug makes all the channels disabled and kills all wireless.
> 
> No; wireless *works* with another AP, although there are some PHY
> transmission errors.  At least two differences between the two APs -
> the working one broadcasts essid, as I mentioned earlier, and it uses
> WPA-PSK TKIP.  The non-working one hides its essid, and doesn't use
> encryption.  Earlier kernels worked fine on both.  iw shows that even
> on the bad kernel, the channels aren't disabled, as they are in the
> page you link to.  This seems to be a different problem.
> 
> $ bin/iw dev wmaster0 info
> Band 1:
>         Frequencies:
>                 * 2412 MHz (passive scanning, no IBSS)
>                 * 2417 MHz (passive scanning, no IBSS)
>                 * 2422 MHz (passive scanning, no IBSS)
>                 * 2427 MHz (passive scanning, no IBSS)
>                 * 2432 MHz (passive scanning, no IBSS)
>                 * 2437 MHz (passive scanning, no IBSS)
>                 * 2442 MHz (passive scanning, no IBSS)
>                 * 2447 MHz (passive scanning, no IBSS)
>                 * 2452 MHz (passive scanning, no IBSS)
>                 * 2457 MHz (passive scanning, no IBSS)
>                 * 2462 MHz (passive scanning, no IBSS)

It is the passive scanning that is killing you. For hidden essid, you
need an active scan. You need to implement the CRDA
(http://linuxwireless.org/en/developers/Regulatory/CRDA), which will
get your system to provide active scanning.

Larry


From Larry.Finger at lwfinger.net  Thu Sep 18 15:47:42 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 08:47:42 -0500
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181519.12366.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181519.12366.IvDoorn@gmail.com>
Message-ID: <48D25BFE.6020708@lwfinger.net>

Ivo van Doorn wrote:

> Is dev->phy.radio_on set when mac80211 has send an instruction
> to the driver to enable the radio (start() or config() callback)
> or does it represent the key state in the hardware?
> 
> If it is something coming from mac80211, then you do not want
> to send a SOFT_BLOCKED event since that will cause all other radios
> to be switched off simply because the b43 interface has not been
> enabled.
> 
> Off course when it represents the key state in the hardware then the
> code would be fine...

The state comes from mac80211 and is set in the config() callback.

What state should be sent at the point when the hardware block is
removed? It seems to me that forcing an UNBLOCKED state gives the
wrong result. Perhaps RFKILL does need to have 4 states so that an
RFKILL_STATE_HW_UNBLOCKED state can be transmitted.

Larry


From linville at tuxdriver.com  Thu Sep 18 15:52:52 2008
From: linville at tuxdriver.com (John W. Linville)
Date: Thu, 18 Sep 2008 09:52:52 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D24911.80101@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
Message-ID: <20080918135251.GD4552@tuxdriver.com>

On Thu, Sep 18, 2008 at 07:26:57AM -0500, Larry Finger wrote:

> > $ bin/iw dev wmaster0 info
> > Band 1:
> >         Frequencies:
> >                 * 2412 MHz (passive scanning, no IBSS)
> >                 * 2417 MHz (passive scanning, no IBSS)
> >                 * 2422 MHz (passive scanning, no IBSS)
> >                 * 2427 MHz (passive scanning, no IBSS)
> >                 * 2432 MHz (passive scanning, no IBSS)
> >                 * 2437 MHz (passive scanning, no IBSS)
> >                 * 2442 MHz (passive scanning, no IBSS)
> >                 * 2447 MHz (passive scanning, no IBSS)
> >                 * 2452 MHz (passive scanning, no IBSS)
> >                 * 2457 MHz (passive scanning, no IBSS)
> >                 * 2462 MHz (passive scanning, no IBSS)
> 
> It is the passive scanning that is killing you. For hidden essid, you
> need an active scan. You need to implement the CRDA
> (http://linuxwireless.org/en/developers/Regulatory/CRDA), which will
> get your system to provide active scanning.

Hmmm...does the user have CONFIG_WIRELESS_OLD_REGULATORY=y?  That is
supposed to enable identical behavior to what we had before w/o
requiring CRDA.

John
-- 
John W. Linville
linville at tuxdriver.com


From Larry.Finger at lwfinger.net  Thu Sep 18 16:07:51 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 09:07:51 -0500
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
Message-ID: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>

The changes below, along with Henriques patch "[PATCH] rfkill: update
LEDs for all state changes", and the reversion of commit bc19d6e make
the wireless LED toggle correctly.

This version passes UNBLOCKED to rfkill when the hardware switch enables the radio.

Most of this material comes from Matthew Garrett.

Larry

Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
+++ wireless-testing/drivers/net/wireless/b43/rfkill.c
@@ -44,13 +44,11 @@ static bool b43_is_hw_radio_enabled(stru
 	return 0;
 }
 
-/* The poll callback for the hardware button. */
-static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
+static void b43_rfkill_update(struct b43_wldev *dev)
 {
-	struct b43_wldev *dev = poll_dev->private;
 	struct b43_wl *wl = dev->wl;
 	bool enabled;
-	bool report_change = 0;
+	struct b43_rfkill *rfk = &(dev->wl->rfkill);
 
 	mutex_lock(&wl->mutex);
 	if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {
@@ -60,18 +58,35 @@ static void b43_rfkill_poll(struct input
 	enabled = b43_is_hw_radio_enabled(dev);
 	if (unlikely(enabled != dev->radio_hw_enable)) {
 		dev->radio_hw_enable = enabled;
-		report_change = 1;
 		b43info(wl, "Radio hardware status changed to %s\n",
 			enabled ? "ENABLED" : "DISABLED");
+		if (!enabled)
+			rfkill_force_state(rfk->rfkill,
+					   RFKILL_STATE_HARD_BLOCKED);
+		else
+			rfkill_force_state(rfk->rfkill,
+					   RFKILL_STATE_UNBLOCKED);
 	}
 	mutex_unlock(&wl->mutex);
+}
 
-	/* send the radio switch event to the system - note both a key press
-	 * and a release are required */
-	if (unlikely(report_change)) {
-		input_report_key(poll_dev->input, KEY_WLAN, 1);
-		input_report_key(poll_dev->input, KEY_WLAN, 0);
-	}
+static void b43_rfkill_poll(unsigned long data)
+{
+	struct b43_rfkill *rfkill = (struct b43_rfkill *)data;
+	schedule_work(&rfkill->poll_queue);
+}
+
+static void b43_rfkill_work(struct work_struct *work)
+{
+	struct b43_rfkill *rfk = container_of(work, struct b43_rfkill,
+					      poll_queue);
+	struct b43_wl *wl = container_of(rfk, struct b43_wl, rfkill);
+	struct b43_wldev *dev = wl->current_dev;
+
+	b43_rfkill_update(dev);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	add_timer(&rfk->poll_timer);
 }
 
 /* Called when the RFKILL toggled in software. */
@@ -141,48 +156,23 @@ void b43_rfkill_init(struct b43_wldev *d
 	rfk->rfkill->toggle_radio = b43_rfkill_soft_toggle;
 	rfk->rfkill->user_claim_unsupported = 1;
 
-	rfk->poll_dev = input_allocate_polled_device();
-	if (!rfk->poll_dev) {
-		rfkill_free(rfk->rfkill);
-		goto err_freed_rfk;
-	}
-
-	rfk->poll_dev->private = dev;
-	rfk->poll_dev->poll = b43_rfkill_poll;
-	rfk->poll_dev->poll_interval = 1000; /* msecs */
-
-	rfk->poll_dev->input->name = rfk->name;
-	rfk->poll_dev->input->id.bustype = BUS_HOST;
-	rfk->poll_dev->input->id.vendor = dev->dev->bus->boardinfo.vendor;
-	rfk->poll_dev->input->evbit[0] = BIT(EV_KEY);
-	set_bit(KEY_WLAN, rfk->poll_dev->input->keybit);
-
 	err = rfkill_register(rfk->rfkill);
 	if (err)
-		goto err_free_polldev;
+		goto err_free_rfk;
 
-#ifdef CONFIG_RFKILL_INPUT_MODULE
-	/* B43 RF-kill isn't useful without the rfkill-input subsystem.
-	 * Try to load the module. */
-	err = request_module("rfkill-input");
-	if (err)
-		b43warn(wl, "Failed to load the rfkill-input module. "
-			"The built-in radio LED will not work.\n");
-#endif /* CONFIG_RFKILL_INPUT */
+	rfk->registered = 1;
 
-	err = input_register_polled_device(rfk->poll_dev);
-	if (err)
-		goto err_unreg_rfk;
+	INIT_WORK(&rfk->poll_queue, b43_rfkill_work);
 
-	rfk->registered = 1;
+	init_timer(&rfk->poll_timer);
+	rfk->poll_timer.function = b43_rfkill_poll;
+	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
+	rfk->poll_timer.data = (unsigned long)rfk;
+	add_timer(&rfk->poll_timer);
 
 	return;
-err_unreg_rfk:
-	rfkill_unregister(rfk->rfkill);
-err_free_polldev:
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
-err_freed_rfk:
+err_free_rfk:
+	rfkill_free(rfk->rfkill);
 	rfk->rfkill = NULL;
 out_error:
 	rfk->registered = 0;
@@ -197,9 +187,8 @@ void b43_rfkill_exit(struct b43_wldev *d
 		return;
 	rfk->registered = 0;
 
-	input_unregister_polled_device(rfk->poll_dev);
+	del_timer(&rfk->poll_timer);
+
 	rfkill_unregister(rfk->rfkill);
-	input_free_polled_device(rfk->poll_dev);
-	rfk->poll_dev = NULL;
 	rfk->rfkill = NULL;
 }
Index: wireless-testing/drivers/net/wireless/b43/rfkill.h
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.h
+++ wireless-testing/drivers/net/wireless/b43/rfkill.h
@@ -7,14 +7,14 @@ struct b43_wldev;
 #ifdef CONFIG_B43_RFKILL
 
 #include <linux/rfkill.h>
-#include <linux/input-polldev.h>
-
 
 struct b43_rfkill {
 	/* The RFKILL subsystem data structure */
 	struct rfkill *rfkill;
-	/* The poll device for the RFKILL input button */
-	struct input_polled_dev *poll_dev;
+	/* The timer list for the RFKILL polling */
+	struct timer_list poll_timer;
+	/* Workqueue for the RFKILL polling */
+	struct work_struct poll_queue;
 	/* Did initialization succeed? Used for freeing. */
 	bool registered;
 	/* The unique name of this rfkill switch */


From Larry.Finger at lwfinger.net  Thu Sep 18 16:15:59 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 09:15:59 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080918135251.GD4552@tuxdriver.com>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net> <20080918135251.GD4552@tuxdriver.com>
Message-ID: <48D2629F.8030606@lwfinger.net>

John W. Linville wrote:
> 
> Hmmm...does the user have CONFIG_WIRELESS_OLD_REGULATORY=y?  That is
> supposed to enable identical behavior to what we had before w/o
> requiring CRDA.


From Larry.Finger at lwfinger.net  Thu Sep 18 17:17:23 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 10:17:23 -0500
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918144836.GI1583@khazad-dum.debian.net>
References: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>
	<20080918142405.GG1583@khazad-dum.debian.net>
	<200809181628.22544.IvDoorn@gmail.com>
	<20080918144836.GI1583@khazad-dum.debian.net>
Message-ID: <48D27103.1050709@lwfinger.net>

Henrique de Moraes Holschuh wrote:
> 
> IMHO if tx power off is handled by the wireless device driver through the
> software rfkill line, it DOES MEAN the radio goes into rfkill SOFT_BLOCK.
> 
> As long as the rfkill class is kept syncronized with reality through the use
> of rfkill_force_state(), this WILL work just fine, because no input events
> that change any other devices are ever sent by the rfkill core.
> 
> Now, if any input event generation (by the wireless device driver, since
> rfkill core NEVER does it) is in the picture, it could be more complicated
> (or not... after all, an *INPUT DEVICE* switch would simply *always* match
> the *particular* hardware rfkill input line it is tied to, regardless of
> radio state -- the input device does not CARE at all about the software
> rfkill lines, other hardware rfkill lines, wireless tx power state, or phase
> of the moon).

OK, now I'm totally confused. I realize that English is probably not
your first language, but simple declarative sentences would be nice.

The situation with b43 is as follows:

(a) When the hardware switch is off, the radio is hardware blocked.

(b) When the hardware switch is on, the radio should follow whatever
mac80211 and userland wants.

What should b43 do to make this happen? Does V2 do it right?

Larry


From Larry.Finger at lwfinger.net  Thu Sep 18 18:49:01 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 11:49:01 -0500
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918162440.GL1583@khazad-dum.debian.net>
References: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>
	<20080918142405.GG1583@khazad-dum.debian.net>
	<200809181628.22544.IvDoorn@gmail.com>
	<20080918144836.GI1583@khazad-dum.debian.net>
	<48D27103.1050709@lwfinger.net>
	<20080918162440.GL1583@khazad-dum.debian.net>
Message-ID: <48D2867D.6010501@lwfinger.net>

Henrique de Moraes Holschuh wrote:
> 
> The problem is in the "should".
> 
> Maybe something else than b43 (like firmware) changed the radio software
> rfkill bit, and it does not match what mac80211 and userland requested
> anymore.
> 
> What you need to pass to rfkill_force_state() is what the radio is currently
> doing.  So, the state you need to send to rfkill_force_state has to be based
> on the real state of the hardware's "soft switch bit".

The hardware does not have such a bit. Once it is initialized and
mac80211 sends it a packet, it will try to send it. That is true even
if the hardware switch is off. It just will not succeed.

> If the hardware "soft switch" bit is write-only, you have no choice but to
> use the mac80211 value like your V2 patch does, BTW.

Since we have only a read-only hardware switch bit, I think you are
saying that V2 is correct.

Larry



From mb at bu3sch.de  Thu Sep 18 19:14:58 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:14:58 +0200
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918142405.GG1583@khazad-dum.debian.net>
References: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>
	<20080918142405.GG1583@khazad-dum.debian.net>
Message-ID: <200809181914.58417.mb@bu3sch.de>

On Thursday 18 September 2008 16:24:05 Henrique de Moraes Holschuh wrote:
> On Thu, 18 Sep 2008, Larry Finger wrote:
> > The changes below, along with Henriques patch "[PATCH] rfkill: update
> > LEDs for all state changes", and the reversion of commit bc19d6e make
> > the wireless LED toggle correctly.
> > 
> > This version passes UNBLOCKED to rfkill when the hardware switch enables the radio.
> 
> As I said in an email I just sent (unfortunately, after you already sent
> this patch), whatever goes to rfkill_force_state must be the CURRENT state
> of the hardware.
> 
> So, depending on what happens to b43 hardware when the hardware switch
> enables it (i.e. does it enable for real, ignoring the software rfkill input
> lines?), this patch might or might not be correct.

It does enable it, but software might still be blocking it.
sw and hw rfkill are two unrelated things in b43.

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:20:10 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:20:10 +0200
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <48D2867D.6010501@lwfinger.net>
References: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>
	<20080918162440.GL1583@khazad-dum.debian.net>
	<48D2867D.6010501@lwfinger.net>
Message-ID: <200809181920.10416.mb@bu3sch.de>

On Thursday 18 September 2008 18:49:01 Larry Finger wrote:
> Henrique de Moraes Holschuh wrote:
> > 
> > The problem is in the "should".
> > 
> > Maybe something else than b43 (like firmware) changed the radio software
> > rfkill bit, and it does not match what mac80211 and userland requested
> > anymore.
> > 
> > What you need to pass to rfkill_force_state() is what the radio is currently
> > doing.  So, the state you need to send to rfkill_force_state has to be based
> > on the real state of the hardware's "soft switch bit".
> 
> The hardware does not have such a bit. Once it is initialized and
> mac80211 sends it a packet, it will try to send it. That is true even
> if the hardware switch is off. It just will not succeed.

Right, b43 does have two "bits". One read-only bit that tells the hardware
block state. This state can only be changed by physically pressing rfkill
button. The other "bit" is a read/write "bit" to turn off the radio in software.
If _either_ one bit is blocking the radio, it will be physically blocked.

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:31:49 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:31:49 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
Message-ID: <200809181931.49636.mb@bu3sch.de>

On Thursday 18 September 2008 07:07:51 Larry Finger wrote:
> Index: wireless-testing/drivers/net/wireless/b43/rfkill.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c
> +++ wireless-testing/drivers/net/wireless/b43/rfkill.c
> @@ -44,13 +44,11 @@ static bool b43_is_hw_radio_enabled(stru
>  	return 0;
>  }
>  
> -/* The poll callback for the hardware button. */
> -static void b43_rfkill_poll(struct input_polled_dev *poll_dev)
> +static void b43_rfkill_update(struct b43_wldev *dev)
>  {
> -	struct b43_wldev *dev = poll_dev->private;
>  	struct b43_wl *wl = dev->wl;
>  	bool enabled;
> -	bool report_change = 0;
> +	struct b43_rfkill *rfk = &(dev->wl->rfkill);
>  
>  	mutex_lock(&wl->mutex);
>  	if (unlikely(b43_status(dev) < B43_STAT_INITIALIZED)) {
> @@ -60,18 +58,40 @@ static void b43_rfkill_poll(struct input
>  	enabled = b43_is_hw_radio_enabled(dev);
>  	if (unlikely(enabled != dev->radio_hw_enable)) {
>  		dev->radio_hw_enable = enabled;
> -		report_change = 1;
>  		b43info(wl, "Radio hardware status changed to %s\n",
>  			enabled ? "ENABLED" : "DISABLED");
> +		if (!enabled)
> +			rfkill_force_state(rfk->rfkill,
> +					   RFKILL_STATE_HARD_BLOCKED);
> +		else {
> +			if (!dev->phy.radio_on)
> +				rfkill_force_state(rfk->rfkill,
> +						   RFKILL_STATE_SOFT_BLOCKED);
> +			else
> +				rfkill_force_state(rfk->rfkill,
> +						   RFKILL_STATE_UNBLOCKED);
> +		}
>  	}
>  	mutex_unlock(&wl->mutex);

Can rfkill_force_state recurse into b43_rfkill_soft_toggle()?
input_report_key could do this in the past (Dunno if that's still true now),
so that's why it's done outside of the lock to avoid deadlocks.

Also keep in mind that N and LP(?) devices report state through interrupt.

> +}
>  
> -	/* send the radio switch event to the system - note both a key press
> -	 * and a release are required */
> -	if (unlikely(report_change)) {
> -		input_report_key(poll_dev->input, KEY_WLAN, 1);
> -		input_report_key(poll_dev->input, KEY_WLAN, 0);
> -	}
> +static void b43_rfkill_poll(unsigned long data)
> +{
> +	struct b43_rfkill *rfkill = (struct b43_rfkill *)data;
> +	schedule_work(&rfkill->poll_queue);
> +}
> +
> +static void b43_rfkill_work(struct work_struct *work)
> +{
> +	struct b43_rfkill *rfk = container_of(work, struct b43_rfkill,
> +					      poll_queue);
> +	struct b43_wl *wl = container_of(rfk, struct b43_wl, rfkill);
> +	struct b43_wldev *dev = wl->current_dev;
> +
> +	b43_rfkill_update(dev);
> +	rfk->poll_timer.function = b43_rfkill_poll;
> +	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
> +	add_timer(&rfk->poll_timer);
>  }

Why not using delayed work instead of reinventing the wheel?
Also please schedule it on the mac80211 workqueue to avoid possible
deadlocks with the networking core.

>  /* Called when the RFKILL toggled in software. */
> @@ -141,48 +161,23 @@ void b43_rfkill_init(struct b43_wldev *d
>  	rfk->rfkill->toggle_radio = b43_rfkill_soft_toggle;
>  	rfk->rfkill->user_claim_unsupported = 1;
>  
> -	rfk->poll_dev = input_allocate_polled_device();
> -	if (!rfk->poll_dev) {
> -		rfkill_free(rfk->rfkill);
> -		goto err_freed_rfk;
> -	}
> -
> -	rfk->poll_dev->private = dev;
> -	rfk->poll_dev->poll = b43_rfkill_poll;
> -	rfk->poll_dev->poll_interval = 1000; /* msecs */
> -
> -	rfk->poll_dev->input->name = rfk->name;
> -	rfk->poll_dev->input->id.bustype = BUS_HOST;
> -	rfk->poll_dev->input->id.vendor = dev->dev->bus->boardinfo.vendor;
> -	rfk->poll_dev->input->evbit[0] = BIT(EV_KEY);
> -	set_bit(KEY_WLAN, rfk->poll_dev->input->keybit);
> -
>  	err = rfkill_register(rfk->rfkill);
>  	if (err)
> -		goto err_free_polldev;
> +		goto err_free_rfk;
>  
> -#ifdef CONFIG_RFKILL_INPUT_MODULE
> -	/* B43 RF-kill isn't useful without the rfkill-input subsystem.
> -	 * Try to load the module. */
> -	err = request_module("rfkill-input");
> -	if (err)
> -		b43warn(wl, "Failed to load the rfkill-input module. "
> -			"The built-in radio LED will not work.\n");
> -#endif /* CONFIG_RFKILL_INPUT */
> +	rfk->registered = 1;
>  
> -	err = input_register_polled_device(rfk->poll_dev);
> -	if (err)
> -		goto err_unreg_rfk;
> +	INIT_WORK(&rfk->poll_queue, b43_rfkill_work);
>  
> -	rfk->registered = 1;
> +	init_timer(&rfk->poll_timer);
> +	rfk->poll_timer.function = b43_rfkill_poll;
> +	rfk->poll_timer.expires = round_jiffies(jiffies + HZ);
> +	rfk->poll_timer.data = (unsigned long)rfk;
> +	add_timer(&rfk->poll_timer);
>  
>  	return;
> -err_unreg_rfk:
> -	rfkill_unregister(rfk->rfkill);
> -err_free_polldev:
> -	input_free_polled_device(rfk->poll_dev);
> -	rfk->poll_dev = NULL;
> -err_freed_rfk:
> +err_free_rfk:
> +	rfkill_free(rfk->rfkill);
>  	rfk->rfkill = NULL;
>  out_error:
>  	rfk->registered = 0;
> @@ -197,9 +192,8 @@ void b43_rfkill_exit(struct b43_wldev *d
>  		return;
>  	rfk->registered = 0;
>  
> -	input_unregister_polled_device(rfk->poll_dev);
> +	del_timer(&rfk->poll_timer);
> +

cancel the work. I'm not sure whether to do it here, however.
One must take care to avoid deadlocks for wl->mutex.
I don't know from the top of my head whether b43_rfkill_exit is called
with the mutex locked or not. However, in case it is, dropping and
reaquireing the lock is not an option.

>  	rfkill_unregister(rfk->rfkill);
> -	input_free_polled_device(rfk->poll_dev);
> -	rfk->poll_dev = NULL;
>  	rfk->rfkill = NULL;
>  }
> Index: wireless-testing/drivers/net/wireless/b43/rfkill.h
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/rfkill.h
> +++ wireless-testing/drivers/net/wireless/b43/rfkill.h
> @@ -7,14 +7,14 @@ struct b43_wldev;
>  #ifdef CONFIG_B43_RFKILL
>  
>  #include <linux/rfkill.h>
> -#include <linux/input-polldev.h>
> -
>  
>  struct b43_rfkill {
>  	/* The RFKILL subsystem data structure */
>  	struct rfkill *rfkill;
> -	/* The poll device for the RFKILL input button */
> -	struct input_polled_dev *poll_dev;
> +	/* The timer list for the RFKILL polling */
> +	struct timer_list poll_timer;
> +	/* Workqueue for the RFKILL polling */
> +	struct work_struct poll_queue;
>  	/* Did initialization succeed? Used for freeing. */
>  	bool registered;
>  	/* The unique name of this rfkill switch */

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:34:02 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:34:02 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <48D25BFE.6020708@lwfinger.net>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181519.12366.IvDoorn@gmail.com>
	<48D25BFE.6020708@lwfinger.net>
Message-ID: <200809181934.03026.mb@bu3sch.de>

On Thursday 18 September 2008 15:47:42 Larry Finger wrote:
> Ivo van Doorn wrote:
> 
> > Is dev->phy.radio_on set when mac80211 has send an instruction
> > to the driver to enable the radio (start() or config() callback)
> > or does it represent the key state in the hardware?
> > 
> > If it is something coming from mac80211, then you do not want
> > to send a SOFT_BLOCKED event since that will cause all other radios
> > to be switched off simply because the b43 interface has not been
> > enabled.
> > 
> > Off course when it represents the key state in the hardware then the
> > code would be fine...
> 
> The state comes from mac80211 and is set in the config() callback.
> 
> What state should be sent at the point when the hardware block is
> removed? It seems to me that forcing an UNBLOCKED state gives the
> wrong result. Perhaps RFKILL does need to have 4 states so that an
> RFKILL_STATE_HW_UNBLOCKED state can be transmitted.

If sw is unblocked, but hw is still blocked, you must not announce
unblocked state to rfkill.


-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:37:38 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:37:38 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181553.29140.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<48D25BFE.6020708@lwfinger.net>
	<200809181553.29140.IvDoorn@gmail.com>
Message-ID: <200809181937.38257.mb@bu3sch.de>

On Thursday 18 September 2008 15:53:28 Ivo van Doorn wrote:
> On Thursday 18 September 2008, Larry Finger wrote:
> > Ivo van Doorn wrote:
> > 
> > > Is dev->phy.radio_on set when mac80211 has send an instruction
> > > to the driver to enable the radio (start() or config() callback)
> > > or does it represent the key state in the hardware?
> > > 
> > > If it is something coming from mac80211, then you do not want
> > > to send a SOFT_BLOCKED event since that will cause all other radios
> > > to be switched off simply because the b43 interface has not been
> > > enabled.
> > > 
> > > Off course when it represents the key state in the hardware then the
> > > code would be fine...
> > 
> > The state comes from mac80211 and is set in the config() callback.
> > 
> > What state should be sent at the point when the hardware block is
> > removed? It seems to me that forcing an UNBLOCKED state gives the
> > wrong result. Perhaps RFKILL does need to have 4 states so that an
> > RFKILL_STATE_HW_UNBLOCKED state can be transmitted.
> 
> When the key is pressed to unblock the device, then simply send state
> RFKILL_STATE_UNBLOCKED to rfkill. That will generate a trigger to the
> driver to enable the radio,

The radio is enabled in _hardware_. There doesn't need to be any trigger.
It's already on. In fact, such a trigger (done through rfkill->toggle callback)
would deadlock wl->mutex with the current patch.

> and at that time you can check if mac80211 
> wants the radio on or not (aka you check dev->phy.radio_on or the mac80211
> config structure).

No!
Software and hardware rfkill states are completely different and _independent_
states on the b43 hardware. You set the software state from the mac80211 callback
no matter what hardware state the device is in. You just have to announce the
state correctly to the rfkill subsystem if mac80211 changed the software
state.

Do not change any software state from within the hardware state change handler.
This will blow up.

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:41:45 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:41:45 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918142133.GF1583@khazad-dum.debian.net>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181553.29140.IvDoorn@gmail.com>
	<20080918142133.GF1583@khazad-dum.debian.net>
Message-ID: <200809181941.45301.mb@bu3sch.de>

On Thursday 18 September 2008 16:21:33 Henrique de Moraes Holschuh wrote:
> The problem is that it really boils down to something like this:
> 
> static inline enum rfkill_state translate_to_rfkill_state(
> 		const bool is_any_hw_rfkill_line_active_RIGHT_NOW,
> 		const bool is_any_sw_rfkill_line_active_RIGHT_NOW) {
> 
> 	if (is_any_hw_rfkill_line_active_RIGHT_NOW)
> 		return RFKILL_STATE_HARD_BLOCKED;
> 	else if (is_any_sw_rfkill_line_active_RIGHT_NOW)
> 		return RFKILL_STATE_SOFT_BLOCKED;
> 	else
> 		return RFKILL_STATE_UNBLOCKED;
> }
> 
> and send that to rfkill_force_state().

I agree with that. We must call that from the paths that change the software
state of the b43 radio and the hardware rfkill state notifiers in the b43 driver.

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:44:09 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:44:09 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181624.53050.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<20080918141006.GE1583@khazad-dum.debian.net>
	<200809181624.53050.IvDoorn@gmail.com>
Message-ID: <200809181944.10018.mb@bu3sch.de>

On Thursday 18 September 2008 16:24:52 Ivo van Doorn wrote:
> On Thursday 18 September 2008, Henrique de Moraes Holschuh wrote:
> > On Thu, 18 Sep 2008, Ivo van Doorn wrote:
> > > If it is something coming from mac80211, then you do not want
> > > to send a SOFT_BLOCKED event since that will cause all other radios
> > > to be switched off simply because the b43 interface has not been
> > > enabled.
> > 
> > Drivers ARE supposed to be able to set their radio state to their heart's
> > content, without messing with any other devices.  There are no constraints
> > to calls to rfkill_force_state(), other than the current issue that it must
> > not be done from an atomic context.
> 
> My main point was that when the radio is not enabled because the user
> did something like "iwconfig wlan0 txpower off" then this is not an rfkill
> SOFT_BLOCKED event. Since that command has nothing to do with the
> entire rfkill layer.
> 
> When you consider such commands as rfkill events you get wrong behavior
> because it would trigger a SOFT_BLOCK in rfkill which will be send to all
> registered drivers who can disable their radio off as well. And that is
> definately not what you want...

Well, if that's the definition of the API, we must not force rfkill
state to anything other than HW_BLOCKED or UNBLOCKED.
I dunno how the API is defined...

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 19:46:11 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:46:11 +0200
Subject: [RFC V2] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918144836.GI1583@khazad-dum.debian.net>
References: <48d260b7.SG5SGntEQ00lxFKi%Larry.Finger@lwfinger.net>
	<200809181628.22544.IvDoorn@gmail.com>
	<20080918144836.GI1583@khazad-dum.debian.net>
Message-ID: <200809181946.11477.mb@bu3sch.de>

On Thursday 18 September 2008 16:48:36 Henrique de Moraes Holschuh wrote:
> On Thu, 18 Sep 2008, Ivo van Doorn wrote:
> > On Thursday 18 September 2008, Henrique de Moraes Holschuh wrote:
> > > On Thu, 18 Sep 2008, Larry Finger wrote:
> > > > The changes below, along with Henriques patch "[PATCH] rfkill: update
> > > > LEDs for all state changes", and the reversion of commit bc19d6e make
> > > > the wireless LED toggle correctly.
> > > > 
> > > > This version passes UNBLOCKED to rfkill when the hardware switch enables the radio.
> > > 
> > > As I said in an email I just sent (unfortunately, after you already sent
> > > this patch), whatever goes to rfkill_force_state must be the CURRENT state
> > > of the hardware.
> > > 
> > > So, depending on what happens to b43 hardware when the hardware switch
> > > enables it (i.e. does it enable for real, ignoring the software rfkill input
> > > lines?), this patch might or might not be correct.
> > 
> > As far as I can see the v2 patch is correct, it sends the BLOCK event when the
> > rfkill key was pressed to block the radio and the UNBLOCK event when the rfkill
> > key was pressed to unblock the radio.
> 
> If rfkill_force_state() is being used, you MUST send to it the *real* radio
> state.  Not the cached radio state, not "desired" radio state, not "user
> requested" radio state.  It has to be the *real* radio state.
> 
> If a device driver is not doing so, it is incorrect and either it must send
> the real radio state, or it should be doing something else than calling
> rfkill_force_state().

So well. You tell me this way, and Ivo tells me the other way around to not
announce SW_BLOCKED state ever. ;)
What's actually right?

-- 
Greetings Michael.


From johannes at sipsolutions.net  Thu Sep 18 19:49:29 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 19:49:29 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181942.29122.IvDoorn@gmail.com>
	(sfid-20080918_194236_689430_7EB36354)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<48D25BFE.6020708@lwfinger.net> <200809181934.03026.mb@bu3sch.de>
	<200809181942.29122.IvDoorn@gmail.com>
	(sfid-20080918_194236_689430_7EB36354)
Message-ID: <1221760169.9262.91.camel@johannes.berg>

On Thu, 2008-09-18 at 19:42 +0200, Ivo van Doorn wrote:

> Well from my perspective:
> Note that 'sw' is the RADIO state as requested by mac80211 and
> 'hw' is the RFKILL state as indicated by the hardware
> 
> radio: block, rfkill: block => BLOCK
> radio: block, rfkill: unblock => UNBLOCK
> radio: unblock, rfkill: block => BLOCK
> radio: unblock, rfkill: unblock => UNBLOCK

Can't that crap just live in rfkill?

rfkill_announce_softstate(OPEN/BLOCKED)
rfkill_announce_hardstate(OPEN/BLOCKED)

and all the other junk happens there. And make sure this can be called
from interrupts.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/e9c7efc2/attachment.pgp>

From mb at bu3sch.de  Thu Sep 18 19:53:22 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:53:22 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181942.29122.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181934.03026.mb@bu3sch.de>
	<200809181942.29122.IvDoorn@gmail.com>
Message-ID: <200809181953.22746.mb@bu3sch.de>

On Thursday 18 September 2008 19:42:28 Ivo van Doorn wrote:
> On Thursday 18 September 2008, Michael Buesch wrote:
> > On Thursday 18 September 2008 15:47:42 Larry Finger wrote:
> > > Ivo van Doorn wrote:
> > > 
> > > > Is dev->phy.radio_on set when mac80211 has send an instruction
> > > > to the driver to enable the radio (start() or config() callback)
> > > > or does it represent the key state in the hardware?
> > > > 
> > > > If it is something coming from mac80211, then you do not want
> > > > to send a SOFT_BLOCKED event since that will cause all other radios
> > > > to be switched off simply because the b43 interface has not been
> > > > enabled.
> > > > 
> > > > Off course when it represents the key state in the hardware then the
> > > > code would be fine...
> > > 
> > > The state comes from mac80211 and is set in the config() callback.
> > > 
> > > What state should be sent at the point when the hardware block is
> > > removed? It seems to me that forcing an UNBLOCKED state gives the
> > > wrong result. Perhaps RFKILL does need to have 4 states so that an
> > > RFKILL_STATE_HW_UNBLOCKED state can be transmitted.
> > 
> > If sw is unblocked, but hw is still blocked, you must not announce
> > unblocked state to rfkill.
> 
> Well from my perspective:
> Note that 'sw' is the RADIO state as requested by mac80211 and
> 'hw' is the RFKILL state as indicated by the hardware
> 
> radio: block, rfkill: block => BLOCK
> radio: block, rfkill: unblock => UNBLOCK

If the radio is physically blocked by the hardware rfkill switch,
why on earth would we want to announce unblocked state?
Or did I get your table wrong?

(Still note that software and hardware states are _independent_ in b43.
Think of it as two independent bits that can each turn the radio off, where
the hardware state bit is readonly and is triggered by the hw-button).

-- 
Greetings Michael.


From johannes at sipsolutions.net  Thu Sep 18 19:54:09 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 19:54:09 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181952.15770.IvDoorn@gmail.com>
	(sfid-20080918_195224_932237_E9E182C0)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181624.53050.IvDoorn@gmail.com>
	<200809181944.10018.mb@bu3sch.de>
	<200809181952.15770.IvDoorn@gmail.com>
	(sfid-20080918_195224_932237_E9E182C0)
Message-ID: <1221760449.9262.96.camel@johannes.berg>

On Thu, 2008-09-18 at 19:52 +0200, Ivo van Doorn wrote:

> From rfkill.h:
> 	RFKILL_STATE_SOFT_BLOCKED = 0,	/* Radio output blocked */
> 	RFKILL_STATE_UNBLOCKED    = 1,	/* Radio output allowed */
> 	RFKILL_STATE_HARD_BLOCKED = 2,	/* Output blocked, non-overrideable */
> 
> Since b43 has a rfkill mechanism that does switch of the radio when RFKILL is set to BLOCK
> after a key press, it should send RFKILL_STATE_HARD_BLOCKED because rfkill cannot override
> it.
> 
> rt2x00 hardware does not change the radio state when RFKILL is set to BLOCK after a key press,
> the state is therefor overridable and it can send RFKILL_STATE_SOFT_BLOCKED to rfkill.

If rt2x00 has no meaning of "hardware blocked", why is the button not a
simple input device?

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/584966c9/attachment.pgp>

From mb at bu3sch.de  Thu Sep 18 19:56:59 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 19:56:59 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181948.27507.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181937.38257.mb@bu3sch.de>
	<200809181948.27507.IvDoorn@gmail.com>
Message-ID: <200809181957.00151.mb@bu3sch.de>

On Thursday 18 September 2008 19:48:27 Ivo van Doorn wrote:
> Well no actually, when the radio state (software rfkill state in your words)

No, "radio state" is _not_ "software rfkill state" in my words.
It's an independent state.
The actual physical radio state is a combined state of the two sw and hw state bits.
If either bit blocks the radio, it's physically blocked. We cannot toggle the hw bit
from software.

> it shouldn't be send to rfkill at all. rfkill should only be informed about the hardware
> rfkill state changes.

So that's fine. We just revert the patch that caused all the trouble and we will
gain _exactly_ that.

> > Do not change any software state from within the hardware state change handler.
> > This will blow up.
> 
> When you use userspace tools this won't happen since the hardware state change handler
> will send an uevent to userspace which might act upon that, and will eventually send an
> instruction back to the hardware, but that goes through a different thread.

It will semantically blow up. See the initial mail from Larry with the regression report.

-- 
Greetings Michael.


From johannes at sipsolutions.net  Thu Sep 18 19:54:09 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 19:54:09 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809181952.15770.IvDoorn@gmail.com>
	(sfid-20080918_195224_932237_E9E182C0)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181624.53050.IvDoorn@gmail.com>
	<200809181944.10018.mb@bu3sch.de>
	<200809181952.15770.IvDoorn@gmail.com>
	(sfid-20080918_195224_932237_E9E182C0)
Message-ID: <1221760449.9262.96.camel@johannes.berg>

On Thu, 2008-09-18 at 19:52 +0200, Ivo van Doorn wrote:

> From rfkill.h:
> 	RFKILL_STATE_SOFT_BLOCKED = 0,	/* Radio output blocked */
> 	RFKILL_STATE_UNBLOCKED    = 1,	/* Radio output allowed */
> 	RFKILL_STATE_HARD_BLOCKED = 2,	/* Output blocked, non-overrideable */
> 
> Since b43 has a rfkill mechanism that does switch of the radio when RFKILL is set to BLOCK
> after a key press, it should send RFKILL_STATE_HARD_BLOCKED because rfkill cannot override
> it.
> 
> rt2x00 hardware does not change the radio state when RFKILL is set to BLOCK after a key press,
> the state is therefor overridable and it can send RFKILL_STATE_SOFT_BLOCKED to rfkill.

If rt2x00 has no meaning of "hardware blocked", why is the button not a
simple input device?

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/584966c9/attachment-0001.pgp>

From johannes at sipsolutions.net  Thu Sep 18 20:13:46 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 20:13:46 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809182006.58620.IvDoorn@gmail.com>
	(sfid-20080918_200703_023992_1E2D0C69)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181952.15770.IvDoorn@gmail.com>
	<1221760449.9262.96.camel@johannes.berg>
	<200809182006.58620.IvDoorn@gmail.com>
	(sfid-20080918_200703_023992_1E2D0C69)
Message-ID: <1221761626.20772.0.camel@johannes.berg>

On Thu, 2008-09-18 at 20:06 +0200, Ivo van Doorn wrote:
> On Thursday 18 September 2008, Johannes Berg wrote:
> > On Thu, 2008-09-18 at 19:52 +0200, Ivo van Doorn wrote:
> > 
> > > From rfkill.h:
> > > 	RFKILL_STATE_SOFT_BLOCKED = 0,	/* Radio output blocked */
> > > 	RFKILL_STATE_UNBLOCKED    = 1,	/* Radio output allowed */
> > > 	RFKILL_STATE_HARD_BLOCKED = 2,	/* Output blocked, non-overrideable */
> > > 
> > > Since b43 has a rfkill mechanism that does switch of the radio when RFKILL is set to BLOCK
> > > after a key press, it should send RFKILL_STATE_HARD_BLOCKED because rfkill cannot override
> > > it.
> > > 
> > > rt2x00 hardware does not change the radio state when RFKILL is set to BLOCK after a key press,
> > > the state is therefor overridable and it can send RFKILL_STATE_SOFT_BLOCKED to rfkill.
> > 
> > If rt2x00 has no meaning of "hardware blocked", why is the button not a
> > simple input device?
> 
> Because I had that discussion with Henrique and that ended with a "it isn't a input device"...

Why isn't it? If it doesn't affect the hardware itself it might as well
be connected to the ps/2 port for all I care.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/172c893c/attachment.pgp>

From mb at bu3sch.de  Thu Sep 18 20:17:12 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 20:17:12 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809182010.35285.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181957.00151.mb@bu3sch.de>
	<200809182010.35285.IvDoorn@gmail.com>
Message-ID: <200809182017.12685.mb@bu3sch.de>

On Thursday 18 September 2008 20:10:35 Ivo van Doorn wrote:
> On Thursday 18 September 2008, Michael Buesch wrote:
> > On Thursday 18 September 2008 19:48:27 Ivo van Doorn wrote:
> > > Well no actually, when the radio state (software rfkill state in your words)
> > 
> > No, "radio state" is _not_ "software rfkill state" in my words.
> > It's an independent state.
> > The actual physical radio state is a combined state of the two sw and hw state bits.
> > If either bit blocks the radio, it's physically blocked. We cannot toggle the hw bit
> > from software.
> 
> Ah ok. In that case b43 should do:
> 
> send HW_BLOCK when the hardware rfkill state is set to block
> send SOFT_BLOCK when the software rfkill state is set to block
> 
> But it shouldn't (and that change was the start of this discussion) send SOFT_BLOCK
> when mac80211 disabled the radio.

I'm kind of confused. You say one thing and revert it right in the next sentence.

-- 
Greetings Michael.


From mb at bu3sch.de  Thu Sep 18 20:34:00 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Thu, 18 Sep 2008 20:34:00 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809182023.21751.IvDoorn@gmail.com>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809182017.12685.mb@bu3sch.de>
	<200809182023.21751.IvDoorn@gmail.com>
Message-ID: <200809182034.00801.mb@bu3sch.de>

On Thursday 18 September 2008 20:23:21 Ivo van Doorn wrote:
> On Thursday 18 September 2008, Michael Buesch wrote:
> > On Thursday 18 September 2008 20:10:35 Ivo van Doorn wrote:
> > > On Thursday 18 September 2008, Michael Buesch wrote:
> > > > On Thursday 18 September 2008 19:48:27 Ivo van Doorn wrote:
> > > > > Well no actually, when the radio state (software rfkill state in your words)
> > > > 
> > > > No, "radio state" is _not_ "software rfkill state" in my words.
> > > > It's an independent state.
> > > > The actual physical radio state is a combined state of the two sw and hw state bits.
> > > > If either bit blocks the radio, it's physically blocked. We cannot toggle the hw bit
> > > > from software.
> > > 
> > > Ah ok. In that case b43 should do:
> > > 
> > > send HW_BLOCK when the hardware rfkill state is set to block
> > > send SOFT_BLOCK when the software rfkill state is set to block
> > > 
> > > But it shouldn't (and that change was the start of this discussion) send SOFT_BLOCK
> > > when mac80211 disabled the radio.
> > 
> > I'm kind of confused. You say one thing and revert it right in the next sentence.
> 
> Ehm now you are confusing me.
> You state that software rfkill state is not the state as requested by mac80211.


Nono. I will try to explain it once again. It's really easy.

Think of b43 having two independent registers for rfkill. (the actual hardware
is different, but that doesn't matter. It's a driver internal implementation detail).
One of these registers is readonly and it does indicate the physical rfkill button state.
If that register indicates BLOCK, we can't do anything about it. The radio is blocked.
However, we can still write to the second register and turn the radio off through
that, too. We can also write to the second register to turn the radio on, _but_ it won't
physically turn on until the physical button is pressed and the first register changes
to Unblocked.
So you say that rfkill should only be notified about changes in the first read-only
hardware intication bit? If that's the case, it would be possible to turn the radio off
through mac80211 calls (using the read-write register), but still have rfkill think it's
unblocked.

-- 
Greetings Michael.


From johannes at sipsolutions.net  Thu Sep 18 20:36:35 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 20:36:35 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <200809182034.00801.mb@bu3sch.de>
	(sfid-20080918_203449_107036_C7A426D0)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809182017.12685.mb@bu3sch.de>
	<200809182023.21751.IvDoorn@gmail.com>
	<200809182034.00801.mb@bu3sch.de>
	(sfid-20080918_203449_107036_C7A426D0)
Message-ID: <1221762995.20772.9.camel@johannes.berg>

On Thu, 2008-09-18 at 20:34 +0200, Michael Buesch wrote:

> So you say that rfkill should only be notified about changes in the first read-only
> hardware intication bit? If that's the case, it would be possible to turn the radio off
> through mac80211 calls (using the read-write register), but still have rfkill think it's
> unblocked.

This is why I'm saying it needs to be integrated with mac80211. Anything
else is stupid because it would force drivers to keep track of all three
states.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/70d21718/attachment.pgp>

From johannes at sipsolutions.net  Thu Sep 18 21:14:15 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Thu, 18 Sep 2008 21:14:15 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080918184709.GN1583@khazad-dum.debian.net>
	(sfid-20080918_204723_031094_B6AF070E)
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181716.24355.IvDoorn@gmail.com>
	<20080918160803.GK1583@khazad-dum.debian.net>
	<200809181851.59182.IvDoorn@gmail.com>
	<20080918184709.GN1583@khazad-dum.debian.net>
	(sfid-20080918_204723_031094_B6AF070E)
Message-ID: <1221765255.20772.26.camel@johannes.berg>

On Thu, 2008-09-18 at 15:47 -0300, Henrique de Moraes Holschuh wrote:

> Passing rfkill state around using the input layer is broken, and caused real
> issues.  That is what cannot be done, that is what was fixed in the new API.
> But that does not preclude, e.g., b43, from also exporting input events...
> *as long as* it is done correctly.

[...]

I don't get it.

We only have a few things to control:

 * radio state for each device

and a few mechanisms:
 1) mac80211-internal (TPC, ..., iwconfig txpower off)
 2) per-hardware input button (soft)
 3) per-hardware rfkill button (hard)
 4) platform input buttons (soft)
 5) platform rfkill buttons (hard)

b43, for example, 1, 2 and 3 (where connected, this is unknown to the
driver) and may live on a platform that also has 4, 5 is very unlikely.

The way I see it, we should have about this architecture:

input layer        userspace      mac80211     driver     rfkill
  2 ----------------->|
                     (a)----------------------------------->|
  4 ----------------->|                                     |
                                      (b)<------------------|
                                       |
                                       +-------->(c)

                                      (e)<-------(d)
                                       |
                                       +------------------->|
                                                            |
                    (f)<------------------------------------|


(a) synthesize rfkill state for each driver out of the various input
    events you can get, depending on whether the platform button is
    bluetooth, wlan, all, ...
(b) take rfkill state and transform it into conf.radio_enabled along
    with the internal conf.radio_enabled state that mac80211 may decide
    on based on iwconfig txpower off. assume that users know what
    they're doing if they iwconfig txpower off, I think it's pretty
    pointless to have in light of rfkill and for all I care we can
    remove it
(c) take conf.radio_enabled and enable/disable radio
(d) notify mac80211 about _HARD_ rfkill state
(e) take that into account for internal state machine and report to
    rfkill subsystem
(f) display to user

Driver only has to follow conf.radio_enabled and inform mac80211 of the
hard state.

Where's the flaw?

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/60bd546d/attachment.pgp>

From celejar at gmail.com  Thu Sep 18 22:09:57 2008
From: celejar at gmail.com (Celejar)
Date: Thu, 18 Sep 2008 16:09:57 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D24911.80101@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
Message-ID: <20080918160957.94ea063d.celejar@gmail.com>

On Thu, 18 Sep 2008 07:26:57 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Celejar wrote:
> > On Thu, 18 Sep 2008 00:16:28 -0500
> > Larry Finger <Larry.Finger at lwfinger.net> wrote:
> > 
> >> Celejar wrote:
> >>> On Tue, 16 Sep 2008 21:29:50 -0500
> >>> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> >>>
> >>>> Celejar wrote:
> >>>>> Hi,
> >>>>>
> >>>>> With 2.6.27-rc3-wl everything worked; with 2.6.27-rc6-wl, I can connect
> >>>>> to APs that broadcast essid, but not one that doesn't.  The card does
> >>>>> not associate.  Is this a b43 issue, or a mac80211 issue, or something
> >>>>> else? Kernels are from wireless-testing.git.
> >>>> It is difficult to say. As you have wireless-testing.git, please
> >>>> bisect the source to find the problem. If you don't know how to use
> >>>> git for this, see
> >>>>
> >>>> http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html
> >>> Done.
> >>>
> >>> 544ec9a11fdef5142a76a8eb4b186a80a272c035 is first bad commit
> >>> commit 544ec9a11fdef5142a76a8eb4b186a80a272c035
> >>> Author: Luis R. Rodriguez <lrodriguez at atheros.com>
> >>> Date:   Tue Sep 9 23:19:48 2008 -0700
> >> You need the patch at
> >>
> >> http://marc.info/?l=linux-wireless&m=122117070715002&w=2
> >>
> >> Your mention of hidden essid's made me think this was a different
> >> problem. This bug makes all the channels disabled and kills all wireless.
> > 
> > No; wireless *works* with another AP, although there are some PHY
> > transmission errors.  At least two differences between the two APs -
> > the working one broadcasts essid, as I mentioned earlier, and it uses
> > WPA-PSK TKIP.  The non-working one hides its essid, and doesn't use
> > encryption.  Earlier kernels worked fine on both.  iw shows that even
> > on the bad kernel, the channels aren't disabled, as they are in the
> > page you link to.  This seems to be a different problem.
> > 
> > $ bin/iw dev wmaster0 info
> > Band 1:
> >         Frequencies:
> >                 * 2412 MHz (passive scanning, no IBSS)
> >                 * 2417 MHz (passive scanning, no IBSS)
> >                 * 2422 MHz (passive scanning, no IBSS)
> >                 * 2427 MHz (passive scanning, no IBSS)
> >                 * 2432 MHz (passive scanning, no IBSS)
> >                 * 2437 MHz (passive scanning, no IBSS)
> >                 * 2442 MHz (passive scanning, no IBSS)
> >                 * 2447 MHz (passive scanning, no IBSS)
> >                 * 2452 MHz (passive scanning, no IBSS)
> >                 * 2457 MHz (passive scanning, no IBSS)
> >                 * 2462 MHz (passive scanning, no IBSS)
> 
> It is the passive scanning that is killing you. For hidden essid, you
> need an active scan. You need to implement the CRDA
> (http://linuxwireless.org/en/developers/Regulatory/CRDA), which will
> get your system to provide active scanning.

Okay, I built and installed CRDA, and I now get:

Band 1:
        Frequencies:
                * 2412 MHz
                * 2417 MHz
                * 2422 MHz
                * 2427 MHz
                * 2432 MHz
                * 2437 MHz
                * 2442 MHz
                * 2447 MHz
                * 2452 MHz
                * 2457 MHz
                * 2462 MHz
                * 2467 MHz (disabled)
                * 2472 MHz (disabled)
                * 2484 MHz (disabled)

[This is also what I get with an earlier kernel.]

But the card *still* won't associate with the hidden essid AP; is there
anything else I need to do after 'make, make install' CRDA?

> Larry

Thanks,
Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From celejar at gmail.com  Thu Sep 18 22:13:33 2008
From: celejar at gmail.com (Celejar)
Date: Thu, 18 Sep 2008 16:13:33 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080918135251.GD4552@tuxdriver.com>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net> <20080918135251.GD4552@tuxdriver.com>
Message-ID: <20080918161333.578e7abb.celejar@gmail.com>

On Thu, 18 Sep 2008 09:52:52 -0400
"John W. Linville" <linville at tuxdriver.com> wrote:

> On Thu, Sep 18, 2008 at 07:26:57AM -0500, Larry Finger wrote:
> 
> > > $ bin/iw dev wmaster0 info
> > > Band 1:
> > >         Frequencies:
> > >                 * 2412 MHz (passive scanning, no IBSS)
> > >                 * 2417 MHz (passive scanning, no IBSS)
> > >                 * 2422 MHz (passive scanning, no IBSS)
> > >                 * 2427 MHz (passive scanning, no IBSS)
> > >                 * 2432 MHz (passive scanning, no IBSS)
> > >                 * 2437 MHz (passive scanning, no IBSS)
> > >                 * 2442 MHz (passive scanning, no IBSS)
> > >                 * 2447 MHz (passive scanning, no IBSS)
> > >                 * 2452 MHz (passive scanning, no IBSS)
> > >                 * 2457 MHz (passive scanning, no IBSS)
> > >                 * 2462 MHz (passive scanning, no IBSS)
> > 
> > It is the passive scanning that is killing you. For hidden essid, you
> > need an active scan. You need to implement the CRDA
> > (http://linuxwireless.org/en/developers/Regulatory/CRDA), which will
> > get your system to provide active scanning.
> 
> Hmmm...does the user have CONFIG_WIRELESS_OLD_REGULATORY=y?  That is
> supposed to enable identical behavior to what we had before w/o
> requiring CRDA.

No, CONFIG_WIRELESS_OLD_REGULATORY is indeed unset.

> John W. Linville

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From peter at stuge.se  Thu Sep 18 23:30:41 2008
From: peter at stuge.se (Peter Stuge)
Date: Thu, 18 Sep 2008 23:30:41 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <1221765255.20772.26.camel@johannes.berg>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809181716.24355.IvDoorn@gmail.com>
	<20080918160803.GK1583@khazad-dum.debian.net>
	<200809181851.59182.IvDoorn@gmail.com>
	<20080918184709.GN1583@khazad-dum.debian.net>
	<1221765255.20772.26.camel@johannes.berg>
Message-ID: <20080918213041.3571.qmail@stuge.se>

Johannes Berg wrote:
..
> (b) take rfkill state and transform it into conf.radio_enabled along
>     with the internal conf.radio_enabled state that mac80211 may decide
>     on based on iwconfig txpower off. assume that users know what
>     they're doing if they iwconfig txpower off, I think it's pretty
>     pointless to have in light of rfkill and for all I care we can
>     remove it

From a usability perspective anything but a single control at the
core is utterly confusing and must IMO be avoided at all cost.


> Driver only has to follow conf.radio_enabled and inform mac80211 of
> the hard state.
> 
> Where's the flaw?

Seems complete. I like it.


b43 radio state in hardware is a simple logic nor; when both bits are
0 the radio is on. There are many different ways for the user to
signal radio enable or disable; radio control is not symmetric.

I think the confusion may come from the two separate methods of
disabling radio in b43 hardware. There can be both a button suitable
for rfkill integration, and a button that overrides whatever software
tries to do. The latter is notification only (but pressing it does
generate a notification, right? Or is it polled?) and should maybe
not be handled by rfkill (I too am not very familiar with the rfkill
design :\) but must certainly be reflected in LEDs.

Again, LEDs _must_ follow hardware state. Usability. I think the
simplest way to accomplish that is logic that funnels into one single
radio setting and the LED following that setting.

The twist is that radio state is not only controlled by the kernel,
but also by hardware.


//Peter
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080918/5d1741c5/attachment.pgp>

From Larry.Finger at lwfinger.net  Fri Sep 19 00:33:12 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Thu, 18 Sep 2008 17:33:12 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080918160957.94ea063d.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>	<48D06B9E.70307@lwfinger.net>	<20080918004509.23a4bdc9.celejar@gmail.com>	<48D1E42C.70904@lwfinger.net>	<20080918015202.8c5f6381.celejar@gmail.com>	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
Message-ID: <48D2D728.6070105@lwfinger.net>

Celejar wrote:
> 
> Okay, I built and installed CRDA, and I now get:
> 
> Band 1:
>         Frequencies:
>                 * 2412 MHz
>                 * 2417 MHz
>                 * 2422 MHz
>                 * 2427 MHz
>                 * 2432 MHz
>                 * 2437 MHz
>                 * 2442 MHz
>                 * 2447 MHz
>                 * 2452 MHz
>                 * 2457 MHz
>                 * 2462 MHz
>                 * 2467 MHz (disabled)
>                 * 2472 MHz (disabled)
>                 * 2484 MHz (disabled)
> 
> [This is also what I get with an earlier kernel.]
> 
> But the card *still* won't associate with the hidden essid AP; is there
> anything else I need to do after 'make, make install' CRDA?

No, with this output, you have definitely connected with CRDA. Now
that you have CRDA working, I think you may have to bisect again.
Certainly, the passive scanning would have made it difficult, if not
impossible, to connect to a hidden essid. As you say, you now have the
same channel listing as you had with the earlier kernel, thus your
bisection may converge on a different patch. Fortunately, it shouldn't
take too long. You can go a couple of patches earlier than the
regulatory change with a 'git bisect good dbcabfe1a5cfa192e'.

Another option would be to uninstall CRDA by deleting /sbin/crda and
setting the CONFIG_WIRELESS_OLD_REGULATORY variable to y. At that
point, everything should be exactly as in the kernels prior to
adopting CRDA.

Larry


From celejar at gmail.com  Fri Sep 19 06:10:50 2008
From: celejar at gmail.com (Celejar)
Date: Fri, 19 Sep 2008 00:10:50 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D2D728.6070105@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
	<48D2D728.6070105@lwfinger.net>
Message-ID: <20080919001050.d9ed273a.celejar@gmail.com>

On Thu, 18 Sep 2008 17:33:12 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Celejar wrote:
> > 
> > Okay, I built and installed CRDA, and I now get:
> > 
> > Band 1:
> >         Frequencies:
> >                 * 2412 MHz
> >                 * 2417 MHz
> >                 * 2422 MHz
> >                 * 2427 MHz
> >                 * 2432 MHz
> >                 * 2437 MHz
> >                 * 2442 MHz
> >                 * 2447 MHz
> >                 * 2452 MHz
> >                 * 2457 MHz
> >                 * 2462 MHz
> >                 * 2467 MHz (disabled)
> >                 * 2472 MHz (disabled)
> >                 * 2484 MHz (disabled)
> > 
> > [This is also what I get with an earlier kernel.]
> > 
> > But the card *still* won't associate with the hidden essid AP; is there
> > anything else I need to do after 'make, make install' CRDA?
> 
> No, with this output, you have definitely connected with CRDA. Now
> that you have CRDA working, I think you may have to bisect again.
> Certainly, the passive scanning would have made it difficult, if not
> impossible, to connect to a hidden essid. As you say, you now have the
> same channel listing as you had with the earlier kernel, thus your
> bisection may converge on a different patch. Fortunately, it shouldn't
> take too long. You can go a couple of patches earlier than the
> regulatory change with a 'git bisect good dbcabfe1a5cfa192e'.
> 
> Another option would be to uninstall CRDA by deleting /sbin/crda and
> setting the CONFIG_WIRELESS_OLD_REGULATORY variable to y. At that
> point, everything should be exactly as in the kernels prior to
> adopting CRDA.

This works fine, so I'm happy.  If a bisection will help the devs,
though, I'll be glad to do it. 

> Larry

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Fri Sep 19 18:13:48 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 19 Sep 2008 11:13:48 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080919001050.d9ed273a.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>	<48D06B9E.70307@lwfinger.net>	<20080918004509.23a4bdc9.celejar@gmail.com>	<48D1E42C.70904@lwfinger.net>	<20080918015202.8c5f6381.celejar@gmail.com>	<48D24911.80101@lwfinger.net>	<20080918160957.94ea063d.celejar@gmail.com>	<48D2D728.6070105@lwfinger.net>
	<20080919001050.d9ed273a.celejar@gmail.com>
Message-ID: <48D3CFBC.6070504@lwfinger.net>

Celejar wrote:
> On Thu, 18 Sep 2008 17:33:12 -0500
> Larry Finger <Larry.Finger at lwfinger.net> wrote:
> 
>> Celejar wrote:
>>> Okay, I built and installed CRDA, and I now get:
>>>
>>> Band 1:
>>>         Frequencies:
>>>                 * 2412 MHz
>>>                 * 2417 MHz
>>>                 * 2422 MHz
>>>                 * 2427 MHz
>>>                 * 2432 MHz
>>>                 * 2437 MHz
>>>                 * 2442 MHz
>>>                 * 2447 MHz
>>>                 * 2452 MHz
>>>                 * 2457 MHz
>>>                 * 2462 MHz
>>>                 * 2467 MHz (disabled)
>>>                 * 2472 MHz (disabled)
>>>                 * 2484 MHz (disabled)
>>>
>>> [This is also what I get with an earlier kernel.]
>>>
>>> But the card *still* won't associate with the hidden essid AP; is there
>>> anything else I need to do after 'make, make install' CRDA?
>> No, with this output, you have definitely connected with CRDA. Now
>> that you have CRDA working, I think you may have to bisect again.
>> Certainly, the passive scanning would have made it difficult, if not
>> impossible, to connect to a hidden essid. As you say, you now have the
>> same channel listing as you had with the earlier kernel, thus your
>> bisection may converge on a different patch. Fortunately, it shouldn't
>> take too long. You can go a couple of patches earlier than the
>> regulatory change with a 'git bisect good dbcabfe1a5cfa192e'.
>>
>> Another option would be to uninstall CRDA by deleting /sbin/crda and
>> setting the CONFIG_WIRELESS_OLD_REGULATORY variable to y. At that
>> point, everything should be exactly as in the kernels prior to
>> adopting CRDA.
> 
> This works fine, so I'm happy.  If a bisection will help the devs,
> though, I'll be glad to do it.

I do not think a bisection is necessary. Your successful test of the
old regulatory code suggests to me that there is some kind of problem
with the CRDA database.

Luis - to fill you in, he can connect to an AP with a hidden essid
using the old regulatory code, but not using CRDA. There seems to be
some critical difference between them.

Thanks,

Larry




From mcgrof at gmail.com  Fri Sep 19 20:05:35 2008
From: mcgrof at gmail.com (Luis R. Rodriguez)
Date: Fri, 19 Sep 2008 11:05:35 -0700
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D3CFBC.6070504@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
	<48D2D728.6070105@lwfinger.net>
	<20080919001050.d9ed273a.celejar@gmail.com>
	<48D3CFBC.6070504@lwfinger.net>
Message-ID: <43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>

On Fri, Sep 19, 2008 at 9:13 AM, Larry Finger <Larry.Finger at lwfinger.net> wrote:

> I do not think a bisection is necessary. Your successful test of the
> old regulatory code suggests to me that there is some kind of problem
> with the CRDA database.

BTW the "old regulatory code" is actually not "old regulatory code"
but instead static regulatory definitions slapped in the kernel just
as they were before but under the new regulatory infrastructure guise.

> Luis - to fill you in, he can connect to an AP with a hidden essid
> using the old regulatory code, but not using CRDA. There seems to be
> some critical difference between them.

Thanks for bringing this up Larry.

If by old regulatory code you mean with CONFIG_WIRELESS_OLD_REGULATORY
then I would narrow the search down to testing as follows:

--- Without crda:

mv /sbin/crda /sbin/crda-foo
sudo rmmod your_driver mac80211 cfg80211
sudo modprobe your_driver

# Check channels using iw

--- With crda:
mv /sbin/crda-foo /sbin/crda
sudo rmmod your_driver mac80211 cfg80211
sudo modprobe your_driver

# check channels using iw
---

By default when CONFIG_WIRELESS_OLD_REGULATORY is set the built-in
"US" static regulatory domain is used. If crda is present though a new
regulatory domain will be updated onto the kernel, so we'll get the
new regulatory domain built by crda from the original db.txt. Without
crda present the static regulatory domain shall be used.

What frequency is the AP on?

  Luis


From celejar at gmail.com  Fri Sep 19 20:27:40 2008
From: celejar at gmail.com (Celejar)
Date: Fri, 19 Sep 2008 14:27:40 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
	<48D2D728.6070105@lwfinger.net>
	<20080919001050.d9ed273a.celejar@gmail.com>
	<48D3CFBC.6070504@lwfinger.net>
	<43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>
Message-ID: <20080919142740.60e2c0e8.celejar@gmail.com>

On Fri, 19 Sep 2008 11:05:35 -0700
"Luis R. Rodriguez" <mcgrof at gmail.com> wrote:

> On Fri, Sep 19, 2008 at 9:13 AM, Larry Finger <Larry.Finger at lwfinger.net> wrote:
> 
> > I do not think a bisection is necessary. Your successful test of the
> > old regulatory code suggests to me that there is some kind of problem
> > with the CRDA database.
> 
> BTW the "old regulatory code" is actually not "old regulatory code"
> but instead static regulatory definitions slapped in the kernel just
> as they were before but under the new regulatory infrastructure guise.
> 
> > Luis - to fill you in, he can connect to an AP with a hidden essid
> > using the old regulatory code, but not using CRDA. There seems to be
> > some critical difference between them.
> 
> Thanks for bringing this up Larry.
> 
> If by old regulatory code you mean with CONFIG_WIRELESS_OLD_REGULATORY
> then I would narrow the search down to testing as follows:
> 
> --- Without crda:
> 
> mv /sbin/crda /sbin/crda-foo
> sudo rmmod your_driver mac80211 cfg80211
> sudo modprobe your_driver
> 
> # Check channels using iw
> 
> --- With crda:
> mv /sbin/crda-foo /sbin/crda
> sudo rmmod your_driver mac80211 cfg80211
> sudo modprobe your_driver
> 
> # check channels using iw
> ---
> 
> By default when CONFIG_WIRELESS_OLD_REGULATORY is set the built-in
> "US" static regulatory domain is used. If crda is present though a new
> regulatory domain will be updated onto the kernel, so we'll get the
> new regulatory domain built by crda from the original db.txt. Without
> crda present the static regulatory domain shall be used.
> 
> What frequency is the AP on?

I (the user) am currently connecting successfully with CRDA to a hidden
essid AP.  I previously had claimed that it was still not working, even
though the iw channel output looked good, but it currently seems to be
okay.  I may have previously done something wrong, such as not
rebuilding CRDA for the current kernel, although in that case I'm not
sure why the iw output would have been correct.  In any event, at this
point it seems that it may have been some mistake on my part.  Thanks
for the help, sorry for the noise, and I'll report back if I see any
more trouble.

>   Luis

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From mcgrof at gmail.com  Fri Sep 19 20:33:15 2008
From: mcgrof at gmail.com (Luis R. Rodriguez)
Date: Fri, 19 Sep 2008 11:33:15 -0700
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080919142740.60e2c0e8.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
	<48D2D728.6070105@lwfinger.net>
	<20080919001050.d9ed273a.celejar@gmail.com>
	<48D3CFBC.6070504@lwfinger.net>
	<43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>
	<20080919142740.60e2c0e8.celejar@gmail.com>
Message-ID: <43e72e890809191133gee5fe3h8647460d6adb6782@mail.gmail.com>

On Fri, Sep 19, 2008 at 11:27 AM, Celejar <celejar at gmail.com> wrote:
> On Fri, 19 Sep 2008 11:05:35 -0700

> I (the user) am currently connecting successfully with CRDA to a hidden
> essid AP.  I previously had claimed that it was still not working, even
> though the iw channel output looked good, but it currently seems to be
> okay.  I may have previously done something wrong, such as not
> rebuilding CRDA for the current kernel, although in that case I'm not
> sure why the iw output would have been correct.  In any event, at this
> point it seems that it may have been some mistake on my part.  Thanks
> for the help, sorry for the noise, and I'll report back if I see any
> more trouble.

Thanks for letting us know.

  Luis


From Larry.Finger at lwfinger.net  Fri Sep 19 21:18:39 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 19 Sep 2008 14:18:39 -0500
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <20080919142740.60e2c0e8.celejar@gmail.com>
References: <20080916220904.75283811.celejar@gmail.com>	<48D06B9E.70307@lwfinger.net>	<20080918004509.23a4bdc9.celejar@gmail.com>	<48D1E42C.70904@lwfinger.net>	<20080918015202.8c5f6381.celejar@gmail.com>	<48D24911.80101@lwfinger.net>	<20080918160957.94ea063d.celejar@gmail.com>	<48D2D728.6070105@lwfinger.net>	<20080919001050.d9ed273a.celejar@gmail.com>	<48D3CFBC.6070504@lwfinger.net>	<43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>
	<20080919142740.60e2c0e8.celejar@gmail.com>
Message-ID: <48D3FB0F.1000909@lwfinger.net>

Celejar wrote:
> On Fri, 19 Sep 2008 11:05:35 -0700
> "Luis R. Rodriguez" <mcgrof at gmail.com> wrote:
> 
>> On Fri, Sep 19, 2008 at 9:13 AM, Larry Finger <Larry.Finger at lwfinger.net> wrote:
>>
>>> I do not think a bisection is necessary. Your successful test of the
>>> old regulatory code suggests to me that there is some kind of problem
>>> with the CRDA database.
>> BTW the "old regulatory code" is actually not "old regulatory code"
>> but instead static regulatory definitions slapped in the kernel just
>> as they were before but under the new regulatory infrastructure guise.
>>
>>> Luis - to fill you in, he can connect to an AP with a hidden essid
>>> using the old regulatory code, but not using CRDA. There seems to be
>>> some critical difference between them.
>> Thanks for bringing this up Larry.
>>
>> If by old regulatory code you mean with CONFIG_WIRELESS_OLD_REGULATORY
>> then I would narrow the search down to testing as follows:
>>
>> --- Without crda:
>>
>> mv /sbin/crda /sbin/crda-foo
>> sudo rmmod your_driver mac80211 cfg80211
>> sudo modprobe your_driver
>>
>> # Check channels using iw
>>
>> --- With crda:
>> mv /sbin/crda-foo /sbin/crda
>> sudo rmmod your_driver mac80211 cfg80211
>> sudo modprobe your_driver
>>
>> # check channels using iw
>> ---
>>
>> By default when CONFIG_WIRELESS_OLD_REGULATORY is set the built-in
>> "US" static regulatory domain is used. If crda is present though a new
>> regulatory domain will be updated onto the kernel, so we'll get the
>> new regulatory domain built by crda from the original db.txt. Without
>> crda present the static regulatory domain shall be used.
>>
>> What frequency is the AP on?
> 
> I (the user) am currently connecting successfully with CRDA to a hidden
> essid AP.  I previously had claimed that it was still not working, even
> though the iw channel output looked good, but it currently seems to be
> okay.  I may have previously done something wrong, such as not
> rebuilding CRDA for the current kernel, although in that case I'm not
> sure why the iw output would have been correct.  In any event, at this
> point it seems that it may have been some mistake on my part.  Thanks
> for the help, sorry for the noise, and I'll report back if I see any
> more trouble.

Is it correct that your current setup has
CONFIG_WIRELESS_OLD_REGULATORY set? If I remember correctly, your
previous failure with CRDA was with CONFIG_WIRELESS_OLD_REGULATORY
unset. If that is true, could you please unset it and try again. The
code paths are different.

I think that CRDA runs in userspace and should be relatively
independent of kernel version.

Larry


From Larry.Finger at lwfinger.net  Fri Sep 19 21:47:38 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 19 Sep 2008 14:47:38 -0500
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
Message-ID: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>

An additional BCM4306 has been found with the Bluetooth coexistence
SPROM coding error.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

These devices work with bcm43xx, but not with b43. I'll let you
decide if this is a regression.

Larry
---

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4545,7 +4545,8 @@ static void b43_sprom_fixup(struct ssb_b
 		    IS_PDEV(pdev, BROADCOM, 0x4320,    DELL, 0x0003) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0015) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0014) ||
-		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013))
+		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013) ||
+		    IS_PDEV(pdev, BROADCOM, 0x4320, MOTOROLA, 0x7010))
 			bus->sprom.boardflags_lo &= ~B43_BFL_BTCOEXIST;
 	}
 }


From celejar at gmail.com  Fri Sep 19 22:01:15 2008
From: celejar at gmail.com (Celejar)
Date: Fri, 19 Sep 2008 16:01:15 -0400
Subject: Can't connect to AP with hidden essid with 2.6.27-rc6
In-Reply-To: <48D3FB0F.1000909@lwfinger.net>
References: <20080916220904.75283811.celejar@gmail.com>
	<48D06B9E.70307@lwfinger.net>
	<20080918004509.23a4bdc9.celejar@gmail.com>
	<48D1E42C.70904@lwfinger.net>
	<20080918015202.8c5f6381.celejar@gmail.com>
	<48D24911.80101@lwfinger.net>
	<20080918160957.94ea063d.celejar@gmail.com>
	<48D2D728.6070105@lwfinger.net>
	<20080919001050.d9ed273a.celejar@gmail.com>
	<48D3CFBC.6070504@lwfinger.net>
	<43e72e890809191105p26841666l50a4a139a7177590@mail.gmail.com>
	<20080919142740.60e2c0e8.celejar@gmail.com>
	<48D3FB0F.1000909@lwfinger.net>
Message-ID: <20080919160115.c591532c.celejar@gmail.com>

On Fri, 19 Sep 2008 14:18:39 -0500
Larry Finger <Larry.Finger at lwfinger.net> wrote:

> Celejar wrote:
> > On Fri, 19 Sep 2008 11:05:35 -0700
> > "Luis R. Rodriguez" <mcgrof at gmail.com> wrote:
> > 
> >> On Fri, Sep 19, 2008 at 9:13 AM, Larry Finger <Larry.Finger at lwfinger.net> wrote:
> >>
> >>> I do not think a bisection is necessary. Your successful test of the
> >>> old regulatory code suggests to me that there is some kind of problem
> >>> with the CRDA database.
> >> BTW the "old regulatory code" is actually not "old regulatory code"
> >> but instead static regulatory definitions slapped in the kernel just
> >> as they were before but under the new regulatory infrastructure guise.
> >>
> >>> Luis - to fill you in, he can connect to an AP with a hidden essid
> >>> using the old regulatory code, but not using CRDA. There seems to be
> >>> some critical difference between them.
> >> Thanks for bringing this up Larry.
> >>
> >> If by old regulatory code you mean with CONFIG_WIRELESS_OLD_REGULATORY
> >> then I would narrow the search down to testing as follows:
> >>
> >> --- Without crda:
> >>
> >> mv /sbin/crda /sbin/crda-foo
> >> sudo rmmod your_driver mac80211 cfg80211
> >> sudo modprobe your_driver
> >>
> >> # Check channels using iw
> >>
> >> --- With crda:
> >> mv /sbin/crda-foo /sbin/crda
> >> sudo rmmod your_driver mac80211 cfg80211
> >> sudo modprobe your_driver
> >>
> >> # check channels using iw
> >> ---
> >>
> >> By default when CONFIG_WIRELESS_OLD_REGULATORY is set the built-in
> >> "US" static regulatory domain is used. If crda is present though a new
> >> regulatory domain will be updated onto the kernel, so we'll get the
> >> new regulatory domain built by crda from the original db.txt. Without
> >> crda present the static regulatory domain shall be used.
> >>
> >> What frequency is the AP on?
> > 
> > I (the user) am currently connecting successfully with CRDA to a hidden
> > essid AP.  I previously had claimed that it was still not working, even
> > though the iw channel output looked good, but it currently seems to be
> > okay.  I may have previously done something wrong, such as not
> > rebuilding CRDA for the current kernel, although in that case I'm not
> > sure why the iw output would have been correct.  In any event, at this
> > point it seems that it may have been some mistake on my part.  Thanks
> > for the help, sorry for the noise, and I'll report back if I see any
> > more trouble.
> 
> Is it correct that your current setup has
> CONFIG_WIRELESS_OLD_REGULATORY set? If I remember correctly, your
> previous failure with CRDA was with CONFIG_WIRELESS_OLD_REGULATORY
> unset. If that is true, could you please unset it and try again. The
> code paths are different.

My current setup does not have CONFIG_WIRELESS_OLD_REGULATORY set.

> I think that CRDA runs in userspace and should be relatively
> independent of kernel version.

You are right.  I had thought that although it runs in userspace, since
the build seems to use headers specific to the running kernel, that
might be significant, but I have tested and it does not seem to make a
difference, at least between the two fairly recent -rc6 kernel that I
tried. From the CRDA Makefile:

ifeq ($(origin $(KLIB)), undefined)
KLIB:=          /lib/modules/$(shell uname -r)
endif
KLIB_BUILD ?=   $(KLIB)/build

...

CFLAGS += -I$(KLIB_BUILD)/include -DUSE_GCRYPT

I think the problem I had was that on boot, the b43 / 80211 modules get
loaded, but they don't seem to be calling CRDA, and I can't access my
hidden essid AP.  Doing the module removal and reloading that Luis
suggested causes CRDA to be called, and then things work fine.

> Larry

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From EternalEye at gmail.com  Sat Sep 20 09:38:19 2008
From: EternalEye at gmail.com (EternalEye at gmail.com)
Date: Sat, 20 Sep 2008 00:38:19 -0700
Subject: Any way I can help with BCM4328?
Message-ID: <000e0cd1b5c0e805dd04574ee636@google.com>

I have a BCM4328 wireless-N card in my laptop, and I want to do everything  
I can to help b43 develop a driver for it. I am now in the process of  
upgrading my kernel to one with mmio-trace, and will soon be attaching an  
mmio-trace of the official Broadcom wl.ko module. I will also be able to  
attach an mmio-trace of it with ndiswrapper if that would help. Is there  
anything else I can do to make myself useful?

By the way, I've already sounded out the capabilities of the wl.ko driver,  
so here's what I plan to do as the test regimen:

ifconfig up
iwconfig mode managed
iwconfig mode ad-hoc
iwconfig mode managed
Associate with open network
associate with wpa-psk (tkip) network
Scale through txpower settings
scale through rate settings
scale through sens settings
ifconfig down

Anything to add? I'm thinking of scripting it, so it'll just be a `sudo -s  
wireless-mmio-trace.sh`
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080920/66ba791b/attachment.html>

From mb at bu3sch.de  Sat Sep 20 17:44:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 20 Sep 2008 17:44:55 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
Message-ID: <200809201744.55571.mb@bu3sch.de>

On Friday 19 September 2008 21:47:38 Larry Finger wrote:
> An additional BCM4306 has been found with the Bluetooth coexistence
> SPROM coding error.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---
> 
> John,
> 
> These devices work with bcm43xx, but not with b43. I'll let you
> decide if this is a regression.
> 
> Larry
> ---
> 
> Index: wireless-testing/drivers/net/wireless/b43/main.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/main.c
> +++ wireless-testing/drivers/net/wireless/b43/main.c
> @@ -4545,7 +4545,8 @@ static void b43_sprom_fixup(struct ssb_b
>  		    IS_PDEV(pdev, BROADCOM, 0x4320,    DELL, 0x0003) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0015) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0014) ||
> -		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013))
> +		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013) ||
> +		    IS_PDEV(pdev, BROADCOM, 0x4320, MOTOROLA, 0x7010))
>  			bus->sprom.boardflags_lo &= ~B43_BFL_BTCOEXIST;
>  	}
>  }
> 
> 

ACK


-- 
Greetings Michael.


From johannes at sipsolutions.net  Sat Sep 20 22:51:35 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 20 Sep 2008 22:51:35 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <200809201744.55571.mb@bu3sch.de>
	(sfid-20080920_174550_869772_E28C99C2)
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	(sfid-20080920_174550_869772_E28C99C2)
Message-ID: <1221943895.3023.1.camel@johannes.berg>

On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
> > An additional BCM4306 has been found with the Bluetooth coexistence
> > SPROM coding error.

Does anyone actually make laptops that use these bluetooth coexistence
pins? All CSR bluetooth chips do it automatically I'm told, maybe we
should just kill them completely.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080920/a0f41694/attachment.pgp>

From mcgrof at gmail.com  Sat Sep 20 22:59:39 2008
From: mcgrof at gmail.com (Luis R. Rodriguez)
Date: Sat, 20 Sep 2008 13:59:39 -0700
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <1221943895.3023.1.camel@johannes.berg>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	<1221943895.3023.1.camel@johannes.berg>
Message-ID: <43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>

On Sat, Sep 20, 2008 at 1:51 PM, Johannes Berg
<johannes at sipsolutions.net> wrote:
> On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
>> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
>> > An additional BCM4306 has been found with the Bluetooth coexistence
>> > SPROM coding error.
>
> Does anyone actually make laptops that use these bluetooth coexistence
> pins? All CSR bluetooth chips do it automatically I'm told, maybe we
> should just kill them completely.

Regardless of the wireless card? Or just for bcm?

  Luis


From johannes at sipsolutions.net  Sat Sep 20 23:02:55 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 20 Sep 2008 23:02:55 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>
	(sfid-20080920_225942_127028_DB247EB0)
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	<1221943895.3023.1.camel@johannes.berg>
	<43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>
	(sfid-20080920_225942_127028_DB247EB0)
Message-ID: <1221944575.3023.10.camel@johannes.berg>

On Sat, 2008-09-20 at 13:59 -0700, Luis R. Rodriguez wrote:
> On Sat, Sep 20, 2008 at 1:51 PM, Johannes Berg
> <johannes at sipsolutions.net> wrote:
> > On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
> >> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
> >> > An additional BCM4306 has been found with the Bluetooth coexistence
> >> > SPROM coding error.
> >
> > Does anyone actually make laptops that use these bluetooth coexistence
> > pins? All CSR bluetooth chips do it automatically I'm told, maybe we
> > should just kill them completely.
> 
> Regardless of the wireless card? Or just for bcm?

Well just for b43(legacy), but out of curiosity, does any BT chip use
these pins anyway? Well I guess _somebody_ has to buy BCMs BT chips,
but ...

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080920/b7d45c10/attachment.pgp>

From mcgrof at gmail.com  Sat Sep 20 23:05:21 2008
From: mcgrof at gmail.com (Luis R. Rodriguez)
Date: Sat, 20 Sep 2008 14:05:21 -0700
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <1221944575.3023.10.camel@johannes.berg>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	<1221943895.3023.1.camel@johannes.berg>
	<43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>
	<1221944575.3023.10.camel@johannes.berg>
Message-ID: <43e72e890809201405u63f57680u63ce0329c8cd31a2@mail.gmail.com>

On Sat, Sep 20, 2008 at 2:02 PM, Johannes Berg
<johannes at sipsolutions.net> wrote:
> On Sat, 2008-09-20 at 13:59 -0700, Luis R. Rodriguez wrote:
>> On Sat, Sep 20, 2008 at 1:51 PM, Johannes Berg
>> <johannes at sipsolutions.net> wrote:
>> > On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
>> >> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
>> >> > An additional BCM4306 has been found with the Bluetooth coexistence
>> >> > SPROM coding error.
>> >
>> > Does anyone actually make laptops that use these bluetooth coexistence
>> > pins? All CSR bluetooth chips do it automatically I'm told, maybe we
>> > should just kill them completely.
>>
>> Regardless of the wireless card? Or just for bcm?
>
> Well just for b43(legacy), but out of curiosity, does any BT chip use
> these pins anyway? Well I guess _somebody_ has to buy BCMs BT chips,
> but ...

BCM BT chips? I thought you said CSR?

  Luis


From Larry.Finger at lwfinger.net  Sat Sep 20 23:08:41 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 20 Sep 2008 16:08:41 -0500
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <1221943895.3023.1.camel@johannes.berg>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>	
	<200809201744.55571.mb@bu3sch.de>
	(sfid-20080920_174550_869772_E28C99C2)
	<1221943895.3023.1.camel@johannes.berg>
Message-ID: <48D56659.5060209@lwfinger.net>

Johannes Berg wrote:
> On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
>> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
>>> An additional BCM4306 has been found with the Bluetooth coexistence
>>> SPROM coding error.
> 
> Does anyone actually make laptops that use these bluetooth coexistence
> pins? All CSR bluetooth chips do it automatically I'm told, maybe we
> should just kill them completely.

I don't know, but I really wouldn't want to blindly kill bluetooth
coexistence. After all, most cards have their SPROMs programmed
correctly. Only the PCI-versions of the BCM4306 and the ASUS BCM4318
seem to have the problem.

I have been working the openSUSE and Ubuntu support forums, which is
where I have been getting these new devices to add to the work-around.

Larry



From johannes at sipsolutions.net  Sat Sep 20 23:11:15 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 20 Sep 2008 23:11:15 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <43e72e890809201405u63f57680u63ce0329c8cd31a2@mail.gmail.com>
	(sfid-20080920_230522_937343_EF72BDF9)
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	<1221943895.3023.1.camel@johannes.berg>
	<43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>
	<1221944575.3023.10.camel@johannes.berg>
	<43e72e890809201405u63f57680u63ce0329c8cd31a2@mail.gmail.com>
	(sfid-20080920_230522_937343_EF72BDF9)
Message-ID: <1221945075.3023.14.camel@johannes.berg>

On Sat, 2008-09-20 at 14:05 -0700, Luis R. Rodriguez wrote:

> >> > Does anyone actually make laptops that use these bluetooth coexistence
> >> > pins? All CSR bluetooth chips do it automatically I'm told, maybe we
> >> > should just kill them completely.
> >>
> >> Regardless of the wireless card? Or just for bcm?
> >
> > Well just for b43(legacy), but out of curiosity, does any BT chip use
> > these pins anyway? Well I guess _somebody_ has to buy BCMs BT chips,
> > but ...
> 
> BCM BT chips? I thought you said CSR?

Well the thing is, BCM wifi chips have these IO pins that tell the BT
chip what the wifi chip is doing. But CSR chips for instance don't care,
they just check what the wifi chip is doing on the antenna. So those
don't use those IO pins.

Hence, I'm wondering if there's any use in the IO pins at all. But they
must have added them for a reason, presumably because their own BT chips
can use those inputs...

Anyway, mostly just idly wondering, since most of the time it works fine
and the EEPROM is actually done right I guess we should keep them on.

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080920/a289dc56/attachment.pgp>

From johannes at sipsolutions.net  Sat Sep 20 23:13:09 2008
From: johannes at sipsolutions.net (Johannes Berg)
Date: Sat, 20 Sep 2008 23:13:09 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <48D56659.5060209@lwfinger.net>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<200809201744.55571.mb@bu3sch.de>
	(sfid-20080920_174550_869772_E28C99C2)
	<1221943895.3023.1.camel@johannes.berg>
	<48D56659.5060209@lwfinger.net>
Message-ID: <1221945189.3023.17.camel@johannes.berg>

On Sat, 2008-09-20 at 16:08 -0500, Larry Finger wrote:

> I don't know, but I really wouldn't want to blindly kill bluetooth
> coexistence. After all, most cards have their SPROMs programmed
> correctly. Only the PCI-versions of the BCM4306 and the ASUS BCM4318
> seem to have the problem.

Yeah, true, it's mostly fine. Maybe we're missing something in the specs
that makes the original driver work? Otherwise, I suspect they'd be
getting these cards back in bunches...

> I have been working the openSUSE and Ubuntu support forums, which is
> where I have been getting these new devices to add to the work-around.

Yeah, I still wonder where you get the patience to deal with support
forums, but I think everybody very much appreciates that :)

johannes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: This is a digitally signed message part
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080920/bfb6d55e/attachment.pgp>

From Larry.Finger at lwfinger.net  Sat Sep 20 23:53:52 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Sat, 20 Sep 2008 16:53:52 -0500
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <1221945189.3023.17.camel@johannes.berg>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>	<200809201744.55571.mb@bu3sch.de>	(sfid-20080920_174550_869772_E28C99C2)	<1221943895.3023.1.camel@johannes.berg>	<48D56659.5060209@lwfinger.net>
	<1221945189.3023.17.camel@johannes.berg>
Message-ID: <48D570F0.3070500@lwfinger.net>

Johannes Berg wrote:
> Yeah, I still wonder where you get the patience to deal with support
> forums, but I think everybody very much appreciates that :)

For the past month, we have been providing day care for our 22-month
old grandson. That pretty much precludes any project that requires
large chunks of time to think a problem through. The support forums
only take a few minutes in each instance. Yes, it gets frustrating at
times. The worst has been when it took 4 tries for a user to get the
command '/sbin/lspci -nnv' entered correctly, and he got it only when
someone else gave him every character that had to be typed.

Larry


From leva at ecentrum.hu  Sun Sep 21 10:42:40 2008
From: leva at ecentrum.hu (=?iso-8859-1?q?L=C9VAI_D=E1niel?=)
Date: Sun, 21 Sep 2008 10:42:40 +0200
Subject: can not scan with `iwlist scanning'
Message-ID: <200809211042.41328.leva@ecentrum.hu>

Hi!

I have this device in a laptop:

05:00.0 Network controller: Broadcom Corporation BCM94311MCG wlan 
mini-PCI (rev 01)

I'm using linux kernel 2.6.26.5 with the b43 module. I'm trying to scan 
for available aps. Here is what I do:

# ifconfig wlan0 up
# iwconfig wlan0 mode monitor
# iwlist wlan0 scanning
wlan0  Interface doesn't support scanning : Operation not supported

# dmesg |tail
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
b43-phy0 debug: Wireless interface started

Is scanning really not supported with this card, or am I missing 
something?

Thanks!

Daniel

-- 
LEVAI Daniel
PGP key ID = 0x4AC0A4B1
Key fingerprint = D037 03B9 C12D D338 4412  2D83 1373 917A 4AC0 A4B1


From mb at bu3sch.de  Sun Sep 21 15:07:05 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 21 Sep 2008 15:07:05 +0200
Subject: [PATCH] b43: Fix Bluetooth coexistence SPROM coding error for
	Motorola 7010 variant of BCM4306
In-Reply-To: <1221944575.3023.10.camel@johannes.berg>
References: <48d401da.Q+F4HRESoxeIVa3r%Larry.Finger@lwfinger.net>
	<43e72e890809201359kb65f3d3qb618129ae6b528f4@mail.gmail.com>
	<1221944575.3023.10.camel@johannes.berg>
Message-ID: <200809211507.06119.mb@bu3sch.de>

On Saturday 20 September 2008 23:02:55 Johannes Berg wrote:
> On Sat, 2008-09-20 at 13:59 -0700, Luis R. Rodriguez wrote:
> > On Sat, Sep 20, 2008 at 1:51 PM, Johannes Berg
> > <johannes at sipsolutions.net> wrote:
> > > On Sat, 2008-09-20 at 17:44 +0200, Michael Buesch wrote:
> > >> On Friday 19 September 2008 21:47:38 Larry Finger wrote:
> > >> > An additional BCM4306 has been found with the Bluetooth coexistence
> > >> > SPROM coding error.
> > >
> > > Does anyone actually make laptops that use these bluetooth coexistence
> > > pins? All CSR bluetooth chips do it automatically I'm told, maybe we
> > > should just kill them completely.
> > 
> > Regardless of the wireless card? Or just for bcm?
> 
> Well just for b43(legacy), but out of curiosity, does any BT chip use
> these pins anyway? Well I guess _somebody_ has to buy BCMs BT chips,
> but ...

The wireless card for the powermac uses it.
I have one. (But I never tried whether it works correctly. I'm not sure
how to, anyway)

-- 
Greetings Michael.


From mb at bu3sch.de  Sun Sep 21 15:09:19 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sun, 21 Sep 2008 15:09:19 +0200
Subject: can not scan with `iwlist scanning'
In-Reply-To: <200809211042.41328.leva@ecentrum.hu>
References: <200809211042.41328.leva@ecentrum.hu>
Message-ID: <200809211509.19670.mb@bu3sch.de>

On Sunday 21 September 2008 10:42:40 L?VAI D?niel wrote:
> Hi!
> 
> I have this device in a laptop:
> 
> 05:00.0 Network controller: Broadcom Corporation BCM94311MCG wlan 
> mini-PCI (rev 01)
> 
> I'm using linux kernel 2.6.26.5 with the b43 module. I'm trying to scan 
> for available aps. Here is what I do:
> 
> # ifconfig wlan0 up
> # iwconfig wlan0 mode monitor
> # iwlist wlan0 scanning

You can't actively scan in monitor mode.

-- 
Greetings Michael.


From david at identd.dyndns.org  Sun Sep 21 17:28:35 2008
From: david at identd.dyndns.org (David Ellingsworth)
Date: Sun, 21 Sep 2008 11:28:35 -0400
Subject: BCM4306 Update
Message-ID: <30353c3d0809210828j76c067c1w392359c723a20bb5@mail.gmail.com>

The recent patches to b43legacy affecting the rate control algorithm
and TX power haver greatly improved the performance of my BCM4306/2
card. b43legacy still reports the occasional "b43legacy-phy0 warning:
Unexpected value for chanstat (0x7C00)" message but overall
performance is far better than it has ever been in the past, bcm43xx
included. I'd like to thank you all for all the hard work you have
invested in this driver, your efforts have been greatly appreciated.

Regards,

David Ellingsworth


From mb at bu3sch.de  Mon Sep 22 23:16:47 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 22 Sep 2008 23:16:47 +0200
Subject: [RFC] b43: A patch for control of the radio LED using rfkill
In-Reply-To: <20080922030137.GA1817@khazad-dum.debian.net>
References: <48d1e227.AmBwRnEuhx6kxlHv%Larry.Finger@lwfinger.net>
	<200809201520.28717.IvDoorn@gmail.com>
	<20080922030137.GA1817@khazad-dum.debian.net>
Message-ID: <200809222316.47466.mb@bu3sch.de>

On Monday 22 September 2008 05:01:37 Henrique de Moraes Holschuh wrote:
> As long as the drivers based on mac80211 still know it is rfkill they're
> dealing with (i.e. as long as they will know they MUST NOT emit energy from
> the transmitter when they're soft-blocked),

That's the only policy that makes sense. So I don't think it would be a problem.
IMO that's how the mac80211 config API is defined, currently.

-- 
Greetings Michael.


From celejar at gmail.com  Wed Sep 24 01:35:19 2008
From: celejar at gmail.com (Celejar)
Date: Tue, 23 Sep 2008 19:35:19 -0400
Subject: Multiple station interfaces
Message-ID: <20080923193519.51414820.celejar@gmail.com>

Hi,

I was playing with iw and trying out its ability to add interfaces to a
physical device.  I wanted to configure two interfaces in station mode,
in order to simultaneously associate with two different APs.  I could
not get this to work; although the two interfaces were created
successfully, when one was up, attempting to bring the other up fails
with:

SIOCSIFFLAGS: Name not unique on network

The b43 page mentions the possibility of multiple interfaces in monitor
mode, but makes no mention of multiple stations.  Is this possible?

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From dennisn at dennisn.dyndns.org  Wed Sep 24 04:16:18 2008
From: dennisn at dennisn.dyndns.org (Dennis Nezic)
Date: Tue, 23 Sep 2008 22:16:18 -0400
Subject: BCM4318 authentication problems
Message-ID: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>

Even with the latest stable linux kernel 2.6.26.5, the b43 driver has
trouble authenticating--mainly after cold boots after long periods of
being offline. My AP doesn't have any encryption, and the problem
exists regardless of my proximity to it.

The system log would look like this:

20:52:32 firmware: requesting b43/ucode5.fw
20:52:32 firmware: requesting b43/pcm5.fw
20:52:32 firmware: requesting b43/b0g0initvals5.fw
20:52:32 firmware: requesting b43/b0g0bsinitvals5.fw
20:52:33 b43-phy0: Loading firmware version 410.2160 (2007-05-26
   15:32:10)
20:52:34 ADDRCONF(NETDEV_UP): wlan0: link is not ready
20:52:35 wlan0: Initial auth_alg=0
20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:35 wlan0: authentication with AP 00:11:95:be:b5:a9 timed out
20:52:36 /etc/init.d/net.wlan0[2035]: WEP key is not set for "konoba" -
   not connecting
20:52:36 wlan0: Initial auth_alg=0
20:52:36 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:37 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:37 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:37 wlan0: authentication with AP 00:11:95:be:b5:a9 timed out
20:52:46 /etc/init.d/net.wlan0[2097]: WEP key is not set for "NETGEAR"
   - not connecting
20:52:46 /etc/init.d/net.wlan0[2098]: Couldn't associate with any
access points on wlan0
20:52:46 /etc/init.d/net.wlan0 [2099]: Failed to configure wireless for
wlan0 20:52:46 wlan0: Initial auth_alg=0
20:52:46 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:46 wlan0: Initial auth_alg=0
20:52:46 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:52:46 b43-phy0: Radio turned off by software
20:52:46 /etc/init.d/net.wlan0[1766]: ERROR: net.wlan0 failed to start

It does /eventually/ authenticate, after MANY retries. Usually about
10-20. (I currently have a bash script that iterates through 30
retries :P). Sometimes it won't even work after 30 consecutive retries.
Incidentally, if I take a break for a minute or so, and then try to
authenticate, it usually tends to work :/.


The successful attempt would look something like:

20:56:08 b43-phy0: Radio turned on by software
20:56:08 wlan0: Initial auth_alg=0
20:56:08 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:56:08 wlan0: Initial auth_alg=0
20:56:08 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:56:08 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
   transaction=2 status=0)
20:56:08 wlan0: authenticated
20:56:08 wlan0: associate with AP 00:11:95:be:b5:a9
20:56:08 wlan0: authentication frame received from 00:11:95:be:b5:a9,
   but not in authenticate state - ignored
20:56:08 wlan0: RX AssocResp from 00:11:95:be:b5:a9 (capab=0x421
   status=0 aid=2)
20:56:08 wlan0: associated
20:56:08 wlan0: switched to short barker preamble
   (BSSID=00:11:95:be:b5:a9)
20:56:11 wlan0: Initial auth_alg=0
20:56:11 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:56:11 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
   transaction=2 status=0)
20:56:11 wlan0: authenticated
20:56:11 wlan0: associate with AP 00:11:95:be:b5:a9
20:56:11 wlan0: RX ReassocResp from 00:11:95:be:b5:a9 (capab=0x421
    status=0 aid=2)
20:56:11 wlan0: associated
20:56:11 wlan0: Initial auth_alg=0
20:56:11 wlan0: authenticate with AP 00:11:95:be:b5:a9
20:56:11 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
   transaction=2 status=0)
20:56:11 wlan0: authenticated
20:56:11 wlan0: associate with AP 00:11:95:be:b5:a9
20:56:11 wlan0: RX ReassocResp from 00:11:95:be:b5:a9 (capab=0x421
   status=0 aid=2)
20:56:11 wlan0: associated

Notice that there is one "RX AssocResp" message, then it would claim to
be associated, and then three seconds later it would continue to try to
authenticate, and receive two other "RX ReassocResp" messages, each of
which would produce another "associated" message. This triple
broadcasting for authentication seems a little strange to me?


My wlan0 card is:

Broadcom Corporation BCM4318 [AirForce One 54g]
802.11g Wireless LAN Controller (rev 02)
Subsystem: AMBIT Microsystem Corp. Aspire 3022WLMi, 5024WLMi, 5020

06:02.0 0280: 14e4:4318 (rev 02)
   Subsystem: 1468:0311
   Latency: 64 Interrupt: pin A routed to IRQ 21
   Region 0: Memory at c0304000 (32-bit, non-prefetchable) [size=8K]
   Kernel driver in use: b43-pci-bridge


From celejar at gmail.com  Wed Sep 24 04:39:11 2008
From: celejar at gmail.com (Celejar)
Date: Tue, 23 Sep 2008 22:39:11 -0400
Subject: BCM4318 authentication problems
In-Reply-To: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>
References: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>
Message-ID: <20080923223911.9e14b0fd.celejar@gmail.com>

On Tue, 23 Sep 2008 22:16:18 -0400
Dennis Nezic <dennisn at dennisn.dyndns.org> wrote:

> Even with the latest stable linux kernel 2.6.26.5, the b43 driver has
> trouble authenticating--mainly after cold boots after long periods of
> being offline. My AP doesn't have any encryption, and the problem
> exists regardless of my proximity to it.
> 
> The system log would look like this:
> 
> 20:52:32 firmware: requesting b43/ucode5.fw
> 20:52:32 firmware: requesting b43/pcm5.fw
> 20:52:32 firmware: requesting b43/b0g0initvals5.fw
> 20:52:32 firmware: requesting b43/b0g0bsinitvals5.fw
> 20:52:33 b43-phy0: Loading firmware version 410.2160 (2007-05-26
>    15:32:10)
> 20:52:34 ADDRCONF(NETDEV_UP): wlan0: link is not ready
> 20:52:35 wlan0: Initial auth_alg=0
> 20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:35 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:35 wlan0: authentication with AP 00:11:95:be:b5:a9 timed out
> 20:52:36 /etc/init.d/net.wlan0[2035]: WEP key is not set for "konoba" -
>    not connecting
> 20:52:36 wlan0: Initial auth_alg=0
> 20:52:36 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:37 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:37 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:37 wlan0: authentication with AP 00:11:95:be:b5:a9 timed out
> 20:52:46 /etc/init.d/net.wlan0[2097]: WEP key is not set for "NETGEAR"
>    - not connecting
> 20:52:46 /etc/init.d/net.wlan0[2098]: Couldn't associate with any
> access points on wlan0
> 20:52:46 /etc/init.d/net.wlan0 [2099]: Failed to configure wireless for
> wlan0 20:52:46 wlan0: Initial auth_alg=0
> 20:52:46 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:46 wlan0: Initial auth_alg=0
> 20:52:46 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:52:46 b43-phy0: Radio turned off by software
> 20:52:46 /etc/init.d/net.wlan0[1766]: ERROR: net.wlan0 failed to start
> 
> It does /eventually/ authenticate, after MANY retries. Usually about
> 10-20. (I currently have a bash script that iterates through 30
> retries :P). Sometimes it won't even work after 30 consecutive retries.
> Incidentally, if I take a break for a minute or so, and then try to
> authenticate, it usually tends to work :/.
> 
> 
> The successful attempt would look something like:
> 
> 20:56:08 b43-phy0: Radio turned on by software
> 20:56:08 wlan0: Initial auth_alg=0
> 20:56:08 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:56:08 wlan0: Initial auth_alg=0
> 20:56:08 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:56:08 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
>    transaction=2 status=0)
> 20:56:08 wlan0: authenticated
> 20:56:08 wlan0: associate with AP 00:11:95:be:b5:a9
> 20:56:08 wlan0: authentication frame received from 00:11:95:be:b5:a9,
>    but not in authenticate state - ignored
> 20:56:08 wlan0: RX AssocResp from 00:11:95:be:b5:a9 (capab=0x421
>    status=0 aid=2)
> 20:56:08 wlan0: associated
> 20:56:08 wlan0: switched to short barker preamble
>    (BSSID=00:11:95:be:b5:a9)
> 20:56:11 wlan0: Initial auth_alg=0
> 20:56:11 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:56:11 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
>    transaction=2 status=0)
> 20:56:11 wlan0: authenticated
> 20:56:11 wlan0: associate with AP 00:11:95:be:b5:a9
> 20:56:11 wlan0: RX ReassocResp from 00:11:95:be:b5:a9 (capab=0x421
>     status=0 aid=2)
> 20:56:11 wlan0: associated
> 20:56:11 wlan0: Initial auth_alg=0
> 20:56:11 wlan0: authenticate with AP 00:11:95:be:b5:a9
> 20:56:11 wlan0: RX authentication from 00:11:95:be:b5:a9 (alg=0
>    transaction=2 status=0)
> 20:56:11 wlan0: authenticated
> 20:56:11 wlan0: associate with AP 00:11:95:be:b5:a9
> 20:56:11 wlan0: RX ReassocResp from 00:11:95:be:b5:a9 (capab=0x421
>    status=0 aid=2)
> 20:56:11 wlan0: associated
> 
> Notice that there is one "RX AssocResp" message, then it would claim to
> be associated, and then three seconds later it would continue to try to
> authenticate, and receive two other "RX ReassocResp" messages, each of
> which would produce another "associated" message. This triple
> broadcasting for authentication seems a little strange to me?
> 
> 
> My wlan0 card is:
> 
> Broadcom Corporation BCM4318 [AirForce One 54g]
> 802.11g Wireless LAN Controller (rev 02)
> Subsystem: AMBIT Microsystem Corp. Aspire 3022WLMi, 5024WLMi, 5020
> 
> 06:02.0 0280: 14e4:4318 (rev 02)
>    Subsystem: 1468:0311
>    Latency: 64 Interrupt: pin A routed to IRQ 21
>    Region 0: Memory at c0304000 (32-bit, non-prefetchable) [size=8K]
>    Kernel driver in use: b43-pci-bridge

I don't suppose this will help much, but FWIW, I have almost (I'm aware
that almost is often nothing, in this game ...) the identical card on
my Aspire 3690:

06:02.0 Network controller: Broadcom Corporation BCM4318 [AirForce One 54g] 802.11g Wireless LAN Controller (rev 02)
	Subsystem: AMBIT Microsystem Corp. Device 0312
	Flags: bus master, fast devsel, latency 64, IRQ 22
	Memory at d0002000 (32-bit, non-prefetchable) [size=8K]
	Kernel driver in use: b43-pci-bridge
	Kernel modules: ssb

06:02.0 0280: 14e4:4318 (rev 02)
	Subsystem: 1468:0312
	Flags: bus master, fast devsel, latency 64, IRQ 22
	Memory at d0002000 (32-bit, non-prefetchable) [size=8K]
	Kernel driver in use: b43-pci-bridge
	Kernel modules: ssb

I have never seen the trouble that you're reporting.

Celejar
--
mailmin.sourceforge.net - remote access via secure (OpenPGP) email
ssuds.sourceforge.net - A Simple Sudoku Solver and Generator



From Larry.Finger at lwfinger.net  Wed Sep 24 14:38:36 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Wed, 24 Sep 2008 07:38:36 -0500
Subject: BCM4318 authentication problems
In-Reply-To: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>
References: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>
Message-ID: <48DA34CC.7030809@lwfinger.net>

Dennis Nezic wrote:
> Even with the latest stable linux kernel 2.6.26.5, the b43 driver has
> trouble authenticating--mainly after cold boots after long periods of
> being offline. My AP doesn't have any encryption, and the problem
> exists regardless of my proximity to it.

I have 6 different BCM43xx devices, one of which is a 4318, and none
of them show anything like this behavior. Given that this problem is
worst when your device is cold, I believe that you have a hardware
problem.

Larry


From dennisn at dennisn.dyndns.org  Wed Sep 24 15:15:51 2008
From: dennisn at dennisn.dyndns.org (Dennis Nezic)
Date: Wed, 24 Sep 2008 09:15:51 -0400
Subject: BCM4318 authentication problems
In-Reply-To: <48DA34CC.7030809@lwfinger.net>
References: <20080923221618.4e9bbfe8.dennisn@dennisn.dyndns.org>
	<48DA34CC.7030809@lwfinger.net>
Message-ID: <20080924091551.2ebee7c2.dennisn@dennisn.dyndns.org>

> On Wed, 24 Sep 2008 07:38:36 -0500,
> Larry Finger wrote:
>
> Dennis Nezic wrote:
> > Even with the latest stable linux kernel 2.6.26.5, the b43 driver
> > has trouble authenticating--mainly after cold boots after long
> > periods of being offline. My AP doesn't have any encryption, and
> > the problem exists regardless of my proximity to it.
> 
> I have 6 different BCM43xx devices, one of which is a 4318, and none
> of them show anything like this behavior. Given that this problem is
> worst when your device is cold, I believe that you have a hardware
> problem.

Sorry--I didn't mean "cold" as in temperature, but rather after
powering down, (waiting a few hours), then powering back up. Quick
reboots, or quick attempts to bring wlan0 down and then up, usually
work well / better.

But, it's good to hear that not everyone is experiencing this :).


From sam at eewifi.co.uk  Wed Sep 24 14:54:48 2008
From: sam at eewifi.co.uk (Samuel Hunt)
Date: Wed, 24 Sep 2008 13:54:48 +0100
Subject: Rate memory address for each client
Message-ID: <48DA3898.6050704@eewifi.co.uk>

Hi all.

I'm trying to find out what the memory address is for where each 
client's rate is stored when it's running in AP mode.

For example, if I have 3 clients associated with the AP, I want to find 
out the rate for each one of these clients through looking at a memory 
address.

I'm struggling to find the correct memory address though, I can't see 
anything pointing me in the right direction.

Somewhere there must be a list of all the associated clients, their RSSI 
and the rate for them?


Would really appreciate it if someone could point me in the right direction.

Many thanks!

Sam



From Larry.Finger at lwfinger.net  Fri Sep 26 07:10:37 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 26 Sep 2008 00:10:37 -0500
Subject: [PATCH] b43: Fix Bluetooth Coexistence SPROM programming error
	for HP 12f8 version of BCM4306
Message-ID: <48dc6ecd.LsMPm/7J/Wp9iyzP%Larry.Finger@lwfinger.net>

Yet another BCM4306 card with the Bluetooth Coexistence SPROM programming
error has been found.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

Owners of these cards keep crawling out of the woodwork. This is
2.6.28 material.

Larry
---

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4543,6 +4543,7 @@ static void b43_sprom_fixup(struct ssb_b
 		pdev = bus->host_pci;
 		if (IS_PDEV(pdev, BROADCOM, 0x4318, ASUSTEK, 0x100F) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320,    DELL, 0x0003) ||
+		    IS_PDEV(pdev, BROADCOM, 0x4320,      HP, 0x12f8) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0015) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0014) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013))


From mb at bu3sch.de  Fri Sep 26 11:00:46 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 26 Sep 2008 11:00:46 +0200
Subject: [PATCH] b43: Fix Bluetooth Coexistence SPROM programming error
	for HP 12f8 version of BCM4306
In-Reply-To: <48dc6ecd.LsMPm/7J/Wp9iyzP%Larry.Finger@lwfinger.net>
References: <48dc6ecd.LsMPm/7J/Wp9iyzP%Larry.Finger@lwfinger.net>
Message-ID: <200809261100.47234.mb@bu3sch.de>

On Friday 26 September 2008 07:10:37 Larry Finger wrote:
> Yet another BCM4306 card with the Bluetooth Coexistence SPROM programming
> error has been found.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
> ---
> 
> John,
> 
> Owners of these cards keep crawling out of the woodwork. This is
> 2.6.28 material.

ACK.

> Larry
> ---
> 
> Index: wireless-testing/drivers/net/wireless/b43/main.c
> ===================================================================
> --- wireless-testing.orig/drivers/net/wireless/b43/main.c
> +++ wireless-testing/drivers/net/wireless/b43/main.c
> @@ -4543,6 +4543,7 @@ static void b43_sprom_fixup(struct ssb_b
>  		pdev = bus->host_pci;
>  		if (IS_PDEV(pdev, BROADCOM, 0x4318, ASUSTEK, 0x100F) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320,    DELL, 0x0003) ||
> +		    IS_PDEV(pdev, BROADCOM, 0x4320,      HP, 0x12f8) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0015) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0014) ||
>  		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013))
> --
> To unsubscribe from this list: send the line "unsubscribe linux-wireless" in
> the body of a message to majordomo at vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
> 
> 



-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Fri Sep 26 15:23:00 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Fri, 26 Sep 2008 08:23:00 -0500
Subject: [PATCH V2] b43: Fix Bluetooth Coexistence SPROM programming error for
	HP 12f8 version of BCM4306
Message-ID: <48dce234.RneC5sIzP1+fVQbA%Larry.Finger@lwfinger.net>

Yet another BCM4306 card with the Bluetooth Coexistence SPROM programming
error has been found.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

Owners of these cards keep crawling out of the woodwork. This is
2.6.28 material.

The previous version had some fuzz when applied as I forgot to apply the
previously submitted MOTOROLA patch first.

Larry
---

Index: wireless-testing/drivers/net/wireless/b43/main.c
===================================================================
--- wireless-testing.orig/drivers/net/wireless/b43/main.c
+++ wireless-testing/drivers/net/wireless/b43/main.c
@@ -4543,6 +4543,7 @@ static void b43_sprom_fixup(struct ssb_b
 		pdev = bus->host_pci;
 		if (IS_PDEV(pdev, BROADCOM, 0x4318, ASUSTEK, 0x100F) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320,    DELL, 0x0003) ||
+		    IS_PDEV(pdev, BROADCOM, 0x4320,      HP, 0x12f8) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0015) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0014) ||
 		    IS_PDEV(pdev, BROADCOM, 0x4320, LINKSYS, 0x0013) ||


From mb at bu3sch.de  Fri Sep 26 22:49:25 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 26 Sep 2008 22:49:25 +0200
Subject: [PATCH] [SSB] Initialise dma_mask for SSB_BUSTYPE_SSB devices
In-Reply-To: <20080926202711.GA23466@volta.aurel32.net>
References: <20080926202711.GA23466@volta.aurel32.net>
Message-ID: <200809262249.25902.mb@bu3sch.de>

On Friday 26 September 2008 22:27:11 Aurelien Jarno wrote:
> For SSB_BUSTYPE_SSB type devices, we need to initialize dma_mask using
> coherent_dma_mask so that calls to dma_set_mask() succeed.

This is a hack IMO and the mips DMA API should be fixed.
However, I can live with it and you can add my ACK.

> It fixes the regression on the b44 driver introduced by commit
> f225763a7d6c92c4932dbd528437997078496fcc
> 
> Signed-off-by: Aurelien Jarno <aurelien at aurel32.net>
> ---
>  drivers/ssb/main.c |    1 +
>  1 files changed, 1 insertions(+), 0 deletions(-)
> 
> diff --git a/drivers/ssb/main.c b/drivers/ssb/main.c
> index 87ab244..0ffabf5 100644
> --- a/drivers/ssb/main.c
> +++ b/drivers/ssb/main.c
> @@ -471,6 +471,7 @@ static int ssb_devices_register(struct ssb_bus *bus)
>  #endif
>  			break;
>  		case SSB_BUSTYPE_SSB:
> +			dev->dma_mask = &dev->coherent_dma_mask;
>  			break;
>  		}
>  
> -- 
> 1.5.6.5
> 



-- 
Greetings Michael.


From mb at bu3sch.de  Fri Sep 26 23:16:03 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 26 Sep 2008 23:16:03 +0200
Subject: [PATCH] [SSB] Initialise dma_mask for SSB_BUSTYPE_SSB devices
In-Reply-To: <20080926210926.GA11742@hall.aurel32.net>
References: <20080926202711.GA23466@volta.aurel32.net>
	<200809262249.25902.mb@bu3sch.de>
	<20080926210926.GA11742@hall.aurel32.net>
Message-ID: <200809262316.04056.mb@bu3sch.de>

On Friday 26 September 2008 23:09:26 Aurelien Jarno wrote:
> On Fri, Sep 26, 2008 at 10:49:25PM +0200, Michael Buesch wrote:
> > On Friday 26 September 2008 22:27:11 Aurelien Jarno wrote:
> > > For SSB_BUSTYPE_SSB type devices, we need to initialize dma_mask using
> > > coherent_dma_mask so that calls to dma_set_mask() succeed.
> > 
> > This is a hack IMO and the mips DMA API should be fixed.
> > However, I can live with it and you can add my ACK.
> 
> Why do you think it is a hack? The isa bus is doing the same.

If dma_set_mask doesn't work without it, why not do it inside of
dma_set_mask?

Anyway, as I said I'm fine with this.

-- 
Greetings Michael.


From mb at bu3sch.de  Fri Sep 26 23:57:26 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Fri, 26 Sep 2008 23:57:26 +0200
Subject: [PATCH] [SSB] Initialise dma_mask for SSB_BUSTYPE_SSB devices
In-Reply-To: <20080926214201.GB11742@hall.aurel32.net>
References: <20080926202711.GA23466@volta.aurel32.net>
	<200809262316.04056.mb@bu3sch.de>
	<20080926214201.GB11742@hall.aurel32.net>
Message-ID: <200809262357.26498.mb@bu3sch.de>

On Friday 26 September 2008 23:42:01 Aurelien Jarno wrote:
> > Anyway, as I said I'm fine with this.
> 
> Ok. In which tree do you think it should be merged?

I do not care. Just merge it through some way that does actually work
and doesn't delay it for a couple of months.

-- 
Greetings Michael.


From steve at neoturbine.net  Sat Sep 27 01:27:28 2008
From: steve at neoturbine.net (Steven Bularca)
Date: Fri, 26 Sep 2008 19:27:28 -0400
Subject: BCM4311 Rev 01 constantly re-associating
Message-ID: <48DD6FE0.2080408@neoturbine.net>

Fellow bcm-users,

I have had this issue with my BCM4311 rev 01 for a couple of months 
now.  It seems whenever I am connected to a wireless network supported 
by multiple APs with the same SSID (as is the case whenever I am at home 
or at school), b43 can't seem to tell which one to stay connected to and 
thus is continuously disconnecting and reconnecting over and over.  I 
have provided my dmesg output below, you can see every time the 
connection to an AP is lost and it tries to connect to a different one. 
If there is any other information that developers would need for me to 
provide in an attempt to get this resolved, please let me know.


1 HP     MCP51M    6040000 PTL_    F4240)
ACPI: DSDT 77F0BD5F, 8FB1 (r1 HP       MCP51M  6040000 MSFT  3000000)
ACPI: FACS 77F15FC0, 0040
ACPI: SSDT 77F14D84, 0182 (r1 PTLTD  POWERNOW  6040000  LTP        1)
ACPI: MCFG 77F14F06, 003C (r1 HP       MCFG    6040000  LTP        0)
ACPI: HPET 77F14F42, 0038 (r1 PTLTD  HPETTBL   6040000  LTP        1)
ACPI: APIC 77F14F7A, 005E (r1 HP          APIC    6040000  LTP        0)
ACPI: BOOT 77F14FD8, 0028 (r1     HP $SBFTBL$  6040000  LTP        1)
ACPI: DMI detected: Hewlett-Packard
Detected use of extended apic ids on hypertransport bus
ACPI: PM-Timer IO Port: 0x1008
ACPI: Local APIC address 0xfee00000
ACPI: LAPIC (acpi_id[0x00] lapic_id[0x00] enabled)
ACPI: LAPIC (acpi_id[0x01] lapic_id[0x01] enabled)
ACPI: LAPIC_NMI (acpi_id[0x00] high edge lint[0x1])
ACPI: LAPIC_NMI (acpi_id[0x01] high edge lint[0x1])
ACPI: IOAPIC (id[0x02] address[0xfec00000] gsi_base[0])
IOAPIC[0]: apic_id 2, version 17, address 0xfec00000, GSI 0-23
ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
ACPI: IRQ0 used by override.
ACPI: IRQ2 used by override.
ACPI: IRQ9 used by override.
Enabling APIC mode:  Flat.  Using 1 I/O APICs
ACPI: HPET id: 0x10de8201 base: 0xfed00000
Using ACPI (MADT) for SMP configuration information
Allocating PCI resources starting at 88000000 (gap: 80000000:60000000)
PM: Registered nosave memory: 000000000009d000 - 000000000009e000
PM: Registered nosave memory: 000000000009e000 - 00000000000a0000
PM: Registered nosave memory: 00000000000a0000 - 00000000000d2000
PM: Registered nosave memory: 00000000000d2000 - 0000000000100000
SMP: Allowing 2 CPUs, 0 hotplug CPUs
PERCPU: Allocating 40872 bytes of per cpu data
NR_CPUS: 32, nr_cpu_ids: 2
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 487426
Kernel command line: ro root=UUID=6086100f-debe-4c1b-8f75-2b58a993a249 rhgb
mapped APIC to ffffb000 (fee00000)
mapped IOAPIC to ffffa000 (fec00000)
Enabling fast FPU save and restore... done.
Enabling unmasked SIMD FPU exception support... done.
Initializing CPU#0
CPU 0 irqstacks, hard=c07c6000 soft=c07a6000
PID hash table entries: 4096 (order: 12, 16384 bytes)
Detected 1607.298 MHz processor.
spurious 8259A interrupt: IRQ7.
Console: colour VGA+ 80x25
console [tty0] enabled
Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)
Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)
Memory: 1940284k/1965056k available (2258k kernel code, 23544k reserved, 
1152k data, 284k init, 1047552k highmem)
virtual kernel memory layout:
    fixmap  : 0xffc53000 - 0xfffff000   (3760 kB)
    pkmap   : 0xff400000 - 0xff800000   (4096 kB)
    vmalloc : 0xf8800000 - 0xff3fe000   ( 107 MB)
    lowmem  : 0xc0000000 - 0xf8000000   ( 896 MB)
      .init : 0xc075c000 - 0xc07a3000   ( 284 kB)
      .data : 0xc0634808 - 0xc0754980   (1152 kB)
      .text : 0xc0400000 - 0xc0634808   (2258 kB)
Checking if this processor honours the WP bit even in supervisor mode...Ok.
CPA: page pool initialized 1 of 1 pages preallocated
SLUB: Genslabs=12, HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1
hpet clockevent registered
Calibrating delay using timer specific routine.. 3217.28 BogoMIPS 
(lpj=1608642)
Security Framework initialized
SELinux:  Initializing.
SELinux:  Starting in permissive mode
selinux_register_security:  Registering secondary module capability
Capability LSM initialized as secondary
Mount-cache hash table entries: 512
Initializing cgroup subsys ns
Initializing cgroup subsys cpuacct
Initializing cgroup subsys devices
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 0(2) -> Core 0
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Checking 'hlt' instruction... OK.
ACPI: Core revision 20080321
ENABLING IO-APIC IRQs
..TIMER: vector=0x31 apic1=0 pin1=2 apic2=-1 pin2=-1
CPU0: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.39 BogoMIPS 
(lpj=1607199)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
Brought up 2 CPUs
Total of 2 processors activated (6431.68 BogoMIPS).
sizeof(vma)=84 bytes
sizeof(page)=32 bytes
sizeof(inode)=340 bytes
sizeof(dentry)=132 bytes
sizeof(ext3inode)=492 bytes
sizeof(buffer_head)=56 bytes
sizeof(skbuff)=180 bytes
sizeof(task_struct)=3188 bytes
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
net_namespace: 660 bytes
Booting paravirtualized kernel on bare hardware
Time:  5:20:28  Date: 09/26/08
NET: Registered protocol family 16
No dock devices found.
ACPI: bus type pci registered
PCI: MCFG configuration 0: base e0000000 segment 0 buses 0 - 6
PCI: Not using MMCONFIG.
PCI: BIOS BUG #81[00000000] found
PCI: Using configuration type 1 for base access
Setting up standard PCI resources
ACPI: EC: Look up EC in DSDT
ACPI: BIOS _OSI(Linux) query ignored via DMI
ACPI: Interpreter enabled
ACPI: (supports S0 S3 S4 S5)
ACPI: Using IOAPIC for interrupt routing
PCI: MCFG configuration 0: base e0000000 segment 0 buses 0 - 6
PCI: MCFG area at e0000000 reserved in ACPI motherboard resources
PCI: Using MMCONFIG for extended config space
ACPI: EC: non-query interrupt received, switching to interrupt mode
ACPI: EC: GPE = 0x10, I/O: command/status = 0x66, data = 0x62
ACPI: EC: driver started in interrupt mode
ACPI: PCI Root Bridge [PCI0] (0000:00)
Pre-1.1 PCIe device detected, disable ASPM for 0000:00:03.0. It can be 
enabled forcedly with 'pcie_aspm=force'
PCI: Transparent bridge - 0000:00:10.0
ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]
ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.P2P0._PRT]
ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.XVR1._PRT]
ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.XVR2._PRT]
ACPI: PCI Interrupt Link [LNK1] (IRQs 5) *0, disabled.
ACPI: PCI Interrupt Link [LNK2] (IRQs 7) *11
ACPI: PCI Interrupt Link [LNK3] (IRQs 10) *11
ACPI: PCI Interrupt Link [LNK4] (IRQs 11) *0, disabled.
ACPI: PCI Interrupt Link [LK1E] (IRQs 16) *0, disabled.
ACPI: PCI Interrupt Link [LK2E] (IRQs 17) *0, disabled.
ACPI: PCI Interrupt Link [LK3E] (IRQs 18) *11
ACPI: PCI Interrupt Link [LK4E] (IRQs 19) *0, disabled.
ACPI: PCI Interrupt Link [LSMB] (IRQs *10)
ACPI: PCI Interrupt Link [LPMU] (IRQs 11) *10
ACPI: PCI Interrupt Link [LUS0] (IRQs 22) *11
ACPI: PCI Interrupt Link [LUS2] (IRQs 22) *7
ACPI: PCI Interrupt Link [LMAC] (IRQs 20) *10
ACPI: PCI Interrupt Link [LAZA] (IRQs 21) *0, disabled.
ACPI: PCI Interrupt Link [LACI] (IRQs 21) *0, disabled.
ACPI: PCI Interrupt Link [LMCI] (IRQs 21) *0, disabled.
ACPI: PCI Interrupt Link [LPID] (IRQs 21) *0, disabled.
ACPI: PCI Interrupt Link [LTID] (IRQs 23) *5
ACPI: PCI Interrupt Link [LSI1] (IRQs 20) *10
Linux Plug and Play Support v0.97 (c) Adam Belay
pnp: PnP ACPI init
ACPI: bus type pnp registered
pnp: PnP ACPI: found 13 devices
ACPI: ACPI bus type pnp unregistered
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
PCI: Using ACPI for IRQ routing
NetLabel: Initializing
NetLabel:  domain hash size = 128
NetLabel:  protocols = UNLABELED CIPSOv4
NetLabel:  unlabeled traffic allowed by default
hpet0: at MMIO 0xfed00000, IRQs 2, 8, 31
hpet0: 3 32-bit timers, 25000000 Hz
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 0
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
ACPI: RTC can wake from S4
system 00:00: iomem range 0xe0000000-0xefffffff could not be reserved
system 00:01: iomem range 0xffc00000-0xffffffff could not be reserved
system 00:01: iomem range 0xfec00000-0xfec00fff could not be reserved
system 00:01: iomem range 0xfee00000-0xfeefffff could not be reserved
system 00:01: iomem range 0xfed00000-0xfed00fff has been reserved
system 00:03: iomem range 0xe0000000-0xefffffff could not be reserved
system 00:04: ioport range 0x1000-0x107f has been reserved
system 00:04: ioport range 0x1080-0x10ff has been reserved
system 00:04: ioport range 0x1400-0x147f has been reserved
system 00:04: ioport range 0x1480-0x14ff has been reserved
system 00:04: ioport range 0x1800-0x187f has been reserved
system 00:04: ioport range 0x1880-0x18ff has been reserved
system 00:04: ioport range 0x2000-0x203f has been reserved
system 00:05: ioport range 0x360-0x361 has been reserved
system 00:05: ioport range 0x380-0x383 has been reserved
system 00:05: ioport range 0x4d0-0x4d1 has been reserved
PCI: Bridge: 0000:00:02.0
  IO window: 4000-4fff
  MEM window: 0xb4000000-0xb5ffffff
  PREFETCH window: 0x00000000d0000000-0x00000000d01fffff
PCI: Bridge: 0000:00:03.0
  IO window: disabled.
  MEM window: 0xb6000000-0xb7ffffff
  PREFETCH window: disabled.
PCI: Bridge: 0000:00:10.0
  IO window: disabled.
  MEM window: 0xb8000000-0xb80fffff
  PREFETCH window: disabled.
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
NET: Registered protocol family 2
IP route cache hash table entries: 32768 (order: 5, 131072 bytes)
TCP established hash table entries: 131072 (order: 8, 1048576 bytes)
TCP bind hash table entries: 65536 (order: 7, 524288 bytes)
TCP: Hash tables configured (established 131072 bind 65536)
TCP reno registered
NET: Registered protocol family 1
checking if image is initramfs... it is
Freeing initrd memory: 2660k freed
Simple Boot Flag at 0x36 set to 0x1
apm: BIOS not found.
audit: initializing netlink socket (disabled)
type=2000 audit(1222406427.574:1): initialized
highmem bounce pool size: 64 pages
Total HugeTLB memory allocated, 0
VFS: Disk quotas dquot_6.5.1
Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
msgmni has been set to 1750
SELinux:  Registering netfilter hooks
Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered (default)
pci 0000:00:00.0: Enabling HT MSI Mapping
pci 0000:00:02.0: Enabling HT MSI Mapping
pci 0000:00:03.0: Enabling HT MSI Mapping
pci 0000:00:05.0: Boot video device
pci 0000:00:09.0: Enabling HT MSI Mapping
pci 0000:00:0e.0: Enabling HT MSI Mapping
pci 0000:00:0f.0: Enabling HT MSI Mapping
pci 0000:00:10.0: Enabling HT MSI Mapping
pci 0000:00:10.1: Enabling HT MSI Mapping
PCI: Setting latency timer of device 0000:00:02.0 to 64
assign_interrupt_mode Found MSI capability
Allocate Port Service[0000:00:02.0:pcie00]
Allocate Port Service[0000:00:02.0:pcie03]
PCI: Setting latency timer of device 0000:00:03.0 to 64
assign_interrupt_mode Found MSI capability
Allocate Port Service[0000:00:03.0:pcie00]
Allocate Port Service[0000:00:03.0:pcie03]
pci_hotplug: PCI Hot Plug PCI Core version: 0.5
input: Power Button (FF) as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input0
ACPI: Power Button (FF) [PWRF]
input: Power Button (CM) as 
/devices/LNXSYSTM:00/device:00/PNP0C0C:00/input/input1
ACPI: Power Button (CM) [PWRB]
input: Sleep Button (CM) as 
/devices/LNXSYSTM:00/device:00/PNP0C0E:00/input/input2
ACPI: Sleep Button (CM) [SLPB]
input: Lid Switch as /devices/LNXSYSTM:00/device:00/PNP0C0D:00/input/input3
ACPI: Lid Switch [LID]
ACPI: CPU0 (power states: C1[C1] C2[C2] C3[C3])
ACPI: ACPI0007:00 is registered as cooling_device0
ACPI: CPU1 (power states: C1[C1] C2[C2] C3[C3])
ACPI: ACPI0007:01 is registered as cooling_device1
ACPI: LNXTHERM:01 is registered as thermal_zone0
ACPI: Thermal Zone [THRM] (62 C)
isapnp: Scanning for PnP cards...
isapnp: No Plug & Play device found
hpet_resources: 0xfed00000 is busy
Non-volatile memory driver v1.2
Linux agpgart interface v0.103
Serial: 8250/16550 driver $Revision: 1.90 $ 4 ports, IRQ sharing enabled
brd: module loaded
input: Macintosh mouse button emulation as /devices/virtual/input/input4
PNP: PS/2 Controller [PNP0303:KBC0,PNP0f13:MSE0] at 0x60,0x64 irq 1,12
serio: i8042 KBD port at 0x60,0x64 irq 1
serio: i8042 AUX port at 0x60,0x64 irq 12
mice: PS/2 mouse device common for all mice
input: AT Translated Set 2 keyboard as 
/devices/platform/i8042/serio0/input/input5
rtc_cmos 00:09: rtc core: registered rtc_cmos as rtc0
rtc0: alarms up to one year, y3k
cpuidle: using governor ladder
cpuidle: using governor menu
usbcore: registered new interface driver hiddev
usbcore: registered new interface driver usbhid
usbhid: v2.6:USB HID core driver
TCP cubic registered
Initializing XFRM netlink socket
NET: Registered protocol family 17
Using IPI No-Shortcut mode
registered taskstats version 1
  Magic number: 8:770:315
  hash matches device tty40
Freeing unused kernel memory: 284k freed
Write protecting the kernel text: 2260k
Write protecting the kernel read-only data: 940k
ACPI: PCI Interrupt Link [LUS2] enabled at IRQ 22
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
ehci_hcd 0000:00:0b.1: EHCI Host Controller
ehci_hcd 0000:00:0b.1: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:0b.1: debug port 1
PCI: cache line size of 64 is not supported by device 0000:00:0b.1
ehci_hcd 0000:00:0b.1: irq 22, io mem 0xb0005000
ehci_hcd 0000:00:0b.1: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 8 ports detected
usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb1: Product: EHCI Host Controller
usb usb1: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ehci_hcd
usb usb1: SerialNumber: 0000:00:0b.1
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt Link [LUS0] enabled at IRQ 22
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
USB Universal Host Controller Interface driver v3.0
SCSI subsystem initialized
Driver 'sd' needs updating - please use bus_type methods
libata version 3.00 loaded.
PCI: Setting latency timer of device 0000:00:0d.0 to 64
pata_acpi 0000:00:0e.0: enabling device (0005 -> 0007)
ACPI: PCI Interrupt Link [LTID] enabled at IRQ 23
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
pata_acpi 0000:00:0f.0: enabling device (0005 -> 0007)
ACPI: PCI Interrupt Link [LSI1] enabled at IRQ 20
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
Synaptics Touchpad, model: 1, fw: 6.2, id: 0x1a0b1, caps: 0xa04713/0x200000
input: SynPS/2 Synaptics TouchPad as 
/devices/platform/i8042/serio1/input/input6
usb 2-7: new low speed USB device using ohci_hcd and address 2
usb 2-7: configuration #1 chosen from 1 choice
input: Logitech USB-PS/2 Optical Mouse as 
/devices/pci0000:00/0000:00:0b.0/usb2/2-7/2-7:1.0/input/input7
input,hidraw0: USB HID v1.10 Mouse [Logitech USB-PS/2 Optical Mouse] on 
usb-0000:00:0b.0-7
usb 2-7: New USB device found, idVendor=046d, idProduct=c044
usb 2-7: New USB device strings: Mfr=1, Product=2, SerialNumber=0
usb 2-7: Product: USB-PS/2 Optical Mouse
usb 2-7: Manufacturer: Logitech
sata_nv 0000:00:0e.0: version 3.5
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
sata_nv 0000:00:0e.0: Using SWNCQ mode
PCI: Setting latency timer of device 0000:00:0e.0 to 64
scsi0 : sata_nv
scsi1 : sata_nv
ata1: SATA max UDMA/133 cmd 0x30c0 ctl 0x30b4 bmdma 0x3090 irq 23
ata2: SATA max UDMA/133 cmd 0x30b8 ctl 0x30b0 bmdma 0x3098 irq 23
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ATA-7: FUJITSU MHV2080BH PL, 892C, max UDMA/100
ata1.00: 156301488 sectors, multi 16: LBA48
ata1.00: configured for UDMA/100
ata2: SATA link down (SStatus 0 SControl 300)
scsi 0:0:0:0: Direct-Access     ATA      FUJITSU MHV2080B 892C PQ: 0 ANSI: 5
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
 sda: sda1 sda2 sda3
sd 0:0:0:0: [sda] Attached SCSI disk
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
sata_nv 0000:00:0f.0: Using SWNCQ mode
PCI: Setting latency timer of device 0000:00:0f.0 to 64
scsi2 : sata_nv
scsi3 : sata_nv
ata3: SATA max UDMA/133 cmd 0x30d8 ctl 0x30cc bmdma 0x30a0 irq 20
ata4: SATA max UDMA/133 cmd 0x30d0 ctl 0x30c8 bmdma 0x30a8 irq 20
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ATA-7: FUJITSU MHV2080BH PL, 892C, max UDMA/100
ata3.00: 156301488 sectors, multi 16: LBA48
ata3.00: configured for UDMA/100
ata4: SATA link down (SStatus 0 SControl 300)
scsi 2:0:0:0: Direct-Access     ATA      FUJITSU MHV2080B 892C PQ: 0 ANSI: 5
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
 sdb: sdb1 sdb2 sdb3
sd 2:0:0:0: [sdb] Attached SCSI disk
pata_amd 0000:00:0d.0: version 0.3.10
PCI: Setting latency timer of device 0000:00:0d.0 to 64
scsi4 : pata_amd
scsi5 : pata_amd
ata5: PATA max UDMA/133 cmd 0x1f0 ctl 0x3f6 bmdma 0x3080 irq 14
ata6: PATA max UDMA/133 cmd 0x170 ctl 0x376 bmdma 0x3088 irq 15
ata5.00: ATAPI: MATSHITADVD-RAM UJ-851S, 1.50, max MWDMA2
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
ata6: port disabled. ignoring.
scsi 4:0:0:0: CD-ROM            MATSHITA DVD-RAM UJ-851S  1.50 PQ: 0 ANSI: 5
kjournald starting.  Commit interval 5 seconds
EXT3-fs: mounted filesystem with ordered data mode.
SELinux: 8192 avtab hash slots, 172004 rules.
SELinux: 8192 avtab hash slots, 172004 rules.
SELinux:  8 users, 12 roles, 2382 types, 117 bools, 1 sens, 1024 cats
SELinux:  73 classes, 172004 rules
SELinux:  Completing initialization.
SELinux:  Setting up existing superblocks.
SELinux: initialized (dev sdb2, type ext3), uses xattr
SELinux: initialized (dev usbfs, type usbfs), uses genfs_contexts
SELinux: initialized (dev tmpfs, type tmpfs), uses transition SIDs
SELinux: initialized (dev selinuxfs, type selinuxfs), uses genfs_contexts
SELinux: initialized (dev mqueue, type mqueue), uses transition SIDs
SELinux: initialized (dev hugetlbfs, type hugetlbfs), uses genfs_contexts
SELinux: initialized (dev devpts, type devpts), uses transition SIDs
SELinux: initialized (dev inotifyfs, type inotifyfs), uses genfs_contexts
SELinux: initialized (dev tmpfs, type tmpfs), uses transition SIDs
SELinux: initialized (dev anon_inodefs, type anon_inodefs), uses 
genfs_contexts
SELinux: initialized (dev pipefs, type pipefs), uses task SIDs
SELinux: initialized (dev debugfs, type debugfs), uses genfs_contexts
SELinux: initialized (dev sockfs, type sockfs), uses task SIDs
SELinux: initialized (dev proc, type proc), uses genfs_contexts
SELinux: initialized (dev bdev, type bdev), uses genfs_contexts
SELinux: initialized (dev rootfs, type rootfs), uses genfs_contexts
SELinux: initialized (dev sysfs, type sysfs), uses genfs_contexts
SELinux: policy loaded with handle_unknown=allow
type=1403 audit(1222406439.459:2): policy loaded auid=4294967295 
ses=4294967295
forcedeth: Reverse Engineered nForce ethernet driver. Version 0.61.
ACPI: PCI Interrupt Link [LMAC] enabled at IRQ 20
ACPI: PCI Interrupt 0000:00:14.0[A] -> Link [LMAC] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:14.0 to 64
sd 0:0:0:0: Attached scsi generic sg0 type 0
sd 2:0:0:0: Attached scsi generic sg1 type 0
scsi 4:0:0:0: Attached scsi generic sg2 type 5
ACPI: AC Adapter [ACAD] (on-line)
Driver 'sr' needs updating - please use bus_type methods
sr0: scsi3-mmc drive: 24x/24x writer dvd-ram cd/rw xa/form2 cdda tray
Uniform CD-ROM driver Revision: 3.20
sr 4:0:0:0: Attached scsi CD-ROM sr0
forcedeth 0000:00:14.0: ifname eth0, PHY OUI 0x732 @ 1, addr 
00:16:36:a3:ca:35
forcedeth 0000:00:14.0: highdma pwrctl timirq lnktim desc-v3
i2c-adapter i2c-0: nForce2 SMBus adapter at 0x3040
i2c-adapter i2c-1: nForce2 SMBus adapter at 0x3000
ACPI: PCI Interrupt Link [LK4E] enabled at IRQ 19
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
PCI: Setting latency timer of device 0000:03:00.0 to 64
ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
ACPI: Battery Slot [BAT0] (battery present)
ACPI: WMI: Mapper loaded
ACPI: device:24 is registered as cooling_device2
input: Video Bus as 
/devices/LNXSYSTM:00/device:00/PNP0A03:00/device:22/input/input8
ACPI: Video Device [UVGA] (multi-head: yes  rom: no  post: no)
ACPI: device:2a is registered as cooling_device3
input: Video Bus as 
/devices/LNXSYSTM:00/device:00/PNP0A03:00/device:27/device:28/input/input9
ACPI: Video Device [VGA] (multi-head: yes  rom: no  post: no)
ACPI: PCI Interrupt Link [LNK1] enabled at IRQ 5
ACPI: PCI Interrupt 0000:07:05.0[A] -> Link [LNK1] -> GSI 5 (level, 
high) -> IRQ 5
firewire_ohci: Added fw-ohci device 0000:07:05.0, OHCI version 1.10
nvidia: module license 'NVIDIA' taints kernel.
ACPI: PCI Interrupt Link [LK3E] enabled at IRQ 18
ACPI: PCI Interrupt 0000:00:05.0[A] -> Link [LK3E] -> GSI 18 (level, 
high) -> IRQ 18
PCI: Setting latency timer of device 0000:00:05.0 to 64
NVRM: loading NVIDIA UNIX x86 Kernel Module  173.14.12  Thu Jul 17 
18:11:36 PDT 2008
ricoh-mmc: Ricoh MMC Controller disabling driver
ricoh-mmc: Copyright(c) Philip Langdale
ricoh-mmc: Ricoh MMC controller found at 0000:07:05.2 [1180:0843] (rev 1)
ricoh-mmc: Controller is now disabled.
b43-phy0: Broadcom 4311 WLAN found
b43-phy0 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy0: Selected rate control algorithm 'pid'
firewire_core: created device fw0: GUID 009fc0003533c500, S400
sdhci: Secure Digital Host Controller Interface driver
sdhci: Copyright(c) Pierre Ossman
sdhci: SDHCI controller found at 0000:07:05.1 [1180:0822] (rev 19)
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
ACPI: PCI Interrupt Link [LNK2] enabled at IRQ 7
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
mmc0: Will use DMA mode even though HW doesn't fully claim to support it.
Registered led device: mmc0
mmc0: SDHCI at 0xb8000800 irq 7 DMA
ACPI: PCI Interrupt Link [LAZA] enabled at IRQ 21
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
SELinux: initialized (dev ramfs, type ramfs), uses genfs_contexts
NET: Registered protocol family 10
lo: Disabled Privacy Extensions
Clocksource tsc unstable (delta = 4398045789914 ns)
device-mapper: uevent: version 1.0.3
device-mapper: ioctl: 4.13.0-ioctl (2007-10-18) initialised: 
dm-devel at redhat.com
device-mapper: multipath: version 1.0.5 loaded
EXT3 FS on sdb2, internal journal
SELinux: initialized (dev tmpfs, type tmpfs), uses transition SIDs
fuse init (API version 7.9)
SELinux: initialized (dev sdb1, type fuseblk), uses genfs_contexts
SELinux: initialized (dev sda1, type fuseblk), uses genfs_contexts
Adding 1052248k swap on /dev/sdb3.  Priority:-1 extents:1 across:1052248k
SELinux: initialized (dev binfmt_misc, type binfmt_misc), uses 
genfs_contexts
powernow-k8: Found 1 AMD Turion(tm) 64 X2 Mobile Technology TL-52 
processors (2 cpu cores) (version 2.20.00)
powernow-k8:    0 : fid 0x8 (1600 MHz), vid 0x13
powernow-k8:    1 : fid 0x0 (800 MHz), vid 0x1e
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
SELinux: initialized (dev rpc_pipefs, type rpc_pipefs), uses genfs_contexts
warning: `dbus-daemon' uses deprecated v2 capabilities in a way that may 
be insecure.
SELinux: initialized (dev fusectl, type fusectl), uses genfs_contexts
SELinux: initialized (dev autofs, type autofs), uses genfs_contexts
SELinux: initialized (dev autofs, type autofs), uses genfs_contexts
SELinux: initialized (dev autofs, type autofs), uses genfs_contexts
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy0 as /devices/virtual/input/input10
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
SELinux: initialized (dev sda3, type fuseblk), uses genfs_contexts
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: disassociating by local choice (reason=3)
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=1)
wlan0: associated
wlan0: disassociating by local choice (reason=3)
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-32 rx_ring: Used slots 3/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BE: Used slots 24/128, Failed frames 
44/7585 = 0.5%, Average tries 1.13
b43-phy0 debug: DMA-32 tx_ring_AC_VI: Used slots 4/128, Failed frames 
0/50 = 0.0%, Average tries 1.06
b43-phy0 debug: DMA-32 tx_ring_AC_VO: Used slots 4/128, Failed frames 
0/384 = 0.0%, Average tries 0.99
b43-phy0 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy1: Broadcom 4311 WLAN found
b43-phy1 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy1 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy1: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
ohci_hcd 0000:00:0b.0: remove, state 1
usb usb2: USB disconnect, address 1
usb 2-7: USB disconnect, address 2
ohci_hcd 0000:00:0b.0: USB bus 2 deregistered
ACPI: PCI interrupt for device 0000:00:0b.0 disabled
PM: Syncing filesystems ... done.
PM: Preparing system for mem sleep
Freezing user space processes ... (elapsed 0.00 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.00 seconds) done.
PM: Entering mem sleep
Suspending console(s)
b43-phy1 debug: Suspending...
b43-phy1 debug: Device suspended.
sd 2:0:0:0: [sdb] Synchronizing SCSI cache
sd 2:0:0:0: [sdb] Stopping disk
sd 0:0:0:0: [sda] Synchronizing SCSI cache
sd 0:0:0:0: [sda] Stopping disk
ricoh-mmc: Suspending.
ricoh-mmc: Controller is now re-enabled.
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:07:05.1 disabled
ACPI handle has no context!
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
ata6: port disabled. ignoring.
ACPI: PCI interrupt for device 0000:00:0b.1 disabled
NVRM: RmPowerManagement: 4
ACPI: Preparing to enter system sleep state S3
Disabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
Breaking affinity for irq 5
Breaking affinity for irq 12
Breaking affinity for irq 18
Breaking affinity for irq 22
Breaking affinity for irq 23
CPU 1 is now offline
SMP alternatives: switching to UP code
CPU0 attaching sched-domain:
 domain 0: span 0
  groups: 0
CPU1 is down
x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Back to C!
Enabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
SMP alternatives: switching to SMP code
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.47 BogoMIPS 
(lpj=1607236)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
CPU1 is up
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
ACPI: EC: non-query interrupt received, switching to interrupt mode
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
NVRM: RmPowerManagement: 5
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
PCI: Setting latency timer of device 0000:00:0d.0 to 64
ata6: port disabled. ignoring.
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
b43-pci-bridge 0000:03:00.0: enabling device (0000 -> 0002)
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
firewire_core: skipped bus generations, destroying all nodes
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
ricoh-mmc: Resuming.
ricoh-mmc: Controller is now disabled.
ata5.00: ACPI cmd ef/03:22:00:00:00:a0 filtered out
ata5.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
ata2: SATA link down (SStatus 0 SControl 300)
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata1.00: configured for UDMA/100
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
ata4: SATA link down (SStatus 0 SControl 300)
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata3.00: configured for UDMA/100
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
firewire_core: created device fw0: GUID 009fc0003533c500, S400
atkbd.c: Unknown key pressed (translated set 2, code 0xd9 on 
isa0060/serio0).
atkbd.c: Use 'setkeycodes e059 <keycode>' to make it known.
sd 0:0:0:0: [sda] Starting disk
sd 2:0:0:0: [sdb] Starting disk
b43-phy1 debug: Resuming...
b43-phy1 debug: Device resumed.
PM: Finishing wakeup.
Restarting tasks ... done.
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
  domain 1: span 0-1
   groups: 0-1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
  domain 1: span 0-1
   groups: 0-1
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
psmouse.c: TouchPad at isa0060/serio1/input0 lost sync at byte 4
psmouse.c: TouchPad at isa0060/serio1/input0 lost sync at byte 1
psmouse.c: TouchPad at isa0060/serio1/input0 - driver resynched.
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy1 as /devices/virtual/input/input11
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy1: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy1 debug: Chip initialized
b43-phy1 debug: 32-bit DMA initialized
Registered led device: b43-phy1::tx
Registered led device: b43-phy1::rx
Registered led device: b43-phy1::radio
b43-phy1 debug: Wireless interface started
b43-phy1 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:1d:a2:a0:4f:d2
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:4f:d2
wlan0: RX AssocResp from 00:1d:a2:a0:4f:d2 (capab=0x421 status=0 aid=7)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
wlan0: disassociating by local choice (reason=3)
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX AssocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=16)
wlan0: associated
wlan0: no IPv6 routers present
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=16)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=16)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 1 messages suppressed
b43-phy1 ERROR: PHY transmission error
__ratelimit: 8 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1e:13:0d:b9:52
wlan0: authenticate with AP 00:1e:13:0d:b9:52
wlan0: authenticated
wlan0: associate with AP 00:1e:13:0d:b9:52
wlan0: RX ReassocResp from 00:1e:13:0d:b9:52 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1e:13:0d:b9:52
wlan0: RX AssocResp from 00:1e:13:0d:b9:52 (capab=0x421 status=0 aid=21)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX AssocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=18)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:4f:d2
wlan0: deauthenticated
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:4f:d2
wlan0: RX ReassocResp from 00:1d:a2:a0:4f:d2 (capab=0x421 status=0 aid=16)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: deauthenticated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=28)
wlan0: associated
__ratelimit: 18 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:4f:d2
wlan0: deauthenticated
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:4f:d2
wlan0: RX ReassocResp from 00:1d:a2:a0:4f:d2 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1d:a2:a0:4f:d2
wlan0: RX AssocResp from 00:1d:a2:a0:4f:d2 (capab=0x421 status=0 aid=19)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: deauthenticated
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 8 messages suppressed
b43-phy1 ERROR: PHY transmission error
__ratelimit: 40 messages suppressed
b43-phy1 ERROR: PHY transmission error
__ratelimit: 24 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 6 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 5 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 2 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 4 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:5a:22
wlan0: RX ReassocResp from 00:1d:a2:a0:5a:22 (capab=0x421 status=0 aid=34)
wlan0: associated
wlan0: No ProbeResp from current AP 00:1d:a2:a0:5a:22 - assume out of range
wlan0: authenticate with AP 00:1d:a2:a0:5a:22
wlan0: authenticate with AP 00:1d:a2:a0:68:a2
wlan0: authenticated
wlan0: associate with AP 00:1d:a2:a0:68:a2
wlan0: RX ReassocResp from 00:1d:a2:a0:68:a2 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1d:a2:a0:68:a2
wlan0: RX AssocResp from 00:1d:a2:a0:68:a2 (capab=0x421 status=0 aid=15)
wlan0: associated
wlan0: No ProbeResp from current AP 00:1d:a2:a0:68:a2 - assume out of range
wlan0: authenticate with AP 00:1e:13:0d:b5:82
wlan0: authenticated
wlan0: associate with AP 00:1e:13:0d:b5:82
wlan0: RX ReassocResp from 00:1e:13:0d:b5:82 (capab=0x421 status=17 aid=0)
wlan0: AP denied association (code=17)
wlan0: associate with AP 00:1e:13:0d:b5:82
wlan0: RX AssocResp from 00:1e:13:0d:b5:82 (capab=0x421 status=0 aid=4)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
wlan0: No ProbeResp from current AP 00:1e:13:0d:b5:82 - assume out of range
wlan0: authenticate with AP 00:17:0f:83:c1:82
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:c1:82
wlan0: associate with AP 00:17:0f:83:c1:82
wlan0: associate with AP 00:17:0f:83:c1:82
wlan0: association with AP 00:17:0f:83:c1:82 timed out
wlan0: authenticate with AP 00:17:0f:83:c1:82
wlan0: authenticate with AP 00:17:0f:83:c1:82
wlan0: authenticate with AP 00:17:0f:83:c1:82
wlan0: authentication with AP 00:17:0f:83:c1:82 timed out
wlan0: authenticate with AP 00:0f:34:a6:56:12
wlan0: authenticated
wlan0: associate with AP 00:0f:34:a6:56:12
wlan0: RX AssocResp from 00:0f:34:a6:56:12 (capab=0x421 status=0 aid=2)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:0f:34:a6:56:12
wlan0: authenticate with AP 00:0f:34:a6:56:12
wlan0: authenticated
wlan0: associate with AP 00:0f:34:a6:56:12
wlan0: RX ReassocResp from 00:0f:34:a6:56:12 (capab=0x421 status=0 aid=2)
wlan0: associated
wlan0: No ProbeResp from current AP 00:0f:34:a6:56:12 - assume out of range
wlan0: authenticate with AP 00:17:0f:83:bd:e2
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:bd:e2
wlan0: associate with AP 00:17:0f:83:bd:e2
wlan0: RX ReassocResp from 00:17:0f:83:bd:e2 (capab=0x421 status=0 aid=29)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: No ProbeResp from current AP 00:17:0f:83:bd:e2 - assume out of range
wlan0: authenticate with AP 00:17:0f:83:d2:a2
wlan0: authenticate with AP 00:17:0f:83:bf:62
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:bf:62
wlan0: associate with AP 00:17:0f:83:bf:62
wlan0: RX ReassocResp from 00:17:0f:83:bf:62 (capab=0x421 status=0 aid=39)
wlan0: associated
__ratelimit: 18 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 1 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:17:0f:83:bf:62
wlan0: authenticate with AP 00:17:0f:83:bf:62
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:bf:62
wlan0: RX ReassocResp from 00:17:0f:83:bf:62 (capab=0x421 status=0 aid=39)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 13 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:17:0f:83:d2:a2
wlan0: authenticate with AP 00:17:0f:83:bf:62
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:bf:62
wlan0: RX ReassocResp from 00:17:0f:83:bf:62 (capab=0x421 status=0 aid=39)
wlan0: associated
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 10 messages suppressed
b43-phy1 ERROR: PHY transmission error
__ratelimit: 9 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 1 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 4 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 4 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
__ratelimit: 4 messages suppressed
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
b43-phy1 ERROR: PHY transmission error
wlan0: authenticate with AP 00:17:0f:83:bf:62
wlan0: authenticated
wlan0: associate with AP 00:17:0f:83:bf:62
wlan0: disassociating by local choice (reason=3)
b43-phy1 debug: Removing Interface type 2
b43-phy1 debug: Wireless interface stopped
b43-phy1 debug: DMA-32 rx_ring: Used slots 6/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy1 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy1 debug: DMA-32 tx_ring_AC_BE: Used slots 34/128, Failed frames 
1250/17385 = 7.1%, Average tries 2.02
b43-phy1 debug: DMA-32 tx_ring_AC_VI: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy1 debug: DMA-32 tx_ring_AC_VO: Used slots 4/128, Failed frames 
25/1190 = 2.1%, Average tries 1.18
b43-phy1 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy2: Broadcom 4311 WLAN found
b43-phy2 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy2 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy2: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
ohci_hcd 0000:00:0b.0: remove, state 4
usb usb2: USB disconnect, address 1
ohci_hcd 0000:00:0b.0: USB bus 2 deregistered
ACPI: PCI interrupt for device 0000:00:0b.0 disabled
PM: Syncing filesystems ... done.
PM: Preparing system for mem sleep
Freezing user space processes ... (elapsed 0.00 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.00 seconds) done.
PM: Entering mem sleep
Suspending console(s)
b43-phy2 debug: Suspending...
b43-phy2 debug: Device suspended.
sd 2:0:0:0: [sdb] Synchronizing SCSI cache
sd 2:0:0:0: [sdb] Stopping disk
sd 0:0:0:0: [sda] Synchronizing SCSI cache
sd 0:0:0:0: [sda] Stopping disk
ricoh-mmc: Suspending.
ricoh-mmc: Controller is now re-enabled.
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:07:05.1 disabled
ACPI handle has no context!
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
ata6: port disabled. ignoring.
ACPI: PCI interrupt for device 0000:00:0b.1 disabled
NVRM: RmPowerManagement: 4
ACPI: Preparing to enter system sleep state S3
Disabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
Breaking affinity for irq 5
Breaking affinity for irq 12
Breaking affinity for irq 18
Breaking affinity for irq 21
CPU 1 is now offline
SMP alternatives: switching to UP code
CPU0 attaching sched-domain:
 domain 0: span 0
  groups: 0
CPU1 is down
x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Back to C!
Enabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
SMP alternatives: switching to SMP code
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.51 BogoMIPS 
(lpj=1607255)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
  domain 1: span 0-1
   groups: 0-1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
  domain 1: span 0-1
   groups: 0-1
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
CPU1 is up
ACPI: EC: non-query interrupt received, switching to interrupt mode
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
NVRM: RmPowerManagement: 5
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
PCI: Setting latency timer of device 0000:00:0d.0 to 64
ata6: port disabled. ignoring.
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
b43-pci-bridge 0000:03:00.0: enabling device (0000 -> 0002)
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
firewire_core: skipped bus generations, destroying all nodes
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
ricoh-mmc: Resuming.
ricoh-mmc: Controller is now disabled.
ata5.00: ACPI cmd ef/03:22:00:00:00:a0 filtered out
ata5.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata2: SATA link down (SStatus 0 SControl 300)
ata4: SATA link down (SStatus 0 SControl 300)
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
firewire_core: created device fw0: GUID 009fc0003533c500, S400
ata3.00: NODEV after polling detection
ata3.00: revalidation failed (errno=-2)
ata3: failed to recover some devices, retrying in 5 secs
ata1.00: NODEV after polling detection
ata1.00: revalidation failed (errno=-2)
ata1: failed to recover some devices, retrying in 5 secs
sd 0:0:0:0: [sda] Starting disk
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata3.00: configured for UDMA/100
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
ata1.00: configured for UDMA/100
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Starting disk
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
b43-phy2 debug: Resuming...
b43-phy2 debug: Device resumed.
PM: Finishing wakeup.
Restarting tasks ... done.
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy2 as /devices/virtual/input/input12
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy2: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy2 debug: Chip initialized
b43-phy2 debug: 32-bit DMA initialized
Registered led device: b43-phy2::tx
Registered led device: b43-phy2::rx
Registered led device: b43-phy2::radio
b43-phy2 debug: Wireless interface started
b43-phy2 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX AssocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy2 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy2 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy2 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy2 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy2 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy2 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy2 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy2 debug: RX: Packet dropped
wlan0: disassociating by local choice (reason=3)
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
b43-phy2 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: disassociating by local choice (reason=3)
b43-phy2 debug: Removing Interface type 2
b43-phy2 debug: Wireless interface stopped
b43-phy2 debug: DMA-32 rx_ring: Used slots 14/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy2 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy2 debug: DMA-32 tx_ring_AC_BE: Used slots 16/128, Failed frames 
79/10589 = 0.7%, Average tries 1.16
b43-phy2 debug: DMA-32 tx_ring_AC_VI: Used slots 2/128, Failed frames 
0/55 = 0.0%, Average tries 1.01
b43-phy2 debug: DMA-32 tx_ring_AC_VO: Used slots 6/128, Failed frames 
0/208 = 0.0%, Average tries 1.00
b43-phy2 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy3: Broadcom 4311 WLAN found
b43-phy3 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy3 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy3: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
ohci_hcd 0000:00:0b.0: remove, state 4
usb usb2: USB disconnect, address 1
ohci_hcd 0000:00:0b.0: USB bus 2 deregistered
ACPI: PCI interrupt for device 0000:00:0b.0 disabled
PM: Syncing filesystems ... done.
PM: Preparing system for mem sleep
Freezing user space processes ... (elapsed 0.00 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.00 seconds) done.
PM: Entering mem sleep
Suspending console(s)
b43-phy3 debug: Suspending...
b43-phy3 debug: Device suspended.
sd 2:0:0:0: [sdb] Synchronizing SCSI cache
sd 2:0:0:0: [sdb] Stopping disk
sd 0:0:0:0: [sda] Synchronizing SCSI cache
sd 0:0:0:0: [sda] Stopping disk
ricoh-mmc: Suspending.
ricoh-mmc: Controller is now re-enabled.
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:07:05.1 disabled
ACPI handle has no context!
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
ata6: port disabled. ignoring.
ACPI: PCI interrupt for device 0000:00:0b.1 disabled
NVRM: RmPowerManagement: 4
ACPI: Preparing to enter system sleep state S3
Disabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
Breaking affinity for irq 9
Breaking affinity for irq 12
Breaking affinity for irq 18
CPU 1 is now offline
SMP alternatives: switching to UP code
CPU0 attaching sched-domain:
 domain 0: span 0
  groups: 0
CPU1 is down
x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Back to C!
Enabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
SMP alternatives: switching to SMP code
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.53 BogoMIPS 
(lpj=1607266)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
CPU1 is up
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
ACPI: EC: non-query interrupt received, switching to interrupt mode
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
NVRM: RmPowerManagement: 5
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
PCI: Setting latency timer of device 0000:00:0d.0 to 64
ata6: port disabled. ignoring.
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
b43-pci-bridge 0000:03:00.0: enabling device (0000 -> 0002)
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
ata5.00: ACPI cmd ef/03:22:00:00:00:a0 filtered out
ata5.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
firewire_core: skipped bus generations, destroying all nodes
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
ricoh-mmc: Resuming.
ricoh-mmc: Controller is now disabled.
ata2: SATA link down (SStatus 0 SControl 300)
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata1.00: configured for UDMA/100
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
ata4: SATA link down (SStatus 0 SControl 300)
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata3.00: configured for UDMA/100
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
firewire_core: created device fw0: GUID 009fc0003533c500, S400
sd 0:0:0:0: [sda] Starting disk
sd 2:0:0:0: [sdb] Starting disk
b43-phy3 debug: Resuming...
b43-phy3 debug: Device resumed.
PM: Finishing wakeup.
Restarting tasks ... done.
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy3 as /devices/virtual/input/input13
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy3: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy3 debug: Chip initialized
b43-phy3 debug: 32-bit DMA initialized
Registered led device: b43-phy3::tx
Registered led device: b43-phy3::rx
Registered led device: b43-phy3::radio
b43-phy3 debug: Wireless interface started
b43-phy3 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy3 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: disassociating by local choice (reason=3)
b43-phy3 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
b43-phy3 debug: Removing Interface type 2
b43-phy3 debug: Wireless interface stopped
b43-phy3 debug: DMA-32 rx_ring: Used slots 2/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy3 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy3 debug: DMA-32 tx_ring_AC_BE: Used slots 6/128, Failed frames 
0/128 = 0.0%, Average tries 1.05
b43-phy3 debug: DMA-32 tx_ring_AC_VI: Used slots 2/128, Failed frames 
0/3 = 0.0%, Average tries 1.00
b43-phy3 debug: DMA-32 tx_ring_AC_VO: Used slots 2/128, Failed frames 
0/40 = 0.0%, Average tries 1.02
b43-phy3 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
PCI: Setting latency timer of device 0000:03:00.0 to 64
ohci_hcd 0000:00:0b.0: remove, state 4
usb usb2: USB disconnect, address 1
ohci_hcd 0000:00:0b.0: USB bus 2 deregistered
ACPI: PCI interrupt for device 0000:00:0b.0 disabled
ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
b43: Unknown symbol input_allocate_polled_device
b43: Unknown symbol input_free_polled_device
b43: Unknown symbol input_register_polled_device
b43: Unknown symbol input_unregister_polled_device
b43-phy0: Broadcom 4311 WLAN found
b43-phy0 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy0: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
PM: Syncing filesystems ... done.
PM: Preparing system for mem sleep
Freezing user space processes ... (elapsed 0.00 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.00 seconds) done.
PM: Entering mem sleep
Suspending console(s)
b43-phy0 debug: Suspending...
b43-phy0 debug: Device suspended.
sd 2:0:0:0: [sdb] Synchronizing SCSI cache
sd 2:0:0:0: [sdb] Stopping disk
sd 0:0:0:0: [sda] Synchronizing SCSI cache
sd 0:0:0:0: [sda] Stopping disk
ricoh-mmc: Suspending.
ricoh-mmc: Controller is now re-enabled.
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:07:05.1 disabled
ACPI handle has no context!
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
ata6: port disabled. ignoring.
ACPI: PCI interrupt for device 0000:00:0b.1 disabled
NVRM: RmPowerManagement: 4
ACPI: Preparing to enter system sleep state S3
Disabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU 1 is now offline
SMP alternatives: switching to UP code
CPU0 attaching sched-domain:
 domain 0: span 0
  groups: 0
CPU1 is down
x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Back to C!
Enabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
SMP alternatives: switching to SMP code
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.51 BogoMIPS 
(lpj=1607258)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
CPU1 is up
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
ACPI: EC: non-query interrupt received, switching to interrupt mode
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
NVRM: RmPowerManagement: 5
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
PCI: Setting latency timer of device 0000:00:0d.0 to 64
ata6: port disabled. ignoring.
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
b43-pci-bridge 0000:03:00.0: enabling device (0000 -> 0002)
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
ata5.00: ACPI cmd ef/03:22:00:00:00:a0 filtered out
ata5.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
firewire_core: skipped bus generations, destroying all nodes
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
ricoh-mmc: Resuming.
ricoh-mmc: Controller is now disabled.
ata2: SATA link down (SStatus 0 SControl 300)
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata1.00: configured for UDMA/100
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
ata4: SATA link down (SStatus 0 SControl 300)
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata3.00: configured for UDMA/100
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
firewire_core: created device fw0: GUID 009fc0003533c500, S400
sd 0:0:0:0: [sda] Starting disk
sd 2:0:0:0: [sdb] Starting disk
b43-phy0 debug: Resuming...
b43-phy0 debug: Device resumed.
PM: Finishing wakeup.
Restarting tasks ... done.
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy0 as /devices/virtual/input/input14
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
  domain 1: span 0-1
   groups: 0-1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
  domain 1: span 0-1
   groups: 0-1
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
wlan0: disassociating by local choice (reason=3)
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-32 rx_ring: Used slots 3/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BE: Used slots 22/128, Failed frames 
87/6567 = 1.3%, Average tries 1.37
b43-phy0 debug: DMA-32 tx_ring_AC_VI: Used slots 4/128, Failed frames 
0/81 = 0.0%, Average tries 1.02
b43-phy0 debug: DMA-32 tx_ring_AC_VO: Used slots 4/128, Failed frames 
0/208 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
ACPI: PCI interrupt for device 0000:03:00.0 disabled
b43: Unknown symbol ssb_device_is_enabled
b43: Unknown symbol ssb_pcicore_dev_irqvecs_enable
b43: Unknown symbol ssb_bus_may_powerdown
b43: Unknown symbol ieee80211_free_hw
b43: Unknown symbol ssb_dma_free_consistent
b43: Unknown symbol ieee80211_alloc_hw
b43: Unknown symbol ssb_bus_suspend
b43: Unknown symbol ieee80211_register_hw
b43: Unknown symbol ssb_bus_unregister
b43: Unknown symbol ieee80211_generic_frame_duration
b43: Unknown symbol ieee80211_wake_queue
b43: Unknown symbol ssb_bus_resume
b43: Unknown symbol ssb_set_devtypedata
b43: Unknown symbol __ieee80211_get_tx_led_name
b43: Unknown symbol input_allocate_polled_device
b43: Unknown symbol ieee80211_tx_status_irqsafe
b43: Unknown symbol ssb_device_disable
b43: Unknown symbol __ieee80211_get_rx_led_name
b43: Unknown symbol input_free_polled_device
b43: Unknown symbol ssb_dma_alloc_consistent
b43: Unknown symbol ssb_dma_set_mask
b43: Unknown symbol ieee80211_ctstoself_get
b43: Unknown symbol ssb_device_enable
b43: Unknown symbol ssb_driver_unregister
b43: Unknown symbol ieee80211_stop_queue
b43: Unknown symbol __ssb_driver_register
b43: Unknown symbol __ieee80211_get_assoc_led_name
b43: Unknown symbol ssb_bus_pcmciabus_register
b43: Unknown symbol ssb_bus_powerup
b43: Unknown symbol ieee80211_unregister_hw
b43: Unknown symbol input_register_polled_device
b43: Unknown symbol ieee80211_hdrlen
b43: Unknown symbol ieee80211_rts_get
b43: Unknown symbol ieee80211_beacon_get
b43: Unknown symbol input_unregister_polled_device
b43: Unknown symbol ssb_dma_translation
b43: Unknown symbol ieee80211_rx_irqsafe
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
PCI: Setting latency timer of device 0000:03:00.0 to 64
ohci_hcd 0000:00:0b.0: remove, state 4
usb usb2: USB disconnect, address 1
ohci_hcd 0000:00:0b.0: USB bus 2 deregistered
ACPI: PCI interrupt for device 0000:00:0b.0 disabled
ssb: Sonics Silicon Backplane found on PCI device 0000:03:00.0
b43-phy0: Broadcom 4311 WLAN found
b43-phy0 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy0 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy0: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
PM: Syncing filesystems ... done.
PM: Preparing system for mem sleep
Freezing user space processes ... (elapsed 0.00 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.00 seconds) done.
PM: Entering mem sleep
Suspending console(s)
b43-phy0 debug: Suspending...
b43-phy0 debug: Device suspended.
sd 2:0:0:0: [sdb] Synchronizing SCSI cache
sd 2:0:0:0: [sdb] Stopping disk
sd 0:0:0:0: [sda] Synchronizing SCSI cache
sd 0:0:0:0: [sda] Stopping disk
ricoh-mmc: Suspending.
ricoh-mmc: Controller is now re-enabled.
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:07:05.1 disabled
ACPI handle has no context!
ACPI handle has no context!
ACPI: PCI interrupt for device 0000:03:00.0 disabled
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI interrupt for device 0000:00:0f.0 disabled
ACPI: PCI interrupt for device 0000:00:0e.0 disabled
ata6: port disabled. ignoring.
ACPI: PCI interrupt for device 0000:00:0b.1 disabled
NVRM: RmPowerManagement: 4
ACPI: Preparing to enter system sleep state S3
Disabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
Breaking affinity for irq 1
Breaking affinity for irq 5
Breaking affinity for irq 12
CPU 1 is now offline
SMP alternatives: switching to UP code
CPU0 attaching sched-domain:
 domain 0: span 0
  groups: 0
CPU1 is down
x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
Back to C!
Enabling non-boot CPUs ...
CPU0 attaching NULL sched-domain.
SMP alternatives: switching to SMP code
CPU 1 irqstacks, hard=c07c7000 soft=c07a7000
Booting processor 1/1 ip 6000
Initializing CPU#1
Calibrating delay using timer specific routine.. 3214.52 BogoMIPS 
(lpj=1607261)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
CPU 1(2) -> Core 1
AMD C1E detected late.     Force timer broadcast.
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#1.
x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106
CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-52 stepping 02
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
CPU1 is up
Clockevents: could not switch to one-shot mode: lapic is not functional.
Could not switch to high resolution mode on CPU 1
ACPI: EC: non-query interrupt received, switching to interrupt mode
PCI: Setting latency timer of device 0000:00:02.0 to 64
PCI: Setting latency timer of device 0000:00:03.0 to 64
NVRM: RmPowerManagement: 5
ACPI: PCI Interrupt 0000:00:0b.1[B] -> Link [LUS2] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.1 to 64
PCI: Setting latency timer of device 0000:00:0d.0 to 64
ata6: port disabled. ignoring.
ACPI: PCI Interrupt 0000:00:0e.0[A] -> Link [LTID] -> GSI 23 (level, 
high) -> IRQ 23
PCI: Setting latency timer of device 0000:00:0e.0 to 64
ACPI: PCI Interrupt 0000:00:0f.0[A] -> Link [LSI1] -> GSI 20 (level, 
high) -> IRQ 20
PCI: Setting latency timer of device 0000:00:0f.0 to 64
PCI: Setting latency timer of device 0000:00:10.0 to 64
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
b43-pci-bridge 0000:03:00.0: enabling device (0000 -> 0002)
ACPI: PCI Interrupt 0000:03:00.0[A] -> Link [LK4E] -> GSI 19 (level, 
high) -> IRQ 19
ata5.00: ACPI cmd ef/03:22:00:00:00:a0 filtered out
ata5.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out
ata5: nv_mode_filter: 0x39f&0x39f->0x39f, BIOS=0x0 (0xc600) ACPI=0x39f 
(120:600:0x12)
ata5.00: configured for MWDMA2
firewire_core: skipped bus generations, destroying all nodes
ACPI: PCI Interrupt 0000:07:05.1[B] -> Link [LNK2] -> GSI 7 (level, 
high) -> IRQ 7
ricoh-mmc: Resuming.
ricoh-mmc: Controller is now disabled.
ata2: SATA link down (SStatus 0 SControl 300)
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata1.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata1.00: configured for UDMA/100
sd 0:0:0:0: [sda] 156301488 512-byte hardware sectors (80026 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
ata4: SATA link down (SStatus 0 SControl 300)
ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
ata3.00: ACPI cmd ef/03:46:00:00:00:a0 filtered out
ata3.00: configured for UDMA/100
sd 2:0:0:0: [sdb] 156301488 512-byte hardware sectors (80026 MB)
sd 2:0:0:0: [sdb] Write Protect is off
sd 2:0:0:0: [sdb] Mode Sense: 00 3a 00 00
sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't 
support DPO or FUA
firewire_core: created device fw0: GUID 009fc0003533c500, S400
sd 0:0:0:0: [sda] Starting disk
sd 2:0:0:0: [sdb] Starting disk
b43-phy0 debug: Resuming...
b43-phy0 debug: Device resumed.
PM: Finishing wakeup.
Restarting tasks ... done.
ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver
ACPI: PCI Interrupt 0000:00:0b.0[A] -> Link [LUS0] -> GSI 22 (level, 
high) -> IRQ 22
PCI: Setting latency timer of device 0000:00:0b.0 to 64
ohci_hcd 0000:00:0b.0: OHCI Host Controller
ohci_hcd 0000:00:0b.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:0b.0: irq 22, io mem 0xb0004000
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 8 ports detected
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: OHCI Host Controller
usb usb2: Manufacturer: Linux 2.6.26.5-47.fc9.i686 ohci_hcd
usb usb2: SerialNumber: 0000:00:0b.0
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy0 as /devices/virtual/input/input15
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX AssocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX AssocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: disassociating by local choice (reason=3)
wlan0: disassociating by local choice (reason=3)
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-32 rx_ring: Used slots 2/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BE: Used slots 4/128, Failed frames 
0/140 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-32 tx_ring_AC_VI: Used slots 2/128, Failed frames 
0/17 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-32 tx_ring_AC_VO: Used slots 2/128, Failed frames 
0/41 = 0.0%, Average tries 1.00
b43-phy0 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
ACPI: PCI interrupt for device 0000:00:10.1 disabled
ACPI: PCI Interrupt 0000:00:10.1[B] -> Link [LAZA] -> GSI 21 (level, 
high) -> IRQ 21
PCI: Setting latency timer of device 0000:00:10.1 to 64
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
eth0: no link during initialization.
ADDRCONF(NETDEV_UP): eth0: link is not ready
input: b43-phy0 as /devices/virtual/input/input16
b43-phy0: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy0 debug: Chip initialized
b43-phy0 debug: 32-bit DMA initialized
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
b43-phy0 debug: Wireless interface started
b43-phy0 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
CPU0 attaching NULL sched-domain.
CPU1 attaching NULL sched-domain.
CPU0 attaching sched-domain:
 domain 0: span 0-1
  groups: 0 1
CPU1 attaching sched-domain:
 domain 0: span 0-1
  groups: 1 0
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: RX: Packet dropped
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
psmouse.c: TouchPad at isa0060/serio1/input0 lost sync at byte 4
psmouse.c: TouchPad at isa0060/serio1/input0 - driver resynched.
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX ReassocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy0 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: association with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
b43-phy0 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
b43-phy0 debug: Removing Interface type 2
b43-phy0 debug: Wireless interface stopped
b43-phy0 debug: DMA-32 rx_ring: Used slots 5/64, Failed frames 0/0 = 
0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BK: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy0 debug: DMA-32 tx_ring_AC_BE: Used slots 110/128, Failed frames 
1274/84486 = 1.5%, Average tries 1.36
b43-phy0 debug: DMA-32 tx_ring_AC_VI: Used slots 10/128, Failed frames 
13/1068 = 1.2%, Average tries 1.32
b43-phy0 debug: DMA-32 tx_ring_AC_VO: Used slots 8/128, Failed frames 
21/1655 = 1.2%, Average tries 0.99
b43-phy0 debug: DMA-32 tx_ring_mcast: Used slots 0/128, Failed frames 
0/0 = 0.0%, Average tries 0.00
b43-phy1: Broadcom 4311 WLAN found
b43-phy1 debug: Found PHY: Analog 4, Type 2, Revision 8
b43-phy1 debug: Found Radio: Manuf 0x17F, Version 0x2050, Revision 2
phy1: Selected rate control algorithm 'pid'
Broadcom 43xx driver loaded [ Features: PMLR, Firmware-ID: FW13 ]
input: b43-phy1 as /devices/virtual/input/input17
firmware: requesting b43/ucode5.fw
firmware: requesting b43/pcm5.fw
firmware: requesting b43/b0g0initvals5.fw
firmware: requesting b43/b0g0bsinitvals5.fw
b43-phy1: Loading firmware version 410.2160 (2007-05-26 15:32:10)
b43-phy1 debug: Chip initialized
b43-phy1 debug: 32-bit DMA initialized
Registered led device: b43-phy1::tx
Registered led device: b43-phy1::rx
Registered led device: b43-phy1::radio
b43-phy1 debug: Wireless interface started
b43-phy1 debug: Adding Interface type 2
ADDRCONF(NETDEV_UP): wlan0: link is not ready
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX AssocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
b43-phy1 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: no IPv6 routers present
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy1 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
b43-phy1 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticated
wlan0: associate with AP 00:16:01:9a:91:de
wlan0: RX AssocResp from 00:16:01:9a:91:de (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy1 debug: Using hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: deauthenticated
b43-phy1 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy1 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: association with AP 00:1a:70:ec:59:6a timed out
wlan0: deauthenticated
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy1 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authentication with AP 00:16:01:9a:91:de timed out
wlan0: authenticate with AP 00:16:01:9a:91:de
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authentication with AP 00:1a:70:ec:59:6a timed out
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX AssocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
wlan0: deauthenticated
b43-phy1 debug: Disabling hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticate with AP 00:1a:70:ec:59:6a
wlan0: authenticated
wlan0: associate with AP 00:1a:70:ec:59:6a
wlan0: RX ReassocResp from 00:1a:70:ec:59:6a (capab=0x411 status=0 aid=2)
wlan0: associated
b43-phy1 debug: Using hardware based encryption for keyidx: 0, mac: 
00:1a:70:ec:59:6a


From netrolller.3d at gmail.com  Sat Sep 27 14:08:00 2008
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?Stefanik_G=E1bor?=)
Date: Sat, 27 Sep 2008 14:08:00 +0200
Subject: BCM4311 Rev 01 constantly re-associating
In-Reply-To: <48DD6FE0.2080408@neoturbine.net>
References: <48DD6FE0.2080408@neoturbine.net>
Message-ID: <69e28c910809270508h47e472ddrcbcbb14a1f2597d5@mail.gmail.com>

On Sat, Sep 27, 2008 at 1:27 AM, Steven Bularca <steve at neoturbine.net> wrote:
> Fellow bcm-users,
>
> I have had this issue with my BCM4311 rev 01 for a couple of months
> now.  It seems whenever I am connected to a wireless network supported
> by multiple APs with the same SSID (as is the case whenever I am at home
> or at school), b43 can't seem to tell which one to stay connected to and
> thus is continuously disconnecting and reconnecting over and over.  I
> have provided my dmesg output below, you can see every time the
> connection to an AP is lost and it tries to connect to a different one.
> If there is any other information that developers would need for me to
> provide in an attempt to get this resolved, please let me know.
>
>
> <snip>

Looks like the key might be the PHY transmission errors...

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


From mb at bu3sch.de  Sat Sep 27 20:29:15 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Sat, 27 Sep 2008 20:29:15 +0200
Subject: [PATCH] [SSB] Initialise dma_mask for SSB_BUSTYPE_SSB devices
In-Reply-To: <48DE73A4.1010704@cortland.com>
References: <20080926202711.GA23466@volta.aurel32.net>
	<200809262316.04056.mb@bu3sch.de> <48DE73A4.1010704@cortland.com>
Message-ID: <200809272029.15472.mb@bu3sch.de>

On Saturday 27 September 2008 19:55:48 Steve Brown wrote: 
> FWIW: Last July, I posted this patch for dma_set_mask to the linux-mips 
> list. It never went anywhere.

Yeah thanks. That's the correct solution, IMO.
And I don't think it can even break anything. (Could probably
uncover hidden bugs, however. I'm not sure)


-- 
Greetings Michael.


From sbrown at cortland.com  Sat Sep 27 19:55:48 2008
From: sbrown at cortland.com (Steve Brown)
Date: Sat, 27 Sep 2008 13:55:48 -0400
Subject: [PATCH] [SSB] Initialise dma_mask for SSB_BUSTYPE_SSB devices
In-Reply-To: <200809262316.04056.mb@bu3sch.de>
References: <20080926202711.GA23466@volta.aurel32.net>	<200809262249.25902.mb@bu3sch.de>	<20080926210926.GA11742@hall.aurel32.net>
	<200809262316.04056.mb@bu3sch.de>
Message-ID: <48DE73A4.1010704@cortland.com>

Michael Buesch wrote:
> On Friday 26 September 2008 23:09:26 Aurelien Jarno wrote:
>   
>> On Fri, Sep 26, 2008 at 10:49:25PM +0200, Michael Buesch wrote:
>>     
>>> On Friday 26 September 2008 22:27:11 Aurelien Jarno wrote:
>>>       
>>>> For SSB_BUSTYPE_SSB type devices, we need to initialize dma_mask using
>>>> coherent_dma_mask so that calls to dma_set_mask() succeed.
>>>>         
>>> This is a hack IMO and the mips DMA API should be fixed.
>>> However, I can live with it and you can add my ACK.
>>>       
>> Why do you think it is a hack? The isa bus is doing the same.
>>     
>
> If dma_set_mask doesn't work without it, why not do it inside of
> dma_set_mask?
>
> Anyway, as I said I'm fine with this.
>
>   
FWIW: Last July, I posted this patch for dma_set_mask to the linux-mips 
list. It never went anywhere.

Steve


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 170-dma_set_mask.patch
URL: <https://lists.berlios.de/pipermail/bcm43xx-dev/attachments/20080927/6651f0f9/attachment.ksh>

From dennisn at dennisn.dyndns.org  Sun Sep 28 01:16:17 2008
From: dennisn at dennisn.dyndns.org (Dennis Nezic)
Date: Sat, 27 Sep 2008 19:16:17 -0400
Subject: BCM4311 Rev 01 constantly re-associating
In-Reply-To: <48DD6FE0.2080408@neoturbine.net>
References: <48DD6FE0.2080408@neoturbine.net>
Message-ID: <20080927191617.1ae7aee8.dennisn@dennisn.dyndns.org>

> On Fri, 26 Sep 2008 19:27:28 -0400,
> Steven Bularca <steve-CXsZ7cYqW4uuOtvtkYNheg at public.gmane.org> wrote:
>
> Fellow bcm-users,
> 
> I have had this issue with my BCM4311 rev 01 for a couple of months 
> now.  It seems whenever I am connected to a wireless network
> supported by multiple APs with the same SSID (as is the case whenever
> I am at home or at school), b43 can't seem to tell which one to stay
> connected to and thus is continuously disconnecting and reconnecting
> over and over.  I have provided my dmesg output below, you can see
> every time the connection to an AP is lost and it tries to connect to
> a different one. If there is any other information that developers
> would need for me to provide in an attempt to get this resolved,
> please let me know.

I also have this problem (I think, and posted about it here a few days
ago), with my 4318--but mostly (only) when first trying to establish
the link. Although in my case, it only tries (miserably) to authenticate
with my correct AP. But the pattern and error messages are the same.
Lots of authentication attempts, even lots of actual "authenticatED"
messages, followed immediately by MORE authentication attempts and
"deauthenticated(reason=3)". And this repeats MANY times.

Although eventually it does connect; although dhcpcd usually has trouble
obtaining a lease after this, and I ended up putting it in a loop in a
"postfail" script. It's a mess! But it's a lot better than it was a
year ago ;).


From fback+bcm at fback.net  Mon Sep 29 12:20:58 2008
From: fback+bcm at fback.net (=?ISO-8859-1?Q?Bart=3Fomiej_Ochman?=)
Date: Mon, 29 Sep 2008 12:20:58 +0200
Subject: b43 on broadcom platform / openwrt
Message-ID: <48E0AC0A.3030202@fback.net>

Hello,

I'm testing b43 driver for about a month now, and I noticed strange
issue. The driver is set in AP mode, I'm using WPA-PSK with TKIP / AES
encryption, depending on a client.

When using intel wireless client, it works without any problems. I can
even watch the videos streamed from a remote server (utilizes c.a.
2,5Mbps throughput). But using Atheros client breaks something. After
some short time, the message:

test-gw user.err kernel: b43-phy0 ERROR: PHY transmission error

starts to appear in the logs every 10-15s. The worst thing is it depends
on toolchain (binutils and gcc) version used to build the stuff. With
newer toolchain (binutils 2.18 and gcc 4.2.x) nothing more seems to
happen, but with older toolchain (binutils 2.17 and gcc 4.1.x) the
kernel oopses shot after first message, and the driver becomes totally
unstable (and unusable). This happens with both windows and linux driver.

Do you have any idea, how to debug this further? I could help with this,
but I don't have much experience with kernel stuff.

Best Regards,
BO



From Larry.Finger at lwfinger.net  Mon Sep 29 20:31:58 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 29 Sep 2008 13:31:58 -0500
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
Message-ID: <48E11F1E.50705@lwfinger.net>

Michael,

I have started modifying my copy of b43 to see if I can locate any
coding problems that might be causing the PHY transmission errors. To
start with, I am checking all the sections that use udelay. The main
reason is that when a bug in the CPU timer cut all delays in half, I
got these errors in b43legacy. I also noted the report this morning
that compiler and toolchain versions seem to be important.

One of the first places I looked was in do_dummy_tx. When I checked
the spin-on-condition loops in this routine, I found that the 3rd
always used the maximum number of loops and exited before the
condition was met. I increased the number of possible loops from 10 to
20 and found that it always takes 17 or 18 passes for the condition to
be met on my machine.

The existing code matches specs - I even checked the code in
4.150.10.5. It is too early to tell if this has anything to do with
the errors, but I suggest the following change:

diff --git a/drivers/net/wireless/b43/main.c
b/drivers/net/wireless/b43/main.c
index 7205a93..af60122 100644
--- a/drivers/net/wireless/b43/main.c
+++ b/drivers/net/wireless/b43/main.c
@@ -814,7 +814,7 @@ void b43_dummy_transmission(struct b43_wldev *dev)
 			break;
 		udelay(10);
 	}
-	for (i = 0x00; i < 0x0A; i++) {
+	for (i = 0x00; i < 0x19; i++) {
 		value = b43_read16(dev, 0x0690);
 		if (!(value & 0x0100))
 			break;

Using 25 passes gives a little margin for CPUs that are much faster
than mine. Perhaps the margin should even be bigger.

Larry




From mb at bu3sch.de  Mon Sep 29 20:38:37 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 29 Sep 2008 20:38:37 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E11F1E.50705@lwfinger.net>
References: <48E11F1E.50705@lwfinger.net>
Message-ID: <200809292038.37939.mb@bu3sch.de>

On Monday 29 September 2008 20:31:58 Larry Finger wrote:
> Michael,
> 
> I have started modifying my copy of b43 to see if I can locate any
> coding problems that might be causing the PHY transmission errors. To
> start with, I am checking all the sections that use udelay. The main
> reason is that when a bug in the CPU timer cut all delays in half, I
> got these errors in b43legacy. I also noted the report this morning
> that compiler and toolchain versions seem to be important.
> 
> One of the first places I looked was in do_dummy_tx. When I checked
> the spin-on-condition loops in this routine, I found that the 3rd
> always used the maximum number of loops and exited before the
> condition was met. I increased the number of possible loops from 10 to
> 20 and found that it always takes 17 or 18 passes for the condition to
> be met on my machine.
> 
> The existing code matches specs - I even checked the code in
> 4.150.10.5. It is too early to tell if this has anything to do with
> the errors, but I suggest the following change:
> 
> diff --git a/drivers/net/wireless/b43/main.c
> b/drivers/net/wireless/b43/main.c
> index 7205a93..af60122 100644
> --- a/drivers/net/wireless/b43/main.c
> +++ b/drivers/net/wireless/b43/main.c
> @@ -814,7 +814,7 @@ void b43_dummy_transmission(struct b43_wldev *dev)
>  			break;
>  		udelay(10);
>  	}
> -	for (i = 0x00; i < 0x0A; i++) {
> +	for (i = 0x00; i < 0x19; i++) {
>  		value = b43_read16(dev, 0x0690);
>  		if (!(value & 0x0100))
>  			break;
> 
> Using 25 passes gives a little margin for CPUs that are much faster
> than mine. Perhaps the margin should even be bigger.


Yeah, feel free to submit this to John.
Dummy-tx _can_ for sure trigger PHY TX errors. I already saw that
in my experiments, too. It also makes sense, as dummy-tx is poking
with the lowlevel TX hardware.
So if a loop exists early it may leave TX hardware in an inconsistent state.

Actually, I do know since the very first days of bcm43xx that the
loop counts are not big enough in some of these loops. But I didn't
change it, as it was said the current counts match the specs.
However, I think it's perfectly valid to raise the values.
Please do so, thanks a lot.

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Mon Sep 29 21:19:29 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 29 Sep 2008 14:19:29 -0500
Subject: [PATCH] b43: Increase loop tries in do_dummy_tx
Message-ID: <48e12a41.fSr2FmkheZiPQYjZ%Larry.Finger@lwfinger.net>

One of the spin-on-condition loops in routine do_dummy_tx always exits before
the condition is satisfied. The hardware might be left in an inconsistent
state that might be the cause of the PHY transmission errors seen by some
users.

Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>
---

John,

This is 2.6.28 material.

Larry
---

diff --git a/drivers/net/wireless/b43/main.c b/drivers/net/wireless/b43/main.c
index 7205a93..af60122 100644
--- a/drivers/net/wireless/b43/main.c
+++ b/drivers/net/wireless/b43/main.c
@@ -814,7 +814,7 @@ void b43_dummy_transmission(struct b43_wldev *dev)
 			break;
 		udelay(10);
 	}
-	for (i = 0x00; i < 0x0A; i++) {
+	for (i = 0x00; i < 0x19; i++) {
 		value = b43_read16(dev, 0x0690);
 		if (!(value & 0x0100))
 			break;



From mb at bu3sch.de  Mon Sep 29 21:51:12 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Mon, 29 Sep 2008 21:51:12 +0200
Subject: [PATCH] b43: Increase loop tries in do_dummy_tx
In-Reply-To: <48e12a41.fSr2FmkheZiPQYjZ%Larry.Finger@lwfinger.net>
References: <48e12a41.fSr2FmkheZiPQYjZ%Larry.Finger@lwfinger.net>
Message-ID: <200809292151.12279.mb@bu3sch.de>

On Monday 29 September 2008 21:19:29 Larry Finger wrote:
> One of the spin-on-condition loops in routine do_dummy_tx always exits before
> the condition is satisfied. The hardware might be left in an inconsistent
> state that might be the cause of the PHY transmission errors seen by some
> users.
> 
> Signed-off-by: Larry Finger <Larry.Finger at lwfinger.net>

Signed-off-by: Michael Buesch <mb at bu3sch.de>

> ---
> 
> John,
> 
> This is 2.6.28 material.
> 
> Larry
> ---
> 
> diff --git a/drivers/net/wireless/b43/main.c b/drivers/net/wireless/b43/main.c
> index 7205a93..af60122 100644
> --- a/drivers/net/wireless/b43/main.c
> +++ b/drivers/net/wireless/b43/main.c
> @@ -814,7 +814,7 @@ void b43_dummy_transmission(struct b43_wldev *dev)
>  			break;
>  		udelay(10);
>  	}
> -	for (i = 0x00; i < 0x0A; i++) {
> +	for (i = 0x00; i < 0x19; i++) {
>  		value = b43_read16(dev, 0x0690);
>  		if (!(value & 0x0100))
>  			break;

-- 
Greetings Michael.


From Larry.Finger at lwfinger.net  Mon Sep 29 22:40:22 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 29 Sep 2008 15:40:22 -0500
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E137AF.6060602@fback.net>
References: <48E11F1E.50705@lwfinger.net> <48E137AF.6060602@fback.net>
Message-ID: <48E13D36.50706@lwfinger.net>

Bart?omiej Ochman wrote:
> 
> Beside this, the driver compiled with newer toolchain doesn't break, I
> can watch streamed video as before. Do you want me to test it with "old"
> toolchain, or it's pointless?

I think I misunderstood your previous message. Did you mean that you
get the PHY transmission errors no matter which toolchain you use, but
that the driver only works with the newer toolchain? If that is true,
then you don't need to test with the older one. My assumption would be
that someone fixed a bug in those tools.

Larry



From netrolller.3d at gmail.com  Mon Sep 29 22:44:38 2008
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?Stefanik_G=E1bor?=)
Date: Mon, 29 Sep 2008 22:44:38 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E13D36.50706@lwfinger.net>
References: <48E11F1E.50705@lwfinger.net> <48E137AF.6060602@fback.net>
	<48E13D36.50706@lwfinger.net>
Message-ID: <69e28c910809291344t5946399ahef298912d347f89e@mail.gmail.com>

On Mon, Sep 29, 2008 at 10:40 PM, Larry Finger
<Larry.Finger at lwfinger.net> wrote:
> Bart?omiej Ochman wrote:
>>
>> Beside this, the driver compiled with newer toolchain doesn't break, I
>> can watch streamed video as before. Do you want me to test it with "old"
>> toolchain, or it's pointless?
>
> I think I misunderstood your previous message. Did you mean that you
> get the PHY transmission errors no matter which toolchain you use, but
> that the driver only works with the newer toolchain? If that is true,
> then you don't need to test with the older one. My assumption would be
> that someone fixed a bug in those tools.
>
> Larry

Wrong thread?

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)

From peter at stuge.se  Mon Sep 29 23:16:20 2008
From: peter at stuge.se (Peter Stuge)
Date: Mon, 29 Sep 2008 23:16:20 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <200809292038.37939.mb@bu3sch.de>
References: <48E11F1E.50705@lwfinger.net> <200809292038.37939.mb@bu3sch.de>
Message-ID: <20080929211620.6344.qmail@stuge.se>

Michael Buesch wrote:
> Actually, I do know since the very first days of bcm43xx that the
> loop counts are not big enough in some of these loops.

Would it make sense to double check the conditions after the loop?


> But I didn't change it, as it was said the current counts match the
> specs.

Which specs?


//Peter


From Larry.Finger at lwfinger.net  Mon Sep 29 23:28:25 2008
From: Larry.Finger at lwfinger.net (Larry Finger)
Date: Mon, 29 Sep 2008 16:28:25 -0500
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <20080929211620.6344.qmail@stuge.se>
References: <48E11F1E.50705@lwfinger.net> <200809292038.37939.mb@bu3sch.de>
	<20080929211620.6344.qmail@stuge.se>
Message-ID: <48E14879.4050300@lwfinger.net>

Peter Stuge wrote:
> 
> Which specs?

The ones generated by the reverse engineers. See
http://bcm-v4.sipsolutions.net/.

Larry


From peter at stuge.se  Tue Sep 30 04:52:08 2008
From: peter at stuge.se (Peter Stuge)
Date: Tue, 30 Sep 2008 04:52:08 +0200
Subject: Multiple station interfaces
In-Reply-To: <20080923193519.51414820.celejar@gmail.com>
References: <20080923193519.51414820.celejar@gmail.com>
Message-ID: <20080930025208.11240.qmail@stuge.se>

Celejar wrote:
> simultaneously associate with two different APs

They would at least have to be on the same channel - or I think you
would need double radios and hardware tricks?


//Peter


From peter at stuge.se  Tue Sep 30 07:50:34 2008
From: peter at stuge.se (Peter Stuge)
Date: Tue, 30 Sep 2008 07:50:34 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E14879.4050300@lwfinger.net>
References: <48E11F1E.50705@lwfinger.net> <200809292038.37939.mb@bu3sch.de>
	<20080929211620.6344.qmail@stuge.se>
	<48E14879.4050300@lwfinger.net>
Message-ID: <20080930055034.16412.qmail@stuge.se>

Larry Finger wrote:
> > Which specs?
> 
> The ones generated by the reverse engineers. See
> http://bcm-v4.sipsolutions.net/.

Nice work, but as it's a spec of another driver implementation rather
than hardware (or even the firmware API) I don't think it should be
so authoritative. If other values are clearly better why not use
them?


//Peter


From mb at bu3sch.de  Tue Sep 30 15:26:11 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 15:26:11 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <20080929211620.6344.qmail@stuge.se>
References: <48E11F1E.50705@lwfinger.net> <200809292038.37939.mb@bu3sch.de>
	<20080929211620.6344.qmail@stuge.se>
Message-ID: <200809301526.11519.mb@bu3sch.de>

On Monday 29 September 2008 23:16:20 Peter Stuge wrote:
> Michael Buesch wrote:
> > Actually, I do know since the very first days of bcm43xx that the
> > loop counts are not big enough in some of these loops.
> 
> Would it make sense to double check the conditions after the loop?

No it wouldn't. Accessing the registers has side-effects.

> > But I didn't change it, as it was said the current counts match the
> > specs.
> 
> Which specs?

Our specs?

-- 
Greetings Michael.


From mb at bu3sch.de  Tue Sep 30 15:27:28 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 15:27:28 +0200
Subject: Multiple station interfaces
In-Reply-To: <20080930025208.11240.qmail@stuge.se>
References: <20080923193519.51414820.celejar@gmail.com>
	<20080930025208.11240.qmail@stuge.se>
Message-ID: <200809301527.28730.mb@bu3sch.de>

On Tuesday 30 September 2008 04:52:08 Peter Stuge wrote:
> Celejar wrote:
> > simultaneously associate with two different APs
> 
> They would at least have to be on the same channel - or I think you
> would need double radios and hardware tricks?

Well, you can use PS tricks (put STA into PS mode while listening
on another channel). I don't know if anybody ever tried it, however.

-- 
Greetings Michael.


From mb at bu3sch.de  Tue Sep 30 15:28:26 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 15:28:26 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <20080930055034.16412.qmail@stuge.se>
References: <48E11F1E.50705@lwfinger.net> <48E14879.4050300@lwfinger.net>
	<20080930055034.16412.qmail@stuge.se>
Message-ID: <200809301528.26304.mb@bu3sch.de>

On Tuesday 30 September 2008 07:50:34 Peter Stuge wrote:
> Larry Finger wrote:
> > > Which specs?
> > 
> > The ones generated by the reverse engineers. See
> > http://bcm-v4.sipsolutions.net/.
> 
> Nice work, but as it's a spec of another driver implementation rather
> than hardware (or even the firmware API) I don't think it should be
> so authoritative. If other values are clearly better why not use
> them?

What crap are you smoking?
The b43 and b43-legacy driver are _based_ on these specifications.
There are no other specs available.

-- 
Greetings Michael.


From gavron at wetwork.net  Tue Sep 30 15:46:04 2008
From: gavron at wetwork.net (gavron at wetwork.net)
Date: Tue, 30 Sep 2008 06:46:04 -0700
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <200809301528.26304.mb@bu3sch.de>
References: <48E11F1E.50705@lwfinger.net> <48E14879.4050300@lwfinger.net>
	<20080930055034.16412.qmail@stuge.se> <200809301528.26304.mb@bu3sch.de>
Message-ID: <48E22D9C.9090404@wetwork.net>



Michael Buesch wrote:
> On Tuesday 30 September 2008 07:50:34 Peter Stuge wrote:
>   
>> Larry Finger wrote:
>>     
>>>> Which specs?
>>>>         
>>> The ones generated by the reverse engineers. See
>>> http://bcm-v4.sipsolutions.net/.
>>>       
>> Nice work, but as it's a spec of another driver implementation rather
>> than hardware (or even the firmware API) I don't think it should be
>> so authoritative. If other values are clearly better why not use
>> them?
>>     
>
> What crap are you smoking?
> The b43 and b43-legacy driver are _based_ on these specifications.
> There are no other specs available.
>
>   
If I understand him correctly he's suggesting that there could be BETTER 
values than those used by the reference driver.  In other words, yes, 
B43/B43-Legacy are based on the RE of the Windows driver but perhaps 
there are better values that improve behavior beyond that of the 
original driver.

He didn't say the following but I will: It's also true that there are 
edge cases that RE won't catch without repeated arduous testing in 
adverse conditions, and there may be code in the reference driver that 
will therefore won't end up in the specs.  This means that behavioral 
improvements and/or performance gains in B43/B43-Legacy that can be 
gained without getting into those edge cases are worthy of consideration 
(or maybe specially labeled code).

Just my two farthings worth.

E

-- 
Legal Disclaimer that you are now contractually bound to under all laws with no recourse:
http://attrition.org/security/rants/z/disclaimers.html



From mb at bu3sch.de  Tue Sep 30 15:54:55 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 15:54:55 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E22D9C.9090404@wetwork.net>
References: <48E11F1E.50705@lwfinger.net> <200809301528.26304.mb@bu3sch.de>
	<48E22D9C.9090404@wetwork.net>
Message-ID: <200809301554.56361.mb@bu3sch.de>

On Tuesday 30 September 2008 15:46:04 gavron at wetwork.net wrote:
> If I understand him correctly he's suggesting that there could be BETTER 
> values than those used by the reference driver.  In other words, yes, 
> B43/B43-Legacy are based on the RE of the Windows driver but perhaps 
> there are better values that improve behavior beyond that of the 
> original driver.

I doubt that very much. I think it's as simple as the udelay of the original
driver taking 1.2 microseconds and ours taking only 1.05 microseconds.
Both udelay implementations are valid, but ours uncovers the hidden bug.

-- 
Greetings Michael.


From hs4233 at mail.mn-solutions.de  Tue Sep 30 16:11:18 2008
From: hs4233 at mail.mn-solutions.de (Holger Schurig)
Date: Tue, 30 Sep 2008 16:11:18 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <200809301528.26304.mb@bu3sch.de>
References: <48E11F1E.50705@lwfinger.net> <20080930055034.16412.qmail@stuge.se>
	<200809301528.26304.mb@bu3sch.de>
Message-ID: <200809301611.19035.hs4233@mail.mn-solutions.de>

> The b43 and b43-legacy driver are _based_ on these
> specifications. There are no other specs available.

Can it be the case that the binary windows driver the spec 
producer analyzed used a different PCI settings?  And that 
therefore the delays/access-patterns in the binary driver work 
as expected *in their environment*, but that Linux might have 
programmed the PCI bus/controller differently and that therefore 
the identical approach fails (sometimes) ???


From peter at stuge.se  Tue Sep 30 16:13:53 2008
From: peter at stuge.se (Peter Stuge)
Date: Tue, 30 Sep 2008 16:13:53 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <200809301528.26304.mb@bu3sch.de>
References: <48E11F1E.50705@lwfinger.net> <48E14879.4050300@lwfinger.net>
	<20080930055034.16412.qmail@stuge.se>
	<200809301528.26304.mb@bu3sch.de>
Message-ID: <20080930141353.16996.qmail@stuge.se>

Michael Buesch wrote:
> > Nice work, but as it's a spec of another driver implementation rather
> > than hardware (or even the firmware API) I don't think it should be
> > so authoritative. If other values are clearly better why not use
> > them?
> 
> What crap are you smoking?

Maybe we just miscommunicated, or maybe I misunderstood something
about the reverse engineering process. I am very new to this project.


> The b43 and b43-legacy driver are _based_ on these specifications.
> There are no other specs available.

I know. Allow me to clarify my train of thought:

* Specs are created by reverse engineering of a binary blob.

* After development of b43*, many can happily use the drivers. \o/

* As it turns out, b43* can be made even more reliable by doing
  things slightly different than what the specs say. Case in point
  looping a little longer.

At this point, if there are only/mostly benefits, I don't see why
deviating from the specs is bad - after all they "only" document
another driver, right?


//Peter


From mb at bu3sch.de  Tue Sep 30 16:21:30 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 16:21:30 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <20080930141353.16996.qmail@stuge.se>
References: <48E11F1E.50705@lwfinger.net> <200809301528.26304.mb@bu3sch.de>
	<20080930141353.16996.qmail@stuge.se>
Message-ID: <200809301621.30913.mb@bu3sch.de>

On Tuesday 30 September 2008 16:13:53 Peter Stuge wrote:
> At this point, if there are only/mostly benefits, I don't see why
> deviating from the specs is bad - after all they "only" document
> another driver, right?

The past taught us that deviations from the specs are almost certainly
hidden bugs somewhere else. We had that dozens of times.
In this case, however, I think it's not the case.

-- 
Greetings Michael.


From mb at bu3sch.de  Tue Sep 30 16:22:25 2008
From: mb at bu3sch.de (Michael Buesch)
Date: Tue, 30 Sep 2008 16:22:25 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <200809301611.19035.hs4233@mail.mn-solutions.de>
References: <48E11F1E.50705@lwfinger.net> <200809301528.26304.mb@bu3sch.de>
	<200809301611.19035.hs4233@mail.mn-solutions.de>
Message-ID: <200809301622.26024.mb@bu3sch.de>

On Tuesday 30 September 2008 16:11:18 Holger Schurig wrote:
> > The b43 and b43-legacy driver are _based_ on these
> > specifications. There are no other specs available.
> 
> Can it be the case that the binary windows driver the spec 

They didn't use a windows driver.

> producer analyzed used a different PCI settings?  And that 
> therefore the delays/access-patterns in the binary driver work 
> as expected *in their environment*, but that Linux might have 
> programmed the PCI bus/controller differently and that therefore 
> the identical approach fails (sometimes) ???

Unlikely.

-- 
Greetings Michael.


From artem.v.antonov at gmail.com  Tue Sep 30 18:34:04 2008
From: artem.v.antonov at gmail.com (Artem Antonov)
Date: Tue, 30 Sep 2008 20:34:04 +0400
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <48E11F1E.50705@lwfinger.net>
References: <48E11F1E.50705@lwfinger.net>
Message-ID: <6bc534830809300934w13e88af0me7e19bd287f17af7@mail.gmail.com>

I've tested it with my bcm4318(asus wl-500gP). But there are still PHY
transmission errors. So there should be some more reasons of these
errors :)

Best regards/

2008/9/29, Larry Finger <Larry.Finger at lwfinger.net>:
> Michael,
>
..........


From netrolller.3d at gmail.com  Tue Sep 30 22:02:25 2008
From: netrolller.3d at gmail.com (=?ISO-8859-1?Q?Stefanik_G=E1bor?=)
Date: Tue, 30 Sep 2008 22:02:25 +0200
Subject: [RFC/T] b43: to few loop tries in do_dummy_tx
In-Reply-To: <6bc534830809300934w13e88af0me7e19bd287f17af7@mail.gmail.com>
References: <48E11F1E.50705@lwfinger.net>
	<6bc534830809300934w13e88af0me7e19bd287f17af7@mail.gmail.com>
Message-ID: <69e28c910809301302w48b3d982r5ddac62e459a1ca8@mail.gmail.com>

On Tue, Sep 30, 2008 at 6:34 PM, Artem Antonov
<artem.v.antonov at gmail.com> wrote:
> I've tested it with my bcm4318(asus wl-500gP). But there are still PHY
> transmission errors. So there should be some more reasons of these
> errors :)
>
> Best regards/

It would be good to know whether the Windows driver also suffers from
PHY transmission errors... The "hybrid" Linux driver likely does have
them, possibly even more than us, judging from its poor performance.

-- 
Vista: [V]iruses, [I]ntruders, [S]pyware, [T]rojans and [A]dware. :-)


