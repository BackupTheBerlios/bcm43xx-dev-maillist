<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Cannot get BCM94311MCG working against 2.6.24-rc5
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/bcm43xx-dev/2007-December/index.html" >
   <LINK REL="made" HREF="mailto:bcm43xx-dev%40lists.berlios.de?Subject=Re%3A%20Cannot%20get%20BCM94311MCG%20working%20against%202.6.24-rc5&In-Reply-To=%3C476D567D.3020401%40lwfinger.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003117.html">
   <LINK REL="Next"  HREF="003128.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Cannot get BCM94311MCG working against 2.6.24-rc5</H1>
    <B>Larry Finger</B> 
    <A HREF="mailto:bcm43xx-dev%40lists.berlios.de?Subject=Re%3A%20Cannot%20get%20BCM94311MCG%20working%20against%202.6.24-rc5&In-Reply-To=%3C476D567D.3020401%40lwfinger.net%3E"
       TITLE="Cannot get BCM94311MCG working against 2.6.24-rc5">larry.finger at lwfinger.net
       </A><BR>
    <I>Sat Dec 22 19:25:01 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003117.html">Cannot get BCM94311MCG working against 2.6.24-rc5
</A></li>
        <LI>Next message: <A HREF="003128.html">Cannot get BCM94311MCG working against 2.6.24-rc5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3118">[ date ]</a>
              <a href="thread.html#3118">[ thread ]</a>
              <a href="subject.html#3118">[ subject ]</a>
              <a href="author.html#3118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>sarcarsh wrote:
&gt;<i> [I had sent this email a few minutes back from an unsubscribed id,
</I>&gt;<i> apologies if you are getting this twice]
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am trying out Linux on my Dell D620 which has BCM94311MCG wlan card.
</I>&gt;<i> 
</I>&gt;<i> lspci gives:
</I>&gt;<i> 0c:00.0 Network controller: Broadcom Corporation BCM94311MCG wlan
</I>&gt;<i> mini-PCI (rev 01)
</I>&gt;<i> 
</I>&gt;<i> I installed Ubuntu 7.10 and while this would not wor out-of-the-box,
</I>&gt;<i> with the help of the restricted-driver-manager my WLAN works fine with
</I>&gt;<i> the 2.6.22-14 stock kernel.
</I>&gt;<i> 
</I>&gt;<i> I downloaded and compiled the 2.6.24-rc5 kernel. The kernel compiled and
</I>&gt;<i>   I can boot into it and perform *most* operations. But my WLAN wont work.
</I>&gt;<i> I have been reading on the net and trying to form a picture of the
</I>&gt;<i> BCM43xx chipsets, their history of vendor-no-cooperation with Linux and
</I>&gt;<i> what people have done to bypass that.
</I>&gt;<i> 
</I>&gt;<i> My understanding is that this card has the BCM4311 chipset which is
</I>&gt;<i> supported directly by the kernel on the 2.6.24-rc line. I was expecting
</I>&gt;<i> this to be the case since I thought I compiled the kernel with the
</I>&gt;<i> BCM43xx options &quot;on&quot;. Here's a snip:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">shouryas at rush</A>:~/fed$ grep BCM /boot/config-2.6.24-rc5
</I>&gt;<i> CONFIG_BT_HCIBCM203X=m
</I>&gt;<i> CONFIG_BCM43XX=m
</I>&gt;<i> CONFIG_BCM43XX_DEBUG=y
</I>&gt;<i> CONFIG_BCM43XX_DMA=y
</I>&gt;<i> CONFIG_BCM43XX_PIO=y
</I>&gt;<i> CONFIG_BCM43XX_DMA_AND_PIO_MODE=y
</I>&gt;<i> # CONFIG_BCM43XX_DMA_MODE is not set
</I>&gt;<i> # CONFIG_BCM43XX_PIO_MODE is not set
</I>&gt;<i> CONFIG_DVB_BCM3510=m
</I>&gt;<i> 
</I>&gt;<i> When I do an lsmod, I see..
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">shouryas at rush</A>:~$ lsmod | grep -i bcm
</I>&gt;<i> bcm43xx               433312  0
</I>&gt;<i> ieee80211softmac       34944  1 bcm43xx
</I>&gt;<i> ieee80211              49900  2 bcm43xx,ieee80211softmac
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I tried the ndiswrapper, by following the instructions on the Ubuntu
</I>&gt;<i> site (I even re-compiled ndiswrapper-1.51)
</I>&gt;<i> <A HREF="https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx/Feisty_No-Fluff#head-c8cbba1734885284e4f79c2054461c863169f1bf">https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx/Feisty_No-Fluff#head-c8cbba1734885284e4f79c2054461c863169f1bf</A>
</I>&gt;<i> but, no it won't work :-(
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I found some good info on the Gnome Network-Manager list here:
</I>&gt;<i> <A HREF="http://www.nabble.com/My-Laptop-td14293457.html">http://www.nabble.com/My-Laptop-td14293457.html</A>
</I>&gt;<i> 
</I>&gt;<i> So I tried unloading the bcm43xx module(s), and uninstall the XP driver
</I>&gt;<i> wrapped via ndiswrapper and then load b43 directly. But I get an error.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# rmmod bcm43xx
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# ndiswrapper -l
</I>&gt;<i> bcmwl5 : driver installed
</I>&gt;<i>          device (14E4:4311) present (alternate driver: ssb)
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# ndiswrapper -e bcmwl5
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# ndiswrapper -l
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# modprobe b43
</I>&gt;<i> FATAL: Error inserting b43
</I>&gt;<i> (/lib/modules/2.6.24-rc5/kernel/drivers/net/wireless/b43/b43.ko):
</I>&gt;<i> Unknown symbol in module, or unknown parameter (see dmesg)
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/home/shouryas# dmesg  /* giving the relvant snip here */
</I>&gt;<i> [ 6086.380829] b43: Unknown symbol ssb_bus_pcmciabus_register
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --[At this point I apologize for this too-long email, I am trying to
</I>&gt;<i> make some headway myself and documenting my observations]--
</I>&gt;<i> I tried to see who should export the symbol ssb_bus_pcmciabus_register
</I>&gt;<i> Expectedly, no one does
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/proc# cat kallsyms | grep pcmcia | grep ssb
</I>&gt;<i> yields nothing.
</I>&gt;<i> 
</I>&gt;<i> So, I tried to look into the source:
</I>&gt;<i> Around line 656 of /home/shouryas/kernels/my2.6/drivers/ssb/main.c
</I>&gt;<i> #ifdef CONFIG_SSB_PCMCIAHOST
</I>&gt;<i> int ssb_bus_pcmciabus_register(struct ssb_bus *bus,
</I>&gt;<i>                                 struct pcmcia_device *pcmcia_dev,
</I>&gt;<i>                                 unsigned long baseaddr)
</I>&gt;<i> {
</I>&gt;<i>          int err;
</I>&gt;<i> 
</I>&gt;<i>          bus-&gt;bustype = SSB_BUSTYPE_PCMCIA;
</I>&gt;<i>          bus-&gt;host_pcmcia = pcmcia_dev;
</I>&gt;<i>          bus-&gt;ops = &amp;ssb_pcmcia_ops;
</I>&gt;<i> 
</I>&gt;<i>          err = ssb_bus_register(bus, ssb_pcmcia_get_invariants, baseaddr);
</I>&gt;<i>          if (!err) {
</I>&gt;<i>                  ssb_printk(KERN_INFO PFX &quot;Sonics Silicon Backplane
</I>&gt;<i> found on &quot;
</I>&gt;<i>                             &quot;PCMCIA device %s\n&quot;, pcmcia_dev-&gt;devname);
</I>&gt;<i>          }
</I>&gt;<i> 
</I>&gt;<i>          return err;
</I>&gt;<i> }
</I>&gt;<i> EXPORT_SYMBOL(ssb_bus_pcmciabus_register);
</I>&gt;<i> #endif /* CONFIG_SSB_PCMCIAHOST */
</I>&gt;<i> 
</I>&gt;<i> I looked into my config file to see if CONFIG_SSB_PCMCIAHOST is defined.
</I>&gt;<i> It is !
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">root at rush</A>:/proc# cat /boot/config | grep SSB
</I>&gt;<i> CONFIG_SSB_POSSIBLE=y
</I>&gt;<i> CONFIG_SSB=m
</I>&gt;<i> CONFIG_SSB_PCIHOST_POSSIBLE=y
</I>&gt;<i> CONFIG_SSB_PCIHOST=y
</I>&gt;<i> CONFIG_SSB_PCMCIAHOST_POSSIBLE=y
</I>&gt;<i> CONFIG_SSB_PCMCIAHOST=y
</I>&gt;<i> # CONFIG_SSB_SILENT is not set
</I>&gt;<i> # CONFIG_SSB_DEBUG is not set
</I>&gt;<i> CONFIG_SSB_DRIVER_PCICORE_POSSIBLE=y
</I>&gt;<i> CONFIG_SSB_DRIVER_PCICORE=y
</I>&gt;<i> # CONFIG_USB_OHCI_HCD_SSB is not set
</I>&gt;<i> 
</I>&gt;<i> Also, I looked into dmesg, and see the line
</I>&gt;<i> [   14.635610] ssb: Sonics Silicon Backplane found on PCI device
</I>&gt;<i> 0000:0c:00.0
</I>&gt;<i> 
</I>&gt;<i> So, it seems that SSB_CONFIG_PCMCIA is defined (and no error in SSB 
</I>&gt;<i> detection hoepfully) but then why is the
</I>&gt;<i> symbol not exported ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I would appreciate if you somebody could provide me some hints to where
</I>&gt;<i> to go and look for the problem. Maybe you can solve this immediately but
</I>&gt;<i> still I'd appreciate only hints so that I can play at least some part in
</I>&gt;<i>   resolving the situation.
</I>&gt;<i> 
</I>&gt;<i> I'd be happy to provide more info from my system.
</I>
You are making a number of mistakes. The biggest one is to try to use bcm43xx or b43 with
ndiswrapper. THEY ARE MUTUALLY EXCLUSIVE. If you want to use ndiswrapper, then we cannot help you.

A second minor mistake is to try to use bcm43xx when b43 is available. The actual hardware handling
is not that different; however, the MAC implementation in b43 (mac80211) is vastly superior to that
in bcm43xx (SoftMAC).

Please rebuild your 2.6.24-rc5 with bcm43xx disabled, but with ssb, mac80211 and b43 enabled. Please
enable ssb and b43 debugging. After the new kernel is built, installed and booted, check the output
of the following commands:

iwconfig
ifconfig

If ifconfig does not show eth1 or wlan1 (whatever your device is named) to be UP, then issue an
'ifup eth1' command, then

dmesg | grep ssb
dmesg | grep b43

Fix whatever problems that you can, then post the output of the last two.

Larry

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003117.html">Cannot get BCM94311MCG working against 2.6.24-rc5
</A></li>
	<LI>Next message: <A HREF="003128.html">Cannot get BCM94311MCG working against 2.6.24-rc5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3118">[ date ]</a>
              <a href="thread.html#3118">[ thread ]</a>
              <a href="subject.html#3118">[ subject ]</a>
              <a href="author.html#3118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/bcm43xx-dev">More information about the Bcm43xx-dev
mailing list</a><br>
</body></html>
